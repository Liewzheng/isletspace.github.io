<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"islet.space","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="以下所有对寄存器的描述均来自于《ADSP-214xx SHARC Processor Hardware Reference》，后简称《HWR》。 本笔记主要是针对芯片 ADSP21479 寄存器（PLL、SDRAM、SRU、中断等）进行总结和记录。 [TOC] Register Preview 位类型和操作 许多寄存器旁边都会标注位类型和操作方法，位类型包括 可读可写（RW）、只读（RO）、只读清">
<meta property="og:type" content="article">
<meta property="og:title" content="ADSP21479 寄存器解读">
<meta property="og:url" content="http://islet.space/2021/05/25/Hardware/DSP/2021-05-25-ADSP21479%20%E5%AF%84%E5%AD%98%E5%99%A8%E8%A7%A3%E8%AF%BB/index.html">
<meta property="og:site_name" content="Coder的孤岛">
<meta property="og:description" content="以下所有对寄存器的描述均来自于《ADSP-214xx SHARC Processor Hardware Reference》，后简称《HWR》。 本笔记主要是针对芯片 ADSP21479 寄存器（PLL、SDRAM、SRU、中断等）进行总结和记录。 [TOC] Register Preview 位类型和操作 许多寄存器旁边都会标注位类型和操作方法，位类型包括 可读可写（RW）、只读（RO）、只读清">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210528141056.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210528141255.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210602171620.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210529114430.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527170843.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527171222.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527171224.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527171227.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527172018.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527172024.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527172027.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527172029.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210528140307.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527095059.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210607103819.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210607103750.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525135455.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525135457.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525143535.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525143532.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525143531.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525143542.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603153454.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603153720.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603153724.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525144902.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525144904.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603152241.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603152239.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603152242.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525163021.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525164025.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525164028.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525164217.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525150124.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525164016.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525161210.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527133602.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603140236.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527100924.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527133611.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527102109.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527102114.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603170450.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527102916.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527133616.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603144929.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603172309.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603172312.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603145741.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527133619.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527105334.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210608103432.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527150918.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527151117.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527151120.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527151124.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527152316.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527152313.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527152318.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210527152322.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210529113458.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210529113406.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210529113238.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210529113241.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210529113244.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210602150124.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603134601.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210603134603.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210602155414.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210602195334432.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210602200433030.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210602205507981.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629151248.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629151016.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629162516.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629162554.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629162731.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172559.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172604.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172610.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172614.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172619.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172625.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172628.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630162335568.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630162415539.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630162442482.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630162505383.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630162916913.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630163319226.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630163357041.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630163451919.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/format,f_auto.jpeg">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630135714198.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630135800538.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/image-20210630135821665.png">
<meta property="og:image" content="https://pic.islet.space/2021/07/image-20210701013537361.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172133.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210629172128.png">
<meta property="og:image" content="https://pic.islet.space/2021/05/20210525153905.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210607155909.png">
<meta property="og:image" content="https://pic.islet.space/2021/06/20210607163901.png">
<meta property="article:published_time" content="2021-05-25T06:00:00.000Z">
<meta property="article:modified_time" content="2021-07-08T14:41:04.498Z">
<meta property="article:author" content="Liewzheng">
<meta property="article:tag" content="ADI">
<meta property="article:tag" content="21479">
<meta property="article:tag" content="register">
<meta property="article:tag" content="21478">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.islet.space/2021/05/20210528141056.png">


<link rel="canonical" href="http://islet.space/2021/05/25/Hardware/DSP/2021-05-25-ADSP21479%20%E5%AF%84%E5%AD%98%E5%99%A8%E8%A7%A3%E8%AF%BB/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://islet.space/2021/05/25/Hardware/DSP/2021-05-25-ADSP21479%20%E5%AF%84%E5%AD%98%E5%99%A8%E8%A7%A3%E8%AF%BB/","path":"2021/05/25/Hardware/DSP/2021-05-25-ADSP21479 寄存器解读/","title":"ADSP21479 寄存器解读"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ADSP21479 寄存器解读 | Coder的孤岛</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Coder的孤岛</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">islet of the coder</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-文章"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章</a></li>
        <li class="menu-item menu-item-目录"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>目录</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-简历"><a href="/resume/" rel="section"><i class="fa fa-address-card fa-fw"></i>简历</a></li>
        <li class="menu-item menu-item-友链"><a href="/friends/" rel="section"><i class="fa fa-group fa-fw"></i>友链</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#register-preview"><span class="nav-number">1.</span> <span class="nav-text">Register Preview</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8D%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%93%8D%E4%BD%9C"><span class="nav-number">1.1.</span> <span class="nav-text">位类型和操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6-%E5%A4%96%E5%9B%B4%E8%AE%BE%E5%A4%87%E5%8F%8A%E5%AF%84%E5%AD%98%E5%99%A8%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="nav-number">1.2.</span> <span class="nav-text">头文件-外围设备及寄存器宏定义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#def21479.h"><span class="nav-number">1.2.1.</span> <span class="nav-text">DEF21479.H</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cdef21479.h"><span class="nav-number">1.2.2.</span> <span class="nav-text">CDEF21479.H</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#reset-register"><span class="nav-number">2.</span> <span class="nav-text">Reset Register</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E7%BC%96%E7%A8%8B%E4%B8%AD%E6%96%AD%E4%BC%98%E5%85%88%E7%BA%A7%E6%8E%A7%E5%88%B6%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">3.</span> <span class="nav-text">可编程中断优先级控制寄存器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E4%BF%A1%E5%8F%B7%E6%8E%A7%E5%88%B6%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">4.</span> <span class="nav-text">目标信号控制寄存器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#twi-in-master-tx"><span class="nav-number">5.</span> <span class="nav-text">TWI IN MASTER-TX</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#twi-register"><span class="nav-number">5.1.</span> <span class="nav-text">TWI Register</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#twimitr"><span class="nav-number">5.1.1.</span> <span class="nav-text">TWIMITR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#twidiv"><span class="nav-number">5.1.2.</span> <span class="nav-text">TWIDIV</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#twimctl"><span class="nav-number">5.1.3.</span> <span class="nav-text">TWIMCTL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#twimaddr"><span class="nav-number">5.1.4.</span> <span class="nav-text">TWIMADDR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#twimstat"><span class="nav-number">5.1.5.</span> <span class="nav-text">TWIMSTAT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#twififoctl"><span class="nav-number">5.1.6.</span> <span class="nav-text">TWIFIFOCTL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#twififostat"><span class="nav-number">5.1.7.</span> <span class="nav-text">TWIFIFOSTAT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#twiirptl"><span class="nav-number">5.1.8.</span> <span class="nav-text">TWIIRPTL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#twitxint"><span class="nav-number">5.1.8.1.</span> <span class="nav-text">TWITXINT</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#twitxint-interrupt"><span class="nav-number">5.1.8.1.1.</span> <span class="nav-text">TWITXINT interrupt</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#twiimask"><span class="nav-number">5.1.9.</span> <span class="nav-text">TWIIMASK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#txtwi8"><span class="nav-number">5.1.10.</span> <span class="nav-text">TXTWI8</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E7%A8%8B"><span class="nav-number">5.1.11.</span> <span class="nav-text">例程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E5%AF%84%E5%AD%98%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B0"><span class="nav-number">5.1.11.1.</span> <span class="nav-text">主寄存器初始化函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E6%80%A7-features"><span class="nav-number">5.2.</span> <span class="nav-text">特性 Features</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%92%88%E8%84%9A%E6%8F%8F%E8%BF%B0-pin-descriptions"><span class="nav-number">5.3.</span> <span class="nav-text">针脚描述 Pin Descriptions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sru%E7%BC%96%E7%A8%8B-sru-programming"><span class="nav-number">5.4.</span> <span class="nav-text">SRU编程 SRU Programming</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%92%9F%E9%A2%91%E7%8E%87-clocking"><span class="nav-number">5.5.</span> <span class="nav-text">时钟频率 Clocking</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0-functional-description"><span class="nav-number">5.6.</span> <span class="nav-text">功能描述 Functional Description</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%92%9F%E8%BE%93%E5%87%BA"><span class="nav-number">5.6.1.</span> <span class="nav-text">时钟输出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BA%BF%E4%BB%B2%E8%A3%81-bus-arbitration"><span class="nav-number">5.6.2.</span> <span class="nav-text">总线仲裁 Bus Arbitration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E4%B8%8E%E7%BB%93%E6%9D%9F%E6%83%85%E6%99%AF-start-stop-condition"><span class="nav-number">5.6.3.</span> <span class="nav-text">开始与结束情景 Start &amp; Stop condition</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%BC%8F-operating-modes"><span class="nav-number">5.7.</span> <span class="nav-text">操作模式 Operating Modes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E5%91%BC%E5%8F%AB%E5%AF%BB%E5%9D%80-general-call-addressing"><span class="nav-number">5.7.1.</span> <span class="nav-text">通用呼叫寻址 General Call Addressing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E8%AE%BE%E5%A4%87%E6%A8%A1%E5%BC%8F%E5%AF%BB%E5%9D%80-slave-mode-addressing"><span class="nav-number">5.7.2.</span> <span class="nav-text">从设备模式寻址 Slave Mode Addressing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E8%AE%BE%E5%A4%87%E6%A8%A1%E5%BC%8F%E5%AF%BB%E5%9D%80-master-mode-addressing"><span class="nav-number">5.7.3.</span> <span class="nav-text">主设备模式寻址 Master Mode Addressing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E6%A8%A1%E5%BC%8F-fast-mode"><span class="nav-number">5.7.4.</span> <span class="nav-text">快速模式 Fast Mode</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93-data-transfer"><span class="nav-number">5.8.</span> <span class="nav-text">数据传输 Data Transfer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8-register"><span class="nav-number">5.8.1.</span> <span class="nav-text">寄存器 Register</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E6%96%AD-interrupt"><span class="nav-number">5.9.</span> <span class="nav-text">中断 Interrupt</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E7%89%B9%E5%BE%81-debug-feature"><span class="nav-number">5.10.</span> <span class="nav-text">调试特征 Debug Feature</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#masking"><span class="nav-number">5.10.1.</span> <span class="nav-text">Masking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#service"><span class="nav-number">5.10.2.</span> <span class="nav-text">Service</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E8%AE%BE%E5%A4%87%E5%8F%91%E9%80%81%E6%A8%A1%E5%BC%8F"><span class="nav-number">5.11.</span> <span class="nav-text">主设备发送模式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#clock"><span class="nav-number">6.</span> <span class="nav-text">Clock</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#iop-clock-pclk"><span class="nav-number">6.1.</span> <span class="nav-text">IOP Clock (PCLK)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pll"><span class="nav-number">7.</span> <span class="nav-text">PLL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#pll-registers"><span class="nav-number">7.1.</span> <span class="nav-text">PLL Registers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pmctl"><span class="nav-number">7.1.1.</span> <span class="nav-text">PMCTL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pmctl1"><span class="nav-number">7.1.2.</span> <span class="nav-text">PMCTL1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#plld"><span class="nav-number">7.1.3.</span> <span class="nav-text">PLLD</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E7%A4%BA%E4%BE%8B"><span class="nav-number">7.2.</span> <span class="nav-text">官方示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A4%E6%80%BB%E7%BB%93"><span class="nav-number">7.2.1.</span> <span class="nav-text">步骤总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93"><span class="nav-number">7.2.2.</span> <span class="nav-text">问题总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#interrupt-control-of-pins"><span class="nav-number">8.</span> <span class="nav-text">Interrupt Control of PINs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E5%BE%81"><span class="nav-number">8.1.</span> <span class="nav-text">特征</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E6%96%AD%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">8.2.</span> <span class="nav-text">中断寄存器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E6%8F%8F%E8%BF%B0"><span class="nav-number">8.3.</span> <span class="nav-text">功能描述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E7%BC%96%E7%A8%8B%E4%B8%AD%E6%96%AD%E4%BC%98%E5%85%88%E7%BA%A7%E6%8E%A7%E5%88%B6"><span class="nav-number">8.3.1.</span> <span class="nav-text">可编程中断优先级控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E5%9B%B4%E4%B8%AD%E6%96%AD"><span class="nav-number">8.3.1.1.</span> <span class="nav-text">外围中断</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E4%B8%AD%E6%96%AD"><span class="nav-number">8.3.1.2.</span> <span class="nav-text">软件中断</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E9%87%8D%E4%B8%AD%E6%96%AD%E8%AF%B7%E6%B1%82%E4%BF%A1%E5%8F%B7%E7%9A%84%E5%A4%96%E5%9B%B4%E8%AE%BE%E5%A4%87"><span class="nav-number">8.3.1.3.</span> <span class="nav-text">多重中断请求信号的外围设备</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%96%AD%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">8.3.2.</span> <span class="nav-text">系统中断控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#daidpi%E4%B8%AD%E6%96%AD%E6%BA%90"><span class="nav-number">8.3.2.1.</span> <span class="nav-text">DAI&#x2F;DPI中断源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dai%E4%B8%AD%E6%96%AD%E9%94%81%E5%AD%98%E4%BC%98%E5%85%88%E7%BA%A7%E8%AE%BE%E7%BD%AE"><span class="nav-number">8.3.2.2.</span> <span class="nav-text">DAI中断锁存优先级设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dpi%E4%B8%AD%E6%96%AD%E9%94%81%E5%AD%98"><span class="nav-number">8.3.2.3.</span> <span class="nav-text">DPI中断锁存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#daidpi%E8%BE%B9%E6%B2%BF%E8%A7%A6%E5%8F%91%E4%B8%AD%E6%96%AD%E5%B1%8F%E8%94%BD"><span class="nav-number">8.3.2.4.</span> <span class="nav-text">DAI&#x2F;DPI边沿触发中断屏蔽</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#daidpi%E4%BA%8B%E4%BB%B6%E4%B8%AD%E6%96%AD%E5%B1%8F%E8%94%BD"><span class="nav-number">8.3.2.5.</span> <span class="nav-text">DAI&#x2F;DPI事件中断屏蔽</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#daidpi%E4%B8%AD%E6%96%AD%E6%9C%8D%E5%8A%A1"><span class="nav-number">8.3.2.6.</span> <span class="nav-text">DAI&#x2F;DPI中断服务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E6%96%AD%E6%9C%8D%E5%8A%A1"><span class="nav-number">8.3.3.</span> <span class="nav-text">中断服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1%E8%AF%B7%E6%B1%82%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A8%A1%E5%BC%8F"><span class="nav-number">8.3.3.1.</span> <span class="nav-text">核心缓存服务请求（输入输出模式）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dma%E6%8E%A5%E5%85%A5"><span class="nav-number">8.3.3.2.</span> <span class="nav-text">DMA接入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E6%96%AD%E5%BB%B6%E8%BF%9F"><span class="nav-number">8.3.4.</span> <span class="nav-text">中断延迟</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#dma%E5%AE%8C%E6%88%90%E7%B1%BB%E5%9E%8B"><span class="nav-number">8.3.4.1.</span> <span class="nav-text">DMA完成类型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E7%89%B9%E5%BE%81"><span class="nav-number">8.4.</span> <span class="nav-text">调试特征</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BD%B1%E5%AD%90%E4%B8%AD%E6%96%AD%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-number">8.4.0.1.</span> <span class="nav-text">影子中断寄存器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AF%E8%AF%AD%E6%80%BB%E7%BB%93"><span class="nav-number">8.5.</span> <span class="nav-text">术语总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sport"><span class="nav-number">9.</span> <span class="nav-text">SPORT</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#spctl"><span class="nav-number">9.1.</span> <span class="nav-text">SPCTL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E4%BD%8D%E6%8C%87%E7%A4%BA"><span class="nav-number">9.1.1.</span> <span class="nav-text">寄存器位指示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E4%BD%8D%E8%AF%B4%E6%98%8E"><span class="nav-number">9.1.2.</span> <span class="nav-text">寄存器位说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spctlnx"><span class="nav-number">9.2.</span> <span class="nav-text">SPCTLNx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spmctlx"><span class="nav-number">9.3.</span> <span class="nav-text">SPMCTLx</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#dma"><span class="nav-number">10.</span> <span class="nav-text">DMA</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%A0%E9%80%81%E5%8E%9F%E7%90%86"><span class="nav-number">10.1.</span> <span class="nav-text">传送原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%9C%E6%AD%A2cpu%E8%AE%BF%E9%97%AE%E5%86%85%E5%AD%98"><span class="nav-number">10.1.1.</span> <span class="nav-text">停止CPU访问内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%A8%E6%9C%9F%E6%8C%AA%E7%94%A8"><span class="nav-number">10.1.2.</span> <span class="nav-text">周期挪用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dma%E4%B8%8Ecpu%E4%BA%A4%E6%9B%BF%E8%AE%BF%E9%97%AE%E5%86%85%E5%AD%98"><span class="nav-number">10.1.3.</span> <span class="nav-text">DMA与CPU交替访问内存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#adsp%E8%8A%AF%E7%89%87%E4%B8%AD%E7%9A%84dma"><span class="nav-number">10.2.</span> <span class="nav-text">ADSP芯片中的DMA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#external-ports"><span class="nav-number">10.3.</span> <span class="nav-text">External ports</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BB%E5%9D%80"><span class="nav-number">10.3.1.</span> <span class="nav-text">寻址</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tcb"><span class="nav-number">11.</span> <span class="nav-text">TCB</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#others"><span class="nav-number">12.</span> <span class="nav-text">Others</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dmatcbsport%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">12.1.</span> <span class="nav-text">DMA、TCB、SPORT之间的关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#clockarbitrationpllprescale"><span class="nav-number">12.2.</span> <span class="nav-text">Clock、Arbitration、PLL、prescale</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#latency"><span class="nav-number">12.3.</span> <span class="nav-text">LATENCY</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#twi-%E6%95%88%E6%9E%9C%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4"><span class="nav-number">12.3.1.</span> <span class="nav-text">TWI 效果延迟（时间）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#asmnop"><span class="nav-number">12.4.</span> <span class="nav-text">ASM(&quot;NOP&quot;)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#asm%E4%BD%9C%E7%94%A8"><span class="nav-number">12.4.1.</span> <span class="nav-text">asm()作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%92%9F%E5%91%A8%E6%9C%9F"><span class="nav-number">12.4.2.</span> <span class="nav-text">时钟周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%BA%E5%99%A8%E5%91%A8%E6%9C%9F"><span class="nav-number">12.4.3.</span> <span class="nav-text">机器周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4%E5%91%A8%E6%9C%9F"><span class="nav-number">12.4.4.</span> <span class="nav-text">指令周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BA%BF%E5%91%A8%E6%9C%9F"><span class="nav-number">12.4.5.</span> <span class="nav-text">总线周期</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">12.5.</span> <span class="nav-text">问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">13.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liewzheng</p>
  <div class="site-description" itemprop="description">笔记分享的旮旯孤岛而已</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">93</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">173</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:liewzheng@foxmail.com" title="E-Mail → mailto:liewzheng@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/25/Hardware/DSP/2021-05-25-ADSP21479%20%E5%AF%84%E5%AD%98%E5%99%A8%E8%A7%A3%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ADSP21479 寄存器解读
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-25 14:00:00" itemprop="dateCreated datePublished" datetime="2021-05-25T14:00:00+08:00">2021-05-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-08 22:41:04" itemprop="dateModified" datetime="2021-07-08T22:41:04+08:00">2021-07-08</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hardware/" itemprop="url" rel="index"><span itemprop="name">Hardware</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>以下所有对寄存器的描述均来自于《ADSP-214xx SHARC Processor Hardware Reference》，后简称《HWR》。</p>
<p>本笔记主要是针对芯片 ADSP21479 寄存器（PLL、SDRAM、SRU、中断等）进行总结和记录。</p>
<p>[TOC]</p>
<h1 id="register-preview">Register Preview</h1>
<h2 id="位类型和操作">位类型和操作</h2>
<p>许多寄存器旁边都会标注位类型和操作方法，位类型包括 可读可写（RW）、只读（RO）、只读清除（ROC）、只写清除（WOC）、可读可写1清除（RW1C）、 可读可写1设置（RW1S）。</p>
<p><img src="https://pic.islet.space/2021/05/20210528141056.png" alt="image-20210528134312811" style="zoom: 80%;" /></p>
<p><strong>注意</strong>：<mark>不要尝试去写入这些 <strong><em>reversed位</em></strong> ，读取的值就会使这些位上的值进行更新或者复位。</mark></p>
<p><img src="https://pic.islet.space/2021/05/20210528141255.png" alt="image-20210528134457084" style="zoom:67%;" /></p>
<h2 id="头文件-外围设备及寄存器宏定义">头文件-外围设备及寄存器宏定义</h2>
<p><code>&lt;def21479.h&gt;</code> 是关于 <strong>外围设备</strong>（peripherals）和 <strong>寄存器</strong>（registers）的子集。</p>
<p><code>&lt;cdef21479.h&gt;</code> 包含了对IOP寄存器的宏定义，对C/C++可用。所有定义均和 <code>&lt;def21479.h&gt;</code> 一致，除了以 <code>p</code> 作为前缀的宏定义 和 （relevant casts）以外，它们的用法如 <code>*pSYSTAT = 0x12345678;</code>。</p>
<p>《HWR》仅有第99页中提及了这两份文件。</p>
<figure>
<img src="https://pic.islet.space/2021/06/20210602171620.png" alt="image-20210602171608976" /><figcaption aria-hidden="true">image-20210602171608976</figcaption>
</figure>
<h3 id="def21479.h">DEF21479.H</h3>
<ul>
<li><p>外部接口IOP寄存器（IOP registers for External Port）、SDRAM控制寄存器、AMI寄存器、DMA地址寄存器、SPORT（SP0~SP7）（包含串行接口寄存器、多通道发送接收（Multichannel tx/rx）、SPORT计数寄存器、错误中断控制寄存器、控制寄存器、多通道选择（Multichannel select））、SPI和SPIB寄存器、定时器寄存器、POWER MGT寄存器、外围设备中断优先级控制寄存器（Peripheral interrupt priority control register）、DAI寄存器（DAI参数寄存器、边缘中断锁存寄存器、中断优先级寄存器、（shadow）高/低优先级中断锁存寄存器、DAI状态寄存器、DAI针脚缓存状态寄存器、）、SRU寄存器（包括SRU时钟控制寄存器、数据控制寄存器、FS控制寄存器、针脚控制寄存器、外部Misc.A/B控制寄存器、针脚使能寄存器、shift寄存器的时钟控制和数据控制）、精度时钟控制寄存器（Precision Clock A/B Control Register 0/1）（包括脉冲宽度控制、幅度同步、脉冲宽度控制）、MTM寄存器、PWM寄存器、UART寄存器、TWI寄存器、FIR加速寄存器、IIR加速寄存器、FFT加速寄存器、MLB设备寄存器、WDT寄存器、Shift寄存器、RTC寄存器。</p></li>
<li><p>DPI、DTCP模块</p></li>
</ul>
<hr />
<ul>
<li><p>系统寄存器位定义（MODE1和MMASK寄存器、MODE2寄存器、ASTAT、STKYx和STKYy寄存器、IRPTL寄存器、IMASK寄存器、IMASKP寄存器、LIRPTL寄存器、FLAGS寄存器）</p></li>
<li><p>IOP控制/状态寄存器位定义（EEMUSTAT寄存器、RUNRSTCTL寄存器、SYSCTL寄存器、BRKCTL寄存器、REVPID、SDCTL寄存器位、SDRRC（SDRAM刷新速率控制）寄存器、SDSTAT（SDRAM状态）寄存器、SDSTAT（SDRAM状态）寄存器2、EPCTL寄存器位）</p></li>
<li><p>AMICTL寄存器位（DMAC寄存器控制位、SPICTL寄存器、SPISTAT寄存器、SPCTL（0~5、N0~N7）寄存器、GP计时器状态寄存器、GP计时器控制寄存器、电源管理控制寄存器、外部时钟管理控制寄存器、DAI中断锁存寄存器、IDP控制寄存器、IDP PDAP控制寄存器、DAI针脚缓存状态寄存器（0~19）、DAI状态寄存器、DPI针脚缓存状态寄存器（0~13）、DPI中断锁存寄存器）</p></li>
<li><p>精度时钟控制寄存器（A0、A1、B0、B1、C0、C1、D0、D1）、精度时钟脉冲宽度控制寄存器、精度时钟幅度同步、精度时钟脉冲宽度控制寄存器</p></li>
<li><p>优先级中断控制（Priority Interrupt Control）寄存器（可编程中断（Programmable Interrupt）寄存器位）</p></li>
<li><p>PWM全局控制寄存器、PWM全局状态寄存器、PWM控制寄存器、PWM状态寄存器、PWM输出禁用、PWM调试状态、PWM极性选择寄存器（Polarity Select Register）</p></li>
<li><p>TWI寄存器、主设备内部时钟寄存器（TWIMITR）、TWI从设备控制寄存器（TWISCTL）、TWI从设备状态寄存器（TWISSTAT）、TWI主设备控制寄存器（TWIMCTL）、TWI主设备状态寄存器（TWIMSTAT）、TWI中断控制寄存器（TWIIMASK/TWIIRPTL）、TWI先进先出控制寄存器（TWIFIFOCTL）、TWI先进先出状态寄存器（TWIFIFOSTAT）</p></li>
<li><p>UART寄存器、UARTIIR、UARTLCR、UARTMODE、UARTLSR、UARTTXCTL/RXCTL、UARTTXSTAT/RXSTAT</p></li>
<li><p>SPDIF传输寄存器、SPDIF通道状态寄存器、SPDIF用户位状态寄存器、SPDIF接收器寄存器、SPDIF传输控制寄存器、SPDIF TX输入数据格式、SPDIF接收控制寄存器、SPDIF接收状态（只读）</p></li>
<li><p>采样率转换控制寄存器（0~3）、输入数据格式、输出数据格式、SRC频应复元（Deemphasis）设置、彩艳率转换率（0~3）、采样率转换静音（MUTE）寄存器（SRCMUTE）</p></li>
<li><p>FIR加速器、IIR加速器、FFT加速器</p></li>
<li><p>MLB位定义（DCCR/SSCR/SMCR/IBCR/CECR/CSCR）、WDT寄存器位定义、Shift寄存器位定义、RTC寄存器位定义（控制、初始化、状态、初始化状态）</p></li>
</ul>
<h3 id="cdef21479.h">CDEF21479.H</h3>
<ul>
<li>仿真、断点寄存器</li>
<li>外部接口的IOP寄存器</li>
<li>SDRAM控制寄存器</li>
<li>AMI的IOP寄存器</li>
<li>DAM地址寄存器</li>
<li>SPORT（0~7）（串行接口寄存器、MT/MR寄存器、TDM寄存器、）</li>
<li>SPI寄存器、SPIB寄存器（通过DAI进行路由）</li>
<li>计时器寄存器</li>
<li>电源管理寄存器</li>
<li>外围中断优先级控制寄存器</li>
<li>DAI寄存器（DMA参数寄存器、SRU寄存器、采样率转换寄存器）</li>
<li>DPI寄存器</li>
<li>DTCP模块</li>
<li>SPDIF传输寄存器（通道状态缓存、用户位缓存、SPDIF接收寄存器）</li>
<li>PCG精度时钟控制寄存器</li>
<li>MTM（Memory to Memory）寄存器</li>
<li>PWM脉冲调制寄存器</li>
<li>UART寄存器</li>
<li>TWI寄存器</li>
<li>FIR加速寄存器</li>
<li>IIR加速寄存器</li>
<li>FFT加速寄存器</li>
<li>MLB设备寄存器</li>
<li>WDT寄存器</li>
<li>Shift寄存器</li>
<li>RTC寄存器</li>
</ul>
<p>在《HWR》“自己眼”中，可能自己就这么点儿寄存器。</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210529114430.png" alt="image-20210528140017190" /><figcaption aria-hidden="true">image-20210528140017190</figcaption>
</figure>
<h1 id="reset-register">Reset Register</h1>
<p><strong><em>RUNRSTCTL</em></strong>，运行中复位控制寄存器（Running Reset Control Register）。</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-5 RUNRSTCTL寄存器位功能描述
</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210527170843.png" alt="image-20210527170816951" /><figcaption aria-hidden="true">image-20210527170816951</figcaption>
</figure>
<h1 id="可编程中断优先级控制寄存器">可编程中断优先级控制寄存器</h1>
<ul>
<li><p>supports 19 programmable prioritized interrupts</p></li>
<li><p>任何外部中断输出都可能被连接至任何可编程优先级中断输入。</p></li>
</ul>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-6 默认中断路由
</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210527171222.png" alt="image-20210527171119962" /><figcaption aria-hidden="true">image-20210527171119962</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/20210527171224.png" alt="image-20210527171204914" /><figcaption aria-hidden="true">image-20210527171204914</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/20210527171227.png" alt="image-20210527171219793" /><figcaption aria-hidden="true">image-20210527171219793</figcaption>
</figure>
<h1 id="目标信号控制寄存器">目标信号控制寄存器</h1>
<p>本寄存器控制了：</p>
<ul>
<li><p>programmable priority interrupts</p></li>
<li><p>default interrupt sources</p></li>
</ul>
<figure>
<img src="https://pic.islet.space/2021/05/20210527172018.png" alt="image-20210527171809869" /><figcaption aria-hidden="true">image-20210527171809869</figcaption>
</figure>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-4 PICR0 寄存器
</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210527172024.png" alt="image-20210527171824344" /><figcaption aria-hidden="true">image-20210527171824344</figcaption>
</figure>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-5 PICR1 寄存器
</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210527172027.png" alt="image-20210527171841316" /><figcaption aria-hidden="true">image-20210527171841316</figcaption>
</figure>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-6 PICR2 寄存器
</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210527172029.png" alt="image-20210527171852287" /><figcaption aria-hidden="true">image-20210527171852287</figcaption>
</figure>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-7 PICR3 寄存器
</p>
<h1 id="twi-in-master-tx">TWI IN MASTER-TX</h1>
<p><strong>Peripherals with Multiple Interrupt Request Signals</strong></p>
<blockquote>
<p>TWI和UART有分离的中断输出。两者都默认连接至P14I（DPI）。然而，两者都允许分离连接至默认不路由的PICR，反而提供了更多可通过DAI/DPI中断优先级更改的混合模型。</p>
<p>The TWI and the UART have separate interrupt outputs. Both peripherals are already connected via the P14I (DPI) by default. However both peripherals allow separate connectivity into the PICR that are not routed by default. This provides more flexibility for priority change across the DAI/DPI interrupts.</p>
</blockquote>
<h2 id="twi-register">TWI Register</h2>
<p>《HWR》第1193页起定义了TWI的寄存器。第1244页同样给了TWI相关的寄存器一个列表。</p>
<p><img src="https://pic.islet.space/2021/05/20210528140307.png" alt="image-20210528140209933" style="zoom:67%;" /></p>
<p><code>&lt;cdef21479.h&gt;</code> 对TWI相关的寄存器定义如下，p为前缀的定义是该寄存器的地址位，通过与<code>&lt;def21479.h&gt;</code> 的定义进行 <code>或</code> 运算并赋值给对应的寄存器地址进行控制，如 <code>*pTWIMITR = (0x14) | TWIEN;</code> 。</p>
<p>TWI中所有的Status相关寄存器都是 “只读” 状态，其《位描述》表上都有一个 <code>RO</code> 标志。</p>
<p><img src="https://pic.islet.space/2021/05/20210527095059.png" alt="image-20210527095053483" style="zoom:80%;" /></p>
<p>在VisualDSP++这款IDE中，也可以通过 直接观察到所有TWI的寄存器值。</p>
<p><img src="https://pic.islet.space/2021/06/20210607103819.png" alt="image-20210607103816755" style="zoom:80%;" /> <img src="https://pic.islet.space/2021/06/20210607103750.png" alt="image-20210607103747655" /></p>
<h3 id="twimitr">TWIMITR</h3>
<p>TWIMITR（<strong>Master Internal Time Register</strong>），即主机内部时间寄存器（如图A-143所示，并在表A-129中描述）。</p>
<ul>
<li>用于启用TWI模块，以及建立外围时钟（PCLK）和TWI控制器内部定时事件之间的关系。
<ul>
<li>内部时间参考是从PCLK得出的，使用的是预标定值。<code>PRESCALE = fPCLK / 10 MHz</code></li>
</ul></li>
</ul>
<blockquote>
<p>The internal time reference is <strong><em>derived from PCLK</em></strong> using the prescaled value shown below.</p>
<p><code>PRESCALE = fPCLK/10 MHz</code></p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/20210525135455.png" alt="image-20210525133555377" style="zoom: 67%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-143 TWIMITR 寄存器
</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-129 寄存器位功能描述
</p>
<table>
<colgroup>
<col style="width: 5%" />
<col style="width: 11%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="header">
<th>BITS</th>
<th>NAME</th>
<th>DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6-0</td>
<td>PRESCALE</td>
<td><strong>预分频</strong><br>用于生成一个内部时间参考的外围时钟（PCLK）周期数。<br>必须设置PRESCALE的值，以创建一个周期为10MHz的内部时间参考。这表示为一个7位的二进制值。</td>
</tr>
<tr class="even">
<td>7</td>
<td>TWIEN</td>
<td><strong>TWI使能</strong><br>该位必须设置为从属或主模式操作。<br>建议在初始化PRESCALE时设置该位，并保持设置，以确保总线繁忙检测逻辑的精确运行。<br/>- 0 = 禁用TWI<br/>- 1 = 启用TWI主、从模式操作。<mark>如果该位从高电平过渡到低电平，缓冲器将被刷新，需要2个时钟周期。</mark></td>
</tr>
</tbody>
</table>
<h3 id="twidiv">TWIDIV</h3>
<p>在主模式运行期间，跟SCL相关的TWIDIV（<strong>Clock Divider Register</strong>），即时钟分频器寄存器（如图A-144所示，并在表A-130中描述）。</p>
<ul>
<li>被用来创建串行时钟（SCL）的 <strong>高</strong> 和 <strong>低</strong> 持续时间。</li>
<li>串行时钟的频率可以从400KHz到小于20KHz不等。产生的时钟分辨率为1/10 MHz或100 ns。</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/20210525135457.png" alt="image-20210525134728762" style="zoom: 67%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-144 TWIDIV 寄存器
</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-130 TWIDIV 寄存器位功能描述
</p>
<table>
<thead>
<tr class="header">
<th>BITS</th>
<th>NAME</th>
<th>DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7-0</td>
<td>CLKLOW</td>
<td>时钟低电平<br>该时间映射了串行时间低电平的周期。<br>以8位二进制数表示。</td>
</tr>
<tr class="even">
<td>15-8</td>
<td>CLKHI</td>
<td>时钟高电平<br>该时间映射了串行时钟在等到一个新时钟低电平到来之前的持续时间。<br>以8位二进制数表示。</td>
</tr>
</tbody>
</table>
<h3 id="twimctl">TWIMCTL</h3>
<p>TWIMCTL（Master Control Register），即TWI主机控制寄存器。</p>
<ul>
<li>控制了控制与主机模式操作相关的逻辑。</li>
<li>该寄存器内的操作不会影响到从寄设备的操作；且不应该被修改以控制从属模式的功能。</li>
</ul>
<blockquote>
<p>The TWI master mode control register controls the logic associated with master mode operation.</p>
<p>Bits in this register do not affect slave mode operation and should not be modified to control slave mode functionality.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/20210525143535.png" alt="image-20210525140532502" style="zoom: 67%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-145 TWIMCTL 寄存器
</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-131 TWIMCTL 寄存器位功能描述
</p>
<p><img src="https://pic.islet.space/2021/05/20210525143532.png" alt="image-20210525143454398" style="zoom: 67%;" /></p>
<p><img src="https://pic.islet.space/2021/05/20210525143531.png" alt="image-20210525143529519" style="zoom: 67%;" /></p>
<h3 id="twimaddr">TWIMADDR</h3>
<p>在传输的寻址阶段中，TWI控制器的主机使能，并传输TWI主机模式地址寄存器中的内容。</p>
<p>在对本寄存器进行编程时，忽略读/写位。只有从机地址的前7位（6-0）会被写入本寄存器。</p>
<p>例如：从机的地址是 <code>1010 000x</code> ，则本寄存器的写入内容则是 <code>1010 000</code>（16进制的 <code>0x50</code> ）。<mark>将该地址发送至总线时，TWI控制器根据 主机控制寄存器上TWIMDIR 位来决定对从机的读写。</mark></p>
<blockquote>
<p>During the addressing phase of a transfer, the TWI controller, with its master enabled, transmits the contents of the TWI master mode address register. When programming this register, omit the read/write bit. That is, only the upper 7 bits that make up the slave address should be written to this register. For example, if the slave address is 1010000X, then TWIMADDR is programmed with 1010000, which corresponds to 0x50. When sending out the address on the bus, the TWI controller appends the read/write bit as appropriate, based on the state of the TWIMDIR bit in the master mode control register.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/20210525143542.png" alt="image-20210525140743855" style="zoom: 67%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-146 TWIMADDR 寄存器
</p>
<h3 id="twimstat">TWIMSTAT</h3>
<ul>
<li>Not directly associated with the generation of interrupts but offer information on the current transfer.</li>
<li>Slave mode operation does not affect master mode status bits.</li>
</ul>
<figure>
<img src="https://pic.islet.space/2021/06/20210603153454.png" alt="image-20210603153452903" /><figcaption aria-hidden="true">image-20210603153452903</figcaption>
</figure>
<p>如果TWIMSTAT寄存器中的第2位是1</p>
<p><img src="https://pic.islet.space/2021/06/20210603153720.png" alt="image-20210603153655529" style="zoom:80%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210603153724.png" alt="image-20210603153719024" style="zoom:80%;" /></p>
<h3 id="twififoctl">TWIFIFOCTL</h3>
<p>TWIFIFOCTL（<strong>FIFO Control Register</strong>），即先进先出控制寄存器，只控制FIFO，<mark>完全不与主机模式 或 从机模式操作绑定。</mark></p>
<p><img src="https://pic.islet.space/2021/05/20210525144902.png" alt="image-20210525144403383" style="zoom: 67%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-151 TWIFIFOCTL 寄存器
</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-135 TWIFIFOCTL 寄存器位功能描述
</p>
<p><img src="https://pic.islet.space/2021/05/20210525144904.png" alt="image-20210525144738016" style="zoom:67%;" /></p>
<h3 id="twififostat">TWIFIFOSTAT</h3>
<ul>
<li>指示FIFO缓冲区的接收和发送内容的状态。</li>
<li>FIFO缓冲器不区分主数据和从数据。</li>
<li>可以对FIFO进行管理，允许同时进行主、从操作。</li>
</ul>
<figure>
<img src="https://pic.islet.space/2021/06/20210603152241.png" alt="image-20210603152156841" /><figcaption aria-hidden="true">image-20210603152156841</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/06/20210603152239.png" alt="image-20210603152211766" /><figcaption aria-hidden="true">image-20210603152211766</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/06/20210603152242.png" alt="image-20210603152235432" /><figcaption aria-hidden="true">image-20210603152235432</figcaption>
</figure>
<blockquote>
<p><strong>TWITXS</strong>: 传输FIFO状态。</p>
<p>这些只读位表示FIFO缓冲器中有效数据字节的数量。该状态在每次使用外围数据总线写入FIFO缓冲区或通过传输移位寄存器读取时被更新。</p>
<p>在每次使用外设数据总线写FIFO缓冲区或通过传输移位寄存器读访问时更新。允许同时访问。</p>
<ul>
<li>00 = FIFO是空的。无论是单字节还是双字节的FIFO外设写入都会立即通过。</li>
<li>01 = FIFO包含一个字节的数据。对FIFO的单字节外围写立即通过。一个双字节的外设写入要等到FIFO为空时才进行。</li>
<li>11 = FIFO已满，包含两个字节的数据。</li>
<li>10 = 保留</li>
</ul>
</blockquote>
<h3 id="twiirptl">TWIIRPTL</h3>
<p>TWIIRPTL（TWI interrupt sources register），即TWI中断源寄存器。</p>
<ul>
<li><p>包含了有关 <em>functional areas requiring servicing</em> 的信息。</p></li>
<li><p>大量的比特被当做鉴定器/指示器来使用，主要用于 <em>further read</em> 以及 为 不同的状态寄存器提供服务（service various status register）。</p></li>
<li><p>在维护了与位绑定的中断源后，用户需要清除该中断源位。</p></li>
<li><p>所有的位都是粘性的 （sticky）和 <strong><em>RW1C</em></strong>。</p></li>
</ul>
<p><img src="https://pic.islet.space/2021/05/20210525163021.png" alt="image-20210525163016113" style="zoom: 50%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-1534 TWIIRPTL 寄存器
</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-137 TWIIRPTL 寄存器位功能描述
</p>
<p><img src="https://pic.islet.space/2021/05/20210525164025.png" alt="image-20210525163933340" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/05/20210525164028.png" alt="image-20210525163959598" style="zoom:67%;" /></p>
<h4 id="twitxint">TWITXINT</h4>
<p>首先要搞清楚，这个TWITXINT 是寄存器还是寄存器位，如果是寄存器位，哪它来自于哪个寄存器呢。目前已知包含TWITXINT的寄存器有：<code>TWIIRPTL</code> 、 <code>TWIIMASK</code> 、 <code>TWIFIFOCTL</code>(TWITXINT<strong><em>2</em></strong>)</p>
<blockquote>
<p>在TWIIRPT寄存器中的TWITXINT寄存器位：</p>
<p>发送FIFO服务。</p>
<p>如果 TWIFIFOCTL 寄存器中的 <code>XMTINTLEN2</code> 为 0，则每次 TWIFOSTAT 寄存器中的 TWITXS 字段被更新为 01 或 00 时，该位都被设置。</p>
<p>如果 <code>XMTINTLEN</code> 为 1，则每次 TWITXS 被更新为 00 时，该位都被设置。</p>
<p>1 = 发送 FIFO 缓冲区有一个或两个 8 位位置可供写入。</p>
<p>0 = FIFO不需要服务或TWITXS字段在该位最后被清除后没有变化。</p>
</blockquote>
<h5 id="twitxint-interrupt">TWITXINT interrupt</h5>
<blockquote>
<p>This interrupt is generated when there is one or two bytes of empty space in the FIFO. Simple data handling is all that is required.</p>
</blockquote>
<h3 id="twiimask">TWIIMASK</h3>
<p>TWIIMARK （<strong>TWI Interrupt mask register</strong>），即TWI中断<strong><em>隐藏</em></strong>寄存器。</p>
<ul>
<li>使能中断源（interrupt sources）插入中断输出（Interrupt output）</li>
<li>每一个<strong>使能位</strong>（enable bit）都会与 <strong>TWI中断延迟寄存器</strong>（TWIIRPTL，即TWI interrupt latch register）一个<strong>中断延迟位</strong>（interrupt latch bit）通信。</li>
<li>对TWIIMASK寄存器的读写不会影响 TWIIRPTL 寄存器的内容。</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/20210525164217.png" alt="image-20210525145706357" style="zoom: 67%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-154 TWIIMASK 寄存器
</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-138 TWIIMASK 寄存器位功能描述
</p>
<p><img src="https://pic.islet.space/2021/05/20210525150124.png" alt="image-20210525150058029" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/05/20210525164016.png" alt="image-20210525150122857" style="zoom:67%;" /></p>
<h3 id="txtwi8">TXTWI8</h3>
<p>8位传输用FIFO寄存器（TWI 8-bit transmit FIFO register），做数据缓存之用。</p>
<ul>
<li>存储数据以“先进先出”的顺序进入通信传输缓存。</li>
<li>尽管外围总线写入带宽是32位，但是只有一个字节会被写入8位的 <strong><em>TXTWI8</em></strong>。</li>
<li>伴随着每一次数据写入，<strong>TWIFIFOSTAT</strong> 寄存器中的 <strong>TWITXS</strong> 传输状态位都会被更新。</li>
<li>当FIFO缓存存满时，仍有数据需要写入的话，核心就会让数据等着，直到转运缓存（TRANSMIT FIFO BUFFER）由至少一个字节的空间时才能完成写入操作。</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/20210525161210.png" alt="image-20210525155309392" style="zoom:67%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 22-7 8位传输FIFO寄存器
</p>
<p><img src="https://pic.islet.space/2021/05/20210527133602.png" alt="image-20210527114613231" style="zoom:67%;" /></p>
<h3 id="例程">例程</h3>
<h4 id="主寄存器初始化函数">主寄存器初始化函数</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">ADAU1772_1_ADDR = <span class="number">0X3C</span>;  <span class="comment">//第一个从设备的地址是0x3C，其ADDR1和ADDR0引脚均为0；</span></span><br><span class="line">ADAU1772_2_ADDR = <span class="number">0X3D</span>;  <span class="comment">//第一个从设备的地址是0x3D，其ADDR1和ADDR0引脚为0和1；</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Master_TWI_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="comment">// 预分频为 fPCLK/10 MHz</span></span><br><span class="line">	*pTWIMITR = (<span class="number">0x14</span>) | TWIEN;  <span class="comment">//0x14和0x80进行 位或操作，将结果148写入TWI主机时间寄存器中</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// CLKDIV = TWI SCL period ? 10 MHz time reference</span></span><br><span class="line">	<span class="comment">// CLKDIV = (1/100 KHz) / 100 ns = 100</span></span><br><span class="line">	<span class="comment">// For 40 - 60 duty cycle, CLKHI = 40 and CLKLOW = 60</span></span><br><span class="line"></span><br><span class="line">	*pTWIDIV = (CLKHI &lt;&lt; <span class="number">8</span>) | CLKLOW;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 需要被访问的从设备的地址</span></span><br><span class="line">	*pTWIMADDR = ADAU1772_1_ADDR; </span><br><span class="line"></span><br><span class="line">	<span class="comment">// 传送至从属设备的第一个字节数据</span></span><br><span class="line">	*pTXTWI8 = <span class="number">0x00</span>;</span><br><span class="line">    *pTXTWI8 = <span class="number">0x85</span>; <span class="comment">//(0101 0101b)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*  // 配置TWIFIFOCTL寄存器，为每个数据字节(byte)生成中断</span></span><br><span class="line"><span class="comment">	*pTWIFIFOCTL = TWITXFLUSH | TWIRXFLUSH;</span></span><br><span class="line"><span class="comment">	*pTWIFIFOCTL = 0;</span></span><br><span class="line"><span class="comment">	*/</span>  <span class="comment">//暂时禁用该数据写入寄存器配置（包括中断和写入读取规则等）</span></span><br><span class="line">    *pTWIFIFOCTL = <span class="number">0x15</span>;  <span class="comment">//即（0 1111b），详细配置信息请参照《ADSP-214xx SHARC Processor Hardware Reference》</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">// 中断使能位，上方已经写过了，有些重复</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> INTERRUPT_MODE</span></span><br><span class="line">	*pTWIIMASK |= TWITXINT;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打开TWI的控制寄存器</span></span><br><span class="line">	*pTWIMCTL = (N &lt;&lt; <span class="number">6</span>);  <span class="comment">//？？</span></span><br><span class="line">	*pTWIMCTL |= TWIMEN;  <span class="comment">// 打开主机模式（Master Mode enable）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="特性-features">特性 Features</h2>
<p>《HWR》第855页起对TWI进行了描述。</p>
<figure>
<img src="https://pic.islet.space/2021/06/20210603140236.png" alt="image-20210603140215469" /><figcaption aria-hidden="true">image-20210603140215469</figcaption>
</figure>
<ul>
<li>需要使用DPI进行针脚信号的路由，不能使用DAI</li>
<li>支持主从模式</li>
<li>支持数据缓存接入和核心数据接入，不支持DMA</li>
<li>最大时钟频率400KHz</li>
<li>7-bit 寻址</li>
<li>支持多播主机仲裁</li>
<li>主时钟同步和时钟低延伸支持</li>
<li>低中断速率</li>
<li>分离多字节接收和传输的FIFOs</li>
<li>在总线锁死时，对数据和时钟线的独立复写控制</li>
<li>峰值抑制的输入滤波器</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/20210527100924.png" alt="image-20210527100834503" style="zoom: 67%;" /></p>
<p><img src="https://pic.islet.space/2021/05/20210527133611.png" alt="image-20210527100951355" style="zoom:67%;" /></p>
<h2 id="针脚描述-pin-descriptions">针脚描述 Pin Descriptions</h2>
<p><img src="https://pic.islet.space/2021/05/20210527102109.png" alt="image-20210527101956389" style="zoom:67%;" /></p>
<h2 id="sru编程-sru-programming">SRU编程 SRU Programming</h2>
<p>TWI信号可以通过 <code>SRU2</code> ，如表22-3所示进行路由。</p>
<p><img src="https://pic.islet.space/2021/05/20210527102114.png" alt="image-20210527102029529" style="zoom:67%;" /></p>
<blockquote>
<p>Identify the peripherals that you are trying to connect to the SHARC DSP, and count the unique signals. List the unique I/O signals and look carefully to see what else you may be able to eliminate.</p>
<ul>
<li><p>如果时钟或帧同步连接至多个设备，算作一个信号。If the same <strong><em>clock</em></strong> or <strong><em>frame</em></strong> sync is connected to multiple devices, it counts as one signal.</p></li>
<li><p>如果与一个串行数据流驱动多个设备，也算作一个信号。When a <strong><em>serial data stream</em></strong> drives multiple output devices, it also counts as a single signal.</p></li>
<li><p>如果两个信号相同，但极性相反（倒置），算作一个信号。（因为SRU可以从另一个信号中产生任何一个）</p></li>
<li><p>如果一个时钟信号是另一个时钟信号的相位对齐的整数子倍数，则将它们组合在一起。</p></li>
</ul>
<p>大多数引脚缓冲区在给定的设计中只在一个方向上使用。请注意，许多外设都具有能够实现双向操作的引脚，但仅在系统中的一个方向上使用。当针脚缓冲区是单向的时，SRU的编程会大大简化。</p>
<p>如果针是双向的，确定方向改变的原因。这是另一个别针的状态吗？它是处理器级控制寄存器的状态吗？它是一个端口的软件配置吗？想想当SHARC将逻辑值驱动到双向针上时，以及当针刚刚读取逻辑输入时，可能会控制什么。</p>
<p><strong><em>注意</em></strong> 下图中的 <code>PBxx_O</code> / <code>PBxx_I</code> / <code>PBENxx_I</code> 。针脚缓冲器就像一个小型缓冲器放大器，可以提供足够的电流来驱动针脚和电路板上的痕迹。打开时（即当其启用输入为逻辑高时），针缓冲输入处的逻辑值被驱动到针缓冲输出上。当关闭时（即，当其启用输入为逻辑低时），缓冲器放大器为高阻抗，并且引脚缓冲器输出的逻辑电平很容易由外部源控制。引脚缓冲区是与DAI相关联的物理IC包引线的逻辑网关。</p>
<p><img src="https://pic.islet.space/2021/06/20210603170450.png" alt="image-20210603170447943" style="zoom: 80%;" /></p>
<p>由于引脚缓冲器是一个片上外设，连接到物理封装上的信号被称为引脚缓冲器的输出。虽然它是SHARC的一个输入，但它是引脚缓冲器的一个输出。请注意，图1显示了两个连接的轨迹，它们被标记为 <code>PBxx_O</code>（引脚缓冲器输出）。其中一个是SRU接口的一部分，另一个是外部封装连接引脚。当引脚缓冲器被用作输入时，信号会沿着这个路径。换句话说，SRU内的引脚缓冲器输出总是等于外部引脚的逻辑值。</p>
<p>——《<em>Configuring the Signal Routing Unit of ADSP-2126x SHARC® DSPs</em>》</p>
<p><mark>只有DAI有 PBEN ，DPI只有 PB。</mark></p>
</blockquote>
<p><em>PAGE 874</em> - <strong><em>SRU PROGRAMMING MODE</em></strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SRU(LOW, DPI_PBxx_I); <span class="comment">/* input buffer is low */</span></span><br><span class="line">SRU(TWI_DATA_PBEN_O, DPI_PBENxx_I); <span class="comment">/* TWI data output*/</span></span><br><span class="line"><span class="comment">//SRU(DPI_PBxx_O, TWI_DATA_I); /* TWI data input */</span></span><br><span class="line"></span><br><span class="line">SRU2(LOW, DPI_PByy_I); <span class="comment">/* input buffer is low */</span></span><br><span class="line">SRU2(TWI_CLK_PBEN_O, DPI_PBENyy_I); <span class="comment">/* TWI clock output*/</span></span><br><span class="line"><span class="comment">//SRU2(DPI_PByy_O, TWI_CLK_I); /* TWI clock input*/</span></span><br></pre></td></tr></table></figure>
<p>​</p>
<h2 id="时钟频率-clocking">时钟频率 Clocking</h2>
<ul>
<li>外围时钟（f<sub>PCLK</sub>）是TWI时钟频率的基础。</li>
<li>串行时钟频率最高400KHz，最低20KHz；其分辨率为 1/10MHz 或 100ns。</li>
</ul>
<p>分频数的计算案例如下：</p>
<p><img src="https://pic.islet.space/2021/05/20210527102916.png" alt="image-20210527102754286" style="zoom:67%;" /></p>
<h2 id="功能描述-functional-description">功能描述 Functional Description</h2>
<p>下图22-1展示了TWI控制器的架构。</p>
<ul>
<li><strong>外围接口</strong>（peripheral interface）支持32位宽的数据传输，并被处理器用于支持寄存器和FIFO缓冲器的读写。</li>
<li><strong>寄存器块</strong> 包含了所有的控制和状态位，并依托程序模型来反映了可以写入或读取的内容。状态位可由其各自的（respective）功能块更新。</li>
<li><strong>FIFO缓冲器</strong> 被配置为一个1字节宽、2字节深的发送/接收FIFO缓冲器。</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/20210527133616.png" alt="image-20210527103515471"  /></p>
<ul>
<li><strong>发送移位寄存器</strong>（transmit shift）串行地将其数据从外部移出芯片（shift its data out externally off chip）。该输出可以被控制以产生确认，也可以被手动改写。</li>
<li><strong>接收移位寄存器</strong>（receive shift）从片外串行接收其数据（receive its data serially from off chip）。接收移位寄存器的宽度为1个字节，收到的数据可以被转移到FIFO缓冲区或用于地址比较（address comparison）。</li>
<li><strong>地址比较块</strong> （address compare block）支持在TWI控制器模块作为从机访问时的地址比较。</li>
<li><strong>预分频器块</strong> （prescaler block）必须被编程以产生一个相对于外设时钟的 <code>10MHz</code> 时间基准。这个时间基准用于过滤数据和数据表中电气参数指定的定时事件（见飞利浦的I2C总线规范），以及 <code>TWI_CLOCK</code> 的时钟信号生成。</li>
<li><strong>时钟生成模块</strong> （clock generation module）用于在主模式下生成一个外部串行时钟（<code>TWI_CLOCK</code>）。它包括在多主时钟配置中进行同步所需的逻辑，以及在从属模式下配置时的时钟拉伸。</li>
</ul>
<h3 id="时钟输出">时钟输出</h3>
<p>TWI控制器的时钟输出遵循以下规则。</p>
<ol type="1">
<li><p>一旦时钟高电平（<code>CLKHI</code>）计数完成，串行时钟输出（serial clock output）被驱动为低电平，时钟低电平（<code>CLKLOW</code>）计数开始。</p></li>
<li><p>一旦时钟低电平计数完成，串行时钟线被三振（three-stated），时钟同步逻辑进入延迟模式（阴影区），直到 <code>TWI_CLOCK</code> 线被检测到逻辑1电平。这时，时钟高电平计数开始。</p></li>
</ol>
<p><mark>TWI控制器只在主控模式运行时发出时钟，而且只在传输启动时发出</mark>。如果总线的仲裁（arbitration）丢失，串行时钟输出立即进入三态（three-states）。如果多个时钟试图驱动串行时钟线，TWI控制器将其时钟与其他剩余的时钟同步。这在图22-2中有所说明。</p>
<blockquote>
<p>The TWI controller only issues a clock during master mode operation and only at the time a transfer has been initiated.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/06/20210603144929.png" alt="image-20210603144317584" style="zoom:80%;" /></p>
<p>TWI控制器遵守《<em>Philips I2C Bus Specification version 2.1 dated January 2000</em>》传输协议。图22-3是简易的TWI传输示意。</p>
<p><img src="https://pic.islet.space/2021/06/20210603172309.png" alt="image-20210603145223033" style="zoom:80%;" /></p>
<p>图22-4是TWI控制器在传输过程中的寄存器映射。</p>
<p><img src="https://pic.islet.space/2021/06/20210603172312.png" alt="image-20210603145235075" style="zoom: 80%;" /></p>
<h3 id="总线仲裁-bus-arbitration">总线仲裁 Bus Arbitration</h3>
<p>略</p>
<p><img src="https://pic.islet.space/2021/06/20210603145741.png" alt="image-20210603145739629" style="zoom:67%;" /></p>
<h3 id="开始与结束情景-start-stop-condition">开始与结束情景 Start &amp; Stop condition</h3>
<p>略</p>
<p>​</p>
<h2 id="操作模式-operating-modes">操作模式 Operating Modes</h2>
<h3 id="通用呼叫寻址-general-call-addressing">通用呼叫寻址 General Call Addressing</h3>
<p>如果TWI控制器被启用为从机（TWISEN），并且使用TWIGCE位启用了一般呼叫，则TWI控制器总是解码并确认一般呼叫地址。一般呼叫寻址（0x00）由GCALL位的设置表示，根据传输的性质，TWI控制器是一个从属接收者。如果与传输相关的数据不被确认（NAKed），TWINAK位可以被设置。</p>
<p>如果TWI控制器作为主发射器发出一个总调用，可以设置适当的地址和传输方向，同时加载发送FIFO数据。</p>
<blockquote>
<p>The TWI controller always decodes and acknowledges a general call address if it is enabled as a slave (TWISEN) and if general call is enabled using the TWIGCE bit. General call addressing (0x00) is indicated by the setting of the GCALL bit, and by the nature of the transfer, the TWI controller is a slave-receiver. If the data associated with the transfer is to be not acknowledged (NAKed), the TWINAK bit can be set.</p>
<p>If the TWI controller is to issue a general call as a master-transmitter, the appropriate address and transfer direction can be set along with loading transmit FIFO data.</p>
</blockquote>
<h3 id="从设备模式寻址-slave-mode-addressing">从设备模式寻址 Slave Mode Addressing</h3>
<blockquote>
<p>With the appropriate selection of 7-bit addressing using the TWISLEN bit, the corresponding number of address bits (SADDR) are referenced during the address phase of a transfer.</p>
</blockquote>
<h3 id="主设备模式寻址-master-mode-addressing">主设备模式寻址 Master Mode Addressing</h3>
<p>无论是启用主发送器还是使用 <strong><em>TWIMLEN</em></strong> 位进行7位寻址的主接收器，TWI主站都会按要求执行所有寻址和数据传输。这包括产生重复启动条件，重新传输第一个地址字节的7位，以及确认和产生一个新的传输方向变化（由 <strong><em>TWIMLEN</em></strong> 位指示）。</p>
<blockquote>
<p>Whether enabled as a master-transmitter or master-receiver with 7-bit addressing using the <strong><em>TWIMLEN</em></strong> bit, the TWI master performs all addressing and data transfers as required. This includes generating the repeated start condition, re-transmission of the 7-bits of the first address byte, and acknowledgement and generation of a new transfer direction change (indicated by the <strong><em>TWIMLEN</em></strong> bit).</p>
</blockquote>
<h3 id="快速模式-fast-mode">快速模式 Fast Mode</h3>
<blockquote>
<p>Fast mode (400 kHz) uses essentially the same mechanics as standard mode (100 kHz). It is the electrical specifications and timing that are different. When fast mode is enabled using the <strong><em>TWIFAST</em></strong> bit, the following timings are modified to meet the electrical requirements.</p>
<ul>
<li>Serial data rise times before arbitration evaluation (tr)</li>
<li>Stop condition setup time from serial clock to serial data (tSUSTO)</li>
<li>Bus free time between a stop and start condition (tBUF)</li>
</ul>
</blockquote>
<h2 id="数据传输-data-transfer">数据传输 Data Transfer</h2>
<p>PAGE867:</p>
<p>数据传输部分介绍 <strong>3个寄存器</strong>、<strong>4个缓冲区域</strong> 和 <strong>3个缓存状态</strong>。</p>
<h3 id="寄存器-register">寄存器 Register</h3>
<p><strong>Serial Shift Register</strong>： TWI有一个输入和输出的串行移位器，下面将介绍。</p>
<p><strong>Output Shift Register</strong>： 发送移位寄存器接收字节宽的缓冲区数据或寄存器数据（地址），并将其数据从外部串行移出芯片。该输出可以被控制以产生确认信号，也可以被手动改写。</p>
<p><strong>Input Shift Register</strong>： 接收移位寄存器从芯片外串行地接收数据。在内部，接收移位寄存器是字节宽的，收到的数据可以被转移到缓冲区或用于地址比较。</p>
<h2 id="中断-interrupt">中断 Interrupt</h2>
<p><img src="https://pic.islet.space/2021/05/20210527133619.png" alt="image-20210527104039047" style="zoom:67%;" /></p>
<h2 id="调试特征-debug-feature">调试特征 Debug Feature</h2>
<h3 id="masking">Masking</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bit <span class="built_in">set</span> IMASK P14I; <span class="comment">/* unmasks P14I interrupt */</span></span><br><span class="line">ustat1=dm(DPI_IMASK_RE); <span class="comment">/* set TWI Int */</span></span><br><span class="line">bit <span class="built_in">set</span> ustat1 TWI_INT;</span><br><span class="line">dm(DPI_IMASK_RE)=ustat1;</span><br></pre></td></tr></table></figure>
<h3 id="service">Service</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">TWI_ISR:</span><br><span class="line">ustat1 = dm(TWIIRPTL); <span class="comment">/* read IRPTL to identify cause*/</span></span><br><span class="line">bit TST ustat1 TWITXINT; <span class="comment">/* test TX buffer bit*/</span></span><br><span class="line">IF TF jump TX_BUF;</span><br><span class="line"></span><br><span class="line">TX_BUF:</span><br><span class="line">dm(TWIIRPTL) = ustat1; <span class="comment">/* RW1C to clear TWI TX buffer </span></span><br><span class="line"><span class="comment"> interrupt */</span></span><br><span class="line">r0=dm(TWIMCTL); <span class="comment">/* dummy read*/</span></span><br><span class="line">instruction;</span><br><span class="line">rti;</span><br></pre></td></tr></table></figure>
<h2 id="主设备发送模式">主设备发送模式</h2>
<p>以下为单主机传输模式的的编程过程： 1. Program the <code>TWIMADDR</code> register. - This defines the address transmitted during the address phase of the transfer. 2. Program the <code>TXTWI8</code> or <code>TXTWI16</code> registers. - This is the initial data transmitted. - It is considered an error to complete the address phase of the transfer and not have data available in the transmit FIFO buffer. 3. Program the <code>TWIFIFOCTL</code> register. - Indicate if transmit FIFO buffer interrupts should occur with each byte transmitted (8 bits) or with each 2 bytes transmitted (16 bits). 4. Program the <code>TWIIMASK</code> register. - Enable the bits associated with the desired interrupt sources. - For example, programming the value <code>0x0030</code> results in an interrupt output to the processor when the master transfer completes, or if a master transfer error has occurred. 5. Program the <code>TWIMCTL</code> register. - This prepares and enables master mode operation. - As an example, programming the value <code>0x0201</code> enables master mode operation, generates a 7-bit address, sets the direction to master-transmit, uses standard mode timing, and transmits 8 data bytes before generating a stop condition.</p>
<p><img src="https://pic.islet.space/2021/05/20210527105334.png" alt="image-20210527104628291" style="zoom:67%;" /></p>
<h1 id="clock">Clock</h1>
<blockquote>
<p>The PLLD bits define the VCO output clock to core clock ratio to build the processor core clock (CCLK). The post divider can be changed any time and new division ratios are implemented on the fly.</p>
</blockquote>
<blockquote>
<p>The PCLK and CLKIN clocks are used in the arbitration logic for the shared external bus.</p>
</blockquote>
<blockquote>
<p>The PLL bit settings PLLM/PLLD in PMCTL register need to be programmed such that the PLLM/PLLD ratio is integer (for example 15/2=7.5 fractional, is not allowed).</p>
</blockquote>
<h2 id="iop-clock-pclk">IOP Clock (PCLK)</h2>
<p>The <strong><em>peripheral clock</em></strong> is derived from the <strong><em>core clock</em></strong> with <strong><em>a fixed post divisor of 2</em></strong>.</p>
<p>This clock is the <strong><em>master clock for</em></strong> most peripherals including the <strong><em>I/O processor</em></strong> (IOP).</p>
<h1 id="pll">PLL</h1>
<h2 id="pll-registers">PLL Registers</h2>
<h3 id="pmctl">PMCTL</h3>
<p><code>PMCTL</code> 寄存器，Power management control register。（是的，没错，就是不知道为啥管PLL的要叫PMCTL）</p>
<ul>
<li>Controls the <strong><em>SDCLK</em></strong> to core clock ratio <mark>or</mark> <strong><em>DDR2CLK</em></strong> to core clock ratio related to the external port timing.
<ul>
<li>The fundamental timing clock of the external port is <strong><em>SDRAM clock</em></strong> (SDCLK). The SDRAM clock ratio settings are independent from the peripheral clock (PCLK).
<ul>
<li>The AMI/SDRAM controller is capable of running at up to <strong><em>133 MHz</em></strong> for ADSP-2147x processors. See Table 4-2 for more information about <em>EXTERNAL PORT CLOCK FREQUENCIES</em>.</li>
</ul></li>
<li>The fundamental timing clock of the external port is <strong><em>DDR2 clock</em></strong> (DDR2_CLK). The DDR2 clock ratio settings are independent from the <strong><em>peripheral clock</em></strong> (PCLK).</li>
</ul></li>
<li>32位内存映射寄存器（32-bit memory-mapped register）</li>
<li>包含控制位，可控制：锁相环（PLL, phase lock loop）(PLL乘法器值（multiplier）、PLL除法器值（divider）、锁相环旁路模式（PLL bypass mode） 和 外围设备使能时钟控制（clock control for enabling peripherals）)</li>
<li>包含状态位，可追踪：CLK_CFG针脚（可读写）</li>
<li>PMCTL 寄存器的复位值取决于 <code>CLK_CFG</code> 引脚（bits 5-0 &amp; 17-16）</li>
<li>包含三选一的加速器（FIR、IIR、FFT）</li>
</ul>
<p><img src="https://pic.islet.space/2021/06/20210608103432.png" alt="image-20210608101359924" style="zoom: 67%;" /></p>
<figure>
<img src="https://pic.islet.space/2021/05/20210527150918.png" alt="image-20210527150852485" /><figcaption aria-hidden="true">image-20210527150852485</figcaption>
</figure>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-2 PMCTL 寄存器
</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-3 PMCTL寄存器位功能描述
</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210527151117.png" alt="image-20210527151035867" /><figcaption aria-hidden="true">image-20210527151035867</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/20210527151120.png" alt="image-20210527151017770" /><figcaption aria-hidden="true">image-20210527151017770</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/20210527151124.png" alt="image-20210527151110432" /><figcaption aria-hidden="true">image-20210527151110432</figcaption>
</figure>
<h3 id="pmctl1">PMCTL1</h3>
<p><img src="https://pic.islet.space/2021/05/20210527152316.png" alt="image-20210527152044822" style="zoom:67%;" /></p>
<p style="text-align: center; color: gray; font-weight: 800;">
图 A-3 PMCTL1 寄存器
</p>
<p style="text-align: center; color: gray; font-weight: 800;">
表A-4 PMCTL1寄存器位功能描述
</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210527152313.png" alt="image-20210527152155406" /><figcaption aria-hidden="true">image-20210527152155406</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/20210527152318.png" alt="image-20210527152229763" /><figcaption aria-hidden="true">image-20210527152229763</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/20210527152322.png" alt="image-20210527152251696" /><figcaption aria-hidden="true">image-20210527152251696</figcaption>
</figure>
<h3 id="plld">PLLD</h3>
<p><mark style="font-weight: 900;">Page 888:</mark> <strong>PLLD</strong>（PLL Divider）定义了 <strong>VCO输出时钟</strong> 和 <strong>核心时钟</strong> 的比值，以构建 <strong>处理器核心时钟</strong>（CCLK）。正在使用的分频器可以被随时改变，新的分频比率可以实时被应用。</p>
<p><mark style="font-weight: 900;">Page 957:</mark> <strong>PLLD</strong>只有2位，可以设置为2、4、8、16。</p>
<p><img src="https://pic.islet.space/2021/05/20210529113458.png" alt="image-20210529113003651" style="zoom:67%;" /></p>
<p><mark style="font-weight: 900;">&lt;def21479.h&gt;</mark>:<img src="https://pic.islet.space/2021/05/20210529113406.png" alt="image-20210529113403231" /></p>
<p>以下这几个操作中均需要用到PLLD，分别是：</p>
<ul>
<li>输出时钟生成器编程模型 （Output Clock Generator Programming Model）</li>
<li>改变链接口时钟（Changing the Link Port Clock）</li>
<li>发布分频器（Post Divider）</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/20210529113238.png" alt="image-20210529111641680" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/05/20210529113241.png" alt="image-20210529111748944" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/05/20210529113244.png" alt="image-20210529112121464" style="zoom:67%;" /></p>
<h2 id="官方示例">官方示例</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init_PLL</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> temp,i;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 1 - change the PLLD to 4</span></span><br><span class="line">	temp=*pPMCTL;   <span class="comment">//备份PMCTL寄存器的值至temp</span></span><br><span class="line">	temp&amp;=~PLLD16 ;     <span class="comment">//0x20，将PLLD16的值和temp进行逐位“与”运算</span></span><br><span class="line">	temp|=(PLLD4 | DIVEN) ;   <span class="comment">//0x260    0010 0110 0000</span></span><br><span class="line">	*pPMCTL = temp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 2 - 等待分频器稳定</span></span><br><span class="line">	SysWait(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 3 - set INDIV bit now to bring down the VCO speed and enter the bypass mode</span></span><br><span class="line">	temp&amp;=~DIVEN;</span><br><span class="line">	temp|=(INDIV | PLLBP);</span><br><span class="line">	*pPMCTL = temp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 4 -等待PLL锁定</span></span><br><span class="line">	SysWait(<span class="number">4096</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 5 - come out of the bypass mode</span></span><br><span class="line">	temp=*pPMCTL;</span><br><span class="line">	temp&amp;=~PLLBP;</span><br><span class="line">	*pPMCTL = temp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 6 - 等待分频器稳定</span></span><br><span class="line">	SysWait(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 7 - set the required PLLM and INDIV values here  and enter the bypass mode</span></span><br><span class="line">	 <span class="comment">//PLLM=16, INDIV=0,  fVCO=2*PLLM*CLKIN = 2*16*16.625 = 532 MHz</span></span><br><span class="line">	temp = *pPMCTL;</span><br><span class="line">	temp&amp;=~ (INDIV | PLLM63);</span><br><span class="line">	temp|= (PLL_MULT| PLLBP);</span><br><span class="line">	*pPMCTL = temp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 8 - wait for the PLL to lock</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4096</span>;i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 9 - come out of the bypass mode</span></span><br><span class="line">	temp = *pPMCTL;</span><br><span class="line">	temp&amp;=~PLLBP;</span><br><span class="line">	*pPMCTL=temp;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Step 10 - wait for dividers to stabilize</span></span><br><span class="line">	SysWait(<span class="number">16</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Step 11 - set the required values of PLLD(=2) and SDCKR (=2.5 for ADSP-21489 and 2 for ADSP-21479) here</span></span><br><span class="line">	<span class="comment">// fCCLK = fVCO/PLLD = 532/2 = 266 MHz, fSDCLK = fCCLK/SDCKR = 266/2 = 133 MHz</span></span><br><span class="line">	temp=*pPMCTL;</span><br><span class="line">	temp&amp;=~(PLLD16 | <span class="number">0x1C0000</span> );</span><br><span class="line">	temp|= (SDCKR2 | PLLD2 | DIVEN);</span><br><span class="line">	*pPMCTL=temp;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Step 12 - wait for the dividers to stabilize</span></span><br><span class="line">	SysWait(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>问题</strong>1： 为啥一定要使用temp变量来进行处理，直接使用 <code>*pPMCTL</code> 不是更方便吗？</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initPLL</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/********************************************************************************************/</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> i, pmctlsetting;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Set INDIV bit in PMCTL register</span></span><br><span class="line">	pmctlsetting = *pPMCTL; <span class="comment">// 备份PMCTL寄存器的原始值</span></span><br><span class="line">	pmctlsetting |= INDIV;	<span class="comment">//设置锁相环输出的分频率，0则是1分频，1则是2分频，此处通过或运算设置为二分频</span></span><br><span class="line">	*pPMCTL = pmctlsetting; <span class="comment">// 将至重新写入PMCTL寄存器</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Program PLL multiplier to same value as CLK_CFGx pins/previously programmed value in software……</span></span><br><span class="line">	*pPMCTL = pmctlsetting;</span><br><span class="line">	pmctlsetting |= PLLBP; <span class="comment">//设置锁相环旁路模式</span></span><br><span class="line">	*pPMCTL = pmctlsetting;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//Wait for recommended number of cycles</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4096</span>; i++)</span><br><span class="line">		NOP;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Bring PLL out of bypass mode by clearing PLLBP bit</span></span><br><span class="line">	*pPMCTL ^= PLLBP; <span class="comment">// 通过异或操作 取消旁路模式</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">		NOP;</span><br><span class="line"></span><br><span class="line">	pmctlsetting = *pPMCTL;</span><br><span class="line">	pmctlsetting &amp;= ~PLLM63; <span class="comment">//通过按位取反操作和与操作，清除PLLM所有位</span></span><br><span class="line">	pmctlsetting &amp;= ~INDIV;	 <span class="comment">//通过按位取反操作和与操作，清除分频</span></span><br><span class="line">	<span class="comment">// *pMCTL |= INDIV;</span></span><br><span class="line">	*pPMCTL = pmctlsetting;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// CLKIN = 16.625 MHz, PLLM=32, PLLD = 1, INDIV= 1 =&gt; fINPUT = 16.625/2 = 8.3125 MHz</span></span><br><span class="line">	<span class="comment">// CCLK = 2*PLLM*fINPUT/2*PLLD = (2*32*8.3125)/(2*1) = 266 MHz, SDCLK = CCLK/2 = 133 MHz</span></span><br><span class="line">	<span class="comment">// VCO frequency = 2*fINPUT*PLLM = 2*8.3125*32 = 532 &lt;= fVCOmax (532 MHz)</span></span><br><span class="line"></span><br><span class="line">	pmctlsetting = SDCKR2 | PLLM32 | INDIV | DIVEN; <span class="comment">//设置</span></span><br><span class="line">	*pPMCTL = pmctlsetting;</span><br><span class="line"></span><br><span class="line">	pmctlsetting |= PLLBP;	<span class="comment">//Setting the Bypass bit</span></span><br><span class="line">	pmctlsetting ^= DIVEN;	<span class="comment">//Clearing the DIVEN bit</span></span><br><span class="line">	*pPMCTL = pmctlsetting; <span class="comment">// Putting the PLL into bypass mode</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Wait for around 4096 cycles for the pll to lock.</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5000</span>; i++)</span><br><span class="line">		NOP;</span><br><span class="line"></span><br><span class="line">	pmctlsetting = *pPMCTL;</span><br><span class="line">	pmctlsetting ^= PLLBP; <span class="comment">//清除旁路模式</span></span><br><span class="line">	*pPMCTL = pmctlsetting;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//Wait for around 15 cycles for the output dividers to stabilize.</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">		NOP;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更改之后：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SystemWait</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> MAX)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX; i++) NOP;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initPLL</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	*pPMCTL |= INDIV;	<span class="comment">//设置锁相环输出的分频率，0则是1分频，1则是2分频，此处通过或运算设置为二分频</span></span><br><span class="line">	*pPMCTL |= PLLBP; <span class="comment">//设置锁相环旁路模式</span></span><br><span class="line">	SystemWait(<span class="number">4096</span>);</span><br><span class="line">	</span><br><span class="line">    *pPMCTL ^= PLLBP; <span class="comment">// 通过异或操作 取消旁路模式</span></span><br><span class="line">	SystemWait(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    *pPMCTL &amp;= ~( PLLM63 | INDIV );  <span class="comment">//PLLM和INDIV位全部或操作后取反，再与原PMCTL里的数据与操作，清除该两个定义位的数据</span></span><br><span class="line">	*pPMCTL = SDCKR2 | PLLM32 | INDIV | DIVEN; <span class="comment">//设置这几个位置的值</span></span><br><span class="line">    *pPMCTL = (*pPMCTL | PLLBP) ^ DIVEN</span><br><span class="line">	SystemWait(<span class="number">4096</span>);</span><br><span class="line"></span><br><span class="line">	*pPMCTL ^= PLLBP; <span class="comment">//清除旁路模式</span></span><br><span class="line">	SystemWait(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当使用乘法器（multipliers）和已发布的分频器（post dividers）对PLL进行编程时，<code>DIVEN</code> 和 <code>PLLBP</code> 不可以在同一个时钟周期内被编程。注意：<code>DIVEN</code> 位会自动清零（self clearing）。</p>
<blockquote>
<p>∵ CLKIN = 16.625 MHz, PLLM=32, PLLD = 1, INDIV= 1 ∴ f<sub>INPUT</sub> = 16.625/2 = 8.3125 MHz ∴ CCLK = 2*PLLM *f<sub>INPUT</sub>/2*PLLD = (2*32*8.3125)/(2*1) = 266 MHz ∴ SDCLK = CCLK/2 = 133 MHz， 符合 2147X 对 SDRAM 时钟的要求 VCO frequency = 2*f<sub>INPUT</sub>*PLLM = 2<em>8.3125</em>32 = 532 &lt;= f<sub>VCOmax</sub> (532 MHz)</p>
</blockquote>
<h3 id="步骤总结">步骤总结</h3>
<p>从官方给出的示例代码中，可以将步骤总结如下：</p>
<ol type="1">
<li><mark>设置PLLD</mark> - 等待分频器稳定</li>
<li><mark>设置INDIV位以降低VCO速度，并进入旁路模式</mark> - 等待PLL锁定</li>
<li><mark>从旁路模式出来</mark> - 等待分频器稳定</li>
<li><mark>设置PLLM和INDIV，并进入旁路模式</mark> - 等待PLL锁定</li>
<li><mark>从旁路模式出来</mark> - 等待分频器稳定</li>
<li><mark>设置PLLD和SDCKR</mark> - 等待分频器稳定</li>
</ol>
<p>从以上步骤可以看出，PLL的初始化，主要是设置 <strong>PLLD</strong> 、 <strong>INDIV</strong> 、 <strong>PLLM</strong> 、 <strong>SDCKR</strong> 的值，途中反复等待 <strong>分频器稳定</strong> 和 <strong>PLL锁定</strong>。</p>
<h3 id="问题总结">问题总结</h3>
<ol type="1">
<li>进入旁路模式的意义：</li>
</ol>
<h1 id="interrupt-control-of-pins">Interrupt Control of PINs</h1>
<p><em>Page93</em>：</p>
<blockquote>
<p>For information on the IRPTL, LIRPTL, and IMASK registers, see <em>SHARC Processor Programming Reference</em>.</p>
</blockquote>
<p>下表2-1介绍了经过DAI和DPI的数据通道：</p>
<ul>
<li>DAI共有32个通道（22个外围设备通道，10个miscellaneous通道），DPI共有12个通道（3个外围设备通道，9个miscellaneous通道）</li>
<li>DAI允许设置优先级，而DPI不允许</li>
<li>DAI和DPI都能识别上升沿（Rising Edge）或下降沿（Falling Edge）</li>
<li>到核心的中断（Interrupt to Core)，DAI为2，DPI为1</li>
<li>DAI和DPI都是4分频</li>
</ul>
<figure>
<img src="https://pic.islet.space/2021/06/20210602150124.png" alt="image-20210602150117965" /><figcaption aria-hidden="true">image-20210602150117965</figcaption>
</figure>
<h2 id="特征">特征</h2>
<ul>
<li><p>两个系统中断控制器（SIC, System Interrupt Controller），分别为DAI SIC 和 DPI SIC，连接至核心中断控制器（CIC, Core Interrupt Controller）。</p></li>
<li><p>DAI SIC 允许高/低中断优先级配置选项</p></li>
<li><p>DAI中断控制器提供最高32条独立可配置通道</p></li>
<li><p>DPI中断控制器提供最高12条独立可配置通道</p></li>
<li><p>DAI SIC和DPI SIC都允许针对波形的上升沿或下降沿进行锁存</p></li>
<li><p>与核心锁存中断一致的中断延迟</p></li>
<li><p>时钟：系统中断控制器的基础时钟是 <em>4分频</em> (f<sub>PCLK</sub>)/4 ；所有中断的确认响应速度为4分频最高。</p></li>
</ul>
<h2 id="中断寄存器">中断寄存器</h2>
<p><strong>可编程中断控制寄存器</strong>（<strong>PICR</strong>3 - 0）： 为了登记（assign）独立优先级（individual priorities）到各外围通道，19个外围设备可路由至可编程中断输入。</p>
<p><strong>DAI 中断屏蔽寄存器</strong>（<strong>DAI_IMASK</strong>）：屏蔽上升或下降沿波形。因可屏蔽的边沿有上升沿或下降沿，因此DAI中断屏蔽寄存器分为 DAI_IMASK_RE 和 DAI_IMASK_FE。</p>
<p><strong>DAI 中断屏蔽优先级寄存器</strong>（<strong>DAI_IMASK_PRI</strong>）：为DAI高/低中断优先级屏蔽中断。</p>
<p><strong>DAI 中断锁存寄存器</strong>（<strong>DAI_IRPTL</strong>）: 为DAI高/低优先级中断锁存中断。</p>
<p><strong>DPI 中断屏蔽寄存器</strong>（<strong>DPI_IMASK</strong>）：屏蔽上升或下降沿波形。因可屏蔽的边沿有上升沿或下降沿，因此DPI中断屏蔽寄存器分为 DPI_IMASK_RE 和 DPI_IMASK_FE。</p>
<p><strong>DPI 中断锁存寄存器</strong>（<strong>DPI_IRPTL</strong>）：为DPI中断锁存中断。</p>
<figure>
<img src="https://pic.islet.space/2021/06/20210603134601.png" alt="image-20210603134437928" /><figcaption aria-hidden="true">image-20210603134437928</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/06/20210603134603.png" alt="image-20210603134453465" /><figcaption aria-hidden="true">image-20210603134453465</figcaption>
</figure>
<h2 id="功能描述">功能描述</h2>
<h3 id="可编程中断优先级控制">可编程中断优先级控制</h3>
<h4 id="外围中断">外围中断</h4>
<h4 id="软件中断">软件中断</h4>
<h4 id="多重中断请求信号的外围设备">多重中断请求信号的外围设备</h4>
<h3 id="系统中断控制器">系统中断控制器</h3>
<p>DAI/DPI外围相关事件发生时，这些针脚各自拥有能够指向核心的系统中断控制器。</p>
<p>相对于SHARC核心，音频事件通常发生不频繁，DAI/DPI中断控制器将其所有中断减少到核心主中断系统中的三个中断信号上：</p>
<ul>
<li>一个映射为DAI低优先级</li>
<li>一个映射为DAI高优先级</li>
<li>第三个映射到DPI中断。</li>
</ul>
<p>以上这种操作，允许程序更加粗略地去表示优先级。</p>
<p>输出总线中断信号可以有逻辑地导向（ORed）一个中断线并递交至（fed to）核心中断控制逻辑。</p>
<blockquote>
<p>The output bus interrupt signals are logically ORed into one interrupt line and fed to the core’s interrupt controller logic.</p>
</blockquote>
<figure>
<img src="https://pic.islet.space/2021/06/20210602155414.png" alt="image-20210602154656729" /><figcaption aria-hidden="true">image-20210602154656729</figcaption>
</figure>
<p><strong>注意</strong>：DAI/DPI中断控制器拥有与核心中断控制器相同的中断延迟，或6个延时周期以相应异步中断。</p>
<p>被用于配置DAI中断控制器的有3个寄存器，被用于配置DPI中断控制器的有2个寄存器。32个DAI中断源和12个DPI中断源中的任意一个都可以用于独立配置开关，来控制进入信号的上升沿、下降沿、上升下降沿（both edges）或无沿（neither edge）。</p>
<p>需要注意的是，当核心中断寄存器是系统寄存器时，DAI/DPI中断控制寄存器是被内存映射的寄存器（memory mapped registers），且通过外围设备总线被接入（accessed via the peripheral bus）。</p>
<h4 id="daidpi中断源">DAI/DPI中断源</h4>
<p>DAI有5个外围（中断）源都被多路复用至（multiplexed into）32个中断源里，并以 <code>DAI_INT 0 ~ 31</code> 作为标签名称。</p>
<p>DPI有3个外围（中断）源都被多路复用至（multiplexed into）12个中断源里，并以 <code>DPI_INT 0 ~ 13</code> 作为标签名称。</p>
<p>下表介绍了DAI/DPI在不同的通信方式和信号响应的关系。</p>
<p><img src="https://pic.islet.space/2021/06/image-20210602195334432.png" alt="image-20210602195334432" style="zoom:67%;" /></p>
<h4 id="dai中断锁存优先级设置">DAI中断锁存优先级设置</h4>
<p>DAI系统中断控制器寄存器对（ <code>DAI_IRPTL_H</code> 和 <code>DAI_IRPTL_L</code>）取代了通常由核心中断控制器的IRPTL寄存器执行的功能。一个单一的寄存器（ <code>DAI_IRPTL_PRI</code>）指定了这些中断被映射到哪个锁存器中。</p>
<p>当一个DAI中断被配置为低优先级（<code>DAI_IMASK_PRI</code> 位被清除，默认设置），它将被锁在 <code>DAI_IRPTL_L</code> 寄存器中。低优先级的DAI中断，<code>DAILI</code>，被连接到 <code>P12I</code> 核心中断上。默认情况下。<code>PICR</code> 寄存器可以改变这种连接。每当DAI的低优先级中断被设置，<code>LIRPTL</code>寄存器中的 <code>DAILI</code> 位就会被设置，核心就会为该低优先级中断服务。</p>
<p><img src="https://pic.islet.space/2021/06/image-20210602200433030.png" alt="image-20210602200433030" style="zoom:67%;" /></p>
<p><strong>注意</strong>： DAI会在<strong>中断向量表</strong>中触发一个高优先级一个低优先级的中断。当任一来自DAI的中断需要服务时，两个核心ISR之一必须审查（interrogate）DAI的中断控制器以判定其中断源。</p>
<blockquote>
<p>中断向量表（Interrupt Vector Table, IVT）, Page 177</p>
<p><img src="https://pic.islet.space/2021/06/image-20210602205507981.png" alt="image-20210602205507981" style="zoom:67%;" /></p>
</blockquote>
<h4 id="dpi中断锁存">DPI中断锁存</h4>
<p>DPI系统中断控制寄存器（<code>DPI_IRPTL</code>）取代了通常是由核心控制器寄存器（<code>IRPTL</code>）的功能。</p>
<p>当DPI中断配置时，将被锁存在 <code>DPI_IRPTL</code> 寄存器中。默认情况下，DPI中断被连接至P14I核心中断。PICR寄存器可以改变其连接。无论何时，DPI中断一旦设置，<code>LIRPTL</code> 寄存器中已编程的DPI位会被设置，且核心将会为已编程优先级的中断服务。</p>
<h4 id="daidpi边沿触发中断屏蔽">DAI/DPI边沿触发中断屏蔽</h4>
<p>DAI上升沿中断屏蔽寄存器 <code>DAI_IMASK_RE</code> 和 DAI下降沿中断屏蔽寄存器 <code>DAI_IMASK_FE</code> 取代了核心中断控制器 <code>IMASK</code> 的版本。与 <code>IMASK</code> 寄存器一样，这些DAI寄存器提供了一种指定（specify）哪条中断被确认和处理，哪条中断会被忽略的方法。这对寄存器的功能与 <code>IMASK</code> 一致，但具有更高程度的细化。</p>
<p>对 <code>DAI_IMASK_RE</code> 、 <code>DAI_IMASK_FE</code> 、 <code>DPI_IMASK_RE</code> 、<code>DPI_IMASK_FE</code>这些寄存器的使用，能够使程序对上升沿、下降沿、上升下降沿、或者无沿（neither rising or falling edge）的程序确认或响应能够分别独立地屏蔽（masked separately）。</p>
<p>从SRU过来的信号能够被用于生成中断。例如，当 <code>DAI_IMASK_FE</code> 寄存器的 <code>DAI_30_INT</code> 位被设置为1时，任何从外部通道过来的下降沿信号都能在核心中生成中断，且中断锁存器会被设定。对 <code>MASK</code> 寄存器的读取不会清除 <code>IRPTL</code> 寄存器。</p>
<h4 id="daidpi事件中断屏蔽">DAI/DPI事件中断屏蔽</h4>
<p>系统中断控制器需要一个外设的中断源与事件信号相对应的信息（参考第2-8页中的表2-2）。如此一来，就只有上升沿被当做中断源。对于被标记为事件的DAI/DPI外设，程序可以只在上升沿解除中断源的屏蔽。</p>
<h4 id="daidpi中断服务">DAI/DPI中断服务</h4>
<p>当多通道被复用至一个中断输出信号时，中断确认的操作方式不尽相同。当DAI/DPI中的服务必须被处理时，三者任一的中断服务程序（interrupt service routines）（<code>DAILI</code>, <code>DAIHI</code> 和 <code>DPII</code>）必须查询RIC以确定中断源。该中断源可能是一个或多个DAI/DPI通道（<code>DAI_INT31-0</code> 、 <code>DPI_INT13-0</code>）。</p>
<ul>
<li>当 <code>DAI_IRPTL_H</code> 被读取时，高优先级锁存的中断将会被清除。</li>
<li>当 <code>DAI_IRPTL_L</code> 被读取时，低优先级锁存的中断将会被清除。</li>
<li>当 <code>DPI_IRPTL</code> 被读取时，锁存中断将会被清除。</li>
<li>当 <code>DAI_IRPTL_H/L</code> 寄存器被读取时， <code>IDP_FIFO_GTN_INT</code> 中断不会被清除。当中断需要离开的情况发生时，中断自然会被清除。（This interrupt is cleared automatically when the situation that caused the interrupt goes away.）</li>
<li><code>DPI_IRPTL_SH</code> 是被用于读取主寄存器 <code>DPI_IRPTL</code>的影子寄存器。读取这些影子寄存器将会返回 <code>DPI_IRPTL</code> 寄存器中的数据却不会清除里面的内容。</li>
</ul>
<p>如果在清空锁存器的同一周期内发生中断，则该机制的优先级较低，新的中断器被注册。</p>
<p><strong>注意</strong>：</p>
<ul>
<li>TWII 和UARTRXI 中断不遵循这条原则。确认信号将在这些外围锁存器中发生。</li>
<li>读取中断锁存器（<code>DAI_IRPTL_X</code> 或 <code>DPI_IRPTL</code> ）将会清除中断（只读清除类型）。因此，ISR必须为所有已发现的中断提供服务。即如果复用中断（mumtiple interrupts）被锁存在复用屏蔽寄存器（multiple mask registers）中，必须在执行 <strong><em>RTI</em></strong> 指令前，对所有中断进行服务。</li>
</ul>
<blockquote>
<p><strong>RTI</strong> （(interrupt) return instruction）：中断返回指令</p>
<p>在中断服务程序中用于返回中断指令，在运行中断之前，用JSR指令将PC（程序计数器）和SR（状态寄存器）压入堆栈，当中断服务程序结束时，执行RTI或RTIS指令，将PC和SR从堆栈中弹出。</p>
<p>——<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/RTI/7461669">RTI</a></p>
</blockquote>
<h3 id="中断服务">中断服务</h3>
<p>中断服务部分主要描述了中断服务程序操作（interrupt service routines operate）如何正确清除中断请求。</p>
<p>中断驱动I/O是较为有利（advantageous）的，因为核心并不需要去轮询（poll）输入信号。当一次中断触发时，定序器（sequencer）通常会完成其现有的指令并跳转至中断向量表（IVT）。（向量）地址（the address）通常会从向量表里指向ISR程序。定序器（sequencer）跳转至该程序，完成程序执行并通过执行RTI指令退出程序。然而，这条规则并不对所有情况适用，在ISR程序中，有三种中断确认机制，均取决于外围设备：</p>
<ul>
<li>RTI指令</li>
<li>只读清除（ROC）状态位 + RTI指令</li>
<li>写1清除（W1C，Write-1-to-clear）状态为 + RTI指令</li>
</ul>
<p><mark>锁存器必须在被读取的时候清除中断源</mark>，因此DAI/DPI被设计来正确地执行此项工作。需要注意的是，锁存器读取操作会在退出中断程序（exiting an interrupt routine）前自动确认请求（automatically acknowledges the request）。在W1C机制，程序必须写入锁存器的特定位（specific bit）以正确清除中断（terminate the interrupt properly）。</p>
<p><strong>注意</strong>：如果确认机制没有被正确遵守，中断将可能在未可预知且频率不定（unwanted and sporadic）的情况下发生。</p>
<h4 id="核心缓存服务请求输入输出模式">核心缓存服务请求（输入输出模式）</h4>
<p>如果数据流外围设备通过核心访问各自DMA FIFO的数据缓存，则缓存（器）在中断确认过程中发挥着重要作用。</p>
<p>例如，一个接收缓存已满，中断生成时ISR中的缓存被读取，就会触发清除请求（ROC + RTI）。同样的，如果一个传输缓存已空，中断生成时，写入操作将会清除请求（WOC + RTI）。</p>
<h4 id="dma接入">DMA接入</h4>
<p>如果外设通过DMA访问缓冲区，逻辑操作就不同了。在DMA中，缓存状态对中断没有影响。相反，每当DMA计数寄存器达到0时就会产生一个中断。不同的外围设备所使用的中断确认机制都不同。</p>
<blockquote>
<p><strong>DMA</strong> Direct Memory Access 直接内存访问</p>
<p>是所有现代电脑的重要特色，它允许不同速度的硬件装置来沟通，而不需要依赖于 CPU 的大量中断负载。否则，CPU 需要从来源把每一片段的资料复制到暂存器，然后把它们再次写回到新的地方。在这个时间中，CPU 对于其他的工作来说就无法使用。</p>
</blockquote>
<h3 id="中断延迟">中断延迟</h3>
<p>优秀的编程会要求一条（完整的）中断服务 <em>确认</em> 中断请求尽可能简洁地返回至外围设备。这种（中断）响应允许外围设备尽可能快地感知到其他事件。</p>
<p>此（中断确认）服务程序（routine）必须去确保（中断）请求在RTI指令执行前被释放，否则（中断）服务程序会在执行完RTI指令后被立即调用。</p>
<p>有些中断请求通过W1C操作来清除，该写入指令并没有让核心停滞（stall the core）。相反，该操作被自动锁存在写缓存中，并在被发送至外围总线前会通过外围时钟（<strong><em>PCLK</em></strong>）进行同步。</p>
<p>在W1C操作到达外围设备前，此操作可能会需要多个 <strong><em>CCLK</em></strong> 周期（cycles）。如果 W1C 操作在服务程序的结束点进行操作，一个 dummy 读取操作需要在RTI指令前被执行，以确保外围设备能够在RTI之前释放请求。</p>
<p>下列案例描述了中断延迟：</p>
<ul>
<li>对于具有W1C确认机制的外设来说，写入外设的状态寄存器以清除中断会导致一定的延迟（因为寄存器的写入效应延迟）。</li>
<li>中断驱动的数据传输（核心或DMA）来自任何产生中断和使用ISR程序（routine）的外设，写入外设数据缓冲区（以清除中断）或控制寄存器会导致一定的延迟（因为存在寄存器写入效果延迟和缓冲区时钟域）。</li>
</ul>
<p>如果像案例所示，程序在延迟的周期内（最多10个CCLK周期），程序从中断服务程序（RTI指令）中生成，中断再次出现。为了避免中断多次出现，需要采取下列其中一种措施：（<strong>注意</strong>：中断再生的限制（interrupt regeneration restriction）不适用于DMA操作模式下的任何SPORT。）</p>
<ol type="1">
<li><strong>在中断返回（RTI）前，从相同的外围区块中读取IOP寄存器。读取操作（的同时）会强制写入，如下列样例所示。</strong></li>
</ol>
<p><strong>SPI中断服务程序</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">R0 &#x3D; dm(i0,m0);</span><br><span class="line">dm(TXSPI) &#x3D; R0; &#x2F;&#x2F; 写入SPI数据缓存</span><br><span class="line">R0 &#x3D; dm(SPICTL); &#x2F;* this dummy read forces the previous write to complete *&#x2F;</span><br><span class="line">rti;</span><br></pre></td></tr></table></figure>
<p><strong>PWM中断服务程</strong>序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r1 &#x3D; PWM_STAT3;</span><br><span class="line">dm(PWMGSTAT)&#x3D;r1; &#x2F;* W1C to PWM status reg *&#x2F;</span><br><span class="line">r0&#x3D;dm(PWMGSTAT); &#x2F;* this dummy read forces the previous write to complete *&#x2F;</span><br><span class="line">rti;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li><strong>在写入操作后添加足够的NOP指令。在最坏的情况下，程序需要在写入后添加10条NOP指令，如下面的示例代码所示。</strong></li>
</ol>
<p><strong>中断服务程序</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">R0 &#x3D; 0x0;</span><br><span class="line">dm(SPICTL) &#x3D; R0; &#x2F;* or disable SPI control *&#x2F;</span><br><span class="line">nop; nop; nop; nop; nop; </span><br><span class="line">nop; nop; nop; nop; nop; </span><br><span class="line">rti;</span><br></pre></td></tr></table></figure>
<h4 id="dma完成类型">DMA完成类型</h4>
<p>在SHARC处理器中，中断在内部传输完成（此时DMA计数器过期（expired））后被生成。但是，在某些案例中，传输可能尚未完成（不同通道优先级的原因）且有效的数据仍然存在于（resides in）外设的缓冲区中等待着被传输。为了解决此问题，引入了中断访问完成模式（interrupt access completion mode），在此模式下，上一个数据离开缓存时，中断会被生成。此模式可用于 SPORT 、 SPI 、 连接口 和 外部接口DMA。</p>
<h2 id="调试特征">调试特征</h2>
<h4 id="影子中断寄存器">影子中断寄存器</h4>
<ul>
<li><p>影子中断寄存器（Shadow Interrupt Register）可用于 IDP, S/PDIF, ASRC, UART, TWI 和 DAI/DPI。</p></li>
<li><p>DAI/DPI 中断控制器拥有可以简化调试活动且不会操纵状态控制（manipulate status control）的影子寄存器。</p></li>
<li><p>任何对 <code>DAI_IRPTL_x_SH</code> 或 <code>DPI_IRPTL_SH</code> 影子寄存器的读取都会提供 和 读取 <code>DAI_IRPTL_x</code> 或 <code>DPI_IRPTL</code> 寄存器一样的数据。</p></li>
<li><p>对DAI/DPI影子寄存器的读取不会改变核心中断控制器（core interrupt controller）对中断的确认状态。</p></li>
</ul>
<h2 id="术语总结">术语总结</h2>
<p>中断确认</p>
<p>中断请求</p>
<p>中断服务</p>
<p>中断延迟</p>
<h1 id="sport">SPORT</h1>
<p>对所有SPORT的研究仅限于对I2S开发中需要的研究。</p>
<p>首先，SPORT是指Serial Port，即串行接口。有0 ~ 7 共8个这样的SPORT。</p>
<figure>
<img src="https://pic.islet.space/2021/06/20210629151248.png" alt="image-20210629151245935" /><figcaption aria-hidden="true">image-20210629151245935</figcaption>
</figure>
<p>如果需要用到I2S模式，则需要针对 <code>SPCTLx</code> 和 <code>SPMCTLx</code> 两个寄存器中的某些位做单独设置，其设置指引表格如下 ：</p>
<p><img src="https://pic.islet.space/2021/06/20210629151016.png" alt="image-20210629150923785" style="zoom:80%;" /></p>
<h2 id="spctl">SPCTL</h2>
<p>SPCTL 寄存器在多种模式下具有不同的位定义。</p>
<h3 id="寄存器位指示">寄存器位指示</h3>
<p><img src="https://pic.islet.space/2021/06/20210629162516.png" alt="image-20210629162509309" style="zoom: 80%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629162554.png" alt="image-20210629162550029" style="zoom:80%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629162731.png" alt="image-20210629162728195" style="zoom:80%;" /></p>
<h3 id="寄存器位说明">寄存器位说明</h3>
<p><img src="https://pic.islet.space/2021/06/20210629172559.png" alt="image-20210629172318405" style="zoom: 67%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629172604.png" alt="image-20210629172412087" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629172610.png" alt="image-20210629172430662" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629172614.png" alt="image-20210629172455121" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629172619.png" alt="image-20210629172510903" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629172625.png" alt="image-20210629172534214" style="zoom:67%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629172628.png" alt="image-20210629172549089" style="zoom:67%;" /></p>
<h2 id="spctlnx">SPCTLNx</h2>
<p><strong><em>FE</em></strong>: frame edge 帧边沿</p>
<p><strong><em>FS</em></strong>: frame sync 帧同步</p>
<blockquote>
<p>These registers (where x signifies SPORT 0 through 7) allow programs to <mark>set frame sync edge detection for I2S compatibility</mark>. These registers also <mark>allow interrupts to be generated</mark> when transmit DMA count is expired or when the last bit of last word is shifted out.</p>
</blockquote>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630162335568.png" alt="image-20210630162335568" /><figcaption aria-hidden="true">image-20210630162335568</figcaption>
</figure>
<p>注意：212XX系列和213xx系列芯片上并没有这个寄存器。</p>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630162415539.png" alt="image-20210630162415539" /><figcaption aria-hidden="true">image-20210630162415539</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630162442482.png" alt="image-20210630162442482" /><figcaption aria-hidden="true">image-20210630162442482</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630162505383.png" alt="image-20210630162505383" /><figcaption aria-hidden="true">image-20210630162505383</figcaption>
</figure>
<h2 id="spmctlx">SPMCTLx</h2>
<p>串行接口多通道控制寄存器，Serial ports multichannel control registers</p>
<p>在214xx系列芯片中，该寄存器独立工作，并不成对操作；因此每一个SPORT都有其独立的多通道控制寄存器，所以只需要向两个SPMCTLx寄存器写一次，就可以将SPORT作为一对来操作。</p>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630162916913.png" alt="image-20210630162916913" /><figcaption aria-hidden="true">image-20210630162916913</figcaption>
</figure>
<p>其中，x表示0、2、4、6，y表示1、3、5、7。</p>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630163319226.png" alt="image-20210630163319226" /><figcaption aria-hidden="true">image-20210630163319226</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630163357041.png" alt="image-20210630163357041" /><figcaption aria-hidden="true">image-20210630163357041</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630163451919.png" alt="image-20210630163451919" /><figcaption aria-hidden="true">image-20210630163451919</figcaption>
</figure>
<h1 id="dma">DMA</h1>
<blockquote>
<p>DMA(Direct Memory Access，直接存储器访问) 是所有现代电脑的重要特色，它允许不同速度的硬件装置来沟通，而不需要依赖于 CPU 的大量中断负载。否则，CPU 需要从来源把每一片段的资料复制到暂存器，然后把它们再次写回到新的地方。在这个时间中，CPU 对于其他的工作来说就无法使用。</p>
</blockquote>
<p>CPU和DMA控制器对内存的访问是交替进行的，因为对内存的访问涉及到总线控制，而DMA控制器和CPU在同一时刻仅有一个能获取总线控制权。更具体的DMA控制器与CPU工作方式见下方 <em>传送方式</em>。</p>
<blockquote>
<p>DMA传输方式无需CPU直接控制传输，也没有中断处理方式那样保留现场和恢复现场过程，通过硬件为RAM和IO设备开辟一条直接传输数据的通道，使得CPU的效率大大提高。</p>
</blockquote>
<p>DMA 传输将数据从一个地址空间复制到另外一个地址空间。当CPU 初始化这个传输动作，传输动作本身是由 DMA 控制器来实行和完成。典型的例子就是移动一个外部内存的区块到芯片内部更快的内存区。像是这样的操作并没有让处理器工作拖延，反而可以被重新排程去处理其他的工作。DMA 传输对于高效能 嵌入式系统算法和网络是很重要的。</p>
<figure>
<img src="https://pic.islet.space/2021/06/format,f_auto.jpeg" alt="DMA" /><figcaption aria-hidden="true">DMA</figcaption>
</figure>
<p>在实现DMA传输时，是由 <strong><em>DMA控制器</em></strong> 直接掌管总线，因此，存在着一个总线控制权转移问题。即DMA传输前，CPU要把总线控制权交给DMA控制器，而在结束DMA传输后，DMA控制器应立即把总线控制权再交回给CPU。一个完整的DMA传输过程必须经过 <strong>DMA请求</strong>、<strong>DMA响应</strong>、<strong>DMA传输</strong>、<strong>DMA结束</strong> 4个步骤。</p>
<blockquote>
<p><strong>请求</strong>：CPU对DMA控制器初始化，并向I/O接口发出操作命令，I/O接口提出DMA请求。</p>
<p><strong>响应</strong>：DMA控制器对DMA请求判别优先级及屏蔽，向总线裁决逻辑提出总线请求。当CPU执行完当前总线周期即可释放总线控制权。此时，总线裁决逻辑输出总线应答，表示DMA已经响应，通过DMA控制器通知I/O接口开始DMA传输。</p>
<p><strong>传输</strong>：DMA控制器获得总线控制权后，CPU即刻挂起或只执行内部操作，由DMA控制器输出读写命令，直接控制RAM与I/O接口进行DMA传输。在DMA控制器的控制下，在存储器和外部设备之间直接进行数据传送，在传送过程中不需要中央处理器的参与。开始时需提供要传送的数据的起始位置和数据长度。</p>
<p><strong>结束</strong>：当完成规定的成批数据传送后，DMA控制器即释放总线控制权，并向I/O接口发出结束信号。当I/O接口收到结束信号后，一方面停 止I/O设备的工作，另一方面向CPU提出中断请求，使CPU从不介入的状态解脱，并执行一段检查本次DMA传输操作正确性的代码。最后，带着本次操作结果及状态继续执行原来的程序。</p>
</blockquote>
<p>由此可见，DMA传输方式无需CPU直接控制传输，也没有中断处理方式那样保留现场和恢复现场的过程，通过硬件为RAM与I/O设备开辟一条直接传送数据的通路，使CPU的效率大为提高。</p>
<h2 id="传送原理">传送原理</h2>
<p>DMA技术的出现，使得外围设备可以通过DMA控制器直接访问内存，与此同时，CPU可以继续执行程序。那么DMA控制器与CPU怎样 <mark>分时使用内存</mark> 呢?通常采用以下三种方法：</p>
<ol type="1">
<li><p>停止CPU访问内存；</p></li>
<li><p>周期挪用；</p></li>
<li><p>DMA与CPU交替访问内存。</p></li>
</ol>
<h3 id="停止cpu访问内存">停止CPU访问内存</h3>
<p>当外围设备要求传送一批数据时，由DMA控制器发一个停止信号给CPU，要求CPU放弃对地址总线、数据总线和有关控制总线的使用权。DMA控制器获得总线控制权以后，开始进行数据传送。在一批数据传送完毕后，DMA控制器通知CPU可以使用内存，并把总线控制权交还给CPU。图(a)是这种传送方式的时间图。很显然，在这种DMA传送过程中，CPU基本处于不工作状态或者说保持状态。</p>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630135714198.png" alt="image-20210630135714198" /><figcaption aria-hidden="true">image-20210630135714198</figcaption>
</figure>
<p><strong>优点</strong>: 控制简单，它适用于数据传输率很高的设备进行成组传送。</p>
<p><strong>缺点</strong>: <mark>在DMA控制器访问内存阶段，内存的效能没有充分发挥，相当一部分内存工作周期是空闲的</mark>。这是因为，<mark>外围设备传送两个数据之间的间隔一般总是大于内存存储周期，即使高速I/O设备也是如此</mark>。例如，软盘读出一个8位二进制数大约需要32us，而半导体内存的存储周期小于0.5us，因此许多空闲的存储周期不能被CPU利用。</p>
<h3 id="周期挪用">周期挪用</h3>
<p>当I/O设备没有DMA请求时，CPU按程序要求访问内存；一旦I/O设备有DMA请求，则由I/O设备挪用一个或几个 <strong>内存周期</strong>。这种传送方式的时间图如下图(b)：</p>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630135800538.png" alt="image-20210630135800538" /><figcaption aria-hidden="true">image-20210630135800538</figcaption>
</figure>
<p>I/O设备要求DMA传送时可能遇到两种情况： 1. 此时CPU不需要访内，如CPU正在执行乘法指令。由于乘法指令执行时间较长，此时<mark>I/O访内与CPU访内没有冲突，即I/O设备挪用一二个内存周期对CPU执行程序没有任何影响</mark>。</p>
<ol start="2" type="1">
<li>I/O设备要求访内时CPU也要求访内，这就产生了访内冲突，在这种情况下<mark>I/O设备访内优先，因为I/O访内有时间要求，前一个I/O数据必须在下一个访问请求到来之前存取完毕</mark>。显然，在这种情况下I/O 设备挪用一二个内存周期，意味着CPU延缓了对指令的执行，或者更明确地说，在CPU执行访内指令的过程中插入DMA请求，挪用了一二个内存周期。 与停止CPU访内的DMA方法比较，周期挪用的方法既实现了I/O传送，又较好地发挥了内存和CPU的效率，是一种广泛采用的方法。但是I/O设备每一次周期挪用都有申请总线控制权、建立线控制权和归还总线控制权的过程，所以传送一个字对内存来说要占用一个周期，但对DMA控制器来说一般要2—5个内存周期(视逻辑线路的延迟而定)。因此，周期挪用的方法适用于I/O设备读写周期大于内存存储周期的情况。</li>
</ol>
<h3 id="dma与cpu交替访问内存">DMA与CPU交替访问内存</h3>
<p>如果CPU的工作周期比内存存取周期长很多，此时采用交替访内的方法可以使DMA传送和CPU同时发挥最高的效率。这种传送方式的时间图如下：</p>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210630135821665.png" alt="image-20210630135821665" /><figcaption aria-hidden="true">image-20210630135821665</figcaption>
</figure>
<p>此图是DMA与CPU交替访内的详细时间图．假设CPU工作周期为1.2us，内存存取周期小于0.6us，那么一个CPU周期可分为C1和C2两个分周期，其中C1专供DMA控制器访内，C2专供CPU访内。</p>
<p>这种方式不需要总线使用权的申请、建立和归还过程，总线使用权是通过C1和C2分时制的。<mark>CPU和DMA控制器各自有自己的访内地址寄存器、数据寄存器和读/写信号等控制寄存器</mark>。在C1周期中，如果DMA控制器有访内请求，可将地址、数据等信号送到总线上。在C2周期中，如CPU有访内请求，同样传送地址、数据等信号。事实上，对于总线，这是用C1，C2控制的一个多路转换器，这种总线控制权的转移几乎不需要什么时间，所以对DMA传送来讲效率是很高的。</p>
<p>这种传送方式又称为 <strong><em>透明的DMA</em></strong> 方式，其来由是这种DMA传送对CPU来说，如同透明的玻璃一般，没有任何感觉或影响。在透明的DMA方式下工作，CPU既不停止主程序的运行，也不进入等待状态，是一种高效率的工作方式。当然，相应的硬件逻辑也就更加复杂。</p>
<h2 id="adsp芯片中的dma">ADSP芯片中的DMA</h2>
<p>此处仅以《HWR》文件做参考。</p>
<ol type="1">
<li>外围设备可以通过DMA（控制器）访问缓存，但其逻辑操作会有所区别。</li>
<li>在DMA中，缓存器状态与中断没有差别。相反，不管是否归零，DMA计数寄存器都会生成一个中断。</li>
<li>DMA控制器的确认机制与外设不同。</li>
<li>外部接口拥有两个可以控制 <strong>SDRAM/DDR2</strong> 或 <strong>异步内存接口</strong>（AMI，Asynchronous Memory Interface）的DMA通道。AMI控制器通过额外的8/16bits数据宽度以支持DMA；SDRAM/DDR2 通过额外的16bits数据宽度以支持DMA。</li>
<li>外部接口DMA通过不同的寻址类型（由内向外或由内向内）以支持两种不同的DMA通道。</li>
</ol>
<h2 id="external-ports">External ports</h2>
<p><strong>外部接口</strong>（External ports）具有以下特征：</p>
<ol type="1">
<li>支持两种DMA通道</li>
<li>支持4种模式：<strong>标准模式</strong>、可以自由选择方向的<strong>链式模式</strong>（chained mode）、<strong>点选列表模式</strong>（tap list mode）(Scatter 或 Gather)、<strong>延迟线模式</strong>（delay line mode）(写入以读取)</li>
<li>所有以上模式可以循环运行（operate in circular fashion）；且在循环模式下，一些模式允许回写索引指针，以正确寻址下一个传输控制块（TCB）</li>
<li>支持<strong>由内向外 </strong>或 <strong>由内向内</strong>寻址。</li>
</ol>
<h3 id="寻址">寻址</h3>
<p>外部接口DMA不仅支持由内向外寻址，还支持由内向内寻址。通过所有外部参数寄存器的内部地址索引以完成该项任务。DMA控制器通过地址以辨别传输（工作）而不是通过额外的控制位设置（control bit setting）。</p>
<p><strong>注意</strong>：如果使用内部或外部索引地址，DMA通道的优先级将会改变。</p>
<p>SHARC芯片支持另一种具有更高优先级，但是只支持标准DMA模式的索引模式，即由内向内的DMA索引模式。</p>
<p><strong>注意</strong>：DMAC，即Directory Memory Access Control (Rigister)，直接内存访问控制寄存器。</p>
<h1 id="tcb">TCB</h1>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* TCB = &quot;Transfer Control Block&quot; */</span></span><br><span class="line"><span class="comment">/* TCB format:    ECx (length of destination buffer),</span></span><br><span class="line"><span class="comment">				  EMx (destination buffer step size),</span></span><br><span class="line"><span class="comment">				  EIx (destination buffer index (initialized to start address)),</span></span><br><span class="line"><span class="comment">				  GPx (&quot;general purpose&quot;),</span></span><br><span class="line"><span class="comment">				  CPx (&quot;Chain Point register&quot;; points to last address (IIx) of next TCB to jump to upon completion of this TCB.),</span></span><br><span class="line"><span class="comment">				  Cx  (length of source buffer),</span></span><br><span class="line"><span class="comment">				  IMx (source buffer step size),</span></span><br><span class="line"><span class="comment">				  IIx (source buffer index (initialized to start address))       */</span></span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2021/07/image-20210701013537361.png" alt="image-20210701013537361" /><figcaption aria-hidden="true">image-20210701013537361</figcaption>
</figure>
<p><img src="https://pic.islet.space/2021/06/20210629172133.png" alt="image-20210629155207745" style="zoom:80%;" /></p>
<p><img src="https://pic.islet.space/2021/06/20210629172128.png" alt="image-20210629160318759" style="zoom: 80%;" /></p>
<h1 id="others">Others</h1>
<h2 id="dmatcbsport之间的关系">DMA、TCB、SPORT之间的关系</h2>
<p>DMA，Directly Memory Access，直接内存访问。</p>
<p>TCB，Transfer Control Block，传输控制块。</p>
<p>SPORT，Serial Port，串行接口。</p>
<p>Serial Peripheral ，即串行外设。</p>
<h2 id="clockarbitrationpllprescale">Clock、Arbitration、PLL、prescale</h2>
<p>《HWR》第884页——PLL</p>
<p>PCLK</p>
<p>CLKIN</p>
<h2 id="latency">LATENCY</h2>
<h3 id="twi-效果延迟时间">TWI 效果延迟（时间）</h3>
<p>在TWI寄存器设置后，其效果延迟大概是 1.5到2个PCLK周期。</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210525153905.png" alt="image-20210525153855627" /><figcaption aria-hidden="true">image-20210525153855627</figcaption>
</figure>
<h2 id="asmnop">ASM("NOP")</h2>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Mr_White01/article/details/68488802#:~:text=asm%20(“nop”)是内嵌汇编做空指令延时用的，其中asm%20()的作用是指函数内部的参数翻译为汇编指令，其作用是在C语言环境下直接使用汇编指令执行。%20nop是一个空等待汇编指令，这个指令执行时，单片机是什么也不做，仅仅起一个时间延时作用。,CC2530属于8051系列单片机，asm%20(“nop”)执行的是一条空指令（单周期指令），占用时间是一个机器周期，晶振为32Mhz。%20于是，机器周期%3D12*1%2F32%3D0.375us。%20即一句asm%20(“nop”)延时了0.375us。">blog.csdn.net</a></p>
<h3 id="asm作用">asm()作用</h3>
<p>将函数内部的参数翻译为汇编指令，在C语言环境下直接使用汇编指令执行。</p>
<ul>
<li><p><code>asm("nop")</code>是内嵌汇编做空指令延时用的；</p></li>
<li><p><code>nop</code>是一个空等待汇编指令，这个指令执行时，单片机是什么也不做，仅仅起一个时间延时作用。</p></li>
</ul>
<blockquote>
<p>CC2530属于8051系列单片机，asm(“nop”)执行的是一条空指令（单周期指令），占用时间是一个机器周期，晶振为32Mhz。</p>
<p>于是，机器周期=12*1/32=0.375us ; 即一句asm(“nop”)延时了0.375us。</p>
</blockquote>
<h3 id="时钟周期">时钟周期</h3>
<p>时钟周期也称为振荡周期，定义为时钟脉冲的倒数(可以这样来理解，时钟周期就是单片机外接晶振的倒数，例如12M的晶振，它的时间周期就是1/12 us)，是计算机中最基本的、最小的时间单位。</p>
<p>在一个时钟周期内，CPU仅完成一个最基本的动作。对于某种单片机，若采用了1MHZ的时钟频率，则时钟周期为1us;若采用4MHZ的时钟频率，则时钟 周期为250us。由于时钟脉冲是计算机的基本工作脉冲，它控制着计算机的工作节奏(使计算机的每一步都统一到它的步调上来)。显然，对同一种机型的计算机，时钟频率越高，计算机的工作速度就越快。具体计算就是1/fosc。也就是说如果晶振为1MHz，那么时钟周期就为1us；6MHz的话，就是1/6us。</p>
<p>8051单片机把一个时钟周期定义为一个节拍(用P表示)，二个节拍定义为一个状态周期(用S表示)。</p>
<h3 id="机器周期">机器周期</h3>
<p>在计算机中，为了便于管理，常把一条指令的执行过程划分为若干个阶段，每一阶段完成一项工作。例如，取指令、存储器读、存储器写等，这每一项工作称为一个基本操作。完成一个基本操作所需要的时间称为机器周期。一般情况下，一个机器周期由若干个S周期(状态周期)组成。</p>
<p>8051系列单片机的一个机器周期同6个 S周期(状态周期)组成。前面已说过一个时钟周期定义为一个节拍(用P表示)，二个节拍定义为一个状态周期(用S表示)，8051单片机的机器周期由6个 状态周期组成，也就是说一个机器周期=6个状态周期=12个时钟周期。 具体计算为：时钟周期 X cycles。如果单片机是12周期的话，那么机器周期就是T×12。假设晶振频率为12M，单片机为12周期的话，那么机器周期就是1us。</p>
<p>例如外接24M晶振的单片机，他的一个机器周期=12/24M 秒；52系列单片机一个机器周期等于12个时钟周期。设晶振频率为12MHz时，52单片机是12T的单片机，即频率要12分频。12M经过分频变为1M，由T=1/f,即一个机器周期变为1us。</p>
<h3 id="指令周期">指令周期</h3>
<p>执行一条指令所需要的时间，一般由若干个机器周期组成。指令不同，所需的机器周期也不同。通常，包含一个机器周期的指令成为单周期指令，比如CLR,MOV等等。包含两个机器周期的指令称为双周期指令。另外还有4周期指令，比如乘法和除法指令。对于一些简单的的单字节指令，在取指令周期中，指令取出到指令寄存器后，立即译码执行，不再需要其它的机器周期。对于一些比较复杂的指令，例如转移指令、乘法指令，则需要两个或者两个以上的机器周期。</p>
<h3 id="总线周期">总线周期</h3>
<p>由于存贮器和I/O端口是挂接在总线上的，CPU对存贮器和I/O接口的访问，是通过总线实现的。通常把CPU通过总线对微处理器外部(存贮器或 I/O接口)进行一次访问所需时间称为一个总线周期。</p>
<p>总结一下，时钟周期是最小单位，机器周期需要1个或多个时钟周期，指令周期需要1个或多个机器周期;机器周期指的是完成一个基本操作的时间，这个基本操作有时可能包含总线读写，因而包含总线周期，但是有时可能与总线读写无关，所以，并无明确的相互包含的关系。 指令周期：是CPU的关键指标，指取出并执行一条指令的时间。一般以机器周期为单位，分单指令执行周期、双指令执行周期等。现在的处理器的大部分指令(ARM、DSP)均采用单指令执行周期。机器周期：完成一个基本操作的时间单元，如取指周期、取数周期。时钟周期：CPU的晶振的工作频率的倒数。</p>
<h2 id="问题">问题</h2>
<p>个人对TWI作为主设备时，数据的发送流程框图的理解如下：</p>
<ul>
<li>TWI在需要发送数据时，才生成TWI时钟信号，通过SCLK线（对应评估板上的 <strong><em>DPI11</em></strong>， 以及下图的 <strong><em>TWI_CLK_PBEN_O</em></strong> ）输出。</li>
<li>需要传输的数据通过TWI接口写入FIFO中（对应的寄存器是<code>TXTWI8</code> ），并通过SDA线（对应21479评估板上的 <strong><em>DPI12</em></strong> , 以及下图的 <strong><em>TWI_DATA_PBEN_O</em></strong> ）输出，从机收到数据后通过SDA线（对应下图的 <strong><em>TWI_DATA_ I</em></strong>）返回确认（ACK）信息。
<ul>
<li>在 <code>TWIIRPTL</code> 寄存器中，<code>TWIMCOM</code> 位为1则指示TWI初始化完毕，<code>TWITXINT</code> 为1则指示FIFO寄存器有空位，如果为0则说明 <code>TWIFIFOSTAT</code> 寄存器中的 <code>TWITXS</code> 位没有变化，即数据无法通过SDA发送出去；<code>TWIMERR</code> 则指示主设备传输过程中存在错误，具体错误需要查看 <code>TWIMSTAT</code> 寄存器。</li>
</ul></li>
<li>查看 <code>TWIMSTAT</code> 寄存器可知，<code>TWIMSTAT_REER</code> 位为1，该位为1则指示传输缓冲区读取错误，传输移位寄存器需要数据而缓冲区为空。</li>
<li>检查显示，<code>TXTWI8</code> 写入存在问题，写入语句 <code>*pTXTWI8 = 0xAA;</code> 执行后，观察寄存器窗口查看到数据仍为0x00。</li>
</ul>
<figure>
<img src="https://pic.islet.space/2021/06/20210607155909.png" alt="image-20210607155906359" /><figcaption aria-hidden="true">image-20210607155906359</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/06/20210607163901.png" alt="image-20210607163859502" /><figcaption aria-hidden="true">image-20210607163859502</figcaption>
</figure>
<h1 id="参考">参考</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/DMA/2385376">DMA</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/138573828">DMA原理介绍</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>感谢您的支持和鼓励</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="https://photo.islet.space/2021/00/IMG_4588.JPG" alt="Liewzheng WeChat Pay">
        <span>WeChat Pay</span>
      </div>
      <div>
        <img src="https://photo.islet.space/2021/00/IMG_4590.JPG" alt="Liewzheng Alipay">
        <span>Alipay</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/ADI/" rel="tag"># ADI</a>
              <a href="/tags/21479/" rel="tag"># 21479</a>
              <a href="/tags/register/" rel="tag"># register</a>
              <a href="/tags/21478/" rel="tag"># 21478</a>
          </div>

        

  <div id="vcomments" style="margin: 1rem 0 0 0;"></div>
  <script>
    new Valine({
      el: '#vcomments',
      appId: 'vRGM12EcYxDSM2lat5qjjSeY-gzGzoHsz',
      appKey: 'WBgAb6NTAFQ7DYtgH0uOPNNh'
    })
  </script>
          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/05/24/Programming/C/2021-05-24-ISO-IEC_9899-2011-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="ISO-IEC_9899-2011 学习笔记">
                  <i class="fa fa-chevron-left"></i> ISO-IEC_9899-2011 学习笔记
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/05/25/Hardware/2021-05-25-Type-C-%E6%89%A9%E5%B1%95%E5%99%A8-%E6%96%B9%E6%A1%88%E6%8C%87%E5%8D%97%EF%BC%88DP-Alternative-Mode-%E7%AF%87%EF%BC%89/" rel="next" title="Type-C 扩展器 方案指南（DP Alternative Mode 篇）">
                  Type-C 扩展器 方案指南（DP Alternative Mode 篇） <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备19004822号 </a>
  </div>

<div class="copyright">
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liewzheng</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":"enable","tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
