<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://code.islet.space/font//css?family=/CascadiaCode/CascadiaCode:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"islet.space","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/db.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>
<meta name="description" content="笔记分享的旮旯孤岛而已">
<meta property="og:type" content="website">
<meta property="og:title" content="Coder的孤岛">
<meta property="og:url" content="http://islet.space/index.html">
<meta property="og:site_name" content="Coder的孤岛">
<meta property="og:description" content="笔记分享的旮旯孤岛而已">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Liewzheng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://islet.space/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Coder的孤岛</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Coder的孤岛</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">islet of the coder</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-文章"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章</a></li>
        <li class="menu-item menu-item-目录"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>目录</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-简历"><a href="/resume/" rel="section"><i class="fa fa-address-card fa-fw"></i>简历</a></li>
        <li class="menu-item menu-item-友链"><a href="/friends/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liewzheng</p>
  <div class="site-description" itemprop="description">笔记分享的旮旯孤岛而已</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">108</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">200</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:liewzheng@foxmail.com" title="E-Mail → mailto:liewzheng@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/02/24/Hardware/STM32/2022-02-22-%E5%9C%A8mac%E4%B8%8A%E5%AE%89%E8%A3%85stm32CubeMX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/24/Hardware/STM32/2022-02-22-%E5%9C%A8mac%E4%B8%8A%E5%AE%89%E8%A3%85stm32CubeMX/" class="post-title-link" itemprop="url">在mac上安装stm32CubeMX</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-02-24 02:00:00" itemprop="dateCreated datePublished" datetime="2022-02-24T02:00:00+08:00">2022-02-24</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-02-23 00:06:22" itemprop="dateModified" datetime="2022-02-23T00:06:22+08:00">2022-02-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="tools-download-and-setup">TOOLS DOWNLOAD AND SETUP</h1>
<p>在 ST 官网下载了 CubeMX 的 Mac 版软件，然后会发现关闭安全相关的限制也没办法打开该软件包。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222205346872.png" alt="image-20220222205346872" /><figcaption aria-hidden="true">image-20220222205346872</figcaption>
</figure>
<p>通过 <code>tree</code> 命令查看目录可以找到一个叫 <code>SetupSTM32CubeMX-6_3_0</code> 的应用程序，运行该文件即可进行安装。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222205452868.png" alt="image-20220222205452868" /><figcaption aria-hidden="true">image-20220222205452868</figcaption>
</figure>
<p>Mac 系统上可运行的程序都是 <code>.App</code> 结尾的文件夹，直接点击右键的 <code>显示包内容</code> 即可进入查看。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222205524560.png" alt="image-20220222205524560" /><figcaption aria-hidden="true">image-20220222205524560</figcaption>
</figure>
<p>双击 <code>SetupSTM32CubeMX-6_3_0</code> 即可运行安装程序。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222205545346.png" alt="image-20220222205545346" /><figcaption aria-hidden="true">image-20220222205545346</figcaption>
</figure>
<h1 id="new-project">NEW PROJECT</h1>
<p>在 CubeMX 的 Home 界面，可以 <strong>根据芯片型号新建项目</strong>，也可以 <strong>根据ST板子型号新建项目</strong>。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222213510204.png" alt="image-20220222213510204" /><figcaption aria-hidden="true">image-20220222213510204</figcaption>
</figure>
<p>只需要在对应需要的 MCU 或者 板子上双击即可。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222213140557.png" alt="image-20220222213140557" /><figcaption aria-hidden="true">image-20220222213140557</figcaption>
</figure>
<p>如果使用ST自家的评估板，新建项目时建议直接选择 <code>ACCESS TO BOARD SELECTOR</code> 。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222212802407.png" alt="image-20220222212802407" /><figcaption aria-hidden="true">image-20220222212802407</figcaption>
</figure>
<p>它会帮助默认设置一些板子上的外设（它会提示 <code>Initialize all peripherals with their default Mode?</code> ），就不用用户自己去设置，否则选择 <code>ACCESS TO MCU SELECTOR</code> 就会在某些地方上产生默认配置差异，如 GPIO。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222213201459.png" alt="image-20220222213201459" /><figcaption aria-hidden="true">image-20220222213201459</figcaption>
</figure>
<p>下图为根据 ST 板子型号生成项目时默认配置的一些外设引脚。当然，还需要自行设置各个需要使用到的引脚的具体配置，如输入/输出、拉高/拉低等等。</p>
<p><img src="https://pic.islet.space/2022/02/image-20220222213417943.png" alt="image-20220222213417943" style="zoom:33%;" /></p>
<p>下图为根据 ST 芯片信号生成项目时默认不配置任何引脚：</p>
<p><img src="https://pic.islet.space/2022/02/image-20220222213744404.png" alt="image-20220222213744404" style="zoom:33%;" /></p>
<h1 id="debug-records">DEBUG RECORDS</h1>
<h2 id="attempt-to-rename-spec-link-to-already-defined-spec-nano_link">ATTEMPT TO RENAME SPEC 'LINK' TO ALREADY DEFINED SPEC 'NANO_LINK'</h2>
<p><code>cmake .. ; make</code> 时发现 <code>cmake</code> 无误，而 <code>make</code> 报错，提示 <code>attempt to rename sepc 'link' to already defined spec 'nano_link'</code>。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222224906371.png" alt="image-20220222224906371" /><figcaption aria-hidden="true">image-20220222224906371</figcaption>
</figure>
<p>具体报错信息如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fatal error: &#x2F;Users&#x2F;liewzheng&#x2F;bin&#x2F;gcc-arm-none-eabi-5_4-2016q3&#x2F;bin&#x2F;..&#x2F;lib&#x2F;gcc&#x2F;arm-none-eabi&#x2F;5.4.1&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;arm-none-eabi&#x2F;lib&#x2F;nano.specs: attempt to rename spec &#39;link&#39; to already defined spec &#39;nano_link&#39;</span><br><span class="line">compilation terminated.</span><br><span class="line">make[2]: *** [led_blink.elf] Error 1</span><br><span class="line">make[1]: *** [CMakeFiles&#x2F;led_blink.elf.dir&#x2F;all] Error 2</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure>
<p>而 <code>CMakeLists.txt</code> 文件中只有以下此句设计 <code>spec</code> 和 <code>nano</code> 关键字（下方注释是后来加上去的），此配置在 linux 平台上是运行正常的。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果提示 linker 相关的错误，请删除  `-specs=nosys.specs` 和 `-specs=nano.specs` 这两个标志及所在临时文件夹并再次 `cmake .. ; make` 进行尝试</span></span><br><span class="line"><span class="keyword">SET</span>(CPU <span class="string">&quot;-mcpu=cortex-m4&quot;</span>)</span><br><span class="line"><span class="keyword">SET</span>(FPU <span class="string">&quot;-mfpu=fpv4-sp-d16&quot;</span>)</span><br><span class="line"><span class="keyword">SET</span>(FLOAT_ABI <span class="string">&quot;-mfloat-abi=hard&quot;</span>)</span><br><span class="line"><span class="keyword">SET</span>(MCU <span class="string">&quot;$&#123;CPU&#125; -mthumb $&#123;FPU&#125; $&#123;FLOAT_ABI&#125;&quot;</span> --specs=nosys.specs -specs=nano.specs)</span><br></pre></td></tr></table></figure>
<h3 id="解决方法">解决方法</h3>
<p>根据 <a target="_blank" rel="noopener" href="https://community.st.com/s/question/0D50X00009XkWJiSAN/building-error-from-imported-stm32cubemx-project">Building Error from imported STM32CubeMX project</a> 的解决方法，删除 <code>-specs=nosys.specs</code> 和 <code>-specs=nano.specs</code> 这两个连接器的标志即可编译通过。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222230947465.png" alt="image-20220222230947465" /><figcaption aria-hidden="true">image-20220222230947465</figcaption>
</figure>
<p>删除该两个标志后，<code>MCU</code> 变量为 <code>SET(MCU "$&#123;CPU&#125; -mthumb $&#123;FPU&#125; $&#123;FLOAT_ABI&#125;"</code>。</p>
<h2 id="warning-cannot-find-entry-symbol-arch_paths_first">WARNING: CANNOT FIND ENTRY SYMBOL ARCH_PATHS_FIRST</h2>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220222235232398.png" alt="image-20220222235232398" /><figcaption aria-hidden="true">image-20220222235232398</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/02/24/Linux/Server/2022-02-24-Jenkins%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/24/Linux/Server/2022-02-24-Jenkins%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">Jenkins服务器部署</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-02-24 00:30:00 / Modified: 19:32:16" itemprop="dateCreated datePublished" datetime="2022-02-24T00:30:00+08:00">2022-02-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文只涉及 Jenkins 在 Debian Linux (Kali) 下的相关安装，不涉及使用教程，关于Jenkins的相关科普请自行搜。</p>
<h1 id="jenkins安装">Jenkins安装</h1>
<p>Jenkins 可以通过两种方式运行：</p>
<ul>
<li>通过官网下载 <code>http://mirrors.jenkins.io/war-stable/latest/jenkins.war</code> 程序，并确保安装了 <code>openjdk-8</code> 即可。此种方式是直接运行 <code>.war</code> 的软件的，免安装，但基于 <code>ssh</code> 远程连接的用户断开连接之后可能会导致无法运行。即，如果不知道如何正确操作shell以便在后台运行该免安装程序，就不推荐使用。</li>
<li>另一种是安装版本，仍然需要用户提前先安装好 <code>openjdk-8</code> ，然后通过 <a target="_blank" rel="noopener" href="https://pkg.jenkins.io/debian/">官网教程</a> 来添加源和使用 <code>apt</code> 命令进行安装。这种方式可以使用 <code>systemctl</code> 命令确保 Jenkins 开机自启动并在后台运行。</li>
</ul>
<h2 id="java-setup">JAVA SETUP</h2>
<p>需要注意的是，jre有 oracle 版本和 openjdk 版本，需要安装后者。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update ; sudo apt upgrade ; sudo apt install openjdk-8-jre</span><br></pre></td></tr></table></figure>
<p>将 <code>JAVA_HOME</code> 写到你对应的 shell 配置文件中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-amd64</span><br><span class="line">export CLASSPATH&#x3D;$JAVA_HOME&#x2F;jre&#x2F;lib&#x2F;rt.jar:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br><span class="line">export PATH&#x3D;$JAVA_HOME&#x2F;bin:$PATH</span><br></pre></td></tr></table></figure>
<h2 id="免安装运行">免安装运行</h2>
<p>下面就是使用 <code>java -jar jenkins.war --httpPort=8080</code> 命令来免安装运行的。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220224003818560.png" alt="image-20220224003818560" /><figcaption aria-hidden="true">image-20220224003818560</figcaption>
</figure>
<h2 id="安装运行">安装运行</h2>
<p>实际上，直接运行下面的 <code>sudo apt install openjdk-11-jre</code> 可能会导致无法运行，原因不明，还是推荐自行使用 <code>sudo apt install openjdk-8-jre</code> 进行安装。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220224191828341.png" alt="image-20220224191828341" /><figcaption aria-hidden="true">image-20220224191828341</figcaption>
</figure>
<h2 id="防火墙配置">防火墙配置</h2>
<p>这一点就不再赘述了。</p>
<ol type="1">
<li><strong>开启系统内端口</strong>：用 <code>iptables</code> 参考 《<a href="https://islet.space/2019/03/05/Linux/SSH/CentOS7%E5%AE%89%E8%A3%85iptables%E9%98%B2%E7%81%AB%E5%A2%99/">CentOS7安装iptables防火墙</a>》，注意看后面评论内容。</li>
<li><strong>开启控制台端口</strong>：配置为云服务器的要去网页界面的控制台将对应端口打开。</li>
</ol>
<h1 id="jenkins配置">Jenkins配置</h1>
<p>安装完毕之后，在浏览器中输入 对应网址的 <code>8080</code> 端口，进入页面后输入管理员密码。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220224003852043.png" alt="image-20220224003852043" /><figcaption aria-hidden="true">image-20220224003852043</figcaption>
</figure>
<p>选择新手入门配置安装插件。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220224003716199.png" alt="image-20220224003716199" /><figcaption aria-hidden="true">image-20220224003716199</figcaption>
</figure>
<p>安装完毕之后就会让你设置管理员账户。</p>
<p>虽然，java11是推荐安装，可我就是运行失败。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220224004120934.png" alt="image-20220224004120934" /><figcaption aria-hidden="true">image-20220224004120934</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/02/23/Linux/2022-02-23-%E8%87%AA%E5%BB%BAgit%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/23/Linux/2022-02-23-%E8%87%AA%E5%BB%BAgit%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/" class="post-title-link" itemprop="url">自建git远程仓库</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-02-23 01:45:00 / Modified: 21:18:15" itemprop="dateCreated datePublished" datetime="2022-02-23T01:45:00+08:00">2022-02-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>基本上也就只参考了廖雪峰这篇 《 <a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/896043488029600/899998870925664">搭建Git服务器</a> 》 的文章。</p>
<h1 id="部署git服务器">部署git服务器</h1>
<h2 id="确保已安装git">确保已安装git</h2>
<p>for debian linux:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git </span><br></pre></td></tr></table></figure>
<p>and check the version of it:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure>
<h2 id="创建git账户">创建git账户</h2>
<p>Add a account name <code>git</code> in linux :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser git</span><br></pre></td></tr></table></figure>
<h2 id="设置使用者的ssh配置">设置使用者的SSH配置</h2>
<p>Copy the SSH keys of your client computers to save to the file in <code>/home/git/.ssh/authorized_keys</code> .</p>
<h2 id="禁用shell登录">禁用shell登录</h2>
<p>For the safety of your server, you should ban the shell login for <code>git</code> account.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/passwd</span><br></pre></td></tr></table></figure>
<p>Find something like <code>git:x:1001:1001:,,,:/home/git:/bin/bash</code> , and modify it to:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>git</code>用户可以正常通过ssh使用git，但无法登录shell，因为已经为<code>git</code>用户指定的<code>git-shell</code>每次一登录就自动退出。</p>
</blockquote>
<h1 id="新建仓库">新建仓库</h1>
<ul>
<li>Build a directory named <code>srv</code> to store the repositories. (Of course you can name it the way you like.)</li>
<li>Initializa a new bare repository name <code>xxx</code>.</li>
<li>Change its owner as the user <code>git</code> which is just created before.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /srv/</span><br><span class="line">sudo git init --bare /srv/xxxx.git</span><br><span class="line">sudo chown -R git:git /srv/xxxx.git</span><br></pre></td></tr></table></figure>
<p>And you can copy the script below TO CREATE YOUR NEW REPOSITY. Remember to save it as <code>.sh</code> file and use <code>chmod +x</code> command to make it executable.</p>
<blockquote>
<p>By default, this script is stored as <code>gitInit.sh</code> in the diretory <code>/srv</code>.</p>
<p>If you change the script execute diretory, remember to modify the script below.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GIT_REPOSITORY=<span class="variable">$1</span></span><br><span class="line">sudo git init --bare <span class="variable">$GIT_REPOSITORY</span>.git</span><br><span class="line">sudo chown -R git:git <span class="variable">$GIT_REPOSITORY</span>.git</span><br></pre></td></tr></table></figure>
<p>USAGE:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gitInit.sh &lt;newRepository&gt;</span><br></pre></td></tr></table></figure>
<h1 id="使用仓库">使用仓库</h1>
<p>到这一步为止，已经可以使用 <code>git pull git@&lt;yourServer&gt;:/srv/xxx.git</code> 进行仓库拉取了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@&lt;yourServer&gt;:/srv/sample.git</span><br></pre></td></tr></table></figure>
<p>And you will see:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cloning into <span class="string">&#x27;sample&#x27;</span>...</span><br><span class="line">warning: You appear to have cloned an empty repository.</span><br></pre></td></tr></table></figure>
<p>如果需要添加一个固定的远程仓库，需要使用到 <code>url</code> ，即需要开启了 <code>443</code> 端口的服务器。</p>
<h1 id="其他服务器管理">其他服务器管理</h1>
<h2 id="证书颁发">证书颁发</h2>
<p>如下所示，下面的子域名已经签审了 SSL 证书了，可以正常使用 <code>443</code> 端口不被拒绝。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220223015715136.png" alt="image-20220223015715136" /><figcaption aria-hidden="true">image-20220223015715136</figcaption>
</figure>
<h2 id="防火墙设置">防火墙设置</h2>
<p>确保腾讯云服务器管理页面下的防火墙设置中已开启 <code>443</code> 端口。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220223015852398.png" alt="image-20220223015852398" /><figcaption aria-hidden="true">image-20220223015852398</figcaption>
</figure>
<p>使用 ubuntu 和 centos 系统的可以参考 《<a href="https://islet.space/2019/03/05/Linux/SSH/CentOS7%E5%AE%89%E8%A3%85iptables%E9%98%B2%E7%81%AB%E5%A2%99/#%E4%B8%89-%E8%AE%BE%E7%BD%AE%E7%8E%B0%E6%9C%89%E8%A7%84%E5%88%99">CentOS7安装iptables防火墙</a>》 开启 <code>443</code> 端口，直接运行下面命令即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br></pre></td></tr></table></figure>
<h2 id="克隆远程仓库">克隆远程仓库</h2>
<p>如果本地已有仓库，可能会与远程服务器的 <code>master</code> 分支冲突，需要自行使用 <code>git fetch</code> 管理，然后使用 <code>git push --set-upstream master</code> 进行上传。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220223014741138.png" alt="image-20220223014741138" /><figcaption aria-hidden="true">image-20220223014741138</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/02/22/Macintosh/2022-02-22-%E6%9B%B4%E6%94%B9mac%E7%9A%84%E9%BB%98%E8%AE%A4shell%E4%B8%BAfish/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/22/Macintosh/2022-02-22-%E6%9B%B4%E6%94%B9mac%E7%9A%84%E9%BB%98%E8%AE%A4shell%E4%B8%BAfish/" class="post-title-link" itemprop="url">更改Mac的默认shell为fish</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-02-22 20:50:00" itemprop="dateCreated datePublished" datetime="2022-02-22T20:50:00+08:00">2022-02-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-02-23 00:17:11" itemprop="dateModified" datetime="2022-02-23T00:17:11+08:00">2022-02-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Macintosh/" itemprop="url" rel="index"><span itemprop="name">Macintosh</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Mac 平台自带的 zsh 真的极不好用，同样是 unix-like 平台，跟 kali 平台上的 zsh 体验相差甚远。 一直都是黑白配色，而且修改中断和配置的动手能力确实没有那么强。偶然适用了一下 <code>fish</code> ，发现在 Mac 平台使用效果挺好的，就决定进行更换。切换成黑色背景后更为舒适了，之前一直使用瞎眼的白色。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220223001619177.png" alt="image-20220223001619177" /><figcaption aria-hidden="true">image-20220223001619177</figcaption>
</figure>
<h1 id="fish-setup">FISH SETUP</h1>
<p>我安装了 MacPorts 包管理工具，直接用 <code>port</code> 命令即可安装 <code>fish</code> 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo port install fish</span><br></pre></td></tr></table></figure>
<h1 id="add-fish-to-etcshells">ADD FISH TO /etc/shells</h1>
<p>使用 <code>which fish</code> 可以调出 <code>fish</code> 的安装路径（用 <code>port</code> 安装的话默认路径是 <code>/opt/local/bin/fish</code> ），复制该路径，然后粘贴到 <code>/etc/shells</code> 文件末尾。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/shells</span><br></pre></td></tr></table></figure>
<p><strong>NOTE</strong>：千万不要用 <code>sudo vim /etc/shells</code> 这样会修改到 <code>root</code> 管理员角色的 shell （如果出问题就会很麻烦），用户自己折腾自己的 shell 就好了。</p>
<p>通过 <code>cat /etc/shells</code> 可以查看所有可供使用的 shell 。</p>
<h1 id="change-default-shell">CHANGE DEFAULT SHELL</h1>
<p>使用 <code>chsh</code> 语句即可将 <code>fish</code> 设置为默认 shell 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /opt/<span class="built_in">local</span>/bin/fish</span><br></pre></td></tr></table></figure>
<h1 id="note">NOTE</h1>
<p><code>fish</code> 所使用的配置文件并非 <code>~/.fish</code> 而是 <code>~/.bash_profile</code> ，在里面修改完内容可以 <code>source</code> 该文件进行立即更新。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/28/Linux/System/2022-01-28-Kali-%E4%B8%8E-MBA-2015/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/28/Linux/System/2022-01-28-Kali-%E4%B8%8E-MBA-2015/" class="post-title-link" itemprop="url">Kali 与 MBA-2015</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-28 12:00:00" itemprop="dateCreated datePublished" datetime="2022-01-28T12:00:00+08:00">2022-01-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-02-23 00:20:06" itemprop="dateModified" datetime="2022-02-23T00:20:06+08:00">2022-02-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="网卡驱动安装">网卡驱动安装</h1>
<p>Macbook Air 2015年 13英寸版所使用的的网卡是 博通的 <code>BCM94360CS2</code> 。</p>
<p>可以从 <code>关于本机</code> --&gt; <code>系统报告</code> --&gt; <code>Wi-Fi</code> 中查看到硬件固件版本。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220128154108052.png" alt="image-20220128154108052" /><figcaption aria-hidden="true">image-20220128154108052</figcaption>
</figure>
<p>安装完Linux之后，暂时无法联网，需要使用有线网络进行上网，可以使用 iPhone 接 <code>lighting-USBA</code> 的转接线进行上网，然后使用 <code>apt</code> 命令下载安装 <code>bcmwl-kernel-source</code> 。</p>
<p>如果使用 <code>pkgs.org</code> 官网上下载的 <code>bcmwl-kernel-source.dpkg</code> 则会提示缺少很多依赖，无法直接一步安装到位。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220128154312606.png" alt="image-20220128154312606" /><figcaption aria-hidden="true">image-20220128154312606</figcaption>
</figure>
<h1 id="apfs-硬盘内容读取">APFS 硬盘内容读取</h1>
<p><code>https://github.com/sgan81/apfs-fuse/</code></p>
<h1 id="reference">REFERENCE</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/lovesKey/p/10791914.html">在linux访问macos下的分区</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/23/Computer/2022-01-23-%E7%BB%99Mac-Big-Sur%E4%BF%AE%E6%94%B9%E5%A4%96%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%99%A8%E7%9A%84%E5%88%86%E8%BE%A8%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/23/Computer/2022-01-23-%E7%BB%99Mac-Big-Sur%E4%BF%AE%E6%94%B9%E5%A4%96%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%99%A8%E7%9A%84%E5%88%86%E8%BE%A8%E7%8E%87/" class="post-title-link" itemprop="url">给Mac Big Sur修改外接显示器的分辨率</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-01-23 17:30:00 / Modified: 18:11:59" itemprop="dateCreated datePublished" datetime="2022-01-23T17:30:00+08:00">2022-01-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer/" itemprop="url" rel="index"><span itemprop="name">Computer</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文参考 《<a target="_blank" rel="noopener" href="https://zhangzi.life/articles/1605255382000">Mac 外接显示器色彩问题</a>》和 《<a target="_blank" rel="noopener" href="https://sspai.com/post/57549#!">为 macOS 10.15 开启 HiDPI，让 2K 显示器更舒适</a>》两篇文章。</p>
<p>刚买来新的 HUAWEI Mateview 无线版，显示器分辨率为 <code>3840*2560</code> ，该死的 <code>3:2</code> 屏幕啊，我图啥......</p>
<p>外接2015年的Macbook Air的MiniDP口输出准4K分辨率。</p>
<p>但是，但是，但是~~Air只能输出 <code>16:9</code> 和 <code>16:10</code> 的分辨率，让我搞了整整一下午来调整这个分辨率，4个小时啊。</p>
<p>算了，总结一下吧。</p>
<h1 id="关闭sip">关闭SIP</h1>
<p>Big sur 和之前版本不同，需要的操作如下：</p>
<ol type="1">
<li>关机</li>
<li>长按 <code>Command</code> 键 和 <code>R</code> 键（都不要松开），短按 开机电源键，直到出现进度条才能松开。</li>
<li>找到终端，然后输入 <code>csrutil authenticated-root disable</code> ，出现 <code>successfully</code> 字样就算是成功了。（之前的版本是 <code>csrutil disable</code> ）</li>
</ol>
<h1 id="查询设备号">查询设备号</h1>
<ol type="1">
<li>先断开显示器，输入如下代码：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ioreg -l | grep <span class="string">&quot;DisplayVendorID&quot;</span></span><br><span class="line">ioreg -l | grep <span class="string">&quot;DisplayProductID&quot;</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>再插上显示器，再次运行上方代码。</li>
<li>两次得出来的不同的设备号就可以区分哪个 <code>VendorID</code> 和 <code>ProductID</code> 是外接显示器的。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123175000229.png" alt="image-20220123175000229" /><figcaption aria-hidden="true">image-20220123175000229</figcaption>
</figure>
<ol start="4" type="1">
<li>记下那串代码，并将外接显示器的两个ID转换成对应的十六进制数， 如 <code>8950</code> 即 <code>22f6</code> , <code>28194</code> 即 <code>66e2</code></li>
</ol>
<h1 id="生成配置参数">生成配置参数</h1>
<ol type="1">
<li>在用户目录 ，即 <code>~</code> 下，使用 <code>DisplayVendorID-xxxx</code> （<code>xxxx</code> 即对应外接显示器 Vendor 号的16进制 ）创建一个文件夹。</li>
<li>然后在对应文件夹下创建一个 使用 <code>DisplayProductID-yyyy</code> （ yyyy` 即对应外接显示器 Product 号的16进制 ）创建一个无后缀名的文件。</li>
<li>到 <a target="_blank" rel="noopener" href="https://codeclou.github.io/Display-Override-PropertyList-File-Parser-and-Generator-with-HiDPI-Support-For-Scaled-Resolutions/">Scaled Resolution for your Mac</a> 网站生成配置参数，在红色框中分别填入你外接显示器的对应参数，和你想使你的显示器所呈现的分辨率参数。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123175609151.png" alt="image-20220123175609151" /><figcaption aria-hidden="true">image-20220123175609151</figcaption>
</figure>
<ol start="4" type="1">
<li>复制右侧的 xml 代码至刚刚的 <code>DisplayProductID-yyyy</code> 文件中，并保存。</li>
</ol>
<h1 id="导入系统">导入系统</h1>
<p>在Big Sur系统下，根目录 <code>/</code> 是禁止写入的，需要稍微用点技巧（走点弯路）。</p>
<ol type="1">
<li>新建一个文件夹，将解除SIP之后的 <code>/</code> 挂载到某个地方，如下方所示：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/nvme</span><br><span class="line">sudo mount -o nobrowse -t apfs /dev/disk1s5 ~/nvme/</span><br></pre></td></tr></table></figure>
<p>其中，<code>/dev/disk1s5</code> 中的 <code>/disk1s5</code> 要通过 <strong>磁盘工具</strong> 各自查看自己的 <strong>设备</strong> ，最后面的 <code>s1</code> 去掉不写。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123173550666.png" alt="image-20220123173550666" /><figcaption aria-hidden="true">image-20220123173550666</figcaption>
</figure>
<ol start="2" type="1">
<li>然后就可以 <code>cd</code> 进去查看对应目录下的文件内容，但是所有读写操作都需要加上 <code>sudo</code> 才可以。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/nvme/System/Library/Displays/Contents/Resources/Overrides</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123173806535.png" alt="image-20220123173806535" /><figcaption aria-hidden="true">image-20220123173806535</figcaption>
</figure>
<ol start="3" type="1">
<li>把 <code>~/DisplayVendorID-xxxx</code> 复制到 <code>~/nvme/System/Library/Displays/Contents/Resources/Overrides</code> 里面：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -r ~/DisplayVendorID-22f6 ~/nvme/System/Library/Displays/Contents/Resources/Overrides/DisplayVendorID-22f6</span><br></pre></td></tr></table></figure>
<p>复制完毕之后可以再 <code>ls</code> 查看，就存在了。</p>
<ol start="4" type="1">
<li>但是这种复制只是一种暂时的，重启之后就会被镜像文件所覆盖，所以要重新 snapshot 一下。<mark style="font-weight: 900;">注意，这一步一定要做，否则重启就失效了。</mark></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bless --folder ~/nvme/System/Library/Displays/Contents/Resources/Overrides --bootefi --create-snapshot</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/22/Hardware/STM32/2022-01-22-STM32-NUCLEOL476RG-DEVELOP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/22/Hardware/STM32/2022-01-22-STM32-NUCLEOL476RG-DEVELOP/" class="post-title-link" itemprop="url">STM32-NUCLEOL476RG DEVELOP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-22 19:30:00" itemprop="dateCreated datePublished" datetime="2022-01-22T19:30:00+08:00">2022-01-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-24 08:38:28" itemprop="dateModified" datetime="2022-01-24T08:38:28+08:00">2022-01-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/InternetOfThings/" itemprop="url" rel="index"><span itemprop="name">InternetOfThings</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>截止2022年1月23日，以下是ST公司的产品线，下图通过Flash大小和Nucleo类型对产品进行了一定划分。</p>
<p><img src="https://pic.islet.space/2022/01/en.ln1847_stm32_nucleo.jpg" alt="img" style="zoom: 67%;" /></p>
<h1 id="necleo-l476rg-data-brief">NECLEO-L476RG DATA BRIEF</h1>
<p>Necleo系列开发板下面有很多型号，且每个型号的板子（除开芯片以外）设计应该都是大同小异的，所以最底层板子也就有了自己的型号。</p>
<p>而 NecleoL476RG 开发板的底板型号为 <code>MB1136</code> 。且下方所有Necleo的产品都自带 ST-LINK/V2-1 调试器。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220122193806691.png" alt="image-20220122193806691" /><figcaption aria-hidden="true">image-20220122193806691</figcaption>
</figure>
<h2 id="st-linkv2-1">ST-LINK/V2-1</h2>
<p>支持USB软件 <strong>重新检查</strong>（re-enumeration） 、支持虚拟COM口、支持大容量储存、支持超过 <code>100mA</code> 电流的电源管理，但是不支持 <strong><em>SWIM</em></strong> 接口且最小输入电压为 <code>3V</code> 。</p>
<p>注意：一旦激活了 ST-LINK/V2-1 的目标读出保护功能，就会阻止目标应用运行事后运行（prevents the target application from running afterward.）目标读出保护必须被关闭（must be kept disabled on board）。</p>
<p>可以根据跳线帽的两种状态来使用 ST-LINK/V2-1:</p>
<ul>
<li>在线编程和调试STM32（Program/debug the on-board STM32），此时 <code>CN2</code> 的两个跳线帽都连接着，处于在线编程状态（默认）。</li>
<li>使用连接到SWD连接器CN4的电缆对外部应用板中的MCU进行编程/调试，此时 <code>CN2</code> 的两个跳线帽都不连接，以允许 <code>CN4</code> （即 <code>SWD</code> 接口）连接至外部连接器。</li>
</ul>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123183857115.png" alt="image-20220123183857115" /><figcaption aria-hidden="true">image-20220123183857115</figcaption>
</figure>
<h2 id="layout">LAYOUT</h2>
<p><img src="https://pic.islet.space/2022/01/image-20220123182028068.png" alt="image-20220123182028068" style="zoom:50%;" /></p>
<p><img src="https://pic.islet.space/2022/01/image-20220123182139437.png" alt="image-20220123182139437" style="zoom:50%;" /></p>
<h1 id="chip-breief">CHIP BREIEF</h1>
<p>STM32 Nucleo L476RG 所使用的芯片是 <code>STM32L476RGT6U</code>，其中 <code>L4</code> 是系列号，<code>76</code> 是产线，<code>R</code> 是指64pin，<code>C</code> 是指 256Kbytes 的 Flash内存大小。</p>
<p>下方为《<a target="_blank" rel="noopener" href="https://www.st.com/resource/en/data_brief/nucleo-l476rg.pdf">STM32 Nucleo-64 boards data brief</a>》提供的 <strong>产品芯片命名方法</strong>：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220122195540612.png" alt="image-20220122195540612" /><figcaption aria-hidden="true">image-20220122195540612</figcaption>
</figure>
<h1 id="reference">REFERENCE</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://www.st.com/en/evaluation-tools/nucleo-l476rg.html">NUCLEO-L476RG</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/22/Linux/2022-01-22-customize-vscode-font-in-debian-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/22/Linux/2022-01-22-customize-vscode-font-in-debian-linux/" class="post-title-link" itemprop="url">customize vscode font in debian linux</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-01-22 15:20:00 / Modified: 16:19:33" itemprop="dateCreated datePublished" datetime="2022-01-22T15:20:00+08:00">2022-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="install-fonts-on-debian-linux">INSTALL FONTS ON DEBIAN LINUX</h1>
<p>We can install <strong><em>True Type</em></strong> or <strong><em>Open Type</em></strong> fonts(<code>.ttf</code> / <code>.otf</code> / <code>.ttc</code>) in <em>DEBIAN LINUX</em>, like ubuntu or kali.</p>
<h2 id="download-font-from-website">DOWNLOAD FONT FROM WEBSITE</h2>
<ol type="1">
<li>Download <code>Cascadia Code</code> from <code>https://github.com/microsoft/cascadia-code/releases</code> and unzip it.</li>
<li>We got 3 folders here: <code>/otf/</code> , <code>/ttf/</code> and <code>woff2</code> , and we only need `ttf</li>
</ol>
<h2 id="copy-files-to-system-font-directory">COPY FILES TO SYSTEM FONT DIRECTORY</h2>
<p>Font fils are generally installed in either the system font directory on the path <code>/usr/share/fonts/</code> or in a user font directory that is frequently on one of the following paths:</p>
<ul>
<li><code>~/.local/share/fonts/</code></li>
<li><code>~/usr/local/share/fonts/</code></li>
</ul>
<ol type="1">
<li>Execute the following command to copy the fonts to system path</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -r ttf /usr/share/fonts/CascadiaCode</span><br></pre></td></tr></table></figure>
<h2 id="generate-font-chache">GENERATE FONT CHACHE</h2>
<p>We need to build font infomation caches for apps using fontconfig for their font handling.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/fonts/CascadiaCode</span><br><span class="line">fc-cache -f -v</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><em>NOTE</em></strong></p>
<p>If you cannot execute <code>fc-cache</code> command , copy and execute the following command in terminal.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install fontconfig</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="verify-the-font-installation">VERIFY THE FONT INSTALLATION</h2>
<p>Confirm that the fonts are installed by displaying the paths and style definitions with <code>fc-list</code> command filtered on the font family name with <code>grep</code> .</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc-list | grep <span class="string">&quot;Cascadia Code&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="customize-vscode">CUSTOMIZE VSCODE</h1>
<ol type="1">
<li>Get to <code>Setting</code></li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220122161611892.png" alt="image-20220122161611892" /><figcaption aria-hidden="true">image-20220122161611892</figcaption>
</figure>
<ol start="2" type="1">
<li>Search <code>font</code> in the bar</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220122161750043.png" alt="image-20220122161750043" /><figcaption aria-hidden="true">image-20220122161750043</figcaption>
</figure>
<ol start="3" type="1">
<li>Add <code>'Cascadia Code',</code> to the <code>Editor: Font Family</code> .</li>
<li>Restart vscode.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/11/Hardware/STM32/2022-01-11-%E5%85%89%E7%94%B5%E4%BC%A0%E6%84%9F%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/11/Hardware/STM32/2022-01-11-%E5%85%89%E7%94%B5%E4%BC%A0%E6%84%9F%E5%99%A8/" class="post-title-link" itemprop="url">Optical Sensor Development</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-11 14:30:00" itemprop="dateCreated datePublished" datetime="2022-01-11T14:30:00+08:00">2022-01-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 19:37:19" itemprop="dateModified" datetime="2022-01-23T19:37:19+08:00">2022-01-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/InternetOfThings/" itemprop="url" rel="index"><span itemprop="name">InternetOfThings</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="基础技能">基础技能</h1>
<ol type="1">
<li>ARM架构芯片的样例代码加载、编译、烧录、调试工作熟悉。</li>
<li>bitbucket 如何使用（是否需要配置SSH、repository如何pull和push、add、commit等） √</li>
<li>confluence 如何使用（任务的查看、提交、文章的发布、协作等等）</li>
</ol>
<h1 id="ide-for-realtek">IDE for Realtek</h1>
<h2 id="vscode-arm">VSCODE ARM</h2>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112105541195.png" alt="image-20220112105541195" /><figcaption aria-hidden="true">image-20220112105541195</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112110410253.png" alt="image-20220112110410253" /><figcaption aria-hidden="true">image-20220112110410253</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112110533598.png" alt="image-20220112110533598" /><figcaption aria-hidden="true">image-20220112110533598</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112110507665.png" alt="image-20220112110507665" /><figcaption aria-hidden="true">image-20220112110507665</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112105734831.png" alt="image-20220112105734831" /><figcaption aria-hidden="true">image-20220112105734831</figcaption>
</figure>
<h2 id="keil-arm">KEIL ARM</h2>
<p>将Realtek RTL8762D SDK中的项目单独摘出来，放到某个文件夹下进行管理时，需要单独更改好几处内容：</p>
<ol type="1">
<li>C/C++的Include Path</li>
<li>源文件的Source Path</li>
<li>APP Image（<code>.bin</code> 生成文件），即 <code>after_build_common.bat</code> 的路径和内容。</li>
</ol>
<p>如下所示，把单独某个Project摘出来时会产生很多感叹号。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112111951120.png" alt="image-20220112111951120" /><figcaption aria-hidden="true">image-20220112111951120</figcaption>
</figure>
<h3 id="头文件路径修改">头文件路径修改</h3>
<p>此时需要进入设置中进行头文件路径修改</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112133356533.png" alt="image-20220112133356533" /><figcaption aria-hidden="true">image-20220112133356533</figcaption>
</figure>
<p>选择 <code>C/C++</code> 选项卡下的 <code>Include Paths</code> 进行修改。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112133505056.png" alt="image-20220112133505056" /><figcaption aria-hidden="true">image-20220112133505056</figcaption>
</figure>
<p>原来的路径设置都是使用相对路径进行的，此时需要将 <code>sbee2-sdk-v1.0.0</code> 文件夹放到与你项目文件同盘的某个文件夹下，最好不要相距太远。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112133731688.png" alt="image-20220112133731688" /><figcaption aria-hidden="true">image-20220112133731688</figcaption>
</figure>
<p>可以使用 VS Code将 <code>.uvprojx</code> 文件打开，使用搜索和替换工具对相关头文件的路径进行替换。</p>
<h3 id="源文件路径修改">源文件路径修改</h3>
<p>修改方法同头文件，</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117094508419.png" alt="image-20220117094508419" /><figcaption aria-hidden="true">image-20220117094508419</figcaption>
</figure>
<h3 id="bat文件路径修改">bat文件路径修改</h3>
<p><code>.bat</code> 文件是用于在 <code>.o</code> 文件生成后的链接脚本。所以如果该脚本自身路径和脚本内的包含路径出错，可能会导致无法编译出对应的 <code>app_MP_adk#####</code> 文件。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117095506866.png" alt="image-20220117095506866" /><figcaption aria-hidden="true">image-20220117095506866</figcaption>
</figure>
<p>下方为样例代码原来的设置情况：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120134642405.png" alt="image-20220120134642405" /><figcaption aria-hidden="true">image-20220120134642405</figcaption>
</figure>
<p>在 <code>Option-User</code> 设置中，可以查看到 <code>After Build/Rebuild</code> 相关的设置，其中 <code>Run #1</code> 则是 Realtek MP Tools 需要烧录 EVB开发板相关的脚本文件。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117095438927.png" alt="image-20220117095438927" /><figcaption aria-hidden="true">image-20220117095438927</figcaption>
</figure>
<p>将单独摘放出来的项目文件夹 <code>pixart_i2c</code> 与 <code>sbee2-sdk-v1.0.0</code> 和 <code>sbee2_wristband_sdk_upperstack_img</code> 放到同一个文件夹下。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117110446703.png" alt="image-20220117110446703" /><figcaption aria-hidden="true">image-20220117110446703</figcaption>
</figure>
<p>因此修改 <code>.uvprojx</code> 文件内容下 <code>after_build_common.bat</code> 的路径时，将该路径修改为如下的相对路径即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">..\sbee2-sdk-v1.0.0\tool\after_build_common.bat <span class="variable">$J</span> <span class="comment">#L @L</span></span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117104943624.png" alt="image-20220117104943624" /><figcaption aria-hidden="true">image-20220117104943624</figcaption>
</figure>
<p>保存修改后的 <code>.uvprojx</code> 文件，可以看到 Keil V5 自动更新了相关设置。如下：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117104955125.png" alt="image-20220117104955125" /><figcaption aria-hidden="true">image-20220117104955125</figcaption>
</figure>
<p><code>after_build_common.bat</code> 控制着自动生成Realtek 的 MP Tool 需要使用的 APP Bin文件，如果该 <code>Run #1</code> 没有启用，则无法生产该文件。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117105247314.png" alt="image-20220117105247314" /><figcaption aria-hidden="true">image-20220117105247314</figcaption>
</figure>
<p>该<code>.bat</code> 文件下所有的 <code>..\..\..\tool\</code> 都要修改成 <code>..\sbee2-sdk-v1.0.0\tool\</code>，如果项目文件夹和SDK文件夹路径有异，则需要适当修改。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117105040885.png" alt="image-20220117105040885" /><figcaption aria-hidden="true">image-20220117105040885</figcaption>
</figure>
<p>启用完成之后即可生成对应 <code>app_MP_adk#####</code> 文件</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117105414578.png" alt="image-20220117105414578" /><figcaption aria-hidden="true">image-20220117105414578</figcaption>
</figure>
<h1 id="hardwares">HARDWARES</h1>
<h2 id="adapter">ADAPTER</h2>
<h3 id="specification">SPECIFICATION</h3>
<p>A4芯片，即KA8G2芯片用的转接板需要接入5V电压，LDO会转换电压。</p>
<p>而PAT9126JA芯片则使用两个3.3V进行接入。</p>
<h2 id="chip-board">CHIP &amp; BOARD</h2>
<p>开发测试板为 Realtek RTL8762D EVB KIT。</p>
<p>型号： RTL8762DW</p>
<h2 id="sensor---ka8g2">SENSOR - KA8G2</h2>
<blockquote>
<p><strong><em>KAG2</em></strong> is a high performance and ultra low power <strong><em>CMOS-processed optical image sensor</em></strong> with <em>integrated digital image process circuits</em>. It is based on an optical navigation technology which measures changes in position by optically acquiring sequential surface images(frames) and mathematically determining the speed, the direction and the magnitude of motion. <strong><em>The displacement delta_X and delta_Y information are available in registers which are accessible through SPI serial interface.</em></strong> A host controller reads and translates the data from the SPI serial interface into RF signals before sending them to the host PC.</p>
</blockquote>
<h3 id="specification-1">SPECIFICATION</h3>
<p><img src="https://pic.islet.space/2022/01/image-20220113150323525.png" alt="image-20220113150323525" style="zoom:50%;" /></p>
<h3 id="hardware-linking">HARDWARE LINKING</h3>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112172532934.png" alt="image-20220112172532934" /><figcaption aria-hidden="true">image-20220112172532934</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16391255852712.png" alt="企业微信截图_16391255852712" /><figcaption aria-hidden="true">企业微信截图_16391255852712</figcaption>
</figure>
<h3 id="chip-initiate">CHIP INITIATE</h3>
<p>这个芯片启动时，需要对一些寄存器进行写入以初始化。下方为二维数组，<code>sensor_init_regs[][0]</code> 为寄存器地址，<code>sensor_init_regs[][1]</code> 为寄存器需要写入的数据。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint8_t</span> sensor_init_regs[<span class="number">7</span>][<span class="number">2</span>] = &#123;</span><br><span class="line">	&#123;<span class="number">0X09</span>, <span class="number">0XA5</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X26</span>, <span class="number">0X34</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X19</span>, <span class="number">0X04</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X6D</span>, <span class="number">0X39</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X0D</span>, <span class="number">0X20</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X0E</span>, <span class="number">0X20</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X09</span>, <span class="number">0X00</span>&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>初始化时，需要注意以下问题：</p>
<ol type="1">
<li>某些主控芯片在使用两线SPI进行数据写入时，会有要求使用 <code>7bit</code> 地址，且 MSB 为 <code>1</code> 。此时需要判断是否需要认为修改地址的 MSB为 <code>1</code> ，例如 Realtek 的 RTL8762DW 芯片就不需要人为修改，人为修改会导致波形异常。而某些芯片需要人为写入MSB。</li>
<li>在每一次写入寄存器之后，<mark style="font-weight: 900;">强烈建议进行延时</mark>，可以使用 <code>delay(0xFFFF)</code>，（尝试过 <code>0xFF</code> 太短，不能完成初始化写入）。</li>
</ol>
<h2 id="sensor---pat9126ja">SENSOR - PAT9126JA</h2>
<ol type="1">
<li>需要确定 <code>ID_SEL</code> 引脚的连接情况，是拉高、接地还是悬空。分别对应的 <code>CHIP ID</code> 都是不一样的，可能是<code>0x73</code>  <code>0x75</code>  <code>0x79</code> 三者之一。</li>
</ol>
<p>transformer 上的 <code>VCC</code> 为 <code>3.3V</code></p>
<h3 id="specification-2">SPECIFICATION</h3>
<p>这个芯片有两种电压要求，默认为高电压版本 <code>3.3V</code> ，可以通过SPI写入寄存器和硬件并线来达到降低至 <code>1.8V</code> 低电压的模式。</p>
<h3 id="hadware-linking">HADWARE LINKING</h3>
<figure>
<img src="https://pic.islet.space/2022/01/OpticalSensorTransfer_I2C.png" alt="OpticalSensorTransfer_I2C" /><figcaption aria-hidden="true">OpticalSensorTransfer_I2C</figcaption>
</figure>
<h1 id="sdk-tools">SDK &amp; Tools</h1>
<p>此处有 2个SDK包 和 3个tool包，分别是：</p>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/sbee2-sdk-v1.0.0.zip">sbee2-sdk-v1.0.0.zip</a></li>
<li><a target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/sbee2_wristband_sdk_upperstack_img.zip">sbee2_wristband_sdk_upperstack_img.zip</a></li>
<li><a target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/MPPackTool_v2.0.5.2.zip">MPPackTool_v2.0.5.2.zip</a></li>
<li>日志输出软件：<a target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/DebugAnalyzer-v4.0.0.14.zip">DebugAnalyzer-v4.0.0.14.zip</a></li>
<li>代码烧录软件：<a target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/BeeMPTool_kits_v1.0.5.0.zip">BeeMPTool_kits_v1.0.5.0.zip</a></li>
</ol>
<h1 id="build-flash-log">BUILD / FLASH / LOG</h1>
<h2 id="build">BUILD</h2>
<p>点击 <code>build</code> 按钮即可进行代码构建。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113090856565.png" alt="image-20220113090856565" /><figcaption aria-hidden="true">image-20220113090856565</figcaption>
</figure>
<p><code>build</code> 完毕之后可以看到下方的成功提示 <code>0 Error(s), 0 Warning(s)</code>。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113091008941.png" alt="image-20220113091008941" /><figcaption aria-hidden="true">image-20220113091008941</figcaption>
</figure>
<h2 id="flash">FLASH</h2>
<p>FLAHS需要经过 configuration 、 detect 和 download 三步</p>
<h3 id="configuration">configuration</h3>
<p>根据《RTL8762D SDK User Guide CN》文件，RTL8762D 的 EVB KIT 是可以支持 JLINK 的（如下图所示）。</p>
<p><img src="https://pic.islet.space/2022/01/image-20220113095321215.png" alt="image-20220113095321215" style="zoom:50%;" /></p>
<p>但这里并未使用 JLINK，而是使用 Realtek 专门的工具 <code>BeeMPTool_kits</code>， 通过 <code>UART</code> 进行烧录。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113095804076.png" alt="image-20220113095804076" /><figcaption aria-hidden="true">image-20220113095804076</figcaption>
</figure>
<p>打开 <code>MPTool.exe</code> ，并选中对应的芯片型号 <code>RTL8762D</code> ：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113095854784.png" alt="image-20220113095854784" /><figcaption aria-hidden="true">image-20220113095854784</figcaption>
</figure>
<p>在这里选择 <code>调试</code> 模式进行烧录</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113095949881.png" alt="image-20220113095949881" /><figcaption aria-hidden="true">image-20220113095949881</figcaption>
</figure>
<p>在 <code>Config Set</code> 中选择 <code>Confirm</code> ，不需要修改什么东西。</p>
<p><img src="https://pic.islet.space/2022/01/image-20220113100100098.png" alt="image-20220113100100098" style="zoom:50%;" /></p>
<p>此处需要设置 Flash 地址映射文件 <code>flash map.ini</code> 。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113100324900.png" alt="image-20220113100324900" /><figcaption aria-hidden="true">image-20220113100324900</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113101953154.png" alt="image-20220113101953154" /><figcaption aria-hidden="true">image-20220113101953154</figcaption>
</figure>
<p>下方为 《RTL8762D SDK User Guide CN》文件中，9.1章节对五个images文件进行了描述。</p>
<p><img src="https://pic.islet.space/2022/01/image-20220113102036834.png" alt="image-20220113102036834" style="zoom:67%;" /></p>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 32%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="header">
<th>FILE TYPE</th>
<th>DESCRIPTION</th>
<th>FILE PATH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>System Config File</td>
<td>- 来自 <code>BeeMPTool_kits</code></td>
<td><code>\BeeMPTool_kits_v1.0.5.0\BeeMPTool\ConfigFile\</code></td>
</tr>
<tr class="even">
<td>Bank0 OTA Header File</td>
<td>- 来自 <code>sbee2_wristband_sdk_upperstack_img</code></td>
<td><code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\</code></td>
</tr>
<tr class="odd">
<td>Bank0 Secure Boot Loader Image</td>
<td>- 来自 <code>sbee2_wristband_sdk_upperstack_img</code></td>
<td><code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\</code></td>
</tr>
<tr class="even">
<td>Bank0 ROM Patch Image</td>
<td>- 来自 <code>sbee2_wristband_sdk_upperstack_img</code></td>
<td><code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\</code></td>
</tr>
<tr class="odd">
<td>Bank0 APP Image</td>
<td>- 来自 <code>sbee2-sdk-v1.0.0</code></td>
<td><code>sbee2-sdk-v1.0.0\board\evb\io_sample\SPI3WIRE\spi3wire_polling\bin</code></td>
</tr>
</tbody>
</table>
<h4 id="关于app-image文件选择">关于app image文件选择</h4>
<p>在Build完成后，会生成三个 <code>.bin</code> 文件，如果选择错误，会提示 <code>MD5 check error!Image type doesn't match IC type.</code> ，选择正确的话会提示 <code>File check OK</code> 。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113111301561.png" alt="image-20220113111301561" /><figcaption aria-hidden="true">image-20220113111301561</figcaption>
</figure>
<h3 id="detect">detect</h3>
<p>detect 的时候需要注意：</p>
<ol type="1">
<li>将 EVB kit上的 <code>J15</code> LOG口接地，否则会检测失败</li>
<li>如果出现 <code>Failed</code> 字样，则按一下 EVB KIT 上的红色的 <code>RESET</code> 按钮进行复位后再尝试。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113111054035.png" alt="image-20220113111054035" /><figcaption aria-hidden="true">image-20220113111054035</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113103853161.png" alt="image-20220113103853161" /><figcaption aria-hidden="true">image-20220113103853161</figcaption>
</figure>
<h3 id="download">download</h3>
<p>最后选择 <code>download</code> 下载即可。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113104047601.png" alt="image-20220113104047601" /><figcaption aria-hidden="true">image-20220113104047601</figcaption>
</figure>
<h2 id="upperstack-flash">UPPERSTACK FLASH</h2>
<p>自带的 <code>\sbee2-sdk-v1.0.0\doc\</code> 路径下的教程是，都是有 <code>Bank0 Upperstack Image</code> 需要烧录的。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120140307997.png" alt="image-20220120140307997" /><figcaption aria-hidden="true">image-20220120140307997</figcaption>
</figure>
<p>步骤如下：</p>
<ol type="1">
<li><p>使用 <code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\upperstack_img</code> 路径下的 <code>.ini</code> 文件作为 layout 文件。（而之前使用的<code>flash map.ini</code> 地址为 <code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\</code>）</p></li>
<li><p>指定 <code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\upperstack_img</code> 路径下的 <code>.bin</code> 文件作为 Upperstack Image 文件。</p></li>
<li><p>将 <code>\sbee2_wristband_sdk_upperstack_img\board\evb_stack_img\wristband\flash_map.h</code> 文件作为项目工程里的唯一内存映射文件依赖。<code>flash_map.h</code> 被放在 <code>mem_config.h</code> 头文件下，间接被 <code>syetem_rtl876x.h</code> 引用。</p></li>
</ol>
<h2 id="log">LOG</h2>
<p>RTL8762D 的 EVB KIT 不支持 JTAG 方式进行观察，（听说是）通信过程容易被打断。</p>
<p>这里使用 <code>UART</code> 和 EVB KIT 上的 <code>J15</code> 口来观察 LOG数据。</p>
<h3 id="log软件">LOG软件</h3>
<p>使用专用工具 <code>DebugAnalyzer</code> 进行日志输出。</p>
<ol type="1">
<li>选择合适的串口，即使用 <code>FT232</code> 的UART口，将该芯片口的 <code>RX</code> 连接至 <code>RTL8762D</code> 板子上的 <code>J15</code> 口。并在电脑中选中对应的 <code>FT232</code> 设备。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113093030488.png" alt="image-20220113093030488" /><figcaption aria-hidden="true">image-20220113093030488</figcaption>
</figure>
<ol start="2" type="1">
<li>需要设置 <code>App Trace File</code> 。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113093723962.png" alt="image-20220113093723962" /><figcaption aria-hidden="true">image-20220113093723962</figcaption>
</figure>
<ol start="3" type="1">
<li>观察日志输出</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113104331739.png" alt="image-20220113104331739" /><figcaption aria-hidden="true">image-20220113104331739</figcaption>
</figure>
<h1 id="com-setting">COM SETTING</h1>
<h2 id="uart-setting">UART SETTING</h2>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113111953878.png" alt="image-20220113111953878" /><figcaption aria-hidden="true">image-20220113111953878</figcaption>
</figure>
<h1 id="peripheral">PERIPHERAL</h1>
<h1 id="wired-spi">3-WIRED SPI</h1>
<p>以下是主控板 RTL8762D 的SDK对3线SPI的相关设置结构体。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_SysClock;     <span class="comment">/*!&lt; Specifies system clock */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_Speed;        <span class="comment">/*!&lt; Specifies SPI clock. */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_Mode;         <span class="comment">/*!&lt; Specifies SPI operation mode.</span></span><br><span class="line"><span class="comment">                                This parameter can be a value of @ref THREE_WIRE_SPI_mode */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_ReadDelay;    <span class="comment">/*!&lt; Specifies the delay time from the end of address phase to the start of read data phase.</span></span><br><span class="line"><span class="comment">                                    This parameter can be a value of 0x0 to 0x1f, delay time = (SPI3WIRE_ReadDelay+1)/(2*SPI3WIRE_Speed) */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_OutputDelay;  <span class="comment">/*!&lt; Specifies SPI output delay 1T or not.</span></span><br><span class="line"><span class="comment">                                 This parameter can be a value of @ref THREE_WIRE_SPI_OE_delay_config */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_ExtMode;      <span class="comment">/*!&lt; Specifies extended timing window for SPI output enable = 0. */</span></span><br><span class="line">&#125; SPI3WIRE_InitTypeDef;</span><br></pre></td></tr></table></figure>
<h2 id="writing-delay">WRITING-DELAY</h2>
<p><span class="math display">\[
1s = 1^3ms = 1^6us = 1^9ns\\
1Hz = 1^{-3}KHz = 1^{-6}MHz = 1^{-9}GHz
\]</span></p>
<p>在3线SPI的数据线读取过程中，在前一段地址帧结束且尚未开始读取数据前，会有一段延时。由 <code>spiReadDelay</code> 和 <code>spiWireSpeed</code> 两个参数控制。 <span class="math display">\[
DelayTime = (spiReadDelay +1) / (2* spiWireSpeed)
\tag{延时计算公式}
\]</span> 例如， 当 <code>spiWireSpeed = 8e5</code> 时， 设置 <code>spiReadDelay = 0x03</code> ，此时 可以在中间延时 <code>2.5us</code> 。</p>
<h2 id="clock_freq">CLOCK_FREQ</h2>
<p>将RTL8762D的SPI通信时钟频率从 <code>2E7</code> 更改为 <code>1E6</code> 后可以短时间正常通信，但是稍微过一段时间就出现了不稳定，度数全为 <code>0</code> ，且复位后读取的 <code>chipID</code> 也为 <code>0x00, 0x00</code> 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the actual frequency of spi is set by `SPI3_WIRE_SysClock`</span></span><br><span class="line"><span class="comment">// `1E6` means 1MHz, and `2E7` means 20MHz.</span></span><br><span class="line">SPI3WIRE_InitStruct.SPI3WIRE_SysClock       = <span class="number">1E6</span>;</span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220119152741283.png" alt="image-20220119152741283" /><figcaption aria-hidden="true">image-20220119152741283</figcaption>
</figure>
<h2 id="timing">TIMING</h2>
<p><span class="math display">\[
Sysclk = 1e7 \\
wirespeek = 8e5
\]</span></p>
<h1 id="wired-spi-1">2-WIRED SPI</h1>
<blockquote>
<p>To recover the correct communication of SPI, the host controller can de-assert the SCLK for at least tRESYNC (1us min), and then keep SCLK asserted for a certain time interval tWDT (1.7ms, min) as shown in below Figure . to force the SPI control circuits of the sensor to reset.</p>
</blockquote>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120154724619.png" alt="image-20220120154724619" /><figcaption aria-hidden="true">image-20220120154724619</figcaption>
</figure>
<h1 id="debug-records">DEBUG RECORDS</h1>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112163300158.png" alt="image-20220112163300158" /><figcaption aria-hidden="true">image-20220112163300158</figcaption>
</figure>
<p>0x05 // 0000 0101</p>
<p>// 1000 0101</p>
<h2 id="delta_x-delta_y-unread">DELTA_X &amp; DELTA_Y UNREAD</h2>
<p><code>Motion</code>  <code>DYOVF</code>  <code>DXOVF</code> 并未读出，未检测到移动。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114110802052.png" alt="image-20220114110802052" /><figcaption aria-hidden="true">image-20220114110802052</figcaption>
</figure>
<p><code>Operation_Mode = 0xB8, cofiguration = 0x17</code> 均为默认</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114111325286.png" alt="image-20220114111325286" /><figcaption aria-hidden="true">image-20220114111325286</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114111114776.png" alt="image-20220114111114776" /><figcaption aria-hidden="true">image-20220114111114776</figcaption>
</figure>
<p><code>0xB8</code> 使 设备处于睡眠模式，<code>configuration = 0x17</code> 使设备未处于 <code>sleep3</code> 且 <code>powerDown</code> 为正常模式，即未断电。</p>
<p>所以需要修改 <code>Operation_Mode</code> 为 <code>0x01</code> 。</p>
<p>在设置了下方的语句之后，LOG记录传送回来的 <code>OperationMode</code> 对应的数据为 <code>0xFC</code> 或 <code>0xB8</code> （ <code>1111 1100</code> 和 <code>1011 1000</code>） 。</p>
<p>默认情况下 <code>OperationMode</code> 为 <code>0xB8</code> 即 <code>1011 1000</code> 。</p>
<p>异常情况下 <code>OperationMode</code> 为 <code>0xFC</code> 即 <code>1111 1100</code> 。</p>
<p>即第 <code>2</code> 位和 第 <code>6</code> 位会变，查数据手册，<mark>只有第 <code>2</code> 位（<code>Slp2mu_Enh</code>）有影响，该位控制芯片强制进入 <code>睡眠2</code> 模式。</mark></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spi3wire_writebyte(REG_KA8G2_OPERATION_MODE, KA8G2_OM_RUN);  <span class="comment">// edited by liew in 20211114</span></span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114135400211.png" alt="image-20220114135400211" /><figcaption aria-hidden="true">image-20220114135400211</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114135647079.png" alt="image-20220114135647079" /><figcaption aria-hidden="true">image-20220114135647079</figcaption>
</figure>
<p>从《KA8G2 optical mouse sensor》中的 <strong>MOTION Pin Function</strong> 可以看出，<code>Motion</code> 寄存器即运动检测标志相关寄存器。</p>
<p><img src="https://pic.islet.space/2022/01/image-20220114142319440.png" alt="image-20220114142319440" style="zoom:50%;" /></p>
<h2 id="主控板io口数据异常">主控板IO口数据异常</h2>
<p>下方为利用SDK进行 <strong>读数据</strong> 的相关操作：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="keyword">uint32_t</span> random_seed_value;</span><br><span class="line">    srand(random_seed_value);</span><br><span class="line">    spi3wire_demo();</span><br><span class="line">	DBG_DIRECT(<span class="string">&quot;TEST_20220120&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">uint8_t</span> i = <span class="number">0</span>; i&lt; <span class="number">0xFF</span>; i++)&#123;	</span><br><span class="line">			spi3wire_writebyte(<span class="number">0x7F</span>, i);</span><br><span class="line">			delaySys(<span class="number">0xF</span>);</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并用逻辑分析仪进行捕获和分析，发现数据异常：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120151632286.png" alt="image-20220120151632286" /><figcaption aria-hidden="true">image-20220120151632286</figcaption>
</figure>
<p>经过检查，发现时序解码无误，所有波形的高低和解码结果一致。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120151645002.png" alt="image-20220120151645002" /><figcaption aria-hidden="true">image-20220120151645002</figcaption>
</figure>
<p>但是相连的数据之间数据差异较大。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120151638254.png" alt="image-20220120151638254" /><figcaption aria-hidden="true">image-20220120151638254</figcaption>
</figure>
<p>查看LOG也发现数据的确有按照预定的逻辑进行循环：</p>
<figure>
<img src="https://pic.islet.space/2022/01/20220120.png" alt="20220120" /><figcaption aria-hidden="true">20220120</figcaption>
</figure>
<p>但是逻辑分析仪采出来的数据就是异常。</p>
<p>经过分析，是因为逻辑分析仪的采样率为 <code>1MHz</code> ，与SPI外设的频率 <code>1e6</code> 一致。</p>
<p>修改了逻辑分析仪的采样率为 <code>2MHz</code> ，提高了1倍，采样出来的逻辑就正常了。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120162227888.png" alt="image-20220120162227888" /><figcaption aria-hidden="true">image-20220120162227888</figcaption>
</figure>
<p>但是之前的项目只用了写数据的函数。示波器波形和逻辑分析仪都能正常。</p>
<p>改了项目主循环中的语句为读数据之后，就出现异常了。</p>
<h3 id="问题推断">问题推断</h3>
<p>通过注释部分语句，进行间歇性测试和波形观察。</p>
<p>发现，spi读取语句 <code>uint8_t spi3wire_readbyte(uint8_t address)</code> 可能是波形不正常的原因。</p>
<p>硬件查找主控板和底板的引脚问题：</p>
<ol type="1">
<li>找到扩展板上的GPIO口对应核心板上的哪个口</li>
<li>使用示波器探头直接接触对应的GPIO口并查看波形，查看主控板和底板之间是否存在问题。</li>
</ol>
<p>发现示波器探头从底板更换至主控板之后，示波器所显示波形并无差异。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/12/27/Hardware/ESP32/2021-12-27-islet%E5%AE%B6%E5%BA%AD%E7%89%A9%E8%81%94%E7%BD%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/27/Hardware/ESP32/2021-12-27-islet%E5%AE%B6%E5%BA%AD%E7%89%A9%E8%81%94%E7%BD%91/" class="post-title-link" itemprop="url">islet家庭物联网</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-27 19:40:00" itemprop="dateCreated datePublished" datetime="2021-12-27T19:40:00+08:00">2021-12-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-02-24 19:05:52" itemprop="dateModified" datetime="2022-02-24T19:05:52+08:00">2022-02-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/InternetOfThings/" itemprop="url" rel="index"><span itemprop="name">InternetOfThings</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>GITEE</strong>: https://gitee.com/isletspace/esp32iot</p>
<p>本项目是使用 <strong>微信小程序</strong>+<strong>腾讯云</strong>+<strong>乐鑫开发板</strong>+<strong>5V-多路-继电器</strong>+<strong>220V-AC-电器</strong> 的模式对家庭中的硬件进行检测和控制，本项目涉及到 <strong>网络前端</strong>、<strong>服务器后端</strong>、<strong>网络通信</strong> 和 <strong>物联网硬件控制</strong> 方面的相关知识。</p>
<p><strong>需要实现的功能</strong>：</p>
<ol type="1">
<li>开发板能够自动连接家庭WiFi</li>
<li>开发板能够通过MQTT协议与后台服务器取得联系</li>
<li>开发板能够定时自动获取时钟并校准</li>
<li>开发板能够根据MQTT协议控制外围电路</li>
<li>开发板能够根据已经设置的参数与实时的传感器参数比对，并在一定环境条件内开启/关闭相关电路</li>
<li>手机可以通过微信小程序发送MQTT数据至服务器</li>
</ol>
<p><strong>软件开发平台</strong>：Mac</p>
<p><strong>硬件开发IDE</strong>：Arduino</p>
<h1 id="硬件准备">硬件准备</h1>
<ol type="1">
<li>4路5V红板（光耦/高低电平）继电器 *1</li>
<li>DHT11温度模块 *2</li>
<li>加热器 *1</li>
<li>ESP32-WROOM-32开发板 *1</li>
</ol>
<p>其他：</p>
<ol type="1">
<li>杜邦线</li>
<li>电烙铁</li>
<li>锡丝</li>
<li>松香</li>
<li>面包板</li>
</ol>
<h2 id="芯片模组比对选型">芯片模组比对选型</h2>
<p>ESP32-WROOM-32X（此处 <code>X</code> 代表不确定） 和 ESP32-WROVER-X（此处 <code>X</code> 代表不确定） 在性能上基本一模一样，包括核心数、最大时钟频率、Flash大小、支持的接口类型 和 特殊传感器等等。除了在 PSRAM、工作温度范围、天线、WiFi最高频率 和 模组尺寸上有所区别外。 ESP32-WROVER-X 则具有PSRAM 和 最大的面积（18mm × 31.4mm × 3.3mm）。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228014701607.png" alt="官方展示的ESP32模组性能参数对比" /><figcaption aria-hidden="true">官方展示的ESP32模组性能参数对比</figcaption>
</figure>
<h2 id="芯片选型">芯片选型</h2>
<p>无脑选了ESP32-WROOM-32SE，反正自己用，而且便宜（￥21.5包邮）。</p>
<h2 id="芯片基本信息">芯片基本信息</h2>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228012555509.png" alt="Arduino所展示的开发板可调参数" /><figcaption aria-hidden="true">Arduino所展示的开发板可调参数</figcaption>
</figure>
<h1 id="arduino-ide准备">Arduino IDE准备</h1>
<p>使用 Arduino IDE 进行开发，但开发配置相关的 <code>.json</code> 文件 及其安装包都在 <code>github.com</code> 上，但因为加速器的加速层级可能和IDE拉取资源包所用的数据层级不在同一个上面，无法代理，就白天基本上无法下载，凌晨（正经程序员谁tm熬夜）才有机会下载东西。</p>
<blockquote>
<p>英文版下的 <code>首选项</code> 是 <code>Preferences</code> 。</p>
</blockquote>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228011905234.png" alt="修改附加开发板管理网址" /><figcaption aria-hidden="true">修改附加开发板管理网址</figcaption>
</figure>
<p>然后去 <code>开发板管理器</code> 中搜索 <code>esp32</code> 进行安装。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228012156101.png" alt="目录-开发板-开发板管理器" /><figcaption aria-hidden="true">目录-开发板-开发板管理器</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228012244049.png" alt="搜索关键词“esp32”" /><figcaption aria-hidden="true">搜索关键词“esp32”</figcaption>
</figure>
<h2 id="解决github问题">解决github问题</h2>
<h3 id="方法一">方法一</h3>
<p>本来应该用如下链接进行配置的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://dl.espressif.com/dl/package_esp32_index.json </span><br></pre></td></tr></table></figure>
<p>自己扒拉了一遍该文件中可能包含的所有资源包（主要是 <code>github.com</code> 上的），然后修改了 <code>.json</code> 文件，放到自己的桶里，然后放出来使用，还好这个文件里有明确提到要哪些资源不然也没法扒拉。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://code.islet.space/espressif/dl/package_esp32_index.json</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：Mac系统下可能会因为曾经下载过的缓存文件无法生效（如果自行修改了网站上的 <code>.json</code> 文件的话），需要自行清除缓存，打开 <code>~/Library/ArduinoXX/cache/</code> 并对应删除该网站的文件夹即可，如 <code>code.islet.space</code> 。（这里的 <code>ArduinoXX</code> 中的 <code>XX</code> 需要自己去看自己的文件夹，应该是受版本控制的）</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228005455101.png" alt="修改链接后可以正常下载" /><figcaption aria-hidden="true">修改链接后可以正常下载</figcaption>
</figure>
<h3 id="方法二">方法二</h3>
<p>自己去github，用浏览器或者下载器下好了以后放到 <code>用户目录--资源库--程序缓存--指定位置</code>（如下）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&#x2F;Library&#x2F;ArduinoXX&#x2F;staging&#x2F;packages&#x2F;</span><br></pre></td></tr></table></figure>
<p>这个文件夹也就需要放这么多文件吧。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228012028024.png" alt="资源库缓存指定位置下的文件" /><figcaption aria-hidden="true">资源库缓存指定位置下的文件</figcaption>
</figure>
<p>亲测，第二种方法更好用。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228011814461.png" alt="提示安装成功" /><figcaption aria-hidden="true">提示安装成功</figcaption>
</figure>
<h1 id="visual-studio-code-ide准备">Visual Studio Code IDE准备</h1>
<p>总的来说，VS Code的IDE配置会比Arduino更为复杂，但是无奈在都是科学上网的情况下，VS Code下载毫无压力，且VS Code使用习惯之后更加方便。</p>
<p>至少前期配置工作来说，VS Code更为友好。</p>
<h2 id="espressif-idf插件安装">Espressif IDF插件安装</h2>
<p>首先去插件市场搜索 <code>Espressif IDF</code> 插件进行安装，然后点击 <code>查看</code> -&gt; <code>命令面板</code>。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228182209737.png" alt="image-20211228182209737" /><figcaption aria-hidden="true">image-20211228182209737</figcaption>
</figure>
<p>到这里需要输入 <code>configure esp-idf extension</code> 以进入该插件的配置页面。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228182314161.png" alt="image-20211228182314161" /><figcaption aria-hidden="true">image-20211228182314161</figcaption>
</figure>
<h2 id="必要工具安装">必要工具安装</h2>
<p>然后它就会提示你需要安装几个必要插件，有 Git / Python / CMake 和 Ninja。这些都可以从Espressif的 <a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/get-started/index.html">官方文档</a> 中获取到安装步骤。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228182508965.png" alt="image-20211228182508965" /><figcaption aria-hidden="true">image-20211228182508965</figcaption>
</figure>
<p>下方为四个工具的官方下载链接，前三个都可以通过官方下载软件包进行安装，第四个 Ninja 我安装不成功，是通过 Mac Ports 进行安装的。</p>
<p>GIT : https://git-scm.com/</p>
<p>PYTHON : https://www.python.org/downloads/</p>
<p>CMAKE : https://cmake.org/download/</p>
<p>NINJA : https://github.com/ninja-build/ninja/releases</p>
<p>需要注意的是，CMAKE 和 Ninja 安装完还需要加入到系统环境变量 <code>PATH</code> 中去，Windows系统下的系统环境变量添加比较方便，下方为 Mac 系统下 CMake 的系统环境变量添加方法。</p>
<h3 id="cmake命令行">CMAKE命令行</h3>
<p>打开Mac系统下的 CMake GUI，点击 <code>Tools</code> --&gt; <code>How to Install For Command Line Use</code> ，可以查看到三种将 CMake 添加到命令行中去运行的方法。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228183126458.png" alt="点击“工具”菜单中的“如何为命令行使用进行安装”" /><figcaption aria-hidden="true">点击“工具”菜单中的“如何为命令行使用进行安装”</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228183411724.png" alt="可以查看到三种安装方法" /><figcaption aria-hidden="true">可以查看到三种安装方法</figcaption>
</figure>
<p>使用的是第二种方法，向命令行输入 <code>sudo "/Applications/CMake.app/Contents/bin/cmake-gui" --install</code> 并输入管理员密码即可。</p>
<p>然后通过 <code>cmake --version</code> 可以查看到版本号说明安装成功，但需要注意的是 <code>whereis cmake</code> 还是没有用。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228183403876.png" alt="操作结果" /><figcaption aria-hidden="true">操作结果</figcaption>
</figure>
<h3 id="工具安装验证">工具安装验证</h3>
<p>四个必须要安装的软件都已经安装完毕，通过 <code>--version</code> 可以查看版本号。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228184801497.png" alt="安装验证" /><figcaption aria-hidden="true">安装验证</figcaption>
</figure>
<h2 id="配置继续">配置继续</h2>
<p>四个必要工具安装完毕之后，关闭 <code>ESP-IDF Setup</code> 页面，然后重新在 <strong>命令面板</strong> 输入 <code>configure esp-idf extension</code> 以进入该插件的配置页面。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228184938407.png" alt="再次进入配置页面" /><figcaption aria-hidden="true">再次进入配置页面</figcaption>
</figure>
<p>此处选择 <code>EXPRESS</code> 即可，里面会要求选择从哪个服务器下载（自己看情况选择<code>Github</code> / <code>Espressif</code>）、IDF版本（默认选最新）、IDF放置路径、工具路径、使用的Python3路径 等几个信息，选完了就进入下一界面，会自动下载安装 ESP-IDF。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228185458736.png" alt="详细配置页面" /><figcaption aria-hidden="true">详细配置页面</figcaption>
</figure>
<p>耐心等待下载完毕即可，我用 <code>Espressif</code> 服务器下载不下来，然后该用 <code>Github</code> 和 科学上网进行下载的。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228185748221.png" alt="image-20211228185748221" /><figcaption aria-hidden="true">image-20211228185748221</figcaption>
</figure>
<p>下载过程页面如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190058612.png" alt="image-20211228190058612" /><figcaption aria-hidden="true">image-20211228190058612</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190027057.png" alt="image-20211228190027057" /><figcaption aria-hidden="true">image-20211228190027057</figcaption>
</figure>
<p>最后提示的安装成功：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190438498.png" alt="image-20211228190438498" /><figcaption aria-hidden="true">image-20211228190438498</figcaption>
</figure>
<h1 id="示例项目载入">示例项目载入</h1>
<p>在 <strong>命令面板</strong> 中输入 <code>show examples projects</code> 。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190651117.png" alt="image-20211228190651117" /><figcaption aria-hidden="true">image-20211228190651117</figcaption>
</figure>
<p>即可调出 ESP-IDF的示例代码项目列表。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190738993.png" alt="image-20211228190738993" /><figcaption aria-hidden="true">image-20211228190738993</figcaption>
</figure>
<p>选择 <code>blink</code> 作为测试代码。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190839371.png" alt="image-20211228190839371" /><figcaption aria-hidden="true">image-20211228190839371</figcaption>
</figure>
<h2 id="项目构建">项目构建</h2>
<p>这里可以用命令面板输入 <code>esp build your project</code> ，也可以点击GUI下方的 <img src="https://pic.islet.space/2021/12/image-20211231124940242.png" alt="image-20211231124940242" />进行构建。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228191057987.png" alt="命令面板构建" /><figcaption aria-hidden="true">命令面板构建</figcaption>
</figure>
<p>构建完成后，会生成 <code>build</code> 文件夹，下次构建时CMake会查看变动的文件然后只编译变动过的代码。</p>
<p>也可以删除该 <code>build</code> 文件夹，使其全部重新构建，会比较费时。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228191156613.png" alt="build过程" /><figcaption aria-hidden="true">build过程</figcaption>
</figure>
<p>点击下方的闪电按钮<img src="https://pic.islet.space/2021/12/image-20211231125445685.png" alt="烧录按钮" />即可烧录，烧录成功提示如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228221323556.png" alt="烧录过程" /><figcaption aria-hidden="true">烧录过程</figcaption>
</figure>
<h1 id="连接wifi">连接WiFi</h1>
<p>下图为使用示例代码更改的项目代码文件内容：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228222302314.png" alt="项目文件内容示例" /><figcaption aria-hidden="true">项目文件内容示例</figcaption>
</figure>
<p>利用ESP自带的示例代码<code>station</code> 进行调试和更改，需要注意以下几点：</p>
<ol type="1">
<li><p>不用去更改 <code>isletSpaceIotMain.c</code> 中的 <code>SSID</code> 和 <code>PASS</code> ，只需要在 <code>sdkconfig</code> 文件中进行更改即可（如下图）。</p></li>
<li><p>所有的 WiFi设置参数 都可以在 <code>sdkconfig</code> 文件中进行修改，如需要连接 AP 的 名称和密码，还有自身设备所显示的名称。</p></li>
<li><p>修改文件名之后，需要对两个 <code>CMakeList.txt</code>文件 和 一个<code>Makefile</code> 文件中的项目和文件名进行修改（如下图）。</p></li>
</ol>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228222645861.png" alt="如果修改代码名称需要修改main文件夹下的CMakeList文件" /><figcaption aria-hidden="true">如果修改代码名称需要修改main文件夹下的CMakeList文件</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228222717269.png" alt="如果修改项目名称需要修改根目录下的CMakeList" /><figcaption aria-hidden="true">如果修改项目名称需要修改根目录下的CMakeList</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228222733903.png" alt="如果修改项目名称需要修改根目录下的Makefile" /><figcaption aria-hidden="true">如果修改项目名称需要修改根目录下的Makefile</figcaption>
</figure>
<h2 id="menuconfig">MENUCONFIG</h2>
<p>MENUCONFIG 或者说 <code>sdkconfig</code> ，一个是图形界面的，一个是纯文本形式的。</p>
<p>用menuconfig的话只需要找到下方的齿轮按钮即可。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211231130402110.png" alt="image-20211231130402110" /><figcaption aria-hidden="true">image-20211231130402110</figcaption>
</figure>
<p>可以找到WiFi相关的配置位置：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211231130507316.png" alt="image-20211231130507316" /><figcaption aria-hidden="true">image-20211231130507316</figcaption>
</figure>
<p>对 <code>sdkconfig</code> 文件中的设备名称进行修改。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228223040901.png" alt="image-20211228223040901" /><figcaption aria-hidden="true">image-20211228223040901</figcaption>
</figure>
<p>修改完毕后可以在路由器 AP 的后台查看到已经连接的设备的名称，如下。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228223134009.png" alt="image-20211228223134009" /><figcaption aria-hidden="true">image-20211228223134009</figcaption>
</figure>
<h1 id="mqtt协议">MQTT协议</h1>
<p>根据 Espressif 官网的 <a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/protocols/mqtt.html">ESP-MQTT</a> 开发文档可知，MQTT 协议支持以下几种形式：</p>
<ul>
<li><p>MQTT over TCP</p></li>
<li><p>MQTT over SSL with mbedtls</p></li>
<li><p>MQTT over Websocket</p></li>
<li><p>MQTT over Websocket Secure.</p></li>
</ul>
<p>各MQTT协议形式（与对应SDK里的 <a href="##MQTT相关示例代码">MQTT示例代码</a>）及其所使用的端口号不同：</p>
<ul>
<li><code>protocols/mqtt/tcp</code>: MQTT over tcp, default port 1883</li>
<li><code>protocols/mqtt/ssl</code>: MQTT over tcp, default port 8883</li>
<li><code>protocols/mqtt/ssl_psk</code>: MQTT over tcp using pre-shared keys for authentication, default port 8883</li>
<li><code>protocols/mqtt/ws</code>: MQTT over Websocket, default port 80</li>
<li><code>protocols/mqtt/wss</code>: MQTT over Websocket Secure, default port 443</li>
</ul>
<h2 id="mqtt事件结构体">MQTT事件结构体</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MQTT event configuration structure</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">esp_mqtt_event_id_t</span> event_id;       <span class="comment">/*!&lt; MQTT event type */</span></span><br><span class="line">    <span class="keyword">esp_mqtt_client_handle_t</span> client;    <span class="comment">/*!&lt; MQTT client handle for this event */</span></span><br><span class="line">    <span class="keyword">void</span> *user_context;                 <span class="comment">/*!&lt; User context passed from MQTT client config */</span></span><br><span class="line">    <span class="keyword">char</span> *data;                         <span class="comment">/*!&lt; Data associated with this event */</span></span><br><span class="line">    <span class="keyword">int</span> data_len;                       <span class="comment">/*!&lt; Length of the data for this event */</span></span><br><span class="line">    <span class="keyword">int</span> total_data_len;                 <span class="comment">/*!&lt; Total length of the data (longer data are supplied with multiple events) */</span></span><br><span class="line">    <span class="keyword">int</span> current_data_offset;            <span class="comment">/*!&lt; Actual offset for the data associated with this event */</span></span><br><span class="line">    <span class="keyword">char</span> *topic;                        <span class="comment">/*!&lt; Topic associated with this event */</span></span><br><span class="line">    <span class="keyword">int</span> topic_len;                      <span class="comment">/*!&lt; Length of the topic for this event associated with this event */</span></span><br><span class="line">    <span class="keyword">int</span> msg_id;                         <span class="comment">/*!&lt; MQTT messaged id of message */</span></span><br><span class="line">    <span class="keyword">int</span> session_present;                <span class="comment">/*!&lt; MQTT session_present flag for connection event */</span></span><br><span class="line">    <span class="keyword">esp_mqtt_error_codes_t</span> *error_handle; <span class="comment">/*!&lt; esp-mqtt error handle including esp-tls errors as well as internal mqtt errors */</span></span><br><span class="line">    <span class="keyword">bool</span> retain;                        <span class="comment">/*!&lt; Retained flag of the message associated with this event */</span></span><br><span class="line">&#125; <span class="keyword">esp_mqtt_event_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">esp_mqtt_event_t</span> *<span class="keyword">esp_mqtt_event_handle_t</span>;</span><br></pre></td></tr></table></figure>
<h2 id="mqtt相关示例代码">MQTT相关示例代码</h2>
<p>了解完官方开发文档中的信息，就可以知道MQTT示例代码里的这些文件夹命名含义，以及自己需要打开哪个示例代码了。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228223617579.png" alt="image-20211228223617579" /><figcaption aria-hidden="true">image-20211228223617579</figcaption>
</figure>
<h2 id="menuconfig-1">MENUCONFIG</h2>
<p>MENUCONFIG 页面可以看到MQTT的相关配置信息。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229011902429.png" alt="image-20211229011902429" /><figcaption aria-hidden="true">image-20211229011902429</figcaption>
</figure>
<h1 id="mqtt服务器开发">MQTT服务器开发</h1>
<p>自行购买了腾讯云的服务器，然后完成了配置（步骤略），发现自测“主题订阅”不成功。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229033019004.png" alt="image-20211229033019004" /><figcaption aria-hidden="true">image-20211229033019004</figcaption>
</figure>
<p>然后刚好发现服务器的 Ubuntu 20 系统使用的防火墙是 <code>iptables</code> ，顺利打开 <code>1883</code> 端口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -A INPUT -p tcp --dport 1883 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>然后查看打开情况。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229032825212.png" alt="image-20211229032825212" /><figcaption aria-hidden="true">image-20211229032825212</figcaption>
</figure>
<p>顺便在服务器页面也打开相关配置。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229032753559.png" alt="image-20211229032753559" /><figcaption aria-hidden="true">image-20211229032753559</figcaption>
</figure>
<p>最后自测成功：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229032920902.png" alt="image-20211229032920902" /><figcaption aria-hidden="true">image-20211229032920902</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229032953396.png" alt="image-20211229032953396" /><figcaption aria-hidden="true">image-20211229032953396</figcaption>
</figure>
<h1 id="小程序开发未完">小程序开发（未完）</h1>
<p>因为个人使用腾讯云注册了自己的域名 islet.space，且小程序也属于腾讯自家产品，为了后续开发的兼容性和便利性，就同步参阅了腾讯云的 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/1081/47684">物联网自主品牌小程序开发文档</a> 。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227202550338.png" alt="image-20211227202550338" /><figcaption aria-hidden="true">image-20211227202550338</figcaption>
</figure>
<h2 id="微信开发者工具">微信开发者工具</h2>
<p>微信开发者工具下载页面：https://cloud.tencent.com/document/product/1081/47685</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227202759080.png" alt="image-20211227202759080" /><figcaption aria-hidden="true">image-20211227202759080</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227203058077.png" alt="image-20211227203058077" /><figcaption aria-hidden="true">image-20211227203058077</figcaption>
</figure>
<h2 id="后台设置">后台设置</h2>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/1081/34738">物联网开发平台</a></p>
<h1 id="debug">DEBUG</h1>
<h2 id="烧录和调试过程报错">烧录和调试过程报错</h2>
<p>出现这种情况，可能是所选芯片不正确导致。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228214645589.png" alt="烧录错误提示" /><figcaption aria-hidden="true">烧录错误提示</figcaption>
</figure>
<h3 id="解决过程">解决过程</h3>
<p>重新选择了芯片，然后将烧录方法改为 <code>UART</code> ，重新烧录即可成功。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228215715687.png" alt="在插件中选择”扩展设置“" /><figcaption aria-hidden="true">在插件中选择”扩展设置“</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228215826153.png" alt="选择需要调试的设备类型" /><figcaption aria-hidden="true">选择需要调试的设备类型</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228215747432.png" alt="选择烧录方式" /><figcaption aria-hidden="true">选择烧录方式</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228215518196.png" alt="烧录成功提示" /><figcaption aria-hidden="true">烧录成功提示</figcaption>
</figure>
<h2 id="头文件查找错误">头文件查找错误</h2>
<p>这个bug始终没有解决，之后再说吧。。。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228232022467.png" alt="提示无该文件" /><figcaption aria-hidden="true">提示无该文件</figcaption>
</figure>
<h2 id="wifi初始化出错">WIFI初始化出错</h2>
<p>将WiFi-station的代码搬到 MQTT-TCP中，发现 <code>wifiStationInit()</code> 函数初始化错误，报错的行数是 <code>117</code> 。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229143428551.png" alt="wifi初始化函数出错" /><figcaption aria-hidden="true">wifi初始化函数出错</figcaption>
</figure>
<p>经检查，发现该函数示例代码的一部分，并未改动，且未添加其他自定义的 <code>.h</code> 或 <code>.c</code> 文件进行编译，应该不存在人为修改错误。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229150011594.png" alt="检查函数定义" /><figcaption aria-hidden="true">检查函数定义</figcaption>
</figure>
<p>因为仅修改了本 <code>isletSpaceIotMain.c</code> 文件，就在本文件中搜索 <code>esp_event_loop_create_default</code> 关键字，发现在 <code>app_main()</code> 中也有该语句，初步判断可能是两次调用导致错误，就注释了 <code>298</code> 行 和 <code>299</code> 行进行重新编译和烧录，问题解决，设备可以正常连接到路由器。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229150054429.png" alt="注释重复语句" /><figcaption aria-hidden="true">注释重复语句</figcaption>
</figure>
<h2 id="mqtt服务器连接错误">MQTT服务器连接错误</h2>
<p>在设备成功接入WiFi后，发现MQTT客户端无法连接至服务器。给出的错误提示是 <code>There are no transports valid</code> ，大致意思即连接不可用。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229150744192.png" alt="Monitor提示无可用传输" /><figcaption aria-hidden="true">Monitor提示无可用传输</figcaption>
</figure>
<p>经过检查，发现原来填写在 <code>sdkconfig</code> 文件中的 <code>Broker URL</code> 链接为 <code>https://iot.islet.space</code> ，而实际上，官网给出的配置方式如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229152435708.png" alt="查看官方URI定义" /><figcaption aria-hidden="true">查看官方URI定义</figcaption>
</figure>
<p>打开项目配置菜单，修改为 <code>mqtt://iot.islet.space</code> ，并重新 Build 和 Flash。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229151252895.png" alt="修改URL" /><figcaption aria-hidden="true">修改URL</figcaption>
</figure>
<p>可以发现错误已解决，设备已经正常连接至服务器。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229152118764.png" alt="Monitor提示成功" /><figcaption aria-hidden="true">Monitor提示成功</figcaption>
</figure>
<p>尝试在对应主题下发布信息进行测试：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229152036214.png" alt="尝试发布信息" /><figcaption aria-hidden="true">尝试发布信息</figcaption>
</figure>
<p>通过终端Monitor可以观察到，设备正常接收到数据：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229152141547.png" alt="设备接收成功" /><figcaption aria-hidden="true">设备接收成功</figcaption>
</figure>
<h2 id="eventhandler未进入">eventHandler未进入</h2>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229182911935.png" alt="image-20211229182911935" /><figcaption aria-hidden="true">image-20211229182911935</figcaption>
</figure>
<h1 id="参考">参考</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xujiuba/article/details/107234040">Mac 安装 CMake 配置及环境配置</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Lc6ausiKvQM">Quick User Guide for the ESP-IDF VS Code Extension</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/get-started/index.html#id2">ESP-IDF 编程指南</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/protocols/mqtt.html">ESP-MQTT</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备19004822号 </a>
  </div>

<div class="copyright">
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liewzheng</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.12.0/dist/mermaid.min.js","integrity":"sha256-0dD7vUjUCTGJjeLnPotQQJIcSzug5fO6WDMYYyNIX4c="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":"enable","tags":"all","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
