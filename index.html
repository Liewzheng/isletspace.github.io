<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;islet.space&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;Searching...&quot;,&quot;empty&quot;:&quot;We didn&#39;t find any results for the search: ${query}&quot;,&quot;hits_time&quot;:&quot;${hits} results found in ${time} ms&quot;,&quot;hits&quot;:&quot;${hits} results found&quot;}}</script>
<meta name="description" content="笔记分享的旮旯孤岛而已">
<meta property="og:type" content="website">
<meta property="og:title" content="Coder的孤岛">
<meta property="og:url" content="http://islet.space/index.html">
<meta property="og:site_name" content="Coder的孤岛">
<meta property="og:description" content="笔记分享的旮旯孤岛而已">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Liewzheng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://islet.space/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;en&quot;,&quot;comments&quot;:&quot;&quot;,&quot;permalink&quot;:&quot;&quot;,&quot;path&quot;:&quot;index.html&quot;,&quot;title&quot;:&quot;&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>Coder的孤岛</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Coder的孤岛</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">islet of the coder</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-文章"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liewzheng</p>
  <div class="site-description" itemprop="description">笔记分享的旮旯孤岛而已</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">80</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">151</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:liewzheng@qq.com" title="E-Mail → mailto:liewzheng@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/07/15/Hardware/TI/2021-07-15-IGBT%E5%8F%8A%E5%85%B6%E9%A9%B1%E5%8A%A8%E8%8A%AF%E7%89%87%E8%A7%84%E6%A0%BC%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/15/Hardware/TI/2021-07-15-IGBT%E5%8F%8A%E5%85%B6%E9%A9%B1%E5%8A%A8%E8%8A%AF%E7%89%87%E8%A7%84%E6%A0%BC%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">IGBT及其驱动芯片规格学习</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-07-15 08:50:00 / Modified: 21:11:22" itemprop="dateCreated datePublished" datetime="2021-07-15T08:50:00+08:00">2021-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hardware/" itemprop="url" rel="index"><span itemprop="name">Hardware</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>IGBT和其驱动芯片的电气特性、引脚等参数的开发记录。</p>
<h1 id="IGBT"><a href="#IGBT" class="headerlink" title="IGBT"></a>IGBT</h1><p>IGBT芯片选型为 IKW50N65WR5。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210715090401339.png" alt="image-20210715090401339"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210715093221500.png" alt="image-20210715093221500"></p>
<p>IGBT有三个极，发射极、集电极 和 栅极。</p>
<p>从其电气性能表格中，可以看出：</p>
<ul>
<li>集电极到发射极的击穿电压 <em>最小</em> 为650V</li>
<li>在 V<span style="font-size: 0.8rem; font-weight: 500;">GE</span> 完全导通（最高15V）时，集电极到发射极的饱和电压为1.8V以下，此时 IGBT 处于截止状态</li>
<li>在 V<span style="font-size: 0.8rem; font-weight: 500;">GE</span> 完全截止（0V）时，二极管的正向电压为1.9V以下。<mark> 此时，V<span style="font-size: 0.8rem; font-weight: 500;">CE</span> 处于导通状态。</mark></li>
</ul>
<p><img src="https://pic.islet.space/2021/07/image-20210715094151439.png" alt="image-20210715094151439"></p>
<p>从上方表中可以看出，在官方的《开关特性测试情况》下，V<span style="font-size: 0.8rem; font-weight: 500;">GE</span> 的通电情况是 0V 或者 15V，故此推断给此IGBT的栅极电源输入信号应该是0V ~ 15V的方波。</p>
<p>因此，下图中IGBT器件的电路连接方式为：G 接0/15V方波信号，C 接最高650V电源，E 接地。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210715095656309.png" alt="image-20210715095656309"></p>
<h1 id="DRIVER-IC"><a href="#DRIVER-IC" class="headerlink" title="DRIVER IC"></a>DRIVER IC</h1><p><img src="https://pic.islet.space/2021/07/image-20210715102359830.png" alt="image-20210715102359830"></p>
<p>选用芯片型号为 2EDL05I06PF，根据表1索引可得，芯片封装类型为DSO-8，目标驱动芯片是 IGBT，而非 MOSFET。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210715102251417.png" alt="image-20210715102251417"></p>
<p>再根据图3可得芯片引脚分布，根据表2可得所有引脚描述。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210715095931941.png" alt="image-20210715095931941"></p>
<p>结合表2和图3，再根据图1的典型应用电路，可以大致知道芯片的连接方法。</p>
<table>
<thead>
<tr>
<th>针脚</th>
<th>功能描述</th>
</tr>
</thead>
<tbody><tr>
<td>VDD</td>
<td>芯片供电接口</td>
</tr>
<tr>
<td>GND</td>
<td>芯片接地接口</td>
</tr>
<tr>
<td>HIN</td>
<td>调制波形输入接口——高位</td>
</tr>
<tr>
<td>LIN</td>
<td>调制波形输入接口——低位</td>
</tr>
<tr>
<td>VB</td>
<td>高位正电</td>
</tr>
<tr>
<td>HO</td>
<td>控制高位IGBT栅极的信号输出接口</td>
</tr>
<tr>
<td>VS</td>
<td>高位负电</td>
</tr>
<tr>
<td>LO</td>
<td>控制低位IGBT栅极的信号输出接口</td>
</tr>
</tbody></table>
<blockquote>
<p>还是不太明白VB和VS的作用</p>
</blockquote>
<p>表4给出了 V<span style="font-size: 0.8rem; font-weight: 500;">DD</span> 和 V<span style="font-size: 0.8rem; font-weight: 500;">B</span> 的供电范围：</p>
<p><img src="https://pic.islet.space/2021/07/image-20210715105358524.png" alt="image-20210715105358524"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210715105816397.png" alt="image-20210715105816397"></p>
<p>表6 给出了输入 V<span style="font-size: 0.8rem; font-weight: 500;">IN</span> 的逻辑电平高低的电压范围，高电平为1.7 ~ 2.4 V， 低电平为0.7 ~ 1.1V。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210715103507327.png" alt="image-20210715103507327"></p>
<p>图2 提供了驱动芯片内部结构示意图</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/07/14/Hardware/2021-07-14-Semiconductor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/14/Hardware/2021-07-14-Semiconductor/" class="post-title-link" itemprop="url">Semiconductor</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-14 20:30:00" itemprop="dateCreated datePublished" datetime="2021-07-14T20:30:00+08:00">2021-07-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-16 00:45:31" itemprop="dateModified" datetime="2021-07-16T00:45:31+08:00">2021-07-16</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Semiconductor/" itemprop="url" rel="index"><span itemprop="name">Semiconductor</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文章用于记录半导体（晶体管的工作原理等blablabla的知识）。</p>
<h1 id="半导体的定义"><a href="#半导体的定义" class="headerlink" title="半导体的定义"></a>半导体的定义</h1><p><strong>半导体</strong> 是指常温下导电性能介于导体与绝缘体之间的材料。 按照国际通行的半导体产品标准方式进行分类，半导体可以分为四类：<strong>集成电路</strong>（Integer Circuit），<strong>分立器件</strong>（Discrete Device），<strong>传感器</strong>（Sensor） 和 <strong>光电子器件</strong>（Optoelectronic Devices） ，统称为半导体元件。</p>
<p>分立器件按照功率转换进行分类，可以分为 <strong>功率器件</strong> 和 <strong>非功率器件</strong>，其中，<strong>传感器</strong> 和 <strong>光电器件</strong> 属于 分立器件下的 <strong>非功率器件</strong>，剩下的均是 <strong>功率器件</strong>，包含大部分晶体管，如 Zener Diode、BJT、IGFET、IGBT、Thyristor等。</p>
<p><strong>注意</strong>：功率器件的概念很大，不仅在分立器件中存在功率半导体，在IC中也存在功率半导体的产品。</p>
<h2 id="本征半导体"><a href="#本征半导体" class="headerlink" title="本征半导体"></a>本征半导体</h2><p><mark>导电性介于导体与绝缘体之间的物质</mark>称为 <strong>半导体</strong>。</p>
<p><strong>导体</strong>：如铁、铝、铜等金属元素等低价元素，其最外层电子在外电场作用下很容易产生定向移动，形成电流。</p>
<p><strong>绝缘体</strong>：如惰性气体、橡胶等，其原子的最外层电子受原子核的束缚力很强，只有在外电场强到一定程度时才可能导电。</p>
<p><strong>半导体</strong>：如硅（Si）、锗（Ge），均为四价元素，它们原子的最外层电子受原子核的束缚力介于导体与绝缘体之间。</p>
<p><strong>本征半导体</strong>：intrinsic semiconductor， 是 <strong>纯净</strong>（Purity）的 <strong>晶体结构</strong>（Crystal Texture）的 半导体；intrinsic 具有 “本质，固有” 之意。<strong>纯净</strong>，即无杂质之意；<strong>晶体结构</strong>，即稳定的结构。</p>
<h2 id="P-N型半导体"><a href="#P-N型半导体" class="headerlink" title="P/N型半导体"></a>P/N型半导体</h2><p>纯净的硅晶体不带电荷，不显示出任何导电特性。</p>
<p><strong>自由电子</strong>（Electron）：由于热运动，具有足够能量的价电子挣脱共价键的束缚而成为自由电子</p>
<p><strong>空穴</strong>（Hole）：自由电子的产生使共价键中留有一个空位置</p>
<p><strong>复合</strong>：自由电子与空穴相碰同时消失</p>
<p><strong>电荷</strong>：电子和空穴都是电荷，电子呈现负电荷，空穴呈现正电荷</p>
<p><strong>载流子</strong>（Carrier）：运载电荷的粒子称为载流子</p>
<p><strong>导电性</strong>：物体呈现出的传导电流的能力</p>
<p><strong>多数载流子</strong>：在纯净硅晶体中掺杂数量较多的电荷称为多数载流子。</p>
<p><strong>少数载流子</strong>：在纯净硅晶体中掺杂数量较少的电荷称为少数载流子。</p>
<p>外加电场时，带负电的自由电子和带正电的空穴均参与导电，且运动方向相反。由于载流子数目很少，故导电性很差。温度升高，热运动加剧，载流子浓度增大，导电性增强。热力学温度0K时不导电。</p>
<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714204623205.png" alt="image-20210714204623205" style="zoom: 33%;" />

<div style="text-align: center; font-weight:900;">图 N型半导体结构</div>



<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714204653816.png" alt="image-20210714204653816" style="zoom: 33%;" />

<div style="text-align: center; font-weight:900;">图 P型半导体结构</div>



<p>往纯净的硅晶体中掺杂一定浓度的 <strong>磷</strong>（P）或 <strong>硼</strong>（B）即可获得 使得硅晶半导体带上电子或空穴，即获得了 <strong>N型半导体</strong> 和 <strong>P型半导体</strong>。</p>
<p><strong>杂质半导体</strong>：在本征的基础上掺杂其他元素。</p>
<p><strong>P型半导体</strong>：掺杂了硼元素的硅晶体，空穴为多数载流子。</p>
<p><strong>N型半导体</strong>：掺杂了磷元素的硅晶体。自由电子为多数载流子。</p>
<h2 id="PN结"><a href="#PN结" class="headerlink" title="PN结"></a>PN结</h2><p><strong>结</strong>：即 Junction，在纯净硅晶体中掺杂两种不同电荷所形成的杂质接触截面。</p>
<p><strong>扩散运动</strong>：物质 <mark>因浓度差而产生</mark> 的运动。气体、液体、固体均有之。扩散运动使靠近接触面P区的空穴浓度降低、靠近接触面N区的自由电子浓度降低，产生内电场。</p>
<p><strong>漂移运动</strong>：因 <mark>电场作用</mark> 所产生的运动。</p>
<p><strong>动态平衡</strong>：结处因空穴和电子一刻不停地复合和分离（官方：参与扩散运动和漂移运动的载流子数目相同）而形成 “无多数载流子” 的状态。</p>
<blockquote>
<p><strong>注意</strong>：扩散运动和漂移运动是相反的， </p>
</blockquote>
<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714210922380.png" alt="image-20210714210922380" style="zoom:50%;" />

<div style="text-align: center; font-weight:900;">图 扩散运动</div>



<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714210942004.png" alt="image-20210714210942004" style="zoom:67%;" />

<div style="text-align: center; font-weight:900;">图 漂移运动</div>

<p><strong>耗尽层</strong>：PN结处，因动态平衡而达到的“无多数载流子”的状态，该结的大小称为耗尽层。</p>
<p>如果此时让P区的多数载流子，即空穴尽量往N区移动，让N区的多数载流子，即自由电子尽量往P区移动，则两种电荷进行复合，形成更宽的耗尽层，此时因为耗尽层因为没有多数载流子而呈现不导电特性。</p>
<p>反之，让P区的多数载流子尽量往P区靠拢，让N区的多数载流子尽量往N区靠拢（注意，这里用的是“靠拢”，因为中间已经有耗尽层的形成，此时的“靠拢”是让耗尽层中已经复合消失的电子和空穴重新拆开，分别往各自原来的反向回归。），耗尽层的宽度会逐渐缩小，显现出导电特性。</p>
<p><strong>正向</strong>：电源的正、负极分别对准半导体的P、N极进行连接。</p>
<p><strong>反向</strong>：电源的正、负极分别对准半导体的N、P极进行连接。</p>
<p><strong>正向导通</strong>：耗尽层变窄，扩散运动加剧，由于外电源的作用，形成扩散电流，PN结处于导通状态。</p>
<p><strong>反向截止</strong>：耗尽层变宽，阻止扩散运动，有利于漂移运动，形成漂移电流。由于电流很小，故可近似认为其截止。</p>
<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714212136379.png" alt="image-20210714212136379" style="zoom:33%;" />

<div style="text-align: center; font-weight:900;">图 正向导通</div>



<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714212143706.png" alt="image-20210714212143706" style="zoom:33%;" />

<div style="text-align: center; font-weight:900;">图 反向截止</div>



<h3 id="电容效应"><a href="#电容效应" class="headerlink" title="电容效应"></a>电容效应</h3><p><strong>势垒电容</strong>：PN结外加电压变化时，空间电荷区的宽度将发生变化，有电荷的积累和释放的过程，与电容的充放电相同，其等效电容称为势垒电容Cb。</p>
<p><strong>扩散电容</strong>：PN结外加的正向电压变化时，在扩散路程中载流子的浓度及其梯度均有变化，也有电荷的积累和释放的过程，其等效电容称为扩散电容Cd。</p>
<p><strong>结电容</strong>：等于 势垒电容 与 扩散电容 之和。但 <mark>结电容不是常量！</mark> 若PN结外加电压频率高到一定程度，则失去单向导电性！</p>
<h1 id="二极管"><a href="#二极管" class="headerlink" title="二极管"></a>二极管</h1><p>The diode is the most used semiconductor device in electronics circuits. <em><strong>It is a two-terminal electrical check valve that allows the flow of current in one direction.</strong></em> They are mostly made up of <em><strong>silicon</strong></em> but <em><strong>germanium</strong></em> is also used. Usually, they are used for <em><strong>rectification</strong></em>. But there are different properties &amp; characteristics of diodes which can be used for different application. These characteristics are modified to form different types of diodes. </p>
<p><img src="https://pic.islet.space/2021/07/image-20210713102126884.png" alt="image-20210713102126884"></p>
<img src="https://pic.islet.space/2021/07/Types-of-Diodes-and-Their-Applications.jpg" alt="Types of Diodes and Their Applications" style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">图 二极管的几种外形</div>



<p><img src="https://pic.islet.space/2021/07/image-20210713102141393.png" alt="image-20210713102141393"></p>
<div style="text-align: center; font-weight: 900;">图 二极管的几种常见结构和符号</div>

<h2 id="主要特征参数"><a href="#主要特征参数" class="headerlink" title="主要特征参数"></a>主要特征参数</h2><ol>
<li>最大整流电流（Maximum Rectification Current）</li>
<li>最高反向工作电压（Maximum Reverse Voltage）</li>
<li>反向电流（Reverse Current）</li>
<li>最高工作频率（Maximum Frequency）</li>
</ol>
<h1 id="晶体管"><a href="#晶体管" class="headerlink" title="晶体管"></a>晶体管</h1><p>晶体管主要分为两种类型，BJT 和 FET。</p>
<p><strong>工作区域</strong>：晶体管的导通状态，分为三种，分别是饱和、截止和放大，分别是指</p>
<h2 id="BJT"><a href="#BJT" class="headerlink" title="BJT"></a>BJT</h2><p>BJT，即 Bioplar Junction Transistor，双极性结型晶体管。</p>
<p>![image-20210714213248733](/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714213248733.png)</p>
<div style="text-align: center; font-weight:900;">图 晶体管内部结构和符号示意</div>

<p><strong>注意</strong>：晶体管的符号示意中，箭头的方向永远是从P指向N的，此时先不用管c、b、e是怎么接，确定好。</p>
<blockquote>
<p>BJT结构特点：三极三区两PN结，发射区多子浓度高，基区多子浓度低且薄，集电区 面积大。</p>
</blockquote>
<p><strong>发射区</strong>：多数载流子较高的区域，自由电子流出的方向。</p>
<p><strong>基区</strong>：多数载流子浓度较低且薄的区域。</p>
<p><strong>集电区</strong>：面积大的区域，空穴流出的反向。</p>
<blockquote>
<p>某极 是根导线，与BJT中的物理区不同。</p>
</blockquote>
<p><strong>发射结</strong>：发射区和基区之间的PN结。</p>
<p><strong>集电结</strong>：集电区和基区之间的PN结。</p>
<blockquote>
<p><strong>注意</strong>：以上多数载流子可以是 空穴 或 自由电子，因此 BJT 可以有 NPN 和 PNP 两种类型的BJT。</p>
</blockquote>
<p>联系到实际电路连接中，一般情况下，<strong>集电区</strong> 都是接 <strong>供电电源</strong> ， <strong>基区</strong> 都是接 <strong>控制电源</strong>， <strong>发射区</strong> 都是接 <strong>负端/地</strong>。控制电源的电压会低于供电电源的电压，但会大于发射区的电压。</p>
<p>基区所连接的控制电源 为BJT提供 高电平或低电平 予以控制半导体的导通或截止，<mark>半导体所控制的负载的最大电压取决于发射极的供电电源电压 和 基区的控制电源电压</mark>。</p>
<img src="https://pic.islet.space/2021/07/image-20210713104805683.png" alt="image-20210713104805683" style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">图 BJT的几种常见外形</div>



<img src="https://pic.islet.space/2021/07/image-20210713105054978.png" alt="image-20210713105054978" style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">图 BJT的结构和符号</div>



<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>从下图可以看出，下图 BJT 为 NPN 型半导体，集电区接正电，发射区接地，基区接地。集电区与基区为反向截止状态，集电结的耗尽层增大，进一步阻止集电区和发射区之间的电流导通。</p>
<p>若此时向基区施加正向电流，基区电压高于发射区电压，发射结正偏导通，发射区多子（电子）往基区流动，。发射区的电子能够顺利往集电区流动，集电区的电流往发射区流动，从而导通 该BJT。</p>
<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714215347959.png" alt="image-20210714215347959" style="zoom:33%;" />

<div style="text-align: center; font-weight:900;">图 BJT导通时的内部电荷流向示意</div>



<p>集电极电流是漂移形成的，发射极电流是扩散形成的。</p>
<p><strong>发射区电流</strong> I<span style="font-size: 0.8rem;">E</span> 是由 扩散运动形成的。</p>
<p><strong>基区电流</strong> I<span style="font-size: 0.8rem;">B</span> 是由 复合运动形成的。</p>
<p><strong>集电区电流</strong> I<span style="font-size: 0.8rem;">C</span> 是由 漂移运动形成的。</p>
<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714222731446.png" alt="image-20210714222731446" style="zoom:33%;" />

<div style="text-align: center; font-weight:900;">图 BJT输入特性曲线</div>



<img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714222645318.png" alt="image-20210714222645318" style="zoom: 33%;" />

<div style="text-align: center; font-weight:900;">图 BJT输出特性曲线</div>



<h3 id="工作区域"><a href="#工作区域" class="headerlink" title="工作区域"></a>工作区域</h3><img src="/Users/liewzheng/Library/Application Support/typora-user-images/image-20210714223024773.png" alt="image-20210714223024773" style="zoom:67%;" />

<div style="text-align: center; font-weight:900;">图 BJT工作区域</div>

<p>饱和 和 放大的区别：</p>
<p>共射极电路、共基电路</p>
<h2 id="FET"><a href="#FET" class="headerlink" title="FET"></a>FET</h2><p><strong>场效应晶体管</strong> 简称 <strong>场效应管</strong>。主要有 <strong>结型场效应管</strong>（JFET）和 <strong>金属氧化物半导体场效应管</strong>（MOSFET）两种类型。</p>
<h3 id="JFET"><a href="#JFET" class="headerlink" title="JFET"></a>JFET</h3><img src="https://pic.islet.space/2021/07/image-20210713105852012.png" alt="image-20210713105852012" style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">图 JFET的结构和符号</div>



<h3 id="MOSFET"><a href="#MOSFET" class="headerlink" title="MOSFET"></a>MOSFET</h3><p>在MOS管工作原理图上可以看到，漏极和源极之间有一个寄生二极管。这个叫体二极管，在驱动感性负载(如马达)，这个二极管很重要。顺便说一句，体二极管只在单个的MOS管中存在，在集成电路芯片内部通常是没有的。</p>
<p>下图a中，为增强型P衬底N沟道MOS，其栅极接 <u>高电平</u> 即导通。</p>
<img src="https://pic.islet.space/2021/07/image-20210713110023509.png" alt="image-20210713110023509" style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">图 N沟道增强型MOS管结构示意图 及 增强型MOS管的符号</div>



<img src="https://pic.islet.space/2021/07/image-20210713110146838.png" alt="image-20210713110146838" style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">图 N沟道耗尽型MOS管结构示意图 及 耗尽型MOS管的符号</div>

<h4 id="NMOS工作原理"><a href="#NMOS工作原理" class="headerlink" title="NMOS工作原理"></a>NMOS工作原理</h4><iframe src="//player.bilibili.com/player.html?aid=931455726&bvid=BV1DM4y1T7Yx&cid=363622918&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p>MOS管有4个端子，其符号也是四个端子组成的，以下用NMOS举例：</p>
<p>NMOS底部端子连接到基板/主体（Substrate/Body），称为基板、衬底端子 或 <em><strong>主体端子</strong></em>。上方各有两个N沟道，各自连接 <em><strong>源极端子</strong></em> 和 <em><strong>漏极端子</strong></em>。两个端子中间添加了一层 薄绝缘体或电介质，在此层绝缘体上加了一个 <em><strong>栅极端子</strong></em>。</p>
<img src="https://pic.islet.space/2021/07/image-20210716001316182.png" alt="image-20210716001316182" style="zoom:50%;" />

<p>在NMOS内部构造中，源极端子 和 衬底端子 在内部连接，因此外露出来的端子只有三个。此时因 源极 和 衬底 的电位相同，阻止了任何电流从衬底流向源极。</p>
<img src="https://pic.islet.space/2021/07/image-20210716001716986.png" alt="image-20210716001716986" style="zoom:50%;" />

<p>在MOS中，希望电子从漏极流向源极，在两个极连接一个电源，其电压称为 V<span style="font-size: 0.6rem;">DS</span> ，此时加大电压，电流却不会增大，因为漏极沟道附近的耗尽层不断增大。</p>
<img src="https://pic.islet.space/2021/07/image-20210716002453710.png" alt="image-20210716002453710" style="zoom:50%;" />

<p>栅极端子 和 主体端子 都有绝缘材料，当给栅极端子接电压较小的电压 V<span style="font-size: 0.6rem;">GS</span> 时，两个绝缘材料形成电容效应，栅极处的多子不断吸引自由电子往栅极移动，暂时形成带自由电子较多的N区，从而导通了 源极 和 漏极，暂时形成了回路。因为 栅极处的N区是暂时连接 源极和漏极的通道，因此也被称为 N沟道。随着电压的增大或减小，沟道的大小也会随着变化。足以形成沟道的最低栅极电压被称为 阈值电压。</p>
<img src="https://pic.islet.space/2021/07/image-20210716002900372.png" alt="image-20210716002900372" style="zoom:50%;" />

<p>当不断增加栅极电压，漏极 和 衬底之间的耗尽层将因为 反向偏置 而不断增加。靠近漏极一侧的N沟道宽度将不断减小，直到某个电压点时，称为夹断效应。夹断下映实际上是说，沟道并未完全关闭，许多电子将保留通道，并不是停止了电流流动，而是出现了恒定的饱和电流，其电压被称为 饱和电压。</p>
<img src="https://pic.islet.space/2021/07/image-20210716004255087.png" alt="image-20210716004255087" style="zoom:50%;" />



<div style="text-align: center; font-weight: 900;">表 FET的符号和特性</div>

<p><img src="https://pic.islet.space/2021/07/image-20210713105437061.png" alt="image-20210713105437061"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210713105533255.png" alt="image-20210713105533255"></p>
<h2 id="FET-and-BJT"><a href="#FET-and-BJT" class="headerlink" title="FET and BJT"></a>FET and BJT</h2><p>FET 的 <strong>栅极</strong>、<strong>源极</strong> 和 <strong>漏极</strong> 对应 BJT的 <strong>基极</strong>、<strong>发射极</strong> 和 <strong>集电极</strong>，其作用类似。</p>
<table>
<thead>
<tr>
<th></th>
<th>FET</th>
<th>BJT</th>
</tr>
</thead>
<tbody><tr>
<td>电流索取</td>
<td>用“栅-源”电压控制漏极电流，栅极基本不取电流<br>【输入电阻高的电路选用】</td>
<td>工作时基极总要索取一定的电流<br>【信号源若提供电流的选用】</td>
</tr>
<tr>
<td>导电情况</td>
<td>仅多子参与导电</td>
<td>多子少子均参与导电</td>
</tr>
<tr>
<td>稳定性</td>
<td>较好</td>
<td>较差<br>【因少子数目受温度、辐射等因素影响较大，温度稳定性和抗辐射的能力较差些。】</td>
</tr>
<tr>
<td>噪声系数</td>
<td>小<br>【低噪声放大器的输入级和信噪比要求高的电路选用】</td>
<td>大</td>
</tr>
<tr>
<td>源-漏互换</td>
<td>可以互换，互换后特性变化不大</td>
<td>互换后特性差异很大，特殊需求时互换</td>
</tr>
<tr>
<td>电压范围</td>
<td>宽</td>
<td>窄</td>
</tr>
<tr>
<td>工艺</td>
<td>简单</td>
<td>复杂</td>
</tr>
<tr>
<td>耗电</td>
<td>低</td>
<td>高</td>
</tr>
</tbody></table>
<blockquote>
<p>IGFET / MOS / MOSFET 是同一个东西，还有个词叫 MISFET（Metal-Insulated-Semiconductor Field Effect Transistor，金属绝缘半导体场效应管）</p>
</blockquote>
<h1 id="功率半导体"><a href="#功率半导体" class="headerlink" title="功率半导体"></a>功率半导体</h1><p><strong>功率半导体</strong> 器件大致分为两类： <strong>可控功率半导体</strong> 和 <strong>不可控功率半导体</strong>。<strong>可控功率半导体</strong> 如 Thyristor（晶闸管）、BJT（双极型晶体管）、功率MOSFET 和 IGBT 。不可控功率半导体 包括各种类型的功率二极管。</p>
<img src="https://pic.islet.space/2021/07/image-20210713112224602.png" alt="image-20210713112224602" style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">图 常见功率半导体器件及其典型的功率范围、阻断电压和开关频率</div>



<h1 id="IGBT"><a href="#IGBT" class="headerlink" title="IGBT"></a>IGBT</h1><p><strong>绝缘栅型双极晶体管</strong>，即 <strong>IGBT</strong>（Insulated Gate Bipolar Transistor），是由 <em><strong>BJT</strong></em>（双极型三极管)）和 <em><strong>MOS</strong></em>（绝缘栅型场效应管）组成的 <strong>复合全控型电压驱动式功率半导体</strong> 器件, 兼有 <strong>MOSFET</strong>的 <u>高输入阻抗</u> 和 <strong>GTR</strong>的 <u>低导通压降</u> 两方面的优点。IGBT综合了以上两种器件的优点，驱动功率小而饱和压降低。非常适合应用于直流电压为600V及以上的变流系统如交流电机、变频器、开关电源、照明电路、牵引传动等领域。</p>
<blockquote>
<p>GTR 具有饱和压降低，载流密度大，但驱动电流较大的优点；</p>
<p>MOSFET 具有驱动功率很小，开关速度快，但导通压降大，载流密度小的优点。</p>
</blockquote>
<p><strong>IGBT模块</strong> 是由 IGBT（绝缘栅双极型晶体管芯片）与FWD（续流二极管芯片）通过特定的电路桥接封装而成的模块化半导体产品；封装后的IGBT模块直接应用于变频器、UPS不间断电源等设备上；IGBT模块 具有节能、安装维修方便、散热稳定等特点；当前市场上销售的多为此类模块化产品，一般所说的IGBT也指IGBT模块；随着节能环保等理念的推进，此类产品在市场上将越来越多见；</p>
<img src="https://pic.islet.space/2021/07/image-20210713142410853.png" alt="image-20210713142410853" style="zoom: 80%;" />

<div style="text-align: center; font-weight: 900;">图 IGBT内部结构和等效电路</div>

<p>因为IGBT的构造所致，最好还是不要让IGBT长期工作在放大区，会让其降低使用寿命，因开关开断时而进入放大区无可避免，仅工作在 饱和区 和 截止区 即可。</p>
<img src="https://pic.islet.space/2021/07/image-20210715221251088.png" alt="image-20210715221251088" style="zoom:80%;" />



<p>三个英文符号分别表示为 <strong>栅极</strong>（Gate）、<strong>集电极</strong>（Collector）、<strong>发射极</strong>（Emitter）。</p>
<p>在漏极侧增加了高掺杂的P+层，称之为 <strong>集电极</strong>。</p>
<ul>
<li><p>当栅极接近 <u>负电压</u> 或 <u>零电压</u> 时，PN结 J2 阻断，发射极电压远低于集电极电压，IGBT 关断 （正向阻断）；但是此刻 结J1 和 结J3 <strong>正偏导通</strong>。</p>
</li>
<li><p>当栅极接到 <u>正电压</u>（通常是15V）时，氧化层下方的 P区 建立 <strong>反型导电沟道</strong>，为 N-区 提供导电通路，电子从发射极到 N-区 降低了 N-区 的电位，PN结 J1导通，IGBT导通。 </p>
</li>
</ul>
<p>如果栅极电压不够大，形成的反型层较弱，流入漂移区的电子数相对较少，IGBT压降增大，即进入特性曲线的 <strong>线性放大区</strong>。工作在线性放大区会加剧损耗或损坏 IGBT，因而除了开关瞬间，应避免进入线性放大区。</p>
<img src="https://pic.islet.space/2021/07/image-20210713144038325.png" alt="image-20210713144038325" style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">图 IGBT的输出特性</div>

<p>IGBT 的关断电流分为 <strong>MOSFET关断阶段</strong> 和 <strong>BJT关断阶段</strong>。第一个阶段时，关断反型沟道，电流迅速下降；第二个阶段时，会产生持续时间较长的拖尾电流。</p>
<p>拖尾电流使得 IGBT 的关断损耗 高于 MOSFET 的关断损耗。</p>
<img src="https://pic.islet.space/2021/07/image-20210713144838981.png" alt="image-20210713144838981" style="zoom: 67%;" />

<div style="text-align: center; font-weight: 900;">图 MOSFET和IGBT的主要开通和关断特性比较</div>



<p>截止电压：</p>
<p>饱和电压：</p>
<p>击穿电压：</p>
<p>（栅极和发射极）阈值电压</p>
<p>漏电流：泄露电流，leakage current。主要是指栅极和发射极的在反向偏执状态的泄露电流，此处特性与二极管相近。</p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p>IGBT可以分为 <strong>穿通型</strong>（PT）IGBT、<strong>非穿通型</strong>（NPT）IGBT、<strong>场终止型</strong>（FS）IGBT、<strong>沟槽栅</strong>（Trench）IGBT、<strong>载流子存储沟槽栅双极晶体管</strong>（CSTBT）、<strong>注入增强晶体管</strong>（IEGT）、<strong>沟槽栅终止</strong>（Trench-FS）IGBT、<strong>逆导型</strong>（RC）IGBT。</p>
<p><strong>平面栅极结构</strong> 的IGBT设计，形成了JFET结构，以及发射极区软弱的电导调制效应，载流子的浓度从集电极到发射极之间逐步降低。</p>
<p><strong>沟槽型栅极结构</strong> 的IGBT设计，在平面型的基础上保持载流子浓度平均分布或逐步增加载流子浓度，进一步降低通态损耗，而不影响拖尾电流和关断损耗。</p>
<p>载流子越少越有助于降低关断损耗。</p>
<table>
<thead>
<tr>
<th>TYPE</th>
<th>内部构造（原理）</th>
<th>温度系数</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>PT-IGBT<BR>穿通型IGBT</td>
<td><img src="https://pic.islet.space/2021/07/image-20210713112637086.png" alt="image-20210713112637086" style="zoom:67%;" /></td>
<td>正温度系数<br>负温度系数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>NPT-IGBT<BR>非穿通型IGBT</td>
<td><img src="https://pic.islet.space/2021/07/image-20210713112654444.png" alt="image-20210713112654444" style="zoom:67%;" /></td>
<td>正温度系数</td>
<td>1. 有利于IGBT并联</td>
<td>1. 随着温度上升，损耗增大</td>
</tr>
<tr>
<td>FS-IGBT<BR>场终止型IGBT</td>
<td><img src="https://pic.islet.space/2021/07/image-20210713112712678.png" alt="image-20210713112712678" style="zoom:67%;" /></td>
<td>正温度系数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Trench-IGBT<br>沟槽栅IGBT</td>
<td><img src="https://pic.islet.space/2021/07/image-20210713112728045.png" alt="image-20210713112728045" style="zoom:67%;" /></td>
<td></td>
<td></td>
<td>1. 更宽的导电沟道会增加IGBT短路时的电流</td>
</tr>
<tr>
<td>CSTBT<br>载流子存储沟槽双极晶体管</td>
<td><img src="https://pic.islet.space/2021/07/image-20210713122039519.png" alt="image-20210713122039519" style="zoom:67%;" /></td>
<td></td>
<td>1. 降低了IGBT的饱和压降</td>
<td></td>
</tr>
<tr>
<td>IEGT<BR>注入增强栅晶体管</td>
<td><img src="https://pic.islet.space/2021/07/image-20210713112841613.png" alt="image-20210713112841613" style="zoom:67%;" /></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Trench-FS IGBT<br>沟槽栅终止IGBT</td>
<td><img src="https://pic.islet.space/2021/07/image-20210713112933604.png" alt="image-20210713112933604" style="zoom:67%;" /></td>
<td></td>
<td></td>
<td>1. 保持鲁棒性，通态损耗和开关损耗降低<br>2. 功率密度提升，即电流密度增大<br>3. 单位IGBT所需硅材料降低</td>
</tr>
<tr>
<td>RC-IGBT<BR>逆导型IGBT</td>
<td><img src="https://pic.islet.space/2021/07/image-20210713122011473.png" alt="image-20210713122011473" style="zoom:67%;" /></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="术语总结"><a href="#术语总结" class="headerlink" title="术语总结"></a>术语总结</h1><p><strong>FET</strong>： Filed Effect Transistor，即 <strong>场效应管</strong>，是 <mark>利用输入回路的电场效应来控制输出回路电流</mark> 的一种半导体器件，故此得名。由于其仅靠半导体中的多数载流子导电，因此也称为 <strong>单极型晶体管</strong>。</p>
<p><strong>JFET</strong>： Junction Filed Effect Transistor，即 <strong>结型场效应管</strong>，有 P沟道 和 N沟道 两种类型。</p>
<p><strong>IGFET</strong>： Insulated Gate Field Effect Transistor，即 <strong>绝缘栅型场效应管</strong>。因栅极与源极、栅极与漏极之间均采用二氧化硅绝缘层进行阻隔而得名如此。又因栅极为金属铝，故又称为MOS管。具有 高输入阻抗、高开关频率 和 低驱动功率 的优点。</p>
<p><strong>MOS</strong>： Metal-Oxide-Semiconductor，即 <strong>金属氧化物半导体</strong>。同上。</p>
<p><strong>MOSFET</strong>： Metal-Oxide-Semiconductor Field Effect Transistor，即 <strong>金属氧化物半导体场效应管</strong>。同上。</p>
<p><strong>BJT</strong>： Bipolar Junction Transistor， 即 <strong>双极结型晶体管</strong>。因带有两种不同极性电荷的载流子参与导电，故得名如此，或称 <strong>半导体三极管</strong>，简称 <strong>双极晶体管</strong> 或 <strong>晶体管</strong>。</p>
<p><strong>UJT</strong>： Unijunction Transistor，即 <strong>单结晶体管</strong>。因有两个基极，也称为 <strong>双基极晶体管</strong>。</p>
<p><strong>GTR</strong>： Giant Transistor，即 <strong>巨型晶体管</strong>。BJT的一种，亦称为 Power BJT（<strong>电力晶体管</strong>）。具有自关断、无须辅助关断电路、 高电流密度、低保和电压 和 耐高压 的优点。</p>
<p><strong>IGBT</strong>： Insulated Gate Bipolar Transistor，即 <strong>绝缘栅双极型晶体管</strong>。</p>
<p><strong>Thyristor</strong>：即 <strong>半导体闸流管</strong> 、<strong>晶闸管</strong>，又称为 <strong>硅可控元件</strong>（Silicon Controlled Rectifier）， 由按顺序排列的PNPN四层半导体组成。最外层的P区和N区构成了正负极，中间的P区构成了控制极（栅极），可以控制导通。具有耐压高、电流大、耐浪涌能力强 且 价格便宜 等优点。</p>
<p><strong>GTO</strong>： Gate Turn-Off Thyristor，即 <strong>可关断晶闸管</strong>。是一种通过门极来控制器件导通和关断的电力半导体器件。具有 普通晶闸管 和 GTR的优点，是应用于高压大容量场合中的一种大功率开关器件。</p>
<p><strong>PT</strong>： Power Transistor， 即 <strong>功率晶体管</strong> / <strong>功率管</strong>。</p>
<p><strong>IPM</strong>： Intelligent Power Module，即 <strong>智能功率模块</strong>。具有GTR 和 MOSFET 的优点。而且IPM内部集成了逻辑、控制、检测和保护电路，使用起来方便,不仅减小了系统的体积以及开发时间，也大大增强了系统的可靠性。</p>
<img src="https://pic.islet.space/2021/07/d4628535e5dde711c5d042b5a7efce1b9d166176" alt="img" style="zoom: 25%;" />

<div style="text-align: center; font-weight: 900;">图 IPM器件示意</div>



<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li>《模拟电子技术基础》高等教育出版社，童师白</li>
<li>《IGBT模块：技术、驱动和应用》机械工业出版社，Andreas Volke and Michael Hornkamp</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/366981878">逆变器的分类方式有哪些</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IGBT/2078902?fromtitle=%E7%BB%9D%E7%BC%98%E6%A0%85%E5%8F%8C%E6%9E%81%E5%9E%8B%E6%99%B6%E4%BD%93%E7%AE%A1&fromid=12731336">IGBT</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%9C%BA%E6%95%88%E5%BA%94%E7%AE%A1">场效应管</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%99%B6%E4%BD%93%E4%BA%8C%E6%9E%81%E7%AE%A1">晶体二极管</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%99%B6%E4%BD%93%E7%AE%A1/569042#:~:text=%E6%99%B6%E4%BD%93%E7%AE%A1%E6%9C%89%E6%97%B6%E5%A4%9A%E6%8C%87%E6%99%B6%E4%BD%93%E4%B8%89%E6%9E%81%E7%AE%A1%E3%80%82%20%E4%B8%89%E7%AB%AF%E5%AD%90%E6%99%B6%E4%BD%93%E7%AE%A1%E4%B8%BB%E8%A6%81%E5%88%86%E4%B8%BA%E4%B8%A4%E5%A4%A7%E7%B1%BB%EF%BC%9A%20%E5%8F%8C%E6%9E%81%E6%80%A7%E6%99%B6%E4%BD%93%E7%AE%A1,%EF%BC%88BJT%EF%BC%89%E5%92%8C%20%E5%9C%BA%E6%95%88%E5%BA%94%E6%99%B6%E4%BD%93%E7%AE%A1%20%EF%BC%88FET%EF%BC%8C%E5%8D%95%E6%9E%81%E6%80%A7%EF%BC%89%E3%80%82">晶体管</a></li>
<li><a target="_blank" rel="noopener" href="https://circuitglobe.com/difference-between-diode-and-transistor.html">Difference Between Diode &amp; Transistor</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/150177944">半导体分类知识大全</a></li>
<li><a target="_blank" rel="noopener" href="https://xueqiu.com/3593206238/153075165">IGBT—功率半导体皇冠上的明珠</a></li>
<li><a target="_blank" rel="noopener" href="https://www.electricaltechnology.org/2018/12/types-of-diodes-their-applications.html">Types of Diodes and Their Applications - 24 Types of Diodes</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/07/11/Hardware/2021-07-11-%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%8A%AF%E7%89%87%E5%A4%96%E8%AE%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/11/Hardware/2021-07-11-%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%8A%AF%E7%89%87%E5%A4%96%E8%AE%BE/" class="post-title-link" itemprop="url">嵌入式芯片外设</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-11 13:50:00" itemprop="dateCreated datePublished" datetime="2021-07-11T13:50:00+08:00">2021-07-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-15 21:11:03" itemprop="dateModified" datetime="2021-07-15T21:11:03+08:00">2021-07-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hardware/" itemprop="url" rel="index"><span itemprop="name">Hardware</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>嵌入式芯片（如MCU、DSP等）内部包含众多的模块化外设，如 串口控制模块，SPI模块，I2C模块，A/D模块，PWM模块，CAN模块，EEPROM，比较器模块，等等，它们都集成在芯片内部，有相对应的内部控制寄存器，可通过指令直接控制。</p>
<p>按照控制信号类别对外设进行分类，可以分为 <strong>模拟外设</strong>（Analog Peripherals）、<strong>控制外设</strong>（Control Peripherals） 和 <strong>通信外设</strong>（Communication Peripherals）。</p>
<p><strong>模拟外设</strong> 的常见外设如 <strong>模数转换器</strong>（Analog-to-Digital Convertor, ADC）、<strong>可编程增益放大器</strong>（Programmable Gain Amplifier, PGA）、<strong>温度传感器</strong>（Temperature Sensor）、<strong>缓冲数模转换器</strong>（Buffered Digital-to-Analog Convertor, DAC）和 <strong>比较器</strong>（Comparator Subsystem）。</p>
<p><strong>控制外设</strong> 的常见设备如 <strong>捕获器</strong>（Capture, CAP）、<strong>脉冲幅频调制器</strong>（Pulse Width Modulator, PWM）、<strong>正交编码器脉冲</strong>（ Quadrature Encoder Pulse, QEP）和 **西格玛-德尔塔滤波器模块 **（Sigma-Delta Filter Module, SDFM）。</p>
<p><strong>通信外设</strong> 的常见设备如 （Controller Area Network, CAN）、<strong>双线通信</strong>（Inter-Integrated Circuit, I2C）、<strong>电源管理总线接口</strong>（Power Management Bus Interface, PMBus）、<strong>串行通信接口</strong>（Serial Communications Interface, SCI）、<strong>串行外设接口</strong>（Serial Peripheral Interface, SPI）、<strong>局域互联网络</strong>（Local Interconnect Network, LIN） 和 <strong>高速串行接口</strong>（Fast Serial Interface, FSI）。</p>
<h1 id="CLA"><a href="#CLA" class="headerlink" title="CLA"></a>CLA</h1><p>为了解决DSP在对实时控制要求比较高的场合中CPU计算速度不足以及计算负担过重，TI很早之前就已经推出了具有CLA功能的DSP。</p>
<p>CLA，即Control Law  Accelerator，是一个32位浮点数计算加速器，可以理解为一个专门为浮点数运算而优化的CPU。其可以 <strong>独立</strong> 于CPU进行运算操作，并 <mark>可以同时访问</mark> 到ePWM，eCAP，eQEP，ADC result以及Comparator <mark>寄存器</mark>。相当于两个CPU并行工作，从而减少了主CPU的运算负担。</p>
<p>也就是说 CLA可以同时访问所有模拟外设的寄存器。</p>
<p>可以将CLA看作是辅助CPU进行计算的浮点运算协处理器（co-processor）。</p>
<p>一个典型的应用场景如下：</p>
<p><img src="https://pic.islet.space/2021/07/v2-9fdd0b85b26f7ff8074a8c58b1aba945_720w.jpg" alt="img">闭环控制电路</p>
<p>CPU通过ADC采集主电路的电压、电流信息，计算得到控制逻辑（包括频率以及占空比等），从而控制电路工作。因此如果CPU的计算负担很大，比如说需要计算傅里叶分解，比如说需要计算反三角函数等，那么就造成了极大的控制时延。而CLA应运而生，专门为计算浮点数进行优化，且不会造成CPU阻塞于计算而对异常情况无法响应的情况。</p>
<p><img src="https://pic.islet.space/2021/07/v2-2d0d2214e132b1a9982d3ab50db429ff_720w.jpg" alt="img"></p>
<div style="text-align: center; font-weight: 900;">图 28069和28027对比</div>

<p>上图则对比了具有CLA功能的28069和不具有CLA功能的28027的控制延时。对于没有CLA功能的28027，其CPU在ADC采样结束之后触发SOC中断，随后进行闭环计算，最后再结束一个周期的控制，开始下一个周期。而具有<mark>CLA</mark>功能的28069则<mark>可以在采样结束之后立即自主触发CLA计算</mark>（由于没有菊花链，所以触发迅速），并且由于<mark>CLA针对浮点数计算进行优化，因此计算时间更短</mark>。更重要的是，<mark>CPU不需要进行任何操作，因此CPU可以有空闲完成其他任务，比如异常检测，比如故障上报等等</mark>。</p>
<p>简单来说，采用CLA的系统具有<strong>更小的计算时延</strong>，<strong>CPU负担更小，</strong>因此其系统更加迅速稳定。</p>
<h1 id="CLB"><a href="#CLB" class="headerlink" title="CLB"></a>CLB</h1><p>The C2000 configurable logic block (CLB) is a collection of configurable blocks that interconnect through software to implement custom digital logic functions.</p>
<p>The CLB subsystem contains a number of identical tiles.</p>
<h1 id="GPIO"><a href="#GPIO" class="headerlink" title="GPIO"></a>GPIO</h1><p>GPIO，即General-purpose input/output，通用型之输入输出（接口）。功能类似8051的P0—P3，其接脚可以供使用者由程控自由使用，PIN脚依现实考量可作为通用输入（GPI）或通用输出（GPO）或通用输入与输出（GPIO），如当clk generator, chip select等。<br>既然一个引脚可以用于输入、输出或其他特殊功能，那么一定有寄存器用来选择这些功能。对于输入，一定可以通过读取某个寄存器来确定引脚电位的高低；对于输出，一定可以通过写入某个寄存器来让这个引脚输出高电位或者低电位；对于其他特殊功能，则有另外的寄存器来控制它们。</p>
<h1 id="CMPSS"><a href="#CMPSS" class="headerlink" title="CMPSS"></a>CMPSS</h1><p>CMPSS，即Comparator Subsystem，比较器子系统。由模拟比较器和支持电路组成，可用于峰值电流模式控制、开关电源、功率因数校正、电压跳闸监测等应用。</p>
<p>每个CMPSS包含两个比较器、两个12位DAC参考、两个数字滤波器和一个斜坡发生器。比较器在每个模块中表示为“H”或“L”，其中“H”和“L”分别表示高和低。每个比较器产生一个数字输出，指示正输入端的电压是否大于负输入端的电压。比较器的正输入由外部引脚或PGA驱动，负输入可由外部引脚或可编程参考12位DAC驱动。每个比较器输出通过一个可编程的数字滤波器，可以消除假跳闸信号。如果不需要滤波，也可以使用未滤波的输出。一个可选的斜坡发生器电路可用于控制高比较器的12位参考DAC值。</p>
<p><img src="https://pic.islet.space/2021/07/20200416154658460.png"></p>
<h1 id="CAN"><a href="#CAN" class="headerlink" title="CAN"></a>CAN</h1><p>A controller area network(CAN) is ideally suited to the many high-level industrial protocols embracing CAN and <em><strong>ISO-11898:2003</strong></em> as their physical layer.</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><ul>
<li><p>The CAN bus was developed by BOSCH as a <em><strong>multi-master</strong></em>, <em><strong>message broadcast</strong></em> system that specifies a maximum signaling rate of <em><strong>1 megabit per second</strong></em>(bps).</p>
</li>
<li><p>CAN is an International Standardization Organization (ISO) defined serial communications bus originally developed for the automotive industry to replace the complex wiring harness with a two-wire bus.</p>
</li>
<li><p>CAN <em>does not</em> send large blocks of data point-to-point from node A to Node B under the supervision of the central bus master.</p>
</li>
<li><p>In a CAN network, <mark>many short messages</mark> like temperature or RPM <mark>are broadcast to the entire network</mark>, which provides for <mark>data consistency in every node of the system</mark>. 保证系统中各节点的数据一致性。</p>
</li>
<li><p>CAN’s specification calls for high immunity to electrical interface and the ability to self-diagnose and repair data errors.</p>
</li>
</ul>
<p>以下为ISO 11898 对 CAN 标准架构层级解释框图：</p>
<p><img src="C:\Users\431240.IT2004\AppData\Roaming\Typora\typora-user-images\image-20210711162150611.png" alt="image-20210711162150611"></p>
<p>The CAN communication protocol is a <em><strong>carrier-sense</strong></em>, <em><strong>multiple-access</strong></em> protocol with <em><strong>collision detection</strong></em> and <em><strong>arbitration on message priority</strong></em> (<em><strong>CSMA</strong></em> / <em><strong>CD+AMP</strong></em>). <em><strong>CSMA</strong></em> means that each node on a bus must wait for a prescribed period of inactivity before attempting to send a message. <em><strong>CD+AMP</strong></em> means that collisions are resolved through a bit-wise arbitration, based on a preprogrammed priority of each message in the identifier field of a message. The higher priority identifier always wins bus access.</p>
<p>CAN 包含 standard CAN 和 Extended CAN。</p>
<p><img src="C:\Users\431240.IT2004\AppData\Roaming\Typora\typora-user-images\image-20210711163535822.png" alt="image-20210711163535822"></p>
<p><img src="C:\Users\431240.IT2004\AppData\Roaming\Typora\typora-user-images\image-20210711163548817.png" alt="image-20210711163548817"></p>
<h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><p><strong>菊花链</strong>：在电子电气工程中菊花链代表一种配线方案，例如设备A和设备B用电缆相连，设备B再用电缆和设备C相连，设备C用电缆和设备D相连，在这种连接方法中不会形成网状的拓扑结构，只有相邻的设备之间才能直接通信，例如在上例中设备A是不能和设备C直接通信的，它们必须通过设备B来中转，这种方法同样不会形成环路。因为最后一个设备不会连向第一个设备。这种连线方法能够用来传输电力，数字信号和模拟信号。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/72232829">CLA介绍及使用指南</a></li>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/gpio">GPIO</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/whyorwhnt/article/details/105547472">TMS320F280049C 学习笔记16 比较器子系统(CMPSS)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ti.com/lit/an/sloa101b/sloa101b.pdf">《Introduction to the Controller Area Network(CAN)》</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/07/10/Communication/2021-07-10-JTAG%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/10/Communication/2021-07-10-JTAG%E9%80%9A%E4%BF%A1/" class="post-title-link" itemprop="url">JTAG通信</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-07-10 21:00:00 / Modified: 21:28:00" itemprop="dateCreated datePublished" datetime="2021-07-10T21:00:00+08:00">2021-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Communication/" itemprop="url" rel="index"><span itemprop="name">Communication</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><p>以下为 B站up主——“蛋饼的爹地” 制作上传的JTAG科普视频。</p>
<iframe src="//player.bilibili.com/player.html?aid=503270942&bvid=BV1iN411Z7jk&cid=346887915&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>





<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://xploreqa.ieee.org/stampPDF/getPDF.jsp?tp=&arnumber=6515989&ref=aHR0cHM6Ly94cGxvcmVxYS5pZWVlLm9yZy9kb2N1bWVudC82NTE1OTg5">《IEEE 1149.1-2013 Test Access Port and Boundary Scan Architecture》</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/07/10/Hardware/2021-07-10-VCC%E3%80%81VDD%E3%80%81VEE%E3%80%81VSS%E7%9A%84%E5%8C%BA%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/10/Hardware/2021-07-10-VCC%E3%80%81VDD%E3%80%81VEE%E3%80%81VSS%E7%9A%84%E5%8C%BA%E5%88%AB/" class="post-title-link" itemprop="url">VCC、VDD、VEE、VSS的区别</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-10 15:00:00" itemprop="dateCreated datePublished" datetime="2021-07-10T15:00:00+08:00">2021-07-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-15 21:10:58" itemprop="dateModified" datetime="2021-07-15T21:10:58+08:00">2021-07-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hardware/" itemprop="url" rel="index"><span itemprop="name">Hardware</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="对于晶体管"><a href="#对于晶体管" class="headerlink" title="对于晶体管"></a>对于晶体管</h2><p><em><strong>Vcc</strong></em>：来源于集电极电源电压， <em>Collector Voltage</em>， 一般用于双极型晶体管， PNP 管时为负电源电压， 有时也标成 -Vcc， NPN 管时为正电压</p>
<p><em><strong>Vdd</strong></em>：来源于漏极电源电压， <em>Drain Voltage</em>， 用于 MOS 晶体管电路， 一般指正电源。 因为很少单独用 PMOS 晶体管， 所以在 CMOS 电路中 Vdd 经常接在 PMOS 管的源极上。</p>
<p><em><strong>Vss</strong></em>：源极电源电压， 在 CMOS 电路中指负电源， 在单电源时指零伏或接地。</p>
<p><em><strong>Vee</strong></em>：发射极电源电压， <em>Emitter Voltage</em>， 一般用于 ECL 电路的负电源电压。</p>
<p><em><strong>Vbb</strong></em>：基极电源电压， 用于双极晶体管的共基电路。</p>
<h2 id="对于电路及芯片"><a href="#对于电路及芯片" class="headerlink" title="对于电路及芯片"></a>对于电路及芯片</h2><p><em><strong>VDD</strong></em>：电源电压(单极器件)；芯片电源电压。（Device）</p>
<p><em><strong>VCC</strong></em>：电源电压(双极器件)；电路电源电压。（Circuit）</p>
<p><em><strong>VSS</strong></em>：接地端、负极。（Series）</p>
<p><em><strong>VEE</strong></em>：负电压供电；</p>
<p><em><strong>VPP</strong></em>：编程/擦除电压。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/07/10/Hardware/TI/2021-07-10-F280041PM%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/10/Hardware/TI/2021-07-10-F280041PM%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">F280041PM开发笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-10 11:10:00" itemprop="dateCreated datePublished" datetime="2021-07-10T11:10:00+08:00">2021-07-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-15 21:11:29" itemprop="dateModified" datetime="2021-07-15T21:11:29+08:00">2021-07-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hardware/" itemprop="url" rel="index"><span itemprop="name">Hardware</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>TMS320F28004x 下称 本系列芯片。</p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>C28004x 共有2种芯片封装形式： LQFP 和 VQFN 。VQFN 仅有56针，LQFP 有 100针和 64针的区别。分别用 PZ 、PM 和 RSH 三种型号尾缀与 100-pin 、64-pin 和 56-pin 相关联。根据section4.3，可以知道还有个64PMQ的尾缀。</p>
<p>如型号TMS320F280041PM，仅有64针脚，引脚分布如下图所示：</p>
<img src="https://pic.islet.space/2021/07/image-20210710144933414.png" alt="image-20210710144933414"  />



<h1 id="Specification"><a href="#Specification" class="headerlink" title="Specification"></a>Specification</h1><p>下图应该是F280049的系统功能框图，与F280041PM仍有些出入。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210710141413564.png" alt="image-20210710141413564"></p>
<p><strong>注意</strong>：F280041PM不支持 CLA（可编程控制Law加速器，Programmable Control Law Accelerator），Flash为128KB（64KW），GPIO数量为26，AIO数量为14，ADC通道为14，同时280041支持5个PGA</p>
<p>TMS320F28004x 所支持外设如下：</p>
<img src="https://pic.islet.space/2021/07/image-20210710142641475.png" alt="image-20210710142641475" style="zoom:110%;" />



<blockquote>
<p><strong>Q</strong>: 为什么要区分type？</p>
<p><strong>A</strong>: 就同一类功能而言，在C2000系列上，都会有许多不同的增强/阉割版本，就出现了支持全部基础功能的、出现支持部分扩展功能的 和 支持全部扩展功能的等各种版本，那么就需要从功能范围的本质上去描述这些区别，再用相应的 “功能+type x” 的方式来表示其支持的类别。如下图所示，为《spru556n》page 24 所描述的关于CLA的功能类别。</p>
<p><code>CLA type 0</code>，表示的是支持原始CLA功能的模块类型。</p>
<p><code>CLA type 2</code> ，表示在原始功能的基础上，增加了后台代码模式，可以在后台运行通信和清理程序等任务；后台任务持续运行，直到禁用或设备/软复位；后台任务可以由外设或软件触发；其他前台任务可以按照定义的优先顺序中断后台任务；增加了使后台代码部分不被中断的规定；增加了调试功能，具有真正的软件断点支持，在调试停止期间，CLA从同一地址重新获取数据会被停止。</p>
<img src="https://pic.islet.space/2021/07/image-20210712141632913.png" alt="image-20210712141632913" style="zoom: 67%;" />
</blockquote>
<h2 id="引脚"><a href="#引脚" class="headerlink" title="引脚"></a>引脚</h2><h3 id="引脚分配"><a href="#引脚分配" class="headerlink" title="引脚分配"></a>引脚分配</h3><p>Page17 4.2 <em><strong>Pin Attributes</strong></em> 下可以查看各封装芯片引脚的名称、编号 及 功能。</p>
<h3 id="引脚路由"><a href="#引脚路由" class="headerlink" title="引脚路由"></a>引脚路由</h3><p>Page30 4.3 <em><strong>Signal Routing</strong></em> 下可以查看引脚的路由信息。</p>
<h3 id="引脚复用"><a href="#引脚复用" class="headerlink" title="引脚复用"></a>引脚复用</h3><p>Page41 4.4 <em><strong>Pin Multiplexing</strong></em> 下可以查看引脚的复用信息，GPIO口的默认功能就是GPIO，除了GPIO35 和 GPIO37（默认情况下是TDI 和 TDO）。GPIO口的次级功能可以通过设置 <code>GPyGMUXn.GPIOz</code> 和 <code>GPyMUXn.GPIOz</code> 寄存器位来进行。</p>
<p><strong>注意</strong>： </p>
<ul>
<li><code>GPyGMUXn</code> 寄存器应在 <code>GPyMUXn</code> 之前配置，以避免交替复用选择对GPIO产生瞬时脉冲。</li>
<li>GPIO20 , GPIO21 和 GPIO41 至 GPIO55在任何封装上都不可复用。</li>
</ul>
<p>表6 为GPIO的针脚复用说明，表中未列明项为GPIO复用设置保留位。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210712094430159.png" alt="image-20210712094430159"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210712094455163.png" alt="image-20210712094455163"></p>
<h3 id="引脚置高-低"><a href="#引脚置高-低" class="headerlink" title="引脚置高/低"></a>引脚置高/低</h3><p>部分引脚可以被置高/低，下表展示了各引脚的设置类型。默认情况下，GPIO不可置高，但是可以通过软件进行使能。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210712093251720.png" alt="image-20210712093251720"></p>
<h3 id="X-BAR"><a href="#X-BAR" class="headerlink" title="X-BAR"></a>X-BAR</h3><p>X-BAR 即 Crossbar。</p>
<h4 id="输入X-BAR"><a href="#输入X-BAR" class="headerlink" title="输入X-BAR"></a>输入X-BAR</h4><p>输入X-BAR被用于从GPIO口引导信号至许多不同的IP块，如ADC、eCAP、ePWM 和 外部中断。图5 展示了X-BAR的架构，表8 展示了各X-BAR输入可能的路由目的地。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210712095049189.png" alt="image-20210712095049189"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210712095346292.png" alt="image-20210712095346292"></p>
<h4 id="输出X-BAR-和-ePWM-X-BAR"><a href="#输出X-BAR-和-ePWM-X-BAR" class="headerlink" title="输出X-BAR 和 ePWM X-BAR"></a>输出X-BAR 和 ePWM X-BAR</h4><p>输出X-BAR有8个可以路由至各GPIO模块的输出口。ePWM X-BAR 有8个可以路由至各ePWM模块的输出口。</p>
<p>图6 展示了 两个X-BAR的 信号源。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210712095838640.png" alt="image-20210712095838640"></p>
<h2 id="电压"><a href="#电压" class="headerlink" title="电压"></a>电压</h2><p>本系列芯片支持以下三种之一的电源供应（在要求核心电压VDD = 1.2V 的情况下）：</p>
<ul>
<li>外接电源（不支持56针RSH封装）</li>
<li>内部 1.2V LDO电压整流器</li>
<li>内部 1.2V 开关整流器</li>
</ul>
<p><strong>注意</strong>：必须使用同一个系统电压调节器来驱动VDDIO和VDDIO_SW。</p>
<p>下方是有关两个电压调节器的详细描述：</p>
<p><img src="https://pic.islet.space/2021/07/image-20210710154834139.png" alt="image-20210710154834139"></p>
<h2 id="复位"><a href="#复位" class="headerlink" title="复位"></a>复位</h2><h2 id="时钟"><a href="#时钟" class="headerlink" title="时钟"></a>时钟</h2><p>下图展示了本系列芯片的时钟系统，本系列芯片支持两个独立的内部振荡器，直接映射为 <strong>INTOSC1</strong> 和 <strong>INTOSC2</strong> 。默认情况下，都会在芯片启动时开启，且 <strong>INTOSC2</strong> 才是系统参考时钟源，<strong>INTOSC1</strong> 是备用时钟源。<u>这一点可以手动修改</u>。</p>
<img src="https://pic.islet.space/2021/07/image-20210710155206953.png" alt="image-20210710155206953" style="zoom:67%;" />

<p>下图展示了系统PLL的设置框图。</p>
<img src="https://pic.islet.space/2021/07/image-20210710155140640.png" alt="image-20210710155140640" style="zoom:67%;" />



<p>表13 展示了（外部）输入时钟频率的范围要求</p>
<p>表14 展示了（外部）晶体振荡器的电气特性</p>
<p>表15 展示了X1的计时要求</p>
<p>表16 展示了PLL锁定的时间</p>
<p>表17 展示了内部时钟频率</p>
<p>表18 展示了输出时钟XCLKOUT的开断性能</p>
<p>表19 展示了（外部）晶体振荡器参数</p>
<p>表20 展示了（外部）晶体振荡器的等效电阻要求</p>
<p>表21 展示了（外部）晶体振荡器的电气特性</p>
<p>表22 展示了（内部）晶体振荡器的电气特性</p>
<p><img src="https://pic.islet.space/2021/07/image-20210710155540889.png" alt="image-20210710155540889"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210710160134644.png" alt="image-20210710160134644"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210710160150517.png" alt="image-20210710160150517"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210711172100592.png" alt="image-20210711172100592"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210711173148615.png" alt="image-20210711173148615"></p>
<p>图 5-12 至 5-14 展示了三种不同的外部时钟源电路：</p>
<p><img src="https://pic.islet.space/2021/07/image-20210711172426297.png" alt="image-20210711172426297"></p>
<p><strong>注意</strong>：当X1接口被当作时钟接口使用时，X2接口也不可用作GPIO口。</p>
<h3 id="时钟配置方法"><a href="#时钟配置方法" class="headerlink" title="时钟配置方法"></a>时钟配置方法</h3><p>Once the application requirements are understood, a specific clock configuration can be determined. The default configuration is for <em><strong>INTOSC2</strong></em> to be used as the system clock (<em><strong>PLLSYSCLK</strong></em>) with a divider of 1. The following procedure can be used to set up the desired application configuration:</p>
<ol>
<li><p>Select the reference clock source (<em><strong>OSCCLK</strong></em>) by writing to <em><strong>CLKSRCCTL1.OSCCLKSRCSEL</strong></em>. To enable XTAL, follow the instructions in the previous sections.</p>
</li>
<li><p>Select the reference clock source (<em><strong>OSCCLK</strong></em>) by writing to <em><strong>CLKSRCCTL1.OSCCLKSRCSEL</strong></em>. Allow at least 300 <em><u>NOP instructions</u></em> for this to take effect.</p>
</li>
<li><p>Set up the system PLL if desired. TI recommends using the C2000Ware <code>SysCtl:setClock()</code> function for proper configuration of the PLL clock.</p>
</li>
<li><p>Select the <em><strong>LSPCLK</strong></em> divider by writing to <em><strong>LOSPCP</strong></em>.</p>
</li>
<li><p>If an alternate CAN bit clock is needed, select it by writing to <em><strong>CLKSRCCTL2.CANABCLKSEL</strong></em> and <em><strong>CLKSRCCTL2.CANBBCLKSEL</strong></em>.</p>
</li>
<li><p>Enable the desired peripheral clocks by writing to the <em><strong>PCLKCRx</strong></em> registers.</p>
</li>
</ol>
<p>The system clock configuration can be changed at run time. Changing the <em><strong>OSCCLK</strong></em> source will automatically bypass the PLL and set the multiplier to zero. Changing the multiplier from one non-zero value to another will temporarily bypass the PLL until it re-locks.</p>
<p><mark style="font-weight: 900;">注意： At least a 300 CPU clock cycles delay is needed after OSSCLK source is changed. </mark></p>
<h2 id="闪存"><a href="#闪存" class="headerlink" title="闪存"></a>闪存</h2><p>表23 展示了不同时钟源和频率下所需的最小闪存等待状态</p>
<p>表24 展示了闪存的性能参数</p>
<p><img src="https://pic.islet.space/2021/07/image-20210711173614732.png" alt="image-20210711173614732"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210711173721809.png" alt="image-20210711173721809"></p>
<h2 id="JTAG"><a href="#JTAG" class="headerlink" title="JTAG"></a>JTAG</h2><h2 id="GPIO"><a href="#GPIO" class="headerlink" title="GPIO"></a>GPIO</h2><p>在复位时，GPIO会被配置为输入。对于特定的输入，用户还可以选择 <strong>输入鉴定周期</strong>（input qualification cycles）的数量来过滤不需要的 <strong>噪声突变</strong>（unwanted noise glitches）。</p>
<p>表29 展示了GPIO的特性参数，需要注意的是，GPIO的频率只有25MHz最高。</p>
<p>表30 展示了GPIO的输入时间要求</p>
<p><img src="https://pic.islet.space/2021/07/image-20210711174357812.png" alt="image-20210711174357812"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210711174530164.png" alt="image-20210711174530164"></p>
<h2 id="中断"><a href="#中断" class="headerlink" title="中断"></a>中断</h2><p>C28x系列芯片有14条外围中断可用，其中13和14中断被直接关联至CPU定时器1和定时器2。剩余12条中断可以通过 <strong>增强型外围中断扩展</strong>（enhanced Peripheral Interrupt Expansion，ePIE)模块进行信号引导。本模块将最多16个外设中断复用到每个CPU中断线中，并扩展了向量表，允许每个中断有自己的ISR。允许芯片支持数量众多的外围设备。</p>
<p>中断路径一共有三个阶段——外围设备、ePIE模块 和 CPU。每个阶段都有其使能和标志寄存器。本系统允许CPU在其他中断等待时处理一个中断，在软件中实现并优先处理嵌套中断，并在某些关键任务中禁用中断。</p>
<p>下图展示了本系列芯片的中断架构。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210711175336942.png" alt="image-20210711175336942"></p>
<p>外部中断（external interrupt, XINT）电气特性数据和时序特性：</p>
<p>表31 列出了外部中断的时间要求</p>
<p>表32 列出了外部中断开断特性</p>
<p>图25 展示了外部中断的时序</p>
<p><img src="https://pic.islet.space/2021/07/image-20210712083326344.png" alt="image-20210712083326344"></p>
<h2 id="低电量模式"><a href="#低电量模式" class="headerlink" title="低电量模式"></a>低电量模式</h2><p>本系列芯片拥有两种 时钟门（clock-gating） 低电量模式，分别是 HALT 和 IDLE，STANDARD 模式不支持进入低电量。</p>
<p>低电量模式的进入和退出代码，以及更多关于低电量模式的描述信息，需要参考《TRM》手册。</p>
<p>表33 描述了系统进入任何 时钟门 低电量模式后的影响</p>
<p>表34 列明了IDLE模式下的时序要求</p>
<p>表35 列明了IDLE模式下的开断特性</p>
<p>表36 列明了HALT模式下的时序要求</p>
<p>表37 列明了HALT模式下的开断特性</p>
<p>图26 展示了IDLE模式的时序框图</p>
<p>图27 展示了HALT模式的时序框图</p>
<p><img src="https://pic.islet.space/2021/07/image-20210712100908714.png" alt="image-20210712100908714"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210712101034377.png" alt="image-20210712101034377"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210712101211183.png" alt="image-20210712101211183"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210712101225955.png" alt="image-20210712101225955"></p>
<h2 id="模拟外设"><a href="#模拟外设" class="headerlink" title="模拟外设"></a>模拟外设</h2><p>暂略</p>
<h2 id="控制外设"><a href="#控制外设" class="headerlink" title="控制外设"></a>控制外设</h2><p>本系列芯片的控制外设包含 <strong>eCAP</strong>、<strong>HRCAP</strong>、<strong>ePWM</strong>、<strong>HRPWM</strong>、<strong>eQEP</strong> 和 <strong>SDFM</strong>。</p>
<p>根据《spru566n》表11 可知，ePWM 和 HRPWM 都是4型增强外设，具体功能可以参见《sprui33d》。</p>
<h3 id="ePWM"><a href="#ePWM" class="headerlink" title="ePWM"></a>ePWM</h3><blockquote>
<p>The enhanced pulse width modulator (ePWM) peripheral is a key element in controlling many of the <em><strong>power electronic systems</strong></em> found in both commercial and industrial equipment. These systems include <em><strong>digital motor control</strong></em>, <em><strong>switch mode power supply control</strong></em>, <em><strong>uninterruptible power supplies (UPS)</strong></em>, and other forms of power conversion.</p>
</blockquote>
<p>大白话地将，ePWM 这个外设，是由很多个ePWM 模块（Module）组成，每个ePWM 模块都有8个子模块（Submodule）。所有的ePWM模块用数字尾缀来表示第几个ePWM模块，如 <code>ePWM1</code>、<code>ePWM3</code> 。每个ePWM模块又有两个输出，分别是 A 和 B，例如 <code>ePWM1A</code> 和 <code>ePWM1B</code> 。</p>
<p>ePWM模块通过一条时钟同步表（clock synchronization scheme）同步和串联在一起，形成可以统一操作的整体。此外，这个时钟同步表能够被扩展至 eCAP 外设使用。子模块的数量是由设备（设计）和实际使用需求决定的，每个子模块都能够支持单独操作。</p>
<p>每个ePWM模块支持以下功能：</p>
<ul>
<li>带有周期和频率控制的专用16位时基计数器</li>
<li>两个PWM输出（<code>EPWMxA</code> 和 <code>EPWMxB</code> ），可用于以下配置。<ul>
<li>两个独立的PWM输出，单边操作<span style="color: #BBB; font-style: Italic;">（ single-edge operation）</span></li>
<li>两个独立的PWM输出，双边对称操作（ dual-edge symmetric operation）</li>
<li>一个独立的PWM输出，双边不对称操作（ dual-edge asymmetric operation）</li>
</ul>
</li>
<li>通过软件对PWM信号进行异步覆盖控制。</li>
<li>可编程的相位控制，支持相对于其他ePWM模块的滞后或领先操作</li>
<li>逐个周期的硬件锁定（同步）相位关系。</li>
<li>具有独立上升沿和下降沿延迟控制的死区生成。</li>
<li>可编程的跳闸区域分配，包括逐周期跳闸和故障条件下的一次性跳闸。</li>
<li>跳闸条件可以迫使PWM输出达到高、低或高阻抗状态的逻辑水平。</li>
<li>所有事件都可以触发CPU中断和ADC开始转换(SOC)</li>
<li>可编程的事件预处理将CPU在中断上的开销降到最低。</li>
<li>通过高频载波信号进行PWM 斩波（chopping），对脉冲变压器门驱动很有用。</li>
</ul>
<p>8个子模块如下：</p>
<ul>
<li>Time-Base Submodule</li>
<li>Counter Compare Submodule</li>
<li>Action Qualifier Submodule</li>
<li>Dead-Band Generator Submodule</li>
<li>PWM Chopper (PC) Submodule</li>
<li>Trip Zone Submodule</li>
<li>Event Trigger Submodule</li>
<li>Digital Compare Submodule</li>
</ul>
<p>各子模块的 Purpose 和 Control 简单列些如下：</p>
<table>
<thead>
<tr>
<th>SUBMODULE</th>
<th>PURPOSE</th>
<th>CONTROL</th>
</tr>
</thead>
<tbody><tr>
<td>Time-Base</td>
<td>determines all of the event timing for the ePWM module</td>
<td></td>
</tr>
<tr>
<td>Counter Compare</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Action Qualifier</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Dead-Band Generator</td>
<td></td>
<td></td>
</tr>
<tr>
<td>PWM Chopper</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Trip Zone</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Event Trigger</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Digital Compare</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>ePWM 模块通过两个PWM输出（<code>EPWMxA</code> 和 <code>EPWMxB</code>）来组成一条完整的PWM通道。多路 ePWM被在一个设备内实现，几乎每一个ePWM通道实例都是相同的，只有一个例外。有些实例包括一个硬件扩展，可以更精确地控制PWM输出。这种扩展是高分辨率脉宽调制器（HRPWM），在第18.15节中有描述。每个ePWM模块都用一个以1开头的数值表示，例如，<code>ePWM1</code> 是系统中的第一个实例，<code>ePWM3</code> 是第三个实例，<code>ePWMx</code> 表示任何实例。</p>
<p>每一个ePWM模块都被连接至输入和输出信号。每一个ePWM模块都包含着8个子系统，并通过图18-2的方式连接至系统内部。</p>
<p>图1 描述的是外围总线上的多个PWM模块，及输入信号和输出信号通路示例</p>
<p>图2 描述的是PWM模块下各子模块和信号连接方式</p>
<img src="https://pic.islet.space/2021/07/image-20210715140249937.png" alt="image-20210715140249937" style="zoom:80%;" />





<img src="https://pic.islet.space/2021/07/image-20210715141719524.png" alt="image-20210715141719524" style="zoom:80%;" />



<blockquote>
<p>trip input:</p>
<p>trip zone：是ePWM的一个子模块</p>
<p>trip-zone input timing:</p>
<p>Hi-Z： 高阻态</p>
</blockquote>
<p>表57 展示了PWM的时间要求，主要是 同步（Sync）/非同步（Async）/带输入验证（With input qualifier）的 <em><strong>同步输入脉冲宽度</strong></em>（Sync Input Pulse Width）的三种时间</p>
<p>表58 展示了PWM的开关特性，包括最小脉冲周期，同步输出脉冲宽度 和 t<span style="font-size: 0.6rem;">d(TZ-PWM)</span></p>
<p>表59 </p>
<p>图58</p>
<p>图59</p>
<p>图60 为同步链架构示意？？</p>
<p>图61 PWM高阻态时序特性</p>
<p><img src="https://pic.islet.space/2021/07/image-20210712104641579.png" alt="image-20210712104641579"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210712104655718.png" alt="image-20210712104655718"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210712104857729.png" alt="image-20210712104857729"></p>
<p><img src="https://pic.islet.space/2021/07/image-20210712104928659.png" alt="image-20210712104928659"></p>
<h2 id="通信外设"><a href="#通信外设" class="headerlink" title="通信外设"></a>通信外设</h2><p>暂略</p>
<h1 id="Register"><a href="#Register" class="headerlink" title="Register"></a>Register</h1><p>暂略</p>
<h1 id="高频变换器开发"><a href="#高频变换器开发" class="headerlink" title="高频变换器开发"></a>高频变换器开发</h1><p>利用型号为 <code>TMS320F280041</code> 芯片的GPIO（最高输出频率为25MHz）输出一个30KHz的PWM波形，需要使用到 ePWM外设，使用示例中提供的 <code>ePWM6</code> 进行开发，输出高位和低位两个幅频合适的波形后，接到型号为 <code>2EDL05I06PF</code> 的驱动上，驱动型号为 <code>IKW50N65WR5</code> 的IGBT外设。</p>
<ul>
<li> <code>TMS320F280041</code> 的外部晶振输入频率 f<span style="font-size: 0.8rem;">XTAL</span> 在 10 ~ 20 MHz 之间，自身工作频率f<span style="font-size: 0.8rem;">SYSCLK</span> 在 2 ~ 100MHz之间。</li>
</ul>
<p>以下为工作频率设置的样例，刚好实际芯片时钟配置也是需要配置到满频工作状态 <code>100MHz</code> </p>
<img src="https://pic.islet.space/2021/07/image-20210715170724177.png" alt="image-20210715170724177" style="zoom:67%;" />

<ul>
<li>外部晶振和自身工作频率的设置涉及到几个寄存器：<ul>
<li>CLKSRCCTL1.OSCCLKSRCSEL</li>
<li>SYSPLLMULT</li>
<li>IMULT</li>
<li>FMULT</li>
<li>ODIV</li>
<li>SYSCLKDIVSEL.PLLSYSCLKDIV</li>
<li>SYSPLLCTL1.PLLCLKEN</li>
</ul>
</li>
</ul>
<p><strong>工作目标</strong>：</p>
<ol>
<li>输出PWM波形</li>
<li>采集输出的波形和IGBT输出的波形（可能需要检测相位和波纹）</li>
<li>过零饱和电压</li>
</ol>
<h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><p><strong>LDO</strong>: Low dropout, A DC linear voltage regulator which can operate with a very small input/output differential voltage.</p>
<p><strong>V<span style="font-size: 0.8rem;">REG</span></strong>: Voltage Regulator. 稳压器。</p>
<p><strong>V<span style="font-size: 0.8rem;">REF</span></strong>: Voltage Reference. 参考电压</p>
<p><strong>ESD</strong>: Electrostatic Discharge, 静电放电。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.ti.com.cn/cn/lit/gpn/tms320f280049">《TMS320F28004x 微控制器》</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/07/06/Programming/C++/2021-07-06-Linux%E4%B8%8AC++%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/06/Programming/C++/2021-07-06-Linux%E4%B8%8AC++%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/" class="post-title-link" itemprop="url">Linux上C++多线程报错解决办法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-07-06 01:01:51 / Modified: 01:16:47" itemprop="dateCreated datePublished" datetime="2021-07-06T01:01:51+08:00">2021-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="pthread报错"><a href="#pthread报错" class="headerlink" title="pthread报错"></a>pthread报错</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> namespce std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;hello concurent world!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span></span>&#123;</span><br><span class="line"><span class="function">thread <span class="title">t</span><span class="params">(hello)</span></span>;</span><br><span class="line">t.<span class="built_in">join</span>();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个小例子直接用make编译是无法通过的。报错如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/tmp/ccYB66pt.o：在函数‘std::thread::thread&lt;void (&amp;)()&gt;(void (&amp;)())’中：</span><br><span class="line">1-1.cpp:(.text._ZNSt6threadC2IRFvvEJEEEOT_DpOT0_[_ZNSt6threadC5IRFvvEJEEEOT_DpOT0_]+0x21)：对‘pthread_create’未定义的引用</span><br><span class="line">collect2: 错误：ld 返回 1</span><br><span class="line">&lt;<span class="built_in">builtin</span>&gt;: recipe <span class="keyword">for</span> target <span class="string">&#x27;1-1&#x27;</span> failed</span><br><span class="line">make: *** [1-1] Error 1</span><br></pre></td></tr></table></figure>

<p>解决方法是在编译的时候加上 <code>-lpthread</code> 参数。这个类用到posix实现的线程了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -o <span class="built_in">test</span> test.cpp -lpthread</span><br><span class="line">./<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>结果输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello concurent world!</span><br></pre></td></tr></table></figure>



<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wuhui20091515/article/details/52531202">c++使用thread类时编译出错，对‘pthread_create’未定义的引用</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/07/05/Programming/C++/2021-07-05-%E5%9C%A8linux%E4%B8%8A%E7%BC%96%E5%86%99%E6%B1%82%E8%A7%A3ADAU1772%E7%9A%84PLL%E7%B3%BB%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/05/Programming/C++/2021-07-05-%E5%9C%A8linux%E4%B8%8A%E7%BC%96%E5%86%99%E6%B1%82%E8%A7%A3ADAU1772%E7%9A%84PLL%E7%B3%BB%E6%95%B0/" class="post-title-link" itemprop="url">在linux上编写求解ADAU1772的PLL系数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-07-05 20:00:00" itemprop="dateCreated datePublished" datetime="2021-07-05T20:00:00+08:00">2021-07-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-06 01:01:05" itemprop="dateModified" datetime="2021-07-06T01:01:05+08:00">2021-07-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>通过在Linux上编写代码，计算求解ADAU1772在 <strong>输入时钟</strong>（MCLK Input）为16.6MHz时，如何设置内部的4个参数，以达到符合输出时钟要求的目的。</p>
<p>据《ADAU1772》和SigmaStudio，1772 Codec 内部可修改的参数有 <strong>输入时钟分频</strong>（Input Clock Divider）、<strong>整数设置</strong>（Integer Setting）、<strong>分子</strong>（Numerator） 和 <strong>分母</strong>（Denominator）四个。</p>
<p><strong>目标输出时钟</strong>（VCO Output） 是 24.576MHz。</p>
<h1 id="原公式"><a href="#原公式" class="headerlink" title="原公式"></a>原公式</h1><p>以下为《ADAU1772》第30页中，关于PLL计算的公式描述：</p>
<p><img src="https://pic.islet.space/2021/07/image-20210706002255187.png" alt="image-20210706002255187"></p>
<p>以下为SigmaStudio中的PLL设定界面参数设定：</p>
<p><img src="https://pic.islet.space/2021/07/image-20210706002412136.png" alt="image-20210706002412136"></p>
<h1 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h1><p>注意：本代码在Linux上，以C++17的版本进行编译运行。</p>
<p>编译代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ main.cpp -std=c++17 -lpthread</span><br></pre></td></tr></table></figure>

<p>在编写代码时，考虑到SigmaStudio和数据手册之间可能存在表述差异，因此计算PLL的源代码中，也包含了开启 <code>1/2</code> 系数的宏定义 <code>#define HALFCOFF 1</code> ，具体代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * HEADER FILES</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * MACRO DEFINITION</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCURACY 1000000000   <span class="comment">//输出时钟精度，小数点后9个0</span></span></span><br><span class="line"><span class="comment">// #define HALFCOFF 1            //打开1/2系数进行计算，SigmaStudio图示中有该系数，但《ADAU1772》数据手册中没有该系数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * MACRO DEFINITION FOR DEBUG</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">// #define DEBUG_MODE         //Debug模式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * DATA TYPES</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> CLK;           <span class="comment">//数据类型_时钟</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">short</span> COFF;  <span class="comment">//数据类型_系数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * FILE DOMAIN DATA DECLARATION</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line">CLK CLK_IN = <span class="number">16.6</span>;            <span class="comment">//输入时钟</span></span><br><span class="line">CLK CLK_OUT = <span class="number">24.576</span>;         <span class="comment">//输出时钟</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TargetCofficient</span> &#123;</span></span><br><span class="line">    COFF Numerator;</span><br><span class="line">    COFF Denominator;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">COFF Maxiator = <span class="number">65535</span>;</span><br><span class="line">COFF InputClockDivider = <span class="number">4</span>;</span><br><span class="line">COFF IntegerSetting = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * FUNCTIONS DECLARATION</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isSafe</span><span class="params">(COFF, COFF)</span></span>;      <span class="comment">//判断系数的分子和分母相除是否满足要求</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isOK</span><span class="params">(CLK)</span></span>;               <span class="comment">//判断输出结果是否符合输出时钟的精度要求</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CofficientCalculate</span><span class="params">(CLK, COFF, COFF)</span></span>;         <span class="comment">//计算</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ICD1</span><span class="params">(<span class="keyword">void</span>)</span></span>;             <span class="comment">//子线程</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ICD2</span><span class="params">(<span class="keyword">void</span>)</span></span>;             <span class="comment">//子线程</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ICD3</span><span class="params">(<span class="keyword">void</span>)</span></span>;             <span class="comment">//子线程</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ICD4</span><span class="params">(<span class="keyword">void</span>)</span></span>;             <span class="comment">//子线程</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SysPrintf</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * MAIN FUNCTIONS</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;SYSTEM: Procedure starts.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="function">thread <span class="title">thread1</span><span class="params">(ICD1)</span></span>;</span><br><span class="line">    <span class="function">thread <span class="title">thread2</span><span class="params">(ICD2)</span></span>;</span><br><span class="line">    <span class="function">thread <span class="title">thread3</span><span class="params">(ICD3)</span></span>;</span><br><span class="line">    <span class="function">thread <span class="title">thread4</span><span class="params">(ICD4)</span></span>;</span><br><span class="line"></span><br><span class="line">    thread1.<span class="built_in">join</span>();</span><br><span class="line">    thread2.<span class="built_in">join</span>();</span><br><span class="line">    thread3.<span class="built_in">join</span>();</span><br><span class="line">    thread4.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;SYSTEM: Procedure ends up.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * FUNCTIONS DEFINITION</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isSafe</span><span class="params">(COFF N, COFF D)</span></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> result = (<span class="keyword">double</span>)N / (<span class="keyword">double</span>)D;</span><br><span class="line">    <span class="keyword">if</span>( (result &gt;= <span class="number">0.1</span>) &amp;&amp; (result &lt;= <span class="number">0.9</span>) ) <span class="keyword">return</span> <span class="number">1</span>;       <span class="comment">//判断系数是否满足要求，满足则返回1</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isOK</span><span class="params">(CLK clock)</span></span>&#123;</span><br><span class="line">    CLK integerClock , fractClock;</span><br><span class="line">    fractClock = <span class="built_in">modf</span>(clock , &amp;integerClock);                <span class="comment">//分别取出整数和小数部分</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( ((<span class="keyword">int</span>)(fractClock * ACCURACY) == (<span class="keyword">int</span>)(<span class="number">576</span>/(<span class="keyword">double</span>)<span class="number">1000</span> * ACCURACY)) &amp;&amp; ((<span class="keyword">int</span>)integerClock == (<span class="keyword">int</span>)CLK_OUT) ) &#123;  <span class="comment">//如果小数点精度满足要求，且整数部分相同</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;                                           <span class="comment">//则返回1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CofficientCalculate</span><span class="params">(CLK ClockInput, COFF ICD, COFF IS)</span></span>&#123;</span><br><span class="line">    CLK tempCLK;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(COFF i = <span class="number">0</span>; i &lt; Maxiator; i++)&#123;                     <span class="comment">//分母</span></span><br><span class="line">        <span class="keyword">for</span>(COFF j = <span class="number">0</span>; j &lt; Maxiator; j++)&#123;                 <span class="comment">//分子</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">isSafe</span>(j, i))&#123;</span><br><span class="line">                <span class="meta">#<span class="meta-keyword">ifdef</span> HALFCOFF</span></span><br><span class="line">                tempCLK = ClockInput /(<span class="keyword">double</span>)ICD * ((<span class="keyword">double</span>)IS + ((<span class="keyword">double</span>)j/(<span class="keyword">double</span>)i)) *<span class="number">1</span>/<span class="number">2</span>;   <span class="comment">//有系数时</span></span><br><span class="line">                <span class="meta">#<span class="meta-keyword">else</span> </span></span><br><span class="line">                tempCLK = ClockInput /(<span class="keyword">double</span>)ICD * ((<span class="keyword">double</span>)IS + ((<span class="keyword">double</span>)j/(<span class="keyword">double</span>)i)) ;       <span class="comment">//无系数时</span></span><br><span class="line">                <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">                <span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG_MODE</span></span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;SYSTEM:IDC = &quot;</span> &lt;&lt; ICD &lt;&lt; <span class="string">&quot;, IS = &quot;</span> &lt;&lt; IS &lt;&lt; hex &lt;&lt;<span class="string">&quot;, Numerator = 0x&quot;</span>&lt;&lt; j &lt;&lt; <span class="string">&quot;, Denominator = 0x&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;, OutputClock = &quot;</span> &lt;&lt; tempCLK &lt;&lt; endl;</span><br><span class="line">                <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>( <span class="built_in">isOK</span>(tempCLK)) &#123;</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;SYSTEM:IDC = &quot;</span> &lt;&lt; ICD &lt;&lt; <span class="string">&quot;, IS = &quot;</span> &lt;&lt; IS &lt;&lt; hex &lt;&lt;<span class="string">&quot;, Numerator = 0x&quot;</span>&lt;&lt; j &lt;&lt; <span class="string">&quot;, Denominator = 0x&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;, OutputClock = &quot;</span> &lt;&lt; tempCLK &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * THREAD _ CALCULATOR</span></span><br><span class="line"><span class="comment"> *-------------------------------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ICD1</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(COFF enumIS = <span class="number">2</span>; enumIS &lt;= IntegerSetting; enumIS++) <span class="built_in">CofficientCalculate</span>(CLK_IN , <span class="number">1</span>, enumIS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ICD2</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(COFF enumIS = <span class="number">2</span>; enumIS &lt;= IntegerSetting; enumIS++) <span class="built_in">CofficientCalculate</span>(CLK_IN , <span class="number">2</span>, enumIS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ICD3</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(COFF enumIS = <span class="number">2</span>; enumIS &lt;= IntegerSetting; enumIS++) <span class="built_in">CofficientCalculate</span>(CLK_IN , <span class="number">3</span>, enumIS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ICD4</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(COFF enumIS = <span class="number">2</span>; enumIS &lt;= IntegerSetting; enumIS++) <span class="built_in">CofficientCalculate</span>(CLK_IN , <span class="number">4</span>, enumIS);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SysPrintf</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">// while(1) cout &lt;&lt; &quot;Calculating...&quot;;</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Calculating...&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\r\003&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h1><p>通过自行编写的代码，遍历所有可更改的系数进行计算求解，取得小数点后9位精度，并且符合要求的系数如下（含1/2系数）：</p>
<p><img src="https://pic.islet.space/2021/07/image-20210706001243698.png" alt="image-20210706001243698"></p>
<p>以下为不含1/2系数的结果：</p>
<p><img src="https://pic.islet.space/2021/07/image-20210706001350802.png" alt="image-20210706001350802"></p>
<p>经过手工计算，结果（小数点后9位）确实满足要求。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/06/30/Hardware/ADI/2021-06-30-ADSP%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/30/Hardware/ADI/2021-06-30-ADSP%E6%B7%B7%E5%90%88%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">ADSP混合编程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-30 14:00:00" itemprop="dateCreated datePublished" datetime="2021-06-30T14:00:00+08:00">2021-06-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-01 01:31:56" itemprop="dateModified" datetime="2021-07-01T01:31:56+08:00">2021-07-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Hardware/" itemprop="url" rel="index"><span itemprop="name">Hardware</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="伪操作和伪指令"><a href="#伪操作和伪指令" class="headerlink" title="伪操作和伪指令"></a>伪操作和伪指令</h1><p><em><strong>Directives</strong></em>，即 <strong>伪操作</strong>，是汇编语言中的特殊指令助记符。主要作用是为完成汇编程序做各种准备。伪操作仅是在源程序进行汇编时由汇编程序处理，而不是在计算机运行期间由机器执行的指令。即，伪操作只在汇编时起作用，一旦汇编结束，其使命也就结束了。</p>
<p><em><strong>Pseudo-Instruction</strong></em>，即 <em><strong>伪指令</strong></em>，是汇编语言程序里的特殊指令助记符，不是 真指令。伪指令在汇编时被替换成合适的机器指令（根据芯片架构而定，不同芯片架构之间指令可能不同），故其也只在汇编时其作用，不在机器运行期间由机器执行。</p>
<h1 id="ADI汇编文件样式"><a href="#ADI汇编文件样式" class="headerlink" title="ADI汇编文件样式"></a>ADI汇编文件样式</h1><p>.asm 文件具有以下样式，包含 <em><strong>预处理指令</strong></em>（主要是C/C++宏定义）、汇编伪操作类别（assembler direcitives）、数据块、代码块、条件编译预处理 和 汇编标签。</p>
<p><img src="https://pic.islet.space/2021/06/image-20210630170546778.png" alt="image-20210630170546778"></p>
<h2 id="混合编程"><a href="#混合编程" class="headerlink" title="混合编程"></a>混合编程</h2><h3 id="使用asm"><a href="#使用asm" class="headerlink" title="使用asm()"></a>使用asm()</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> img288; <span class="comment">//定义C语言变量</span></span><br><span class="line"><span class="keyword">asm</span>(<span class="string">&quot;ax0 = 0x5C;&quot;</span>);</span><br><span class="line"><span class="keyword">asm</span>(<span class="string">&quot;dm(img288_) = ax0;&quot;</span>);  <span class="comment">//用汇编语言赋值时，变量需要加后置下划线？？？</span></span><br><span class="line">img288 = <span class="number">0x5C</span>;  <span class="comment">//直接用C语言赋值</span></span><br></pre></td></tr></table></figure>

<p>以上C语言与汇编代码经过编译后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ax0 &#x3D; 0x5C;</span><br><span class="line">dm(img288_) &#x3D; ax0;</span><br><span class="line">my1 &#x3D; 92;</span><br><span class="line">dm(img288_) &#x3D; my1;</span><br></pre></td></tr></table></figure>



<p><mark>此处可否把 <code>dm()</code> 当成一个类似于指针的东西</mark></p>
<h3 id="使用汇编子程序"><a href="#使用汇编子程序" class="headerlink" title="使用汇编子程序"></a>使用汇编子程序</h3><p>使用汇编子程序是C语言程序与汇编语言接口的另一种方法。<mark>用户定义的子程序放在单独的汇编文件中，或是做成二进制的库文件，并将子程序的定义用GLOBEL输出，汇编后就可以供C语言程序调用</mark>。下面是一个不需要参数的子程序的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.MODULE&#x2F;RAM_delay_;</span><br><span class="line">.external del_cycle;  &#x2F;&#x2F;声明del_cycle是外部变量</span><br><span class="line">.global delay;  &#x2F;&#x2F;声明delay是全局变量</span><br><span class="line"></span><br><span class="line">delay_:</span><br><span class="line">function_entry;  &#x2F;&#x2F;子程序开始标志，必不可少</span><br><span class="line">ar &#x3D; dm(del_cycle_);</span><br><span class="line">cntr &#x3D; ar;</span><br><span class="line">do d_loop until ce;</span><br><span class="line">d_loop:nop;</span><br><span class="line">exit;  &#x2F;&#x2F;子程序结束标志，必不可少</span><br><span class="line">.ENDMOD;</span><br></pre></td></tr></table></figure>

<p>注意：以上代码源自参考链接4，实际上代码中的关键字相差可能较大，需要根据实际情况进行改动。</p>
<p>比如，21479系列芯片与ADAU1939芯片一同工作，其ADC采样代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.section&#x2F;pm seg_pmco;  &#x2F;&#x2F;程序代码块，procedure memory section</span><br><span class="line"></span><br><span class="line">_Receive_ADC_Samples:  &#x2F;*应该类似于 &#123; *&#x2F;</span><br><span class="line">.global _Receive_ADC_Samples;  &#x2F;&#x2F;定义自己为全局函数</span><br><span class="line"></span><br><span class="line">	r1 &#x3D; -31;     </span><br><span class="line">	r0 &#x3D; dm(_rx1a_buf + Internal_ADC_L1);	</span><br><span class="line">	f0 &#x3D; float r0 by r1;	</span><br><span class="line">	dm(_Left_Channel_In1) &#x3D; r0;</span><br><span class="line">  </span><br><span class="line">	r0 &#x3D; dm(_rx1a_buf + Internal_ADC_R1);	</span><br><span class="line">	f0 &#x3D; float r0 by r1;	</span><br><span class="line">	dm(_Right_Channel_In1) &#x3D; r0;			</span><br><span class="line"></span><br><span class="line">	r0 &#x3D; dm(_rx1b_buf + Internal_ADC_L2);	</span><br><span class="line">	f0 &#x3D; float r0 by r1;	</span><br><span class="line">	dm(_Left_Channel_In2) &#x3D; r0;	</span><br><span class="line">	</span><br><span class="line">	r0 &#x3D; dm(_rx1b_buf + Internal_ADC_R2);	</span><br><span class="line">	f0 &#x3D; float r0 by r1;	</span><br><span class="line">	dm(_Right_Channel_In2) &#x3D; r0;			</span><br><span class="line"></span><br><span class="line">	r0 &#x3D; DM(AD1939_audio_frame_timer);</span><br><span class="line">	r0 &#x3D; r0 + 1;</span><br><span class="line">	DM(AD1939_audio_frame_timer) &#x3D; r0;</span><br><span class="line">	</span><br><span class="line">	leaf_exit;  &#x2F;&#x2F;程序结束标志，应该类似于return;吧</span><br><span class="line">_Receive_ADC_Samples.end:  &#x2F;*应该类似于 &#125;*&#x2F;</span><br></pre></td></tr></table></figure>







<h1 id="Dual-Memory-Support-Keywords-dm-pm"><a href="#Dual-Memory-Support-Keywords-dm-pm" class="headerlink" title="Dual Memory Support Keywords (dm / pm)"></a>Dual Memory Support Keywords (dm / pm)</h1><p>This section describes <em><strong>cc21k</strong></em> language extension keywords to C and C++ that support the dual-memory space, modified Harvard architecture of the ADSP-21xxx processors. There are two keywords used to designate memory space: <em><strong>dm</strong></em> and <em><strong>pm</strong></em>. They can be used to specify the location of a static or global variable or to qualify a pointer declaration.</p>
<p>以下规则适用于两种内存关键字（dm/pm）：</p>
<ul>
<li>The memory space keyword (dm or pm) refers to the expression to the right of the keyword. </li>
<li>You can specify a memory space for each level of pointer. This corresponds to one memory space for each * in the declaration. </li>
<li>The compiler uses <em><strong>Data Memory</strong></em> (DM) as the default memory space for all variables. All undeclared spaces for data are Data Memory spaces. </li>
<li>The compiler always uses <em><strong>Program Memory</strong></em> (PM) as the memory space for functions. Function pointers always point to Program Memory. </li>
<li>You cannot assign memory spaces to <em><strong>automatic variables</strong></em>. <mark>All automatic variables reside on the stack, which is always in Data Memory</mark>. </li>
<li>Literal character strings always reside in Data Memory.</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li>《<a target="_blank" rel="noopener" href="https://www.analog.com/media/en/dsp-documentation/software-manuals/50_21k_cc_mn_rev_1.5.pdf">VisualDSP++ 5.0 C/C++ Compiler Manual for SHARC Processors</a>》</li>
<li>《<a target="_blank" rel="noopener" href="https://www.analog.com/media/en/dsp-documentation/processor-manuals/236999443isr_21xxx.pdf">ADSP-21160 SHARC DSP Instruction Set Reference</a>》</li>
<li>《嵌入式系统原理与应用设计》王光学，电子工业出版社</li>
<li><a target="_blank" rel="noopener" href="http://www.gzweix.com/article/sort0250/sort0251/sort0288/info-228197_2.html">嵌入式C语言开发ADSP21XX系列</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/06/28/Communication/2021-06-28-I2S%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/06/28/Communication/2021-06-28-I2S%E9%80%9A%E4%BF%A1/" class="post-title-link" itemprop="url">I2S通信</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-28 08:40:00" itemprop="dateCreated datePublished" datetime="2021-06-28T08:40:00+08:00">2021-06-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-09 00:15:13" itemprop="dateModified" datetime="2021-07-09T00:15:13+08:00">2021-07-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Communication/" itemprop="url" rel="index"><span itemprop="name">Communication</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>数字音频信号的传输标准，如：</p>
<ul>
<li><em><strong>I2S</strong></em>、<em><strong>PCM</strong></em>  (Pulse Code Modulation) 和 <em><strong>PDM</strong></em> (Pulse Density Modulation)主要用于同一块电路板上芯片之间音频信号的传输；</li>
<li><em><strong>Intel HDA</strong></em> (Intel High Definition Audio) 用于PC的Audio子系统（声卡）应用； </li>
<li><em><strong>S/PDIF</strong></em> 和 <em><strong>Ethernet AVB</strong></em> 主要应用于板间长距离及需要电缆连接的场合。</li>
</ul>
<h1 id="Philips-I2S-标准"><a href="#Philips-I2S-标准" class="headerlink" title="Philips I2S 标准"></a>Philips I2S 标准</h1><p>I2S的标准文件源自 <strong>飞利浦半导体</strong>（Philips Semiconductors）发表于1986年的《<strong>I2S bus specification</strong>（1996年修订版）》。</p>
<blockquote>
<p>I2S（Inter-IC  Sound）采用了独立的导线传输时钟与数据信号的设计，通过将数据和时钟信号分离，避免了因时差诱发的失真，为用户节省了购买抵抗音频抖动的专业设备的费用。</p>
</blockquote>
<p><strong>需要注意</strong>：I2S是一种音频编码协议，同时也是一种音频接口，因此采用I2S接口方式的不一定采用I2S编码，还可以采用 <strong>左对齐</strong>（Left Justifying）编码 或 <strong>右对齐</strong>（Right Justifying）编码。</p>
<p><img src="https://pic.islet.space/2021/06/20210629145837.png" alt="image-20210629145800027"></p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ol>
<li><p>支持全双工/半双工</p>
</li>
<li><p>支持主/从模式</p>
</li>
<li><p>和PCM相比，I2S更适合立体声系统。当然，I2S的变体也支持多通道的时分复用，因此可以支持多声道。</p>
</li>
</ol>
<h2 id="硬件特性"><a href="#硬件特性" class="headerlink" title="硬件特性"></a>硬件特性</h2><h3 id="总线介绍"><a href="#总线介绍" class="headerlink" title="总线介绍"></a>总线介绍</h3><blockquote>
<p>To minimize the number of pins required and to keep wiring simple, a <em><strong>3-line serial bus is used</strong></em> consisting of a line for <em><strong>two time-multiplexed data channels</strong></em>, <em><strong>a word select line</strong></em>(WS) and <em><strong>a clock line</strong></em> (SCK).</p>
</blockquote>
<img src="https://pic.islet.space/2021/06/20210629172149.png" alt="image-20210629112429113" style="zoom:67%;" />

<p>从上图得知，I2S总线共需要三个引脚：</p>
<ul>
<li>连续串行时钟线（<strong>SCK</strong> / <strong>SCLK</strong> / <strong>BCLK</strong>），也叫位时钟，即对应数字音频的每一位数据，SCLK都有1个脉冲。SCLK的频率=2×采样频率×采样位数。</li>
<li>字选择线（<strong>WS</strong> / <strong>LRCLK</strong>），也叫帧时钟，用于切换左右声道的数据。LRCK为“1”表示正在传输的是右声道的数据，为“0”则表示正在传输的是左声道的数据。LRCK的频率等于采样频率。</li>
<li>时分多路复用（简称 TDM）数据线，即串行数据（<strong>SD</strong> 或 <strong>SDATA</strong>），就是<mark>用二进制补码表示的</mark>音频数据。</li>
</ul>
<p>另，有时为了使系统间能够更好地同步，还需要另外传输一个信号MCLK，称为<strong>主时钟</strong>，也叫系统时钟（Sys Clock），<mark>是采样频率的256倍或384倍</mark>。</p>
<p><em><strong>注意</strong></em>：能够生成SCK和WS的就是主设备（Master）。</p>
<h3 id="电压要求"><a href="#电压要求" class="headerlink" title="电压要求"></a>电压要求</h3><table>
<thead>
<tr>
<th></th>
<th>VL</th>
<th>VH</th>
</tr>
</thead>
<tbody><tr>
<td>输出电平</td>
<td>&lt;0.4V</td>
<td>&gt;2.4V</td>
</tr>
<tr>
<td>输入电平</td>
<td>0.8V</td>
<td>2.0V</td>
</tr>
</tbody></table>
<p>这是使用的TTL电平标准，随着其他IC（LSI）的流行，其他电平也会支持。</p>
<h2 id="串行数据"><a href="#串行数据" class="headerlink" title="串行数据"></a>串行数据</h2><blockquote>
<p>I2S格式的信号无论有多少位有效数据，数据的最高位总是出现在LRCK变化（也就是一帧开始）后的第2个SCLK脉冲处。这就使得<mark>接收端与发送端的有效位数可以不同</mark>。如果接收端能处理的有效位数少于发送端，可以放弃数据帧中多余的低位数据；如果接收端能处理的有效位数多于发送端，可以自行补足剩余的位。这种同步机制使得数字音频设备的互连更加方便，而且不会造成数据错位。</p>
<p>随着技术的发展，在统一的 <strong>I2S接口</strong> 下，出现了多种不同的数据格式。根据SDATA数据相对于LRCK和SCLK的位置不同，分为左对齐（较少使用）、I2S格式（即飞利浦规定的格式）和右对齐（也叫日本格式、普通格式）。</p>
<p>为了保证数字音频信号的正确传输，发送端和接收端应该采用相同的数据格式和长度。当然，对I2S格式来说数据长度可以不同。</p>
</blockquote>
<h2 id="字选择"><a href="#字选择" class="headerlink" title="字选择"></a>字选择</h2><p>字选择（word select），也可以叫命令选择线，表明了正在被传输的声道。</p>
<ul>
<li><code>WS=0</code> ，表示正在传输的是 <strong>左声道</strong> 的数据。</li>
<li><code>WS=1</code> ，表示正在传输的是 <strong>右声道</strong> 的数据。</li>
</ul>
<p>WS可以在串行时钟的上升沿或者下降沿发生改变，并且WS信号不需要一定是对称的。在从属装置端，WS<mark>在时钟信号的上升沿发生改变</mark>。WS总是<mark>在最高位传输前的一个时钟周期发生改变</mark>，这样可以使从属装置得到与被传输的串行数据同步的时间，并且使接收端存储当前的命令以及为下次的命令清除空间。</p>
<h1 id="ADI-Codec-I2S移植"><a href="#ADI-Codec-I2S移植" class="headerlink" title="ADI-Codec I2S移植"></a>ADI-Codec I2S移植</h1><p>以下文章/教程仅针对官方提供的例程《AD1939_I2S_Sample_Based_Talkthru》进行修改。</p>
<blockquote>
<ul>
<li><code>&lt;ad1939.h&gt;</code> 定义了ADAU1939的宏定义，包括锁相环、时钟、DAC、ADC等的寄存器，与直接从SigmaStudio导出的文件并没有太大差别，应该经过精简。</li>
<li></li>
</ul>
</blockquote>
<p>首先，需要清晰认识1939和1772的硬件差异。ADAU1939和ADAU1772硬件上的异同，都有4个差分输入，但是1939有8个差分输出，1772有2个双声道输出（4个差分输出）。</p>
<p><img src="https://pic.islet.space/2021/06/20210628095302.png" alt="image-20210628095252103"></p>
<blockquote>
<p><em><strong>SPORTS</strong></em> ，即Serial Ports的简称，串行接口。</p>
</blockquote>
<p>在<code>&lt;ADDS_21479_EzKit.h&gt;</code> 头文件里，以下声明适用于21479和1939的音频通信通道，定义了 <em><strong>2个双声道输入</strong></em> 和 <em><strong>4个双声道输出</strong></em> ，正好符合1939的 <em><strong>4个差分输入</strong></em> 和 <em><strong>8个差分输出</strong></em> 的硬件描述，对应修改到1772时需要减少输出的声音通道。本文件仅对一些全局变量、声音通道、函数等做出声明，具体应用在其他.c文件或.asm文件中。</p>
<p>通过 <em><strong>Sport1 A</strong></em> 从Codec接收数据，并通过 <em><strong>Sport0 A/B</strong></em> 和 <em><strong>Sport2 A/B</strong></em> 将音频数据传输至Codec的四个立体声DAC接口。Sport1 接收中断服务程序以在 DMA接收缓存 <code>rx1a_buf</code> 上完成算术运算（arithmetic computations），并将计算结果存放至 DMA传输缓存 <code>tx0a_buf</code> 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************************************</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/                            AD1939 - SPORT1 RX INTERRUPT SERVICE ROUTINE                             /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/    Receives input data from the AD1939 ADCs via SPORT1 A and transmits processed audio data         /</span></span><br><span class="line"><span class="comment">/    back out to the four AD1939 Stereo DACs/Line Outputs through SPORT0 A/B and SPORT2 A/B           /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/   This Serial Port 1 Recieve Interrupt Service Routine performs arithmetic computations on          /</span></span><br><span class="line"><span class="comment">/   the SPORT1 receive DMA buffer (rx1a_buf) and places results to SPORT0 transmit                    /</span></span><br><span class="line"><span class="comment">/   DMA buffer (tx0a_buf)                                                                             /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/  rx1a_buf[2] - DSP SPORT0 A receive buffer - AD1939 ASDATA1                                         /</span></span><br><span class="line"><span class="comment">/  Slot # Description                             DSP Data Memory Address                             /</span></span><br><span class="line"><span class="comment">/  ------ --------------------------------------  --------------------------------------------------  /</span></span><br><span class="line"><span class="comment">/  0      Internal ADC 0 Left Channel             DM(_rx1a_buf + 0) = DM(_rx1a_buf + Internal_ADC_L1) /</span></span><br><span class="line"><span class="comment">/  1      Internal ADC 0 Right Channel            DM(_rx1a_buf + 1) = DM(_rx1a_buf + Internal_ADC_R1) /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/  rx1b_buf[2] - DSP SPORT0 B receive buffer - AD1939 ASDATA2                                         /</span></span><br><span class="line"><span class="comment">/  Slot # Description                             DSP Data Memory Address                             /</span></span><br><span class="line"><span class="comment">/  ------ --------------------------------------  --------------------------------------------------  /</span></span><br><span class="line"><span class="comment">/  0      Internal ADC 1 Left Channel             DM(_rx1b_buf + 2) = DM(_rx1b_buf + Internal_ADC_L2) /</span></span><br><span class="line"><span class="comment">/  1      Internal ADC 1 Right Channel            DM(_rx1b_buf + 3) = DM(_rx1b_buf + Internal_ADC_R2) /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/  tx0a_buf[2] - DSP SPORT0 A transmit buffer - AD1939 DSDATA1                                        /</span></span><br><span class="line"><span class="comment">/  Slot # Description                             DSP Data Memory Address                             /</span></span><br><span class="line"><span class="comment">/  ------ --------------------------------------  --------------------------------------------------  /</span></span><br><span class="line"><span class="comment">/  0      Internal DAC 1 Left Channel             DM(_tx0a_buf + 0) = DM(_tx0a_buf + Internal_DAC_L1) /</span></span><br><span class="line"><span class="comment">/  1      Internal DAC 1 Right Channel            DM(_tx0a_buf + 1) = DM(_tx0a_buf + Internal_DAC_R1) /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/  tx0a_buf[2] - DSP SPORT0 B transmit buffer - AD1939 DSDATA2                                        /</span></span><br><span class="line"><span class="comment">/  Slot # Description                             DSP Data Memory Address                             /</span></span><br><span class="line"><span class="comment">/  ------ --------------------------------------  --------------------------------------------------  /</span></span><br><span class="line"><span class="comment">/  2      Internal DAC 2 Left Channel             DM(_tx0b_buf + 2) = DM(_tx0b_buf + Internal_DAC_L2) /</span></span><br><span class="line"><span class="comment">/  3      Internal DAC 2 Right Channel            DM(_tx0b_buf + 3) = DM(_tx0b_buf + Internal_DAC_R2) /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/  tx2a_buf[2] - DSP SPORT2 A transmit buffer - AD1939 DSDATA3                                        /</span></span><br><span class="line"><span class="comment">/  Slot # Description                             DSP Data Memory Address                             /</span></span><br><span class="line"><span class="comment">/  ------ --------------------------------------  --------------------------------------------------  /</span></span><br><span class="line"><span class="comment">/  4      Internal DAC 3 Left Channel             DM(_tx2a_buf + 4) = DM(_tx2a_buf + Internal_DAC_L3) /</span></span><br><span class="line"><span class="comment">/  5      Internal DAC 3 Right Channel            DM(_tx2a_buf + 5) = DM(_tx2a_buf + Internal_DAC_R3) /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">/  tx2b_buf[2] - DSP SPORT2 B transmit buffer - AD1939 DSDATA4                                        /</span></span><br><span class="line"><span class="comment">/  Slot # Description                             DSP Data Memory Address                             /</span></span><br><span class="line"><span class="comment">/  ------ --------------------------------------  --------------------------------------------------  /</span></span><br><span class="line"><span class="comment">/  6      Internal DAC 4 Left Channel             DM(_tx2b_buf + 6) = DM(_tx2b_buf + Internal_DAC_L4) /</span></span><br><span class="line"><span class="comment">/  7      Internal DAC 4 Right Channel            DM(_tx2b_buf + 7) = DM(_tx2b_buf + Internal_DAC_R4) /</span></span><br><span class="line"><span class="comment">/                                                                                                     /</span></span><br><span class="line"><span class="comment">******************************************************************************************************/</span></span><br></pre></td></tr></table></figure>

<h2 id="SPTCL寄存器操作"><a href="#SPTCL寄存器操作" class="headerlink" title="SPTCL寄存器操作"></a>SPTCL寄存器操作</h2><p>下方代码是官方示例给出，并经过唐昊整合修改过，其寄存器设置的功能解读和验证如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*pSPCTL0 = (SPTRAN | OPMODE | SLEN32 | SPEN_A | SCHEN_A | SDEN_A | SPEN_B | SCHEN_B | SDEN_B);</span><br><span class="line">*pSPCTL1 = (OPMODE | SLEN32 | SPEN_A | SCHEN_A | SDEN_A | SPEN_B | SCHEN_B | SDEN_B);</span><br><span class="line">*pSPCTL2 = (OPMODE | SLEN32 | SPEN_A | SCHEN_A | SDEN_A | SPEN_B | SCHEN_B | SDEN_B);</span><br></pre></td></tr></table></figure>

<p><strong>SPTRAN</strong>: Serial port Data Transfer Direction. Transfer / Receive from both Channel A and Channel B. 需要注意的是，传输和接收功能只有一个会在 <code>SOPRTx_CLK</code> 和 <code>SPORTx_FS</code> 控制 <em><strong>传输/接收位移寄存器</strong></em>（Transmit/Receive shift register） 时被激活。</p>
<p><strong>OPMODE</strong>: SPORT Operation Mode, <em><strong>I2S</strong></em> / <em><strong>packed</strong></em>, <em><strong>left-justified</strong></em> mode</p>
<p><strong>SLEN32</strong>: Serial port word length, in I2S / left-justified mode , we used SLEN8 ~ SLEN32. <mark>但实际上，1772输出的I2S声道字长度是24bits</mark>。</p>
<p><strong>SPEN_A</strong>: Serial port <em><strong>Channel A DMA</strong></em> enabled.</p>
<p><strong>SCHEN_A</strong>: Serial port <em><strong>Channel A DMA Chainning</strong></em> enabled.</p>
<p><strong>SDEN_A</strong>: Serial port <em><strong>Channel A DMA</strong></em> enabled.</p>
<p><strong>SPEN_B</strong>: Serial port <em><strong>Channel B DMA</strong></em> enabled.</p>
<p><strong>SCHEN_B</strong>: Serial port <em><strong>Channel B DMA Chainning</strong></em> enabled.</p>
<p><strong>SDEN_B</strong>: Serial port <em><strong>Channel B DMA</strong></em> enabled.</p>
<p>通过查询表《HWR》中的表A-84可知，SPORT 0 ~ 2 的设置符合 0用于传输，1和2用于接收的要求。</p>
<p><img src="https://pic.islet.space/2021/07/20210702110602.png" alt="image-20210702110559930"></p>
<p>需要尽可能拉高逻辑分析仪的采样频率，如24MHz以上。</p>
<p><img src="https://pic.islet.space/2021/07/20210702111537.png" alt="image-20210702111535166"></p>
<p>1772下I2S的数据深度为16 ~ 24bit，后面的长度都会由0补齐，采集显示设置时可以设置32bit或24bit皆可。</p>
<p><img src="https://pic.islet.space/2021/07/20210702113337.png" alt="image-20210702113249646"></p>
<p><img src="https://pic.islet.space/2021/07/20210702113543.png" alt="image-20210702113540262"></p>
<h1 id="ASRC-OF-ADAU1772"><a href="#ASRC-OF-ADAU1772" class="headerlink" title="ASRC OF ADAU1772"></a>ASRC OF ADAU1772</h1><p>ADAU1772 master clock input, but the LRCLK and BCLK must be synchronous to each other. The LRCLK and BCLK pins are used to clock both the serial input and output ports. </p>
<p>ADAU1772 can be set to be either the master or the slave in a system. <mark>Because there is only one set of serial data clocks, the input and output ports must always both be either master or slave.</mark></p>
<p>It is <mark>recommended  to use the high drive settings on the serial port pins</mark>.</p>
<p>串行音频接口的通信时序说明图如下，</p>
<p>其中， t<del>SOD</del> 是指：ADC_SDATAx delay; time from BCLK falling (master and slave modes)。从下图中看出PDM（ LJ / RJ / I2S ）都有  t<del>SOD</del> 。</p>
<img src="https://pic.islet.space/2021/07/20210702135103.png" alt="image-20210702111739875" style="zoom: 80%;" />

<p>虽然同样是I2S，且LJ的标准和飞利浦I2S的标准都是左端对齐，但是飞利浦的数据会比LRCLK延时一个完整的时钟周期。而标准LJ则是LRCLK、BCLK 和 SDATA 完全对齐。</p>
<h2 id="通信时钟要求"><a href="#通信时钟要求" class="headerlink" title="通信时钟要求"></a>通信时钟要求</h2><p>量产版采用统一的 <code>16.6MHz</code> 为2个codecs和1个DSP主芯片提供时钟。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210705151852538.png" alt="image-20210705151852538"></p>
<p>异步设备通信开发顺利的前提要求是两者的通信时钟能否保持一致，即最关键的通信时钟信号（<em><strong>BCLK</strong></em> / <em><strong>LRCLK</strong></em>）是否符合设定要求(3.072MHz / 48KHz)。</p>
<p><img src="https://pic.islet.space/2021/07/20210705084415.png" alt="image-20210705084133066"></p>
<p>使用逻辑分析仪去测量音频设备的输出 <strong>帧时钟</strong>（LRCLK） 频率，如果其时钟输出结果符合设置的 <code>48KHz</code> 要求，则说明正确。其 <strong>位时钟频率要求</strong> 应等于 <code>帧时钟长度 * 数据深度 * 2</code> ，如 帧时钟频率为48KHz的 位时钟频率为 <code>48KHz * 32bits * 2</code> ，大致等于 <code>3.072 MHz</code> 。</p>
<p><strong>注意</strong>：逻辑分析仪能否清晰测量和指示波形周期，仍需要该设备自身支持较高频率的采样速率，最好采样速率能与需要采样的目标速率成倍数关系。如果速率过低，则会出现采样变形。如下图中的位时钟采样和测量为 <code>3MHz</code> ，中途会偶然出现 <code>3.429MHz</code>。</p>
<p><img src="https://pic.islet.space/2021/07/20210705095045.png" alt="image-20210705095017424"></p>
<p><img src="https://pic.islet.space/2021/07/20210705095205.png" alt="image-20210705095203461"></p>
<p>在设置错误时，会出现如下情况：</p>
<p><img src="https://pic.islet.space/2021/07/20210705085250.png" alt="image-20210705085041206"></p>
<p>在21479上设置好I2S的 slave端 代码，被动接收master端音频并转发回给master端，而ADAU1772在使用USBi单独通信设置好通信频率48KHz后，成功与21479实现全双工音频转发。</p>
<p>在评估版用户手册中，提示需要16.625MHz的时钟提供给DSP21479。通过修改量产板上codec的PLL寄存器设置，发现 <code>16.625MHz</code> 无效，设置时不起作用，因为与所提供的时钟频率（16.6MHz）不符。</p>
<img src="https://pic.islet.space/2021/07/20210705134121.png" alt="image-20210705104426587" style="zoom: 50%;" />

<img src="https://pic.islet.space/2021/07/image-20210705143238320.png" alt="image-20210705143238320" style="zoom: 80%;" />

<p>设置成 <code>16.6MHz</code> 则可以工作，能够顺利采集到数据（暂停时刻查看缓存数据）。</p>
<img src="https://pic.islet.space/2021/07/image-20210705143246050.png" alt="image-20210705143246050" style="zoom: 80%;" />

<img src="https://pic.islet.space/2021/07/image-20210705143606164.png" alt="image-20210705143606164" style="zoom:67%;" />



<p>仔细阅读以下寄存器信息。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210705145709904.png" alt="image-20210705145709904"></p>
<p><strong>注意</strong>：SigmaStudio中，设置 <strong>输入时钟信号</strong>（MCLK input）和 <strong>输出时钟信号</strong>（VCO Output）后，仅有 <strong>输入信号分频</strong>（input clock divider，下简称 <em><strong>ICD</strong></em>）是可以设置的，其他参数由 <code>load parameters</code> 自动计算。在 <em><strong>输入频率</strong></em> <code>16.6MHz</code> 和 <em><strong>输出频率</strong></em> <code>24.576MHz</code> 不变的情况下，改变 输入信号分频 以生成下表：</p>
<table>
<thead>
<tr>
<th></th>
<th>ICD = 1</th>
<th>ICD = 2</th>
<th>ICD = 3</th>
<th>ICD = 4</th>
</tr>
</thead>
<tbody><tr>
<td>PLL_CTRL0</td>
<td>0x08</td>
<td>0x08</td>
<td>0x08</td>
<td>0x08</td>
</tr>
<tr>
<td>PLL_CTRL1</td>
<td>0x1B</td>
<td>0x1B</td>
<td>0x1B</td>
<td>0x1B</td>
</tr>
<tr>
<td>PLL_CTRL2</td>
<td>0x07</td>
<td>0x07</td>
<td>0x17</td>
<td>0x1F</td>
</tr>
<tr>
<td>PLL_CTRL3</td>
<td>0xCA</td>
<td>0x79</td>
<td>0x5E</td>
<td>0x28</td>
</tr>
<tr>
<td>PLL_CTRL4</td>
<td>0x11</td>
<td>0x2B</td>
<td>0x35</td>
<td>0x47</td>
</tr>
<tr>
<td>PLL_CTRL5</td>
<td>0x01</td>
<td>0x01</td>
<td>0x01</td>
<td>0x01</td>
</tr>
</tbody></table>
<ul>
<li><code>PLL_CTRL0</code> 和 <code>PLL_CTRL1</code> 分别构成 PLL分母（denominator）的高位和低位。</li>
<li><code>PLL_CTRL2</code> 和 <code>PLL_CTRL3</code> 分别构成 PLL分子（numerator）的高位和低位。</li>
<li><code>PLL_CTRL4</code> 控制着 <strong>PLL类型</strong>（整数型/分数型）、<strong>输入时钟分频</strong>（1 - 4）和 PLL设置的 <strong>整数部分</strong>。</li>
<li><code>PLL_CTRL5</code> 目前只能是 <code>0x00</code> 或 <code>0x01</code> 。</li>
</ul>
<p>以下为PLL_CTRL4寄存器的位描述：n</p>
<p><img src="https://pic.islet.space/2021/07/image-20210706101429733.png" alt="image-20210706101429733"></p>
<p>至于 <code>CLK_CONTROL</code> 寄存器，主要是数值 <code>0x89</code> 和 <code>0x8F</code> 的差别。见下表可知，是关于PLL分频的问题。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210705153843902.png" alt="image-20210705153843902"></p>
<p>通过自行编写的代码，遍历所有可更改的系数进行计算求解，取得小数点后9位精度，并且符合要求的系数如下（含1/2系数）：</p>
<p>根据PLL_CTRL4寄存器，ICD=3、IS=8时，该寄存器的值为 <code>01000101</code> ，即 <code>0x45</code> 。（下图IDC更正为ICD）</p>
<p><img src="https://pic.islet.space/2021/07/image-20210706001243698.png" alt="image-20210706001243698"></p>
<p>以下为不含1/2系数的结果：</p>
<p>根据PLL_CTRL4寄存器，ICD=3、IS=4时，该寄存器的值为 <code>00100101</code> ，即 <code>0x25</code> 。</p>
<p><img src="https://pic.islet.space/2021/07/image-20210706001350802.png" alt="image-20210706001350802"></p>
<ul>
<li>CLK_IN mean value is 16.6Mhz</li>
<li>LRCLK mean value is 45.92Khz</li>
</ul>
<h1 id="ANC主板硬件（量产）"><a href="#ANC主板硬件（量产）" class="headerlink" title="ANC主板硬件（量产）"></a>ANC主板硬件（量产）</h1><p>以下为ADAU1772的特征：</p>
<p><strong>Master clock</strong> = <strong>core clock</strong> = 12.288 MHz</p>
<p><strong>serial input sample rate</strong> = 48 kHz</p>
<p><strong>measurement bandwidth</strong> = 20 Hz to 20 kHz</p>
<p><strong>word width</strong> = 24 bits</p>
<p><strong>ambient temperature</strong> = 25°C</p>
<p><strong>outputs line loaded</strong> with 10 kΩ</p>
<p>Codec A是接了DAC输出的，Codec B没有，其地址分别为 <code>0x3D</code> 与 <code>0x3E</code>。        </p>
<h2 id="TWI-I2C"><a href="#TWI-I2C" class="headerlink" title="TWI (I2C)"></a>TWI (I2C)</h2><table>
<thead>
<tr>
<th></th>
<th>Codec A</th>
<th>Codec B</th>
</tr>
</thead>
<tbody><tr>
<td>SCK</td>
<td>DPI_P08</td>
<td>DPI_P08</td>
</tr>
<tr>
<td>SDA</td>
<td>DPI_P07</td>
<td>DPI_P07</td>
</tr>
<tr>
<td>ADDR0</td>
<td>+3.3VA</td>
<td>AGND</td>
</tr>
<tr>
<td>ADDR1</td>
<td>AGND</td>
<td>+3.3VA</td>
</tr>
</tbody></table>
<h2 id="I2S"><a href="#I2S" class="headerlink" title="I2S"></a>I2S</h2><table>
<thead>
<tr>
<th></th>
<th>Codec A</th>
<th>Codec B</th>
</tr>
</thead>
<tbody><tr>
<td>ADC_SDATA_0</td>
<td>DAI_P13</td>
<td>DAI_P15</td>
</tr>
<tr>
<td>ADC_SDATA_1 <em>(clock)</em></td>
<td>DAI_P03</td>
<td>DAI_P16</td>
</tr>
<tr>
<td>LRCLK</td>
<td>DAI_P02</td>
<td>DAI_P11 (<em>useless</em>)</td>
</tr>
<tr>
<td>BCLK</td>
<td>DAI_P01</td>
<td>DAI_P12 (<em>useless</em>)</td>
</tr>
<tr>
<td>DAC_SDATA</td>
<td>DAI_P07</td>
<td>/</td>
</tr>
</tbody></table>
<img src="https://pic.islet.space/2021/07/20210702100719.png" alt="image-20210702100716720" style="zoom:80%;" />



<p><img src="https://pic.islet.space/2021/07/20210702101017.png" alt="image-20210702100920210" style="zoom:67%;" /><img src="https://pic.islet.space/2021/07/20210702101020.png" alt="image-20210702101004870" style="zoom:67%;" /></p>
<h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><table>
<thead>
<tr>
<th></th>
<th>FLASH</th>
</tr>
</thead>
<tbody><tr>
<td>SPI_SOMI</td>
<td>DPI_P01</td>
</tr>
<tr>
<td>SPI_SIMO</td>
<td>DPI_P02</td>
</tr>
<tr>
<td>SPI_CLK</td>
<td>DPI_P03</td>
</tr>
<tr>
<td>SPI_SCS</td>
<td>DPI_P05</td>
</tr>
</tbody></table>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><p>《<a href="">I2S bus specification</a>》</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/I2S/3443390">I2S</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/q2519008/article/details/80413695">【音频】I2S协议详解</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/353520173">I2S/PCM</a></p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备19004822号 </a>
  </div>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liewzheng</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
