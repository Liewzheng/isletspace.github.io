<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;islet.space&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:true,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:true,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;Searching...&quot;,&quot;empty&quot;:&quot;We didn&#39;t find any results for the search: ${query}&quot;,&quot;hits_time&quot;:&quot;${hits} results found in ${time} ms&quot;,&quot;hits&quot;:&quot;${hits} results found&quot;}}</script>
<meta name="description" content="笔记分享的旮旯孤岛而已">
<meta property="og:type" content="website">
<meta property="og:title" content="Coder的孤岛">
<meta property="og:url" content="http://islet.space/page/4/index.html">
<meta property="og:site_name" content="Coder的孤岛">
<meta property="og:description" content="笔记分享的旮旯孤岛而已">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Liewzheng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://islet.space/page/4/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;en&quot;,&quot;comments&quot;:&quot;&quot;,&quot;permalink&quot;:&quot;&quot;,&quot;path&quot;:&quot;page&#x2F;4&#x2F;index.html&quot;,&quot;title&quot;:&quot;&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>Coder的孤岛</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Coder的孤岛</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">islet of the coder</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-首页"><a href="https://islet.space/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-文章"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-目录"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>目录</a></li>
        <li class="menu-item menu-item-zplusplus"><a href="https://zplusplus.cn/" rel="noopener" target="_blank"><i class="fa fa-user fa-fw"></i>ZPLUSPLUS</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liewzheng</p>
  <div class="site-description" itemprop="description">笔记分享的旮旯孤岛而已</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">82</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">155</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:liewzheng@qq.com" title="E-Mail → mailto:liewzheng@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/14/Communication/2021-05-14-I2C%E3%80%81SPI%E3%80%81TDM%E5%8F%8AI2S/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/14/Communication/2021-05-14-I2C%E3%80%81SPI%E3%80%81TDM%E5%8F%8AI2S/" class="post-title-link" itemprop="url">I^2^C、SPI、TDM及I2S</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-14 10:55:00" itemprop="dateCreated datePublished" datetime="2021-05-14T10:55:00+08:00">2021-05-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-15 21:12:20" itemprop="dateModified" datetime="2021-07-15T21:12:20+08:00">2021-07-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Communication/" itemprop="url" rel="index"><span itemprop="name">Communication</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="I-2-C"><a href="#I-2-C" class="headerlink" title="I^2^C"></a>I^2^C</h1><p><strong>标准</strong>：<a target="_blank" rel="noopener" href="https://www.nxp.com/docs/en/user-guide/UM10204.pdf">《NXP_UM10204_I^2^C-bus specification and user manual》</a></p>
<blockquote>
<p><em>I^2^C总线是一个事实上的世界标准，现在已经在50多家公司生产的1000多种不同的IC中实施。</em></p>
<p><em>此外，多功能的I^2^C总线被用于各种控制架构，如系统管理总线（SMBus）、电源管理总线（PMBus）、智能平台管理接口（IPMI）、显示数据通道（DDC）和高级电信计算架构（ATCA）。</em></p>
<p><em>本文件帮助设备和系统设计者了解I^2^C总线的工作原理并实现工作应用。描述了各种操作模式。它包含了对I^2^C<strong>总线数据传输</strong>、握手和总线仲裁方案的全面介绍。详细的章节涵盖了I^2^C总线在每种工作模式下的时序和电气规范。</em></p>
<p><em>I^2^C兼容芯片的设计者应将该文件作为参考，并确保新设备满足该文件中规定的所有限制。包含I^2^C器件的系统的设计者应审查本文件，并参考各个组件的数据表。</em></p>
<p>——翻译自标准文件</p>
</blockquote>
<p>I^2^C(Inter－Integrated Circuit)是一种通用的总线协议。它是由Philips(飞利浦)公司，现NXP(恩智浦)半导体开发的一种简单的双向两线制总线协议标准。</p>
<p>对于硬件设计人员来说，只需要2个管脚，极少的连接线和面积，就可以实现芯片间的通讯，对于软件开发者来说，可以使用同一个I^2^C驱动库，来实现实现不同器件的驱动，大大减少了软件的开发时间。极低的工作电流，降低了系统的功耗，完善的应答机制大大增强通讯的可靠性。</p>
<h2 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h2><img src="https://pic.islet.space/2021/05/image-20210514111033910.png" alt="image-20210514111033910" style="zoom: 67%;" />

<table>
<thead>
<tr>
<th>术语</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>总线</td>
<td>传输数据的通路</td>
</tr>
<tr>
<td>传送者</td>
<td>传输数据至总线的设备</td>
</tr>
<tr>
<td>接收者</td>
<td>从总线上接受数据的设备</td>
</tr>
<tr>
<td>主（机）</td>
<td>主动开启传输、生成时钟信号 并 主动结束传输的设备</td>
</tr>
<tr>
<td>从（机）</td>
<td>由主机寻址的设备</td>
</tr>
<tr>
<td>多主（机）</td>
<td>在不损坏数据传输的情况下允许多主机可以试图同时控制总线</td>
</tr>
<tr>
<td>仲裁</td>
<td>确保在有多个主机同时试图控制总线的情况下，只允许一个主机这样做，而且仲裁成功的信息不会被（其他设备）破坏的程序。</td>
</tr>
<tr>
<td>同步</td>
<td>确保两个及以上设备其时钟信号的同步</td>
</tr>
</tbody></table>
<p>以下这个图应该可以较好地解释“多主机”的概念，多个主机可以同时向外发出传输数据的申请，也可以主动结束其数据传输。虽然，I^2^C降低了总线复用的成本，但仍需要“仲裁”机制来解决多个主机之间的无序竞争状态。</p>
<img src="https://pic.islet.space/2021/05/image-20210514112114667.png" alt="image-20210514112114667" style="zoom:67%;" />

<h2 id="总线特征"><a href="#总线特征" class="headerlink" title="总线特征"></a>总线特征</h2><h3 id="总线硬件要求"><a href="#总线硬件要求" class="headerlink" title="总线硬件要求"></a>总线硬件要求</h3><p>通过 <strong>串行数据</strong>（SDA，Serial Data）和 <strong>串行时钟</strong>（SCL，Serial Clock）两条线路对设备进行连接。</p>
<p>每个设备都通过自身的通信设备地址进行互相辨别，且每个设备都可以当发送者或接收者，取决于设备自身的功能定义。</p>
<h3 id="标准传输速率"><a href="#标准传输速率" class="headerlink" title="标准传输速率"></a>标准传输速率</h3><p>各模式、速率及其传输方向见下方表格。</p>
<blockquote>
<p>Data on the I^2^C-bus can be transferred at rates of up to 100 kbit/s in the Standard-mode, up to 400 kbit/s in the Fast-mode, up to 1 Mbit/s in Fast-mode Plus, or up to 3.4 Mbit/s in the High-speed mode. </p>
</blockquote>
<table>
<thead>
<tr>
<th>MODE</th>
<th>RATE</th>
<th>TRANSFER DIRECTION</th>
<th>DOWNWARD COMPATIBLE WITH</th>
</tr>
</thead>
<tbody><tr>
<td>STANDARD</td>
<td>100 Kbit/s</td>
<td>bidirectional</td>
<td>/</td>
</tr>
<tr>
<td>FAST</td>
<td>400 Kbit/s</td>
<td>bidirectional</td>
<td>STANDARD</td>
</tr>
<tr>
<td>FAST-PLUS</td>
<td>1 Mbit/s</td>
<td>bidirectional</td>
<td>STANDARD / FAST</td>
</tr>
<tr>
<td>HIGH-SPEED</td>
<td>3.4 Mbit/s</td>
<td>bidirectional</td>
<td>STANDARD / FAST / FAST-PLUS</td>
</tr>
<tr>
<td>ULTRA-FAST</td>
<td>5 Mbit/s</td>
<td>unidirectional</td>
<td>/</td>
</tr>
</tbody></table>
<p><img src="https://pic.islet.space/2021/05/image-20210522182927364.png" alt="image-20210522182927364"></p>
<h2 id="协议要求"><a href="#协议要求" class="headerlink" title="协议要求"></a>协议要求</h2><p>以下协议要求适用于双向通信模式（不包括ULTRA-FAST模式下的单向通信）</p>
<h3 id="逻辑电平规定"><a href="#逻辑电平规定" class="headerlink" title="逻辑电平规定"></a>逻辑电平规定</h3><p>由于I^2^C的接入设备众多（如CMOS、NMOS、Bipolar等），因此逻辑电平0和逻辑电平1（的电压）并不是固定不变的，这取决于VDD的电平。</p>
<p>输入参考电平会被控制在VDD电平的30%<del>70%之间。 V</del>IL~ = 0.3 * V<del>DD</del>；V<del>IH</del> = 0.7 * V<del>DD</del> 。</p>
<p>某些传统设备的输入电平会被固定在1.5V（V<del>IL</del>）和3.0V（V<del>IH</del>），但新设备都要求是 30%V<del>DD</del> 及 70%V<del>DD</del> 。</p>
<p><strong>注意</strong>：V<del>IL</del>、V<del>IH</del>、V<del>OL</del>、V<del>OH</del>都是以参考电压作为基准的，即要达到某个电压的百分之多少时，才能够被认为是 <strong>逻辑电平0</strong> 或 <strong>逻辑电平1</strong> 。例如，可将V<del>IL</del> 视作当V<del>DD</del>下降到只有30%及以下时，为逻辑电平0，30%V<del>DD</del>是其逻辑电平的最高阈值；同理可得 V<del>IH</del> ；超过这个值而未到达70%的中间态则为不确定态。</p>
<blockquote>
<p>Due to the variety of different technology devices (CMOS, NMOS, bipolar) that can be connected to the I^2^C-bus, the levels of the logical ‘0’ (LOW) and ‘1’ (HIGH) are not fixed and depend on the associated level of VDD . Input reference levels are set as 30 % and 70 % of VDD ; VIL is 0.3VDD and VIH is 0.7V DD .</p>
<p>See Figure 38, timing diagram. Some legacy device input levels were fixed at V<del>IL</del> = 1.5 V and V<del>IH</del> = 3.0 V, but all new devices require this 30 %/70 % specification. </p>
</blockquote>
<img src="https://pic.islet.space/2021/05/image-20210514134830615.png" alt="image-20210514134830615" style="zoom: 67%;" />



<h3 id="时序正确性"><a href="#时序正确性" class="headerlink" title="时序正确性"></a>时序正确性</h3><ul>
<li>SDA上的数据必须在SCL高电平期间保持稳定，即不能在SCL高电平期间发生翻转（后见原因），只有在SCL低电平时可以翻转。</li>
<li>时钟脉冲信号生成要先于数据传送。</li>
</ul>
<blockquote>
<p>The data on the SDA line must be stable during the HIGH period of the clock. The HIGH or LOW state of the data line can only change when the clock signal on the SCL line is LOW (see Figure 4). One clock pulse is generated for each data bit transferred.</p>
</blockquote>
<img src="https://pic.islet.space/2021/05/image-20210514141512136.png" alt="image-20210514141512136" style="zoom: 80%;" />



<h3 id="开始及结束标志"><a href="#开始及结束标志" class="headerlink" title="开始及结束标志"></a>开始及结束标志</h3><ul>
<li><p>传输开始时必须以一个 <strong>开始</strong> 信号作为标志，结束时必须以一个 <strong>结束</strong> 信号作为标志。</p>
</li>
<li><p><strong>开始信号 <strong>是以SCL为高电平时的 <strong>SDA电平的由高转低</strong> 作为标志，</strong>结束信号</strong> 是以SCL高电平时的 <strong>SDA电平的由低转高</strong> 作为标志。</p>
</li>
<li><p>开始和结束标志必须由主设备控制。</p>
</li>
</ul>
<blockquote>
<p>All transactions begin with a START (S) and are terminated by a STOP (P) (see Figure 5). A HIGH to LOW transition on the SDA line while SCL is HIGH defines a START condition. A LOW to HIGH transition on the SDA line while SCL is HIGH defines a STOP condition.</p>
</blockquote>
<img src="https://pic.islet.space/2021/05/image-20210514142116674.png" alt="image-20210514142116674" style="zoom: 80%;" />



<h4 id="开始字节"><a href="#开始字节" class="headerlink" title="开始字节"></a>开始字节</h4><img src="https://pic.islet.space/2021/05/image-20210515150526897.png" alt="image-20210515150526897" style="zoom:67%;" />

<blockquote>
<p>dummy acknowledge (HIGH) : 无声确认？？？</p>
</blockquote>
<h3 id="总线状态"><a href="#总线状态" class="headerlink" title="总线状态"></a>总线状态</h3><p>总线具有两种状态，<strong>繁忙</strong>（Busy）和 <strong>空闲</strong>（Free），即 SDA电平 “开始” 后，总线进入繁忙状态， SDA电平 “结束” 后，总线进入空闲状态。</p>
<p><strong>注意</strong>：在总线繁忙期间，发生重复的“开始”状态（而不是“结束”状态），由于“重复开始”和 “开始” 功能相同，为了方便，统称为 “开始”，除非特殊说明为 “重复开始”。</p>
<blockquote>
<p>The bus stays busy if a repeated START (Sr) is generated instead of a STOP condition. In this respect, the START (S) and repeated START (Sr) conditions are functionally identical. For the remainder of this document, therefore, the S symbol is used as a generic term to represent both the START and repeated START conditions, unless Sr is particularly relevant.</p>
</blockquote>
<h3 id="传输比特位"><a href="#传输比特位" class="headerlink" title="传输比特位"></a>传输比特位</h3><ul>
<li>SDA线上的字节传输必须满足8位长度。</li>
<li>每次传输数据的字节数不受限制。</li>
<li>每个字节数后都需要跟一个<strong>确认位（Acknowledge bit）</strong>。</li>
<li>当从机无法完整接收或传输一个完整的数据字节时，例如正在产生内部中断等，除非其完成内部的某些功能，否则该从机将能够一直拉低SCL的电平，<strong>强制让主机一直处于等待状态</strong>。只有当从机准备好接收下一个完整的字节并释放SCL时，数据传输才会继续。</li>
</ul>
<blockquote>
<p>Every byte put on the SDA line must be eight bits long. The number of bytes that can be transmitted per transfer is unrestricted. Each byte must be followed by an Acknowledge bit.</p>
<p><strong>Data is transferred with the Most Significant Bit (MSB) first</strong> (see Figure 6). If a slave cannot receive or transmit another complete byte of data until it has performed some other function, for example servicing an internal interrupt, it can hold the clock line SCL LOW to force the master into a wait state. Data transfer then continues when the slave is ready for another byte of data and releases clock line SCL.</p>
</blockquote>
<img src="https://pic.islet.space/2021/05/image-20210514144620803.png" alt="image-20210514144620803" style="zoom:80%;" />



<h3 id="确认标志"><a href="#确认标志" class="headerlink" title="确认标志"></a>确认标志</h3><ul>
<li>每个字节（8比特）后都跟着一个确认位，即前8位数据，第9位确认。</li>
<li><strong>SCL上的时钟信号由主机产生，包括确认位的的第九个时钟脉冲</strong>。</li>
<li>SDA线并不是由主机一直占有的，每发送完一个完整字节后，主机都会释放SDA线，由从机进行数据确认。</li>
<li>发送者在确认时钟脉冲期间释放SDA线，以便接收者可以将SDA线拉低，并且在该时钟脉冲的高电平期间保持稳定的低电平（见图4）。</li>
<li>对于设置（set-up）和保持（Hold）的时间，都应该依照表10中只针对各种不同模式的要求进行设置。</li>
<li>如果SDA电平在第九个时钟脉冲时仍保持高电平，则被定义为 “未确认状态”。则此时主机可以发送一个“结束”标志来结束当前连接，或发送一个“开始”标志来开启一次新的传送。</li>
</ul>
<img src="/home/kali/.config/Typora/typora-user-images/image-20210514154506246.png" alt="image-20210514154506246" style="zoom: 80%;" />

<blockquote>
<p>The acknowledge takes place after every byte. The acknowledge bit allows the receiver to signal the transmitter that the byte was successfully received and another byte may be sent. The master generates all clock pulses, including the acknowledge ninth clock pulse.</p>
<p>The Acknowledge signal is defined as follows: the transmitter releases the SDA line during the acknowledge clock pulse so the <em><strong>receiver can pull the SDA line LOW</strong></em> and it remains stable LOW during the HIGH period of this clock pulse (see Figure 4). Set-up and hold times (specified in Section 6) must also be taken into account.</p>
<p>When SDA remains HIGH during this ninth clock pulse, this is defined as the Not Acknowledge signal. The master can then generate either a STOP condition to abort the transfer, or a repeated START condition to start a new transfer. </p>
</blockquote>
<p><strong>以下为五种“未确认/未应答”的可能情况</strong>：There are five conditions that lead to the generation of a NACK:</p>
<ol>
<li><strong>传输地址错误</strong>：No receiver is present on the bus with the transmitted address so there is no device to respond with an acknowledge.</li>
<li><strong>实时处理中</strong>：The receiver is unable to receive or transmit because it is performing some real-time function and is not ready to start communication with the master.</li>
<li><strong>数据/代码未定义</strong>：During the transfer, the receiver <strong>gets data or commands that it does not understand.</strong></li>
<li><strong>正在传输中</strong>：During the transfer, the receiver <strong>cannot receive any more data bytes</strong>.</li>
<li><strong>未收到结束信号（收发身份未转换）</strong>：A master-receiver must signal the end of the transfer to the slave transmitter.</li>
</ol>
<h3 id="时钟同步"><a href="#时钟同步" class="headerlink" title="时钟同步"></a>时钟同步</h3><p>任意几个主机都可能同时发起数据传输请求，此时只有一个主机和一个从机可以掌握总线进行通信，此时需要通过 <strong>时间同步</strong> 和 <strong>仲裁</strong> 完成对总线的调配。</p>
<p><strong>在单机系统（Single Master System）中，不需要时钟同步和仲裁。</strong></p>
<p>时钟同步是通过I^2^C接口与SCL线的有线-AND连接进行的。</p>
<p>这意味着SCL线上的高电平到低电平的转换会导致相关的主站开始对其低电平周期进行计数（如图7的CLK<del>2</del>），一旦一个主站时钟 CLK<del>1</del> 变为低电平，它就会将SCL线电平拉低，并保持在这个状态，直到另一个时钟 CLK<del>2</del> 达到高电平状态。</p>
<p>然而，如果时钟 CLK<del>2</del> 仍在其低电平周期内，CLK<del>1</del> 的低电平到高电平转换可能不会改变SCL线的状态。</p>
<p>因为SCL线被具有最长的低电平周期的主站 CLK<del>2</del> 保持为低电平，而在这段时间内，低电平周期较短的主站 CLK<del>1</del> 进入高电平等待状态。</p>
<blockquote>
<p>Clock synchronization is performed using the wired-AND connection of I^2^C interfaces to the SCL line. This means that a HIGH to LOW transition on the SCL line causes the masters concerned to start counting off their LOW period and, once a master clock has gone LOW, it holds the SCL line in that state until the clock HIGH state is reached (see Figure 7). However, if another clock is still within its LOW period, the LOW to HIGH transition of this clock may not change the state of the SCL line. The SCL line is therefore held LOW by the master with the longest LOW period. Masters with  shorter LOW periods enter a HIGH wait-state during this time.</p>
</blockquote>
<p>当所有相关的主控器都结束了他们的低电平周期，时钟线被释放并变成高电平。</p>
<p>然后，在主站时钟和SCL线的状态之间没有差异，所有的主站开始计算他们的高电平周期。</p>
<p><strong>第一个完成其高电平周期的主站再次将SCL线拉到低电平</strong>。这样，就产生了一个<strong>同步的SCL时钟</strong>，<strong>其低电平周期由具有最长时钟低电平周期的主站决定</strong>，<strong>其高电平周期由具有最短时钟高电平周期的主站决定</strong>。</p>
<img src="https://pic.islet.space/2021/05/image-20210514170202184.png" alt="image-20210514170202184" style="zoom: 67%;" />



<h3 id="竞争仲裁"><a href="#竞争仲裁" class="headerlink" title="竞争仲裁"></a>竞争仲裁</h3><p>仲裁和同步一样，是指只有在系统中使用一个以上的主站时才需要的协议的一个部分。注意，从机不参与仲裁程序。</p>
<p>一个主站只有在总线空闲时才可以开始传输。两个主站可以在START条件的最小保持时间（tHD;STA）内产生一个START条件，从而在总线上产生一个有效的START条件。然后需要进行仲裁，以确定哪个主站将完成其传输。</p>
<p>仲裁是逐位进行的。在每个比特期间，当SCL为高电平时，每个主站检查SDA电平是否与其所发送的内容相符，期间可能需要很多比特，只要传输的内容相同，两个主站实际上可以无误地完成整个信息传输过程。</p>
<p><mark>当一个主站第一次试图发送一个高电平，但检测到SDA电平为低电平时，主站知道它已经失去了仲裁，并关闭其SDA输出驱动器</mark>。在其他主站被仲裁过程中，正在传输其信息的主站将继续其传输，没有信息丢失。</p>
<p>失去仲裁的主站可以产生时钟脉冲，直到它失去仲裁的字节结束，并且必须在总线空闲时重新尝试传输。</p>
<p><mark>如果一个主站也包含了一个从站功能，并且它在寻址阶段失去了仲裁，有可能获胜的主站正试图对它进行寻址。因此，失败的主站必须立即切换到其从站模式。</mark></p>
<p>图8显示了两个主站的仲裁程序。可能涉及更多，这取决于有多少个主站连接到总线上。</p>
<p><mark>当产生DATA1的主站的内部数据电平与SDA线上的实际电平有差异时，DATA1的输出被关闭。这并不影响由获胜主站发起的数据传输。</mark></p>
<img src="https://pic.islet.space/2021/05/image-20210515142633906.png" alt="image-20210515142633906" style="zoom: 67%;" />



<h3 id="时间拉伸"><a href="#时间拉伸" class="headerlink" title="时间拉伸"></a>时间拉伸</h3><h3 id="从机地址和读取位"><a href="#从机地址和读取位" class="headerlink" title="从机地址和读取位"></a>从机地址和读取位</h3><h3 id="10位寻址"><a href="#10位寻址" class="headerlink" title="10位寻址"></a>10位寻址</h3><h3 id="反转地址"><a href="#反转地址" class="headerlink" title="反转地址"></a>反转地址</h3><h3 id="通用寻址"><a href="#通用寻址" class="headerlink" title="通用寻址"></a>通用寻址</h3><p><img src="https://pic.islet.space/2021/05/image-20210515172907284.png" alt="image-20210515172907284"></p>
<p><img src="https://pic.islet.space/2021/05/image-20210515172945861.png" alt="image-20210515172945861"></p>
<p><img src="https://pic.islet.space/2021/05/image-20210515172958184.png" alt="image-20210515172958184"></p>
<h3 id="软复位"><a href="#软复位" class="headerlink" title="软复位"></a>软复位</h3><p>在发送general call (0000 0000)后，再发送一个 0000 0110 (06h) ，这样两个具有先后顺序的字节来定义软复位。</p>
<p>首先，这种软复位是可选 ，并不是所有设备都会对软复位指令进行响应。</p>
<p>在收到这2个字节的序列时，所有被设计为响应一般调用地址的设备都会复位，并接收其地址的可编程部分。</p>
<blockquote>
<p>On receiving this 2-byte sequence, all devices designed to respond to the general call address reset and take in the programmable part of their address.</p>
</blockquote>
<p>必须采取预防措施，确保设备在施加电源电压后没有拉低SDA或SCL线，因为这些低电平会阻断总线。</p>
<h3 id="总线复位"><a href="#总线复位" class="headerlink" title="总线复位"></a>总线复位</h3><p>SCK信号一直卡在低电平的事件较少发生。</p>
<ul>
<li>如果I^2^C总线设备拥有硬件复位输入，则可以通过优先程序启用硬件中断复位来重置总线。</li>
<li>如果没有硬件复位输入，则通过给设备循环供电，激活强制性的内部开机复位（POR）电路。</li>
</ul>
<p>SDA信号如果一直卡在低电平。</p>
<ul>
<li><p>则主机应该发送九次SCL时钟脉冲，此时令SDA保持低电平的设备在收到九次脉冲后应主动释放总线。</p>
</li>
<li><p>如果九次脉冲没有用，则启用硬件中断复位或循环供电来清除总线。</p>
</li>
</ul>
<h3 id="设备ID"><a href="#设备ID" class="headerlink" title="设备ID"></a>设备ID</h3><p>可选的3字节只读设备ID编码（an optional 3-byte read-only ）：</p>
<ul>
<li>12位是设备制造商编号，具有独一无二性</li>
<li>9位零件ID，由设备制造商写入</li>
<li>3位模具/晶元版本，由设备制造商写入</li>
</ul>
<img src="https://pic.islet.space/2021/05/image-20210515152141963.png" alt="image-20210515152141963" style="zoom:67%;" />

<ol>
<li><p>启动条件</p>
</li>
<li><p> 主站发送保留设备ID的 I^2^C 总线地址，后面的R/W位设置为<code>0</code>（写）：<code>1111 1000</code>。</p>
</li>
<li><p> 主站发送从属地址。LSB是一个 “不关心”的值，只有一个设备必须确认这个字节（拥有I^2^C总线从属地址的设备）。</p>
</li>
<li><p> 主站发送一个 Re-START 条件。</p>
</li>
</ol>
<blockquote>
<p>备注：在 STOP 条件之后，再加上一个 START 条件，就会重置从属状态机，无法进行设备ID读取。另外，在 STOP 条件或 Re-START 条件之后，对另一个从属设备的访问也会重置从属状态机，无法执行Device ID读取。</p>
</blockquote>
<ol start="5">
<li><p> 主站发送保留设备ID的 I^2^C 总线地址，后面的R/W位设置为 <code>1</code>（读）：<code>1111 1001</code>。</p>
</li>
<li><p> 可以进行设备ID读取，从12个制造商位开始（第一个字节+第二个字节的4个MSB），然后是9个部件识别位（第二个字节的4个LSB+第三个字节的5个MSB），然后是三个芯片修订位（第三个字节的3个LSB）。</p>
</li>
<li><p>主站通过NACKing最后一个字节来结束读取序列，从而重置从属设备的状态机，允许主站发送 STOP 条件。</p>
<blockquote>
<p>备注：设备ID的读取可以随时通过发送NACK来停止。</p>
</blockquote>
</li>
</ol>
<p>如果主站在第三个字节之后继续ACK，从站就会滚回第一个字节，并继续发送设备ID序列，直到检测到 NACK。</p>
<h1 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h1><p>标准：</p>
<h2 id="术语-1"><a href="#术语-1" class="headerlink" title="术语"></a>术语</h2><h2 id="SPI和I-2-C的对比"><a href="#SPI和I-2-C的对比" class="headerlink" title="SPI和I^2^C的对比"></a>SPI和I^2^C的对比</h2><table>
<thead>
<tr>
<th></th>
<th>SPI</th>
<th>I^2^C</th>
</tr>
</thead>
<tbody><tr>
<td>通信模式</td>
<td>全双工<br><em>（是指单主从设备之间的全双工，从设备之间无法进行通信）</em></td>
<td>半双工<br><em>（任意主从设备可以分时复用同一条通信线路）</em></td>
</tr>
<tr>
<td>主从模式</td>
<td>一主多从</td>
<td>多主多从</td>
</tr>
<tr>
<td>引脚占用</td>
<td>从设备越多，对主机占用的引脚较多<br>主设备占用引脚：3+n<br>从设备占用引脚：4<br><em>（n为从设备数）</em></td>
<td>主从设备均占用：2</td>
</tr>
<tr>
<td>应答响应</td>
<td>无</td>
<td>有</td>
</tr>
<tr>
<td>传输速率</td>
<td>最高：</td>
<td>最高：3.4Mbps</td>
</tr>
<tr>
<td>从机选择</td>
<td>通过 <strong>CS(SS)选择引脚</strong> 来选择</td>
<td>通过 <strong>器件地址</strong> 来选择</td>
</tr>
<tr>
<td>数据采样</td>
<td>在SCLK边沿采样</td>
<td>在SCL高电平采样</td>
</tr>
<tr>
<td>通信距离</td>
<td>短</td>
<td>短</td>
</tr>
</tbody></table>
<h1 id="UART"><a href="#UART" class="headerlink" title="UART"></a>UART</h1><p>标准：</p>
<h1 id="TDM"><a href="#TDM" class="headerlink" title="TDM"></a>TDM</h1><p>标准：</p>
<h1 id="I-2-S"><a href="#I-2-S" class="headerlink" title="I^2^S"></a>I^2^S</h1><p>标准：</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/14/Communication/2021-05-14-I2C%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/14/Communication/2021-05-14-I2C%E9%80%9A%E4%BF%A1/" class="post-title-link" itemprop="url">I2C通信</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-14 10:55:00" itemprop="dateCreated datePublished" datetime="2021-05-14T10:55:00+08:00">2021-05-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-15 21:12:07" itemprop="dateModified" datetime="2021-07-15T21:12:07+08:00">2021-07-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Communication/" itemprop="url" rel="index"><span itemprop="name">Communication</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="I2C基本通信规则"><a href="#I2C基本通信规则" class="headerlink" title="I2C基本通信规则"></a>I2C基本通信规则</h1><p><strong>标准</strong>：<a target="_blank" rel="noopener" href="https://www.nxp.com/docs/en/user-guide/UM10204.pdf">《NXP_UM10204_I2C-bus specification and user manual》</a></p>
<blockquote>
<p><em>I^2^C总线是一个事实上的世界标准，现在已经在50多家公司生产的1000多种不同的IC中实施。</em></p>
<p><em>此外，多功能的I^2^C总线被用于各种控制架构，如系统管理总线（SMBus）、电源管理总线（PMBus）、智能平台管理接口（IPMI）、显示数据通道（DDC）和高级电信计算架构（ATCA）。</em></p>
<p><em>本文件帮助设备和系统设计者了解I^2^C总线的工作原理并实现工作应用。描述了各种操作模式。它包含了对I^2^C<strong>总线数据传输</strong>、握手和总线仲裁方案的全面介绍。详细的章节涵盖了I^2^C总线在每种工作模式下的时序和电气规范。</em></p>
<p><em>I^2^C兼容芯片的设计者应将该文件作为参考，并确保新设备满足该文件中规定的所有限制。包含I^2^C器件的系统的设计者应审查本文件，并参考各个组件的数据表。</em></p>
<p>——翻译自标准文件</p>
</blockquote>
<p>I^2^C(Inter－Integrated Circuit)是一种通用的总线协议。它是由Philips(飞利浦)公司，现NXP(恩智浦)半导体开发的一种简单的双向两线制总线协议标准。</p>
<p>对于硬件设计人员来说，只需要2个管脚，极少的连接线和面积，就可以实现芯片间的通讯，对于软件开发者来说，可以使用同一个I^2^C驱动库，来实现实现不同器件的驱动，大大减少了软件的开发时间。极低的工作电流，降低了系统的功耗，完善的应答机制大大增强通讯的可靠性。</p>
<h2 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h2><img src="https://pic.islet.space/2021/05/image-20210514111033910.png" alt="image-20210514111033910" style="zoom: 67%;" />

<table>
<thead>
<tr>
<th>术语</th>
<th>释义</th>
</tr>
</thead>
<tbody><tr>
<td>总线</td>
<td>传输数据的通路</td>
</tr>
<tr>
<td>传送者</td>
<td>传输数据至总线的设备</td>
</tr>
<tr>
<td>接收者</td>
<td>从总线上接受数据的设备</td>
</tr>
<tr>
<td>主（机）</td>
<td>主动开启传输、生成时钟信号 并 主动结束传输的设备</td>
</tr>
<tr>
<td>从（机）</td>
<td>由主机寻址的设备</td>
</tr>
<tr>
<td>多主（机）</td>
<td>在不损坏数据传输的情况下允许多主机可以试图同时控制总线</td>
</tr>
<tr>
<td>仲裁</td>
<td>确保在有多个主机同时试图控制总线的情况下，只允许一个主机这样做，而且仲裁成功的信息不会被（其他设备）破坏的程序。</td>
</tr>
<tr>
<td>同步</td>
<td>确保两个及以上设备其时钟信号的同步</td>
</tr>
</tbody></table>
<p>以下这个图应该可以较好地解释“多主机”的概念，多个主机可以同时向外发出传输数据的申请，也可以主动结束其数据传输。虽然，I^2^C降低了总线复用的成本，但仍需要“仲裁”机制来解决多个主机之间的无序竞争状态。</p>
<img src="https://pic.islet.space/2021/05/image-20210514112114667.png" alt="image-20210514112114667" style="zoom:67%;" />

<h2 id="硬件要求"><a href="#硬件要求" class="headerlink" title="硬件要求"></a>硬件要求</h2><h3 id="电气特性"><a href="#电气特性" class="headerlink" title="电气特性"></a>电气特性</h3><p>根据要求，I2C的高电平有效值要达到输入参考电压（一般是VDD）的0.7倍以上，低电平有效值需要达到输入参考电压的0.3倍以下。</p>
<p><img src="https://pic.islet.space/2021/06/20210618143441.png" alt="image-20210618143438565"></p>
<h3 id="总线硬件要求"><a href="#总线硬件要求" class="headerlink" title="总线硬件要求"></a>总线硬件要求</h3><p>通过 <strong>串行数据</strong>（SDA，Serial Data）和 <strong>串行时钟</strong>（SCL，Serial Clock）两条线路对设备进行连接。</p>
<p>每个设备都通过自身的通信设备地址进行互相辨别，且每个设备都可以当发送者或接收者，取决于设备自身的功能定义。</p>
<h3 id="标准传输速率"><a href="#标准传输速率" class="headerlink" title="标准传输速率"></a>标准传输速率</h3><p>各模式、速率及其传输方向见下方表格。</p>
<blockquote>
<p>Data on the I^2^C-bus can be transferred at rates of up to 100 kbit/s in the Standard-mode, up to 400 kbit/s in the Fast-mode, up to 1 Mbit/s in Fast-mode Plus, or up to 3.4 Mbit/s in the High-speed mode. </p>
</blockquote>
<table>
<thead>
<tr>
<th>MODE</th>
<th>RATE</th>
<th>TRANSFER DIRECTION</th>
<th>DOWNWARD COMPATIBLE WITH</th>
</tr>
</thead>
<tbody><tr>
<td>STANDARD</td>
<td>100 Kbit/s</td>
<td>bidirectional</td>
<td>/</td>
</tr>
<tr>
<td>FAST</td>
<td>400 Kbit/s</td>
<td>bidirectional</td>
<td>STANDARD</td>
</tr>
<tr>
<td>FAST-PLUS</td>
<td>1 Mbit/s</td>
<td>bidirectional</td>
<td>STANDARD / FAST</td>
</tr>
<tr>
<td>HIGH-SPEED</td>
<td>3.4 Mbit/s</td>
<td>bidirectional</td>
<td>STANDARD / FAST / FAST-PLUS</td>
</tr>
<tr>
<td>ULTRA-FAST</td>
<td>5 Mbit/s</td>
<td>unidirectional</td>
<td>/</td>
</tr>
</tbody></table>
<h2 id="编码协议"><a href="#编码协议" class="headerlink" title="编码协议"></a>编码协议</h2><p>以下协议要求适用于双向通信模式（不包括ULTRA-FAST模式下的单向通信）</p>
<h3 id="逻辑电平规定"><a href="#逻辑电平规定" class="headerlink" title="逻辑电平规定"></a>逻辑电平规定</h3><p>由于I^2^C的接入设备众多（如CMOS、NMOS、Bipolar等），因此逻辑电平0和逻辑电平1（的电压）并不是固定不变的，这取决于VDD的电平。</p>
<p>输入参考电平会被控制在VDD电平的30%<del>70%之间。 V</del>IL~ = 0.3 * V<del>DD</del>；V<del>IH</del> = 0.7 * V<del>DD</del> 。</p>
<p>某些传统设备的输入电平会被固定在1.5V（V<del>IL</del>）和3.0V（V<del>IH</del>），但新设备都要求是 30%V<del>DD</del> 及 70%V<del>DD</del> 。</p>
<p><strong>注意</strong>：V<del>IL</del>、V<del>IH</del>、V<del>OL</del>、V<del>OH</del>都是以参考电压作为基准的，即要达到某个电压的百分之多少时，才能够被认为是 <strong>逻辑电平0</strong> 或 <strong>逻辑电平1</strong> 。例如，可将V<del>IL</del> 视作当V<del>DD</del>下降到只有30%及以下时，为逻辑电平0，30%V<del>DD</del>是其逻辑电平的最高阈值；同理可得 V<del>IH</del> ；超过这个值而未到达70%的中间态则为不确定态。</p>
<blockquote>
<p>Due to the variety of different technology devices (CMOS, NMOS, bipolar) that can be connected to the I^2^C-bus, the levels of the logical ‘0’ (LOW) and ‘1’ (HIGH) are not fixed and depend on the associated level of VDD . Input reference levels are set as 30 % and 70 % of VDD ; VIL is 0.3VDD and VIH is 0.7V DD .</p>
<p>See Figure 38, timing diagram. Some legacy device input levels were fixed at V<del>IL</del> = 1.5 V and V<del>IH</del> = 3.0 V, but all new devices require this 30 %/70 % specification. </p>
</blockquote>
<img src="https://pic.islet.space/2021/05/image-20210514134830615.png" alt="image-20210514134830615" style="zoom: 67%;" />



<h3 id="时序正确性"><a href="#时序正确性" class="headerlink" title="时序正确性"></a>时序正确性</h3><ul>
<li>SDA上的数据必须在SCL高电平期间保持稳定，即不能在SCL高电平期间发生翻转（后见原因），只有在SCL低电平时可以翻转。</li>
<li>时钟脉冲信号生成要先于数据传送。</li>
</ul>
<blockquote>
<p>The data on the SDA line must be stable during the HIGH period of the clock. The HIGH or LOW state of the data line can only change when the clock signal on the SCL line is LOW (see Figure 4). One clock pulse is generated for each data bit transferred.</p>
</blockquote>
<img src="https://pic.islet.space/2021/05/image-20210514141512136.png" alt="image-20210514141512136" style="zoom: 80%;" />



<h3 id="开始及结束标志"><a href="#开始及结束标志" class="headerlink" title="开始及结束标志"></a>开始及结束标志</h3><ul>
<li><p>传输开始时必须以一个 <strong>开始</strong> 信号作为标志，结束时必须以一个 <strong>结束</strong> 信号作为标志。</p>
</li>
<li><p><strong>开始信号 <strong>是以SCL为高电平时的 <strong>SDA电平的由高转低</strong> 作为标志，</strong>结束信号</strong> 是以SCL高电平时的 <strong>SDA电平的由低转高</strong> 作为标志。</p>
</li>
<li><p>开始和结束标志必须由主设备控制。</p>
</li>
</ul>
<blockquote>
<p>All transactions begin with a START (S) and are terminated by a STOP (P) (see Figure 5). A HIGH to LOW transition on the SDA line while SCL is HIGH defines a START condition. A LOW to HIGH transition on the SDA line while SCL is HIGH defines a STOP condition.</p>
</blockquote>
<img src="https://pic.islet.space/2021/05/image-20210514142116674.png" alt="image-20210514142116674" style="zoom: 80%;" />



<h4 id="开始字节"><a href="#开始字节" class="headerlink" title="开始字节"></a>开始字节</h4><img src="https://pic.islet.space/2021/05/image-20210515150526897.png" alt="image-20210515150526897" style="zoom:67%;" />

<blockquote>
<p>dummy acknowledge (HIGH) : 无声确认？？？</p>
</blockquote>
<h3 id="总线状态"><a href="#总线状态" class="headerlink" title="总线状态"></a>总线状态</h3><p>总线具有两种状态，<strong>繁忙</strong>（Busy）和 <strong>空闲</strong>（Free），即 SDA电平 “开始” 后，总线进入繁忙状态， SDA电平 “结束” 后，总线进入空闲状态。</p>
<p><strong>注意</strong>：在总线繁忙期间，发生重复的“开始”状态（而不是“结束”状态），由于“重复开始”和 “开始” 功能相同，为了方便，统称为 “开始”，除非特殊说明为 “重复开始”。</p>
<blockquote>
<p>The bus stays busy if a repeated START (Sr) is generated instead of a STOP condition. In this respect, the START (S) and repeated START (Sr) conditions are functionally identical. For the remainder of this document, therefore, the S symbol is used as a generic term to represent both the START and repeated START conditions, unless Sr is particularly relevant.</p>
</blockquote>
<h3 id="传输比特位"><a href="#传输比特位" class="headerlink" title="传输比特位"></a>传输比特位</h3><ul>
<li>SDA线上的字节传输必须满足8位长度。</li>
<li>每次传输数据的字节数不受限制。</li>
<li>每个字节数后都需要跟一个<strong>确认位（Acknowledge bit）</strong>。</li>
<li>当从机无法完整接收或传输一个完整的数据字节时，例如正在产生内部中断等，除非其完成内部的某些功能，否则该从机将能够一直拉低SCL的电平，<strong>强制让主机一直处于等待状态</strong>。只有当从机准备好接收下一个完整的字节并释放SCL时，数据传输才会继续。</li>
</ul>
<blockquote>
<p>Every byte put on the SDA line must be eight bits long. The number of bytes that can be transmitted per transfer is unrestricted. Each byte must be followed by an Acknowledge bit.</p>
<p><strong>Data is transferred with the Most Significant Bit (MSB) first</strong> (see Figure 6). If a slave cannot receive or transmit another complete byte of data until it has performed some other function, for example servicing an internal interrupt, it can hold the clock line SCL LOW to force the master into a wait state. Data transfer then continues when the slave is ready for another byte of data and releases clock line SCL.</p>
</blockquote>
<img src="https://pic.islet.space/2021/05/image-20210514144620803.png" alt="image-20210514144620803" style="zoom:80%;" />



<h3 id="确认标志"><a href="#确认标志" class="headerlink" title="确认标志"></a>确认标志</h3><ul>
<li>每个字节（8比特）后都跟着一个确认位，即前8位数据，第9位确认。</li>
<li><strong>SCL上的时钟信号由主机产生，包括确认位的的第九个时钟脉冲</strong>。</li>
<li>SDA线并不是由主机一直占有的，每发送完一个完整字节后，主机都会释放SDA线，由从机进行数据确认。</li>
<li>发送者在确认时钟脉冲期间释放SDA线，以便接收者可以将SDA线拉低，并且在该时钟脉冲的高电平期间保持稳定的低电平。</li>
<li>对于设置（set-up）和保持（Hold）的时间，都应该依照表10中只针对各种不同模式的要求进行设置。</li>
<li>如果SDA电平在第九个时钟脉冲时仍保持高电平，则被定义为 “未确认状态”。则此时主机可以发送一个“结束”标志来结束当前连接，或发送一个“开始”标志来开启一次新的传送。</li>
</ul>
<p><mark>即，此时（第9个脉冲时）SDA的控制权已经被mater释放了，但仍为高电平，slave可以在这第9个时钟脉冲高电平期间获得控制权，如果确认收到数据，则将电平拉低，否则不拉低。</mark></p>
<p><img src="https://pic.islet.space/2021/06/image-20210607141115024.png" alt="image-20210607141115024"></p>
<blockquote>
<p>The acknowledge takes place after every byte. The acknowledge bit allows the receiver to signal the transmitter that the byte was successfully received and another byte may be sent. The master generates all clock pulses, including the acknowledge ninth clock pulse.</p>
<p>The Acknowledge signal is defined as follows: the transmitter releases the SDA line during the acknowledge clock pulse so the <em><strong>receiver can pull the SDA line LOW</strong></em> and it remains stable LOW during the HIGH period of this clock pulse (see Figure 4). Set-up and hold times (specified in Section 6) must also be taken into account.</p>
<p>When SDA remains HIGH during this ninth clock pulse, this is defined as the Not Acknowledge signal. The master can then generate either a STOP condition to abort the transfer, or a repeated START condition to start a new transfer. </p>
</blockquote>
<p><strong>以下为五种“未确认/未应答”的可能情况</strong>：There are five conditions that lead to the generation of a NACK:</p>
<ol>
<li><strong>传输地址错误</strong>：No receiver is present on the bus with the transmitted address so there is no device to respond with an acknowledge.</li>
<li><strong>实时处理中</strong>：The receiver is unable to receive or transmit because it is performing some real-time function and is not ready to start communication with the master.</li>
<li><strong>数据/代码未定义</strong>：During the transfer, the receiver <strong>gets data or commands that it does not understand.</strong></li>
<li><strong>正在传输中</strong>：During the transfer, the receiver <strong>cannot receive any more data bytes</strong>.</li>
<li><strong>未收到结束信号（收发身份未转换）</strong>：A master-receiver must signal the end of the transfer to the slave transmitter.</li>
</ol>
<h3 id="时钟同步"><a href="#时钟同步" class="headerlink" title="时钟同步"></a>时钟同步</h3><p>任意几个主机都可能同时发起数据传输请求，此时只有一个主机和一个从机可以掌握总线进行通信，此时需要通过 <strong>时间同步</strong> 和 <strong>仲裁</strong> 完成对总线的调配。</p>
<p><strong>在单机系统（Single Master System）中，不需要时钟同步和仲裁。</strong></p>
<p>时钟同步是通过I^2^C接口与SCL线的有线-AND连接进行的。</p>
<p>这意味着SCL线上的高电平到低电平的转换会导致相关的主站开始对其低电平周期进行计数（如图7的CLK<del>2</del>），一旦一个主站时钟 CLK<del>1</del> 变为低电平，它就会将SCL线电平拉低，并保持在这个状态，直到另一个时钟 CLK<del>2</del> 达到高电平状态。</p>
<p>然而，如果时钟 CLK<del>2</del> 仍在其低电平周期内，CLK<del>1</del> 的低电平到高电平转换可能不会改变SCL线的状态。</p>
<p>因为SCL线被具有最长的低电平周期的主站 CLK<del>2</del> 保持为低电平，而在这段时间内，低电平周期较短的主站 CLK<del>1</del> 进入高电平等待状态。</p>
<blockquote>
<p>Clock synchronization is performed using the wired-AND connection of I^2^C interfaces to the SCL line. This means that a HIGH to LOW transition on the SCL line causes the masters concerned to start counting off their LOW period and, once a master clock has gone LOW, it holds the SCL line in that state until the clock HIGH state is reached (see Figure 7). However, if another clock is still within its LOW period, the LOW to HIGH transition of this clock may not change the state of the SCL line. The SCL line is therefore held LOW by the master with the longest LOW period. Masters with  shorter LOW periods enter a HIGH wait-state during this time.</p>
</blockquote>
<p>当所有相关的主控器都结束了他们的低电平周期，时钟线被释放并变成高电平。</p>
<p>然后，在主站时钟和SCL线的状态之间没有差异，所有的主站开始计算他们的高电平周期。</p>
<p><strong>第一个完成其高电平周期的主站再次将SCL线拉到低电平</strong>。这样，就产生了一个<strong>同步的SCL时钟</strong>，<strong>其低电平周期由具有最长时钟低电平周期的主站决定</strong>，<strong>其高电平周期由具有最短时钟高电平周期的主站决定</strong>。</p>
<img src="https://pic.islet.space/2021/05/image-20210514170202184.png" alt="image-20210514170202184" style="zoom: 67%;" />



<h3 id="竞争仲裁"><a href="#竞争仲裁" class="headerlink" title="竞争仲裁"></a>竞争仲裁</h3><p>仲裁和同步一样，是指只有在系统中使用一个以上的主站时才需要的协议的一个部分。注意，从机不参与仲裁程序。</p>
<p>一个主站只有在总线空闲时才可以开始传输。两个主站可以在START条件的最小保持时间（tHD;STA）内产生一个START条件，从而在总线上产生一个有效的START条件。然后需要进行仲裁，以确定哪个主站将完成其传输。</p>
<p>仲裁是逐位进行的。在每个比特期间，当SCL为高电平时，每个主站检查SDA电平是否与其所发送的内容相符，期间可能需要很多比特，只要传输的内容相同，两个主站实际上可以无误地完成整个信息传输过程。</p>
<p><mark>当一个主站第一次试图发送一个高电平，但检测到SDA电平为低电平时，主站知道它已经失去了仲裁，并关闭其SDA输出驱动器</mark>。在其他主站被仲裁过程中，正在传输其信息的主站将继续其传输，没有信息丢失。</p>
<p>失去仲裁的主站可以产生时钟脉冲，直到它失去仲裁的字节结束，并且必须在总线空闲时重新尝试传输。</p>
<p><mark>如果一个主站也包含了一个从站功能，并且它在寻址阶段失去了仲裁，有可能获胜的主站正试图对它进行寻址。因此，失败的主站必须立即切换到其从站模式。</mark></p>
<p>图8显示了两个主站的仲裁程序。可能涉及更多，这取决于有多少个主站连接到总线上。</p>
<p><mark>当产生DATA1的主站的内部数据电平与SDA线上的实际电平有差异时，DATA1的输出被关闭。这并不影响由获胜主站发起的数据传输。</mark></p>
<img src="https://pic.islet.space/2021/05/image-20210515142633906.png" alt="image-20210515142633906" style="zoom: 67%;" />









<h3 id="通用寻址"><a href="#通用寻址" class="headerlink" title="通用寻址"></a>通用寻址</h3><p><img src="https://pic.islet.space/2021/05/image-20210515172907284.png" alt="image-20210515172907284"></p>
<p><img src="https://pic.islet.space/2021/05/image-20210515172945861.png" alt="image-20210515172945861"></p>
<p><img src="https://pic.islet.space/2021/05/image-20210515172958184.png" alt="image-20210515172958184"></p>
<h3 id="软复位"><a href="#软复位" class="headerlink" title="软复位"></a>软复位</h3><p>在发送general call (0000 0000)后，再发送一个 0000 0110 (06h) ，这样两个具有先后顺序的字节来定义软复位。</p>
<p>首先，这种软复位是可选 ，并不是所有设备都会对软复位指令进行响应。</p>
<p>在收到这2个字节的序列时，所有被设计为响应一般调用地址的设备都会复位，并接收其地址的可编程部分。</p>
<blockquote>
<p>On receiving this 2-byte sequence, all devices designed to respond to the general call address reset and take in the programmable part of their address.</p>
</blockquote>
<p>必须采取预防措施，确保设备在施加电源电压后没有拉低SDA或SCL线，因为这些低电平会阻断总线。</p>
<h3 id="总线复位"><a href="#总线复位" class="headerlink" title="总线复位"></a>总线复位</h3><p>SCK信号一直卡在低电平的事件较少发生。</p>
<ul>
<li>如果I^2^C总线设备拥有硬件复位输入，则可以通过优先程序启用硬件中断复位来重置总线。</li>
<li>如果没有硬件复位输入，则通过给设备循环供电，激活强制性的内部开机复位（POR）电路。</li>
</ul>
<p>SDA信号如果一直卡在低电平。</p>
<ul>
<li><p>则主机应该发送九次SCL时钟脉冲，此时令SDA保持低电平的设备在收到九次脉冲后应主动释放总线。</p>
</li>
<li><p>如果九次脉冲没有用，则启用硬件中断复位或循环供电来清除总线。</p>
</li>
</ul>
<h3 id="设备ID"><a href="#设备ID" class="headerlink" title="设备ID"></a>设备ID</h3><p>可选的3字节只读设备ID编码（an optional 3-byte read-only ）：</p>
<ul>
<li>12位是设备制造商编号，具有独一无二性</li>
<li>9位零件ID，由设备制造商写入</li>
<li>3位模具/晶元版本，由设备制造商写入</li>
</ul>
<img src="https://pic.islet.space/2021/05/image-20210515152141963.png" alt="image-20210515152141963" style="zoom:67%;" />

<ol>
<li><p>启动条件</p>
</li>
<li><p> 主站发送保留设备ID的 I^2^C 总线地址，后面的R/W位设置为<code>0</code>（写）：<code>1111 1000</code>。</p>
</li>
<li><p> 主站发送从属地址。LSB是一个 “不关心”的值，只有一个设备必须确认这个字节（拥有I^2^C总线从属地址的设备）。</p>
</li>
<li><p> 主站发送一个 Re-START 条件。</p>
</li>
</ol>
<blockquote>
<p>备注：在 STOP 条件之后，再加上一个 START 条件，就会重置从属状态机，无法进行设备ID读取。另外，在 STOP 条件或 Re-START 条件之后，对另一个从属设备的访问也会重置从属状态机，无法执行Device ID读取。</p>
</blockquote>
<ol start="5">
<li><p> 主站发送保留设备ID的 I^2^C 总线地址，后面的R/W位设置为 <code>1</code>（读）：<code>1111 1001</code>。</p>
</li>
<li><p> 可以进行设备ID读取，从12个制造商位开始（第一个字节+第二个字节的4个MSB），然后是9个部件识别位（第二个字节的4个LSB+第三个字节的5个MSB），然后是三个芯片修订位（第三个字节的3个LSB）。</p>
</li>
<li><p>主站通过NACKing最后一个字节来结束读取序列，从而重置从属设备的状态机，允许主站发送 STOP 条件。</p>
<blockquote>
<p>备注：设备ID的读取可以随时通过发送NACK来停止。</p>
</blockquote>
</li>
</ol>
<p>如果主站在第三个字节之后继续ACK，从站就会滚回第一个字节，并继续发送设备ID序列，直到检测到 NACK。</p>
<h1 id="ADI-Codec-I2C开发"><a href="#ADI-Codec-I2C开发" class="headerlink" title="ADI-Codec I2C开发"></a>ADI-Codec I2C开发</h1><p>ADI</p>
<h2 id="物理接口"><a href="#物理接口" class="headerlink" title="物理接口"></a>物理接口</h2><p>存在由ADI官方提供的评估板（和MediaWorks的板） 和 开发第一板（量产板）之间的引脚定义差别，一开始使用的是评估板的DPI 11 和 12引脚，即 <strong>DPI_P11</strong> 为 <em><strong>SDA</strong></em>，<strong>DPI_P12</strong> 为 <em><strong>SCLK</strong></em>。后来发现作为时钟引脚的DPI无法被控制，转而使用 DPI 11 和 13。即 <strong>DPI_P11</strong> 为 <em><strong>SDA</strong></em>，<strong>DPI_P13</strong> 为 <em><strong>SCLK</strong></em>。</p>
 <img src="https://pic.islet.space/2021/05/20210527144920.png" alt="image-20210524112141809" style="zoom:67%;" />



<p><img src="https://pic.islet.space/2021/06/20210621154130.png" alt="image-20210615083241938"></p>
<p>MediaWorks核心板J3引脚排示意图</p>
<p>以下描述均以评估板为例，DIY板不一定适用。</p>
<h2 id="插口（Jumper）定义"><a href="#插口（Jumper）定义" class="headerlink" title="插口（Jumper）定义"></a>插口（Jumper）定义</h2><img src="https://pic.islet.space/2021/04/image-20210427165847934.png" alt="image-20210427165847934" style="zoom: 67%;" />



<h2 id="时钟及PLL"><a href="#时钟及PLL" class="headerlink" title="时钟及PLL"></a>时钟及PLL</h2><ol>
<li>1772的工作频率为12.288兆赫，而如果过要设置PLL，<strong>PLL输出一定是24.576兆赫。</strong></li>
<li>通过 <code>MCLKIN</code> 端为codec提供核心时钟信号，可接入8至27兆赫信号。</li>
<li>通过对 <code>0x0000</code> 到 <code>0x0005</code> 的寄存器进行写入修改PLL。</li>
<li>PLL模式要被设置为分数或整数，则取决于MCLK的输入频率。</li>
<li>在时钟信号达到PLL前，时钟信号会经过整数时间分频器以确保时钟频率符合要求；可以通过设置 0x0005 的bit[2:1]来设置其分频率。</li>
<li>要使用PLL时，<strong>首先要明确PLL输出频率是多少</strong>，当PLL信号与时钟信号是整数倍关系时才需要使用整数分频器。</li>
</ol>
<p><img src="https://pic.islet.space/2021/05/image-20210513093158863.png" alt="image-20210513093158863"></p>
<p>以下列举了整数型及分数型分频器的参数设置：</p>
<img src="https://pic.islet.space/2021/05/image-20210513093047973.png" alt="image-20210513093047973" style="zoom:67%;" />



<h3 id="评估板电路图"><a href="#评估板电路图" class="headerlink" title="评估板电路图"></a>评估板电路图</h3><img src="https://pic.islet.space/2021/05/image-20210513092007130.png" alt="image-20210513092007130" style="zoom:67%;" />





<h2 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h2><h3 id="评估板电路图-1"><a href="#评估板电路图-1" class="headerlink" title="评估板电路图"></a>评估板电路图</h3><img src="https://pic.islet.space/2021/05/image-20210513090414605.png" alt="image-20210513090414605" style="zoom: 67%;" />

<h3 id="第0及第1通道"><a href="#第0及第1通道" class="headerlink" title="第0及第1通道"></a>第0及第1通道</h3><p>以下为codec芯片对引脚的定义，在提供一个接地端，构成TRS是完全没有问题，但是codec的定义和其评估板的外围电路设计有所区别。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210513083636462.png" alt="image-20210513083636462"></p>
<p>正常3.5mm音频接口为TRS接口，其中T虽然为VCC（通常是），R作为音频信号输入，而S为接地端，且T和R可共同作为左右声道分别进行输入。（也有T和S定义相反的设计）</p>
<p>但是按上述电路进行接线时，相当于TS接口（单声道）接线模式，却又不完全相同：</p>
<ul>
<li>使用 MICBIAS<del>x</del> 对14接口进行供电，此时Tip端是VCC。</li>
<li>Ring端接13接口，充当Sleeve端（而实际上的Sleeve端因已经接地，可以不进行连接）。</li>
<li>由Ring(AIN1REF)和Tip(AIN1)共同构成了TS单声道接线模式。</li>
</ul>
<h3 id="第2及第3通道"><a href="#第2及第3通道" class="headerlink" title="第2及第3通道"></a>第2及第3通道</h3><ul>
<li>2/3输入通道是复用立体声通道，即1通道和0通道都可以单独接入音源，在物理音频接口上独立，但第2/3通道是在一起的，共用一个物理通道。UG第7页中也有提到。</li>
</ul>
<img src="https://pic.islet.space/2021/04/image-20210427104818097.png" alt="image-20210427104818097" style="zoom:50%;" />



<img src="https://pic.islet.space/2021/04/image-20210427105655639.png" alt="image-20210427105655639" style="zoom:67%;" />

<ul>
<li>有四个单端输入通道可以设置为麦克风信号或线路信号，一个双立体声数字输入信号通道和也可被用于单端输出的两个差分(differential)输出。</li>
</ul>
<h2 id="I2C通信"><a href="#I2C通信" class="headerlink" title="I2C通信"></a>I2C通信</h2><h3 id="时序"><a href="#时序" class="headerlink" title="时序"></a>时序</h3><p>图85展示了 <strong>单字主写模式</strong> 的时序。每9个时钟脉冲，1772都会拉低一次SDA的电平以表示确认收到。</p>
<p>图86展示了 多字主写模式 的时序。此图展示了2个字节大小数据（例如程序）的写入过程。<mark>1772会在每两个字节后增加一次子地址寄存器，因为被使用的子地址对应着 2字节 长度的寄存器或内存区域</mark>。</p>
<p>图87展示了 单字主写模式后转变为 单字主读模式 的时序。1772作为从机接受数据后发送确认标志，主机立即发起重复开始的 单字主读模式，由从机发送至主机。</p>
<p>图88展示了 多字主读模式 的时序，展示了读取目标字节为2bytes的示例。*<u>此处上述黄底字重复</u>*。其他地址范围可能有不同的字长，从一个到四个字节不等。ADAU1772总是对子地址进行解码，并设置自动递增电路，使地址在适当的字节数后递增。</p>
<img src="https://pic.islet.space/2021/05/image-20210518105918652.png" alt="image-20210518105918652" style="zoom: 67%;" />

<blockquote>
<p>S = 开始 标志</p>
<p>P = 停止 标志</p>
<p>AM = 主机确认标志</p>
<p>AS = 从机确认标志</p>
</blockquote>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><h4 id="USBi接口"><a href="#USBi接口" class="headerlink" title="USBi接口"></a>USBi接口</h4><p>​    《SigmaStudio_USBi_to_EZ-Board_Adapter_Schematic-Rel_0.1.pdf》中对接口的定义，总共需要4个引脚，分别是1、3、4、10，对应着 SCL / SDA / VCC / GND；</p>
<img src="https://pic.islet.space/2021/05/image-20210518112823329.png" alt="image-20210518112823329" style="zoom:67%;" />

<h4 id="1772接口"><a href="#1772接口" class="headerlink" title="1772接口"></a>1772接口</h4><p>需要用到的接口是 <code>SCL/SCLK</code> 和 <code>SDA/MISO</code> 。</p>
<p><img src="https://pic.islet.space/2021/06/20210601105623.png" alt="image-20210518192233133"></p>
<p>ADDR0 和 ADDR1 分别对应的是控制接口（CONTROL PORT）上的 <em><strong>CLATCH</strong></em> 和 <em><strong>CDATA</strong></em> 针脚。</p>
<p><img src="https://pic.islet.space/2021/06/20210607150001.png" alt="image-20210607145600052"></p>
<img src="https://pic.islet.space/2021/05/image-20210518112823329.png" alt="image-20210518112823329" style="zoom:67%;" />

<table>
<thead>
<tr>
<th>BIT_6</th>
<th>BIT_5</th>
<th>BIT_4</th>
<th>BIT_3</th>
<th>BIT_2</th>
<th>BIT_1 / ADDR1 / CDATA</th>
<th>BIT_0 / ADDR0 / CLATCH</th>
<th>ADDRESS</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0x3C</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0x3D</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0x3E</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0x3F</td>
</tr>
</tbody></table>
<h4 id="21479接口"><a href="#21479接口" class="headerlink" title="21479接口"></a>21479接口</h4><p>《ADSP-21479 EZ-Board Evaluation System Manual》，需要用到的接口是 <code>SPI_CLK(DPI_P3)</code> 和 <code>SPI_MISO(DPI_P2)</code> 。</p>
<img src="https://pic.islet.space/2021/05/image-20210518113240492.png" alt="image-20210518113240492" style="zoom:67%;" />

<p>对应评估板上的针脚接口如下图示 24（DPI_P3） 和 27（DPI_P2） 接口。</p>
<p><img src="https://pic.islet.space/2021/05/20210519114409.png" alt="image-20210519114333234"></p>
<h3 id="设备地址"><a href="#设备地址" class="headerlink" title="设备地址"></a>设备地址</h3><p>主机每次发送8位数据，其中最低的一位由主机发送标识读/写位。逻辑电平1是读，逻辑电平0是写。</p>
<p>通过I2C方式进行连接的从机，其设备地址是7位数（1-7，对应表21是<code>bit0-bit6</code>），表21提供了1772的设备地址，<strong>ADDR1</strong> 和 <strong>ADDR0</strong> 位置可以通过接入pin的方式自由设置，即输入引脚的电平不同，每个1772都能够拥有4个独特的地址。此类方式允许多块1772接入同一I2C总线。</p>
<ul>
<li>即，默认情况下从机地址为 <code>0x3C</code> ，可以设置成其他：<code>0x3D</code> , <code>0x3E</code>,  <code>0x3F</code>。</li>
<li>每个SDA和SCL线都应该接入一个2.0KΩ的升压电阻，但不应该高过IOVDD。</li>
</ul>
<p><img src="https://pic.islet.space/2021/06/20210601105537.png" alt="image-20210519093557617"></p>
<img src="https://pic.islet.space/2021/06/20210601105628.png" alt="image-20210519094454381" style="zoom: 67%;" />





<h2 id="相关问答"><a href="#相关问答" class="headerlink" title="相关问答"></a>相关问答</h2><p><strong>Q</strong>: what is the macro SIGMA_WRITE_DELAY supposed to do? Is it a simple  delay? Why are there parameters regarding the device I2C address, data  and length?<br><strong>A</strong>: This macro is used for applications that need to pause the data writes for a specific purpose. For example, if you <em><strong>need time  for the PLL to be set before starting to write to the rest of the  registers</strong></em>. It could be used as a simple delay, you’ll need to specify  the device address always because some applications can require more  than one DSP; the length is just the address byte length (could be 1 or 2 byte length) and data is the value in hex that represents the total  time in milliseconds (that is up to the micro controller clock speed).  The reason length is used, is that some DSPs work with one and some  other require two address bytes.</p>
<p><code>&lt;SigmaStudioFW.h&gt;</code> contains a lot of macros to be defined. What I found by examinating all the code is that what macros need to be defined depend  on what you want to perform with your microcontroller.</p>
<p>If you only need to load a DSP program with a call to default_download(), well, you only need (at least for the ADAU1761)</p>
<p>to implement the two macros:</p>
<ul>
<li><p>SIGMA_WRITE_REGISTER_BLOCK</p>
</li>
<li><p>SIGMA_WRITE_DELAY</p>
</li>
</ul>
<p>The first one is the basis of all the loading of data into <em><strong>program  ram</strong></em>, <em><strong>parameter ram</strong></em>, and <em><strong>registers</strong></em>. The second one is only a delay (to be exact it serves to wait for the PLL to lock, in any case <em><strong>most of the times it can be implemented as a simple delay</strong></em>).</p>
<p>If you want to use sequences, that is to implement some control of  the DSP running with your microcontroller, you will probably need to  implement the other macros. In particular if you will control volume  sliders you will need to implement the conversion macros for integer or  float to the internal 5.23 representation. You can search elsewhere on  the forum, I saw some of this code.</p>
<h1 id="开发代码"><a href="#开发代码" class="headerlink" title="开发代码"></a>开发代码</h1><p>ADI和Codec之间的I2C通信可以通过两种方式进行，第一种是操作21478上面的TWI寄存器，需要查看《HWR》以获取更多信息。第二种是学会控制引脚高低电平，通过高低电平模拟寄存器操控来读取和写入I2C设备。</p>
<p>在开发过程中，先使用的第一种方式对TWI寄存器进行操控，但发现21479中有某个寄存器无法写入，故放弃。下面提供第二种方式中需要用到的三个文件，分别是 <code>TWI.h</code> 、 <code>TWI.c</code>  、<code>SigmaStudioFW.h</code> 。经调试，以下代码可以正常收发数据，实现对从设备的读/写。</p>
<h2 id="TWI-c"><a href="#TWI-c" class="headerlink" title="TWI.c"></a>TWI.c</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * TWI.C</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Created on: 2021年6月16日</span></span><br><span class="line"><span class="comment"> *      Author: 431240</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&quot;TWI.H&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//宏定义</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HWDELAY &#123;HWDelay(MINDT);&#125;  <span class="comment">//延时函数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MTWACK &#123;TWIMWaitAck();&#125;       <span class="comment">//Master Transmitter Wait Ack</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// 全局变量声明</span></span><br><span class="line">DADDR tempDevAddr = <span class="number">0x00</span>;  <span class="comment">//临时设备地址存储比对变量，及其初始化</span></span><br><span class="line">RADDR tempRegAddr = <span class="number">0x00</span>;  <span class="comment">//临时寄存器地址存储对比变量，及其初始化</span></span><br><span class="line">TWIDATA bit = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> TWIDATA dataRead = <span class="number">0</span>;  <span class="comment">//用于观察数据写入后再读取的状态</span></span><br><span class="line"><span class="comment">//static TWIDATA addrAckRead = 0;  //调试观察用</span></span><br><span class="line"><span class="comment">//static TWIDATA regAckRead = 0;  //调试观察用</span></span><br><span class="line"><span class="comment">//static TWIDATA dataAckRead = 0;  //调试观察用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> DADDR targetAddr = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// 函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWITimerIsr</span><span class="params">(<span class="keyword">int</span> delayTime)</span></span>&#123;  <span class="comment">//用于产生中断高/低电平延时的定时器中断（句柄）</span></span><br><span class="line"> <span class="comment">//需要自定义，涉及到定时器调用相关函数，请自行查阅手册</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">HWDelay</span><span class="params">(<span class="keyword">float</span> hwDelayTime)</span></span>&#123;  <span class="comment">// 定义硬件延时（单位微秒）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HWDELAY_CORETIMER</span></span><br><span class="line">	timer_set(<span class="number">6400</span>*hwDelayTime, <span class="number">6400</span>*hwDelayTime);</span><br><span class="line">	timer_on();</span><br><span class="line">	timer_off();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HWDELAY_SYSWAITNOP</span></span><br><span class="line">	SysWaitNOP(HW_SYSWAITNOP_TIME);  <span class="comment">//此处使用循环函数进行延时</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIInit</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//初始化函数</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> EVA_21479</span></span><br><span class="line">	SRU(FLAG13_O,DPI_PB13_I);</span><br><span class="line">	SRU(FLAG11_O,DPI_PB11_I);</span><br><span class="line"></span><br><span class="line">	SRU(HIGH,DPI_PBEN13_I);</span><br><span class="line">	SRU(HIGH,DPI_PBEN11_I);</span><br><span class="line"></span><br><span class="line">	sysreg_bit_set( sysreg_FLAGS, (FLG11O|FLG13O) );</span><br><span class="line">	sysreg_bit_clr( sysreg_FLAGS, (FLG11|FLG13) );</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	SRU(FLAG8_O,DPI_PB08_I);</span><br><span class="line">	SRU(FLAG7_O,DPI_PB07_I);</span><br><span class="line"></span><br><span class="line">	SRU(HIGH,DPI_PBEN08_I);</span><br><span class="line">	SRU(HIGH,DPI_PBEN07_I);</span><br><span class="line"></span><br><span class="line">	sysreg_bit_set( sysreg_FLAGS, (FLG7O|FLG8O) );</span><br><span class="line">	sysreg_bit_clr( sysreg_FLAGS, (FLG7|FLG8) );</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	SDA_OUT;</span><br><span class="line">	SCL_OUT;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">TWIStart</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//启动函数</span></span><br><span class="line">	SDA_OUT;  <span class="comment">//设置为数据输出方向</span></span><br><span class="line"></span><br><span class="line">	S_SDA;</span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIReStart</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//重启动函数</span></span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	C_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SDA;</span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIStop</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//停止</span></span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	C_SCL;  <span class="comment">//modified by liewzheng</span></span><br><span class="line">	C_SDA;  <span class="comment">//在时钟信号拉高之前先拉低数据信号</span></span><br><span class="line">	HWDELAY;  <span class="comment">//modified by liewzheng</span></span><br><span class="line"></span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SDA;  <span class="comment">//在时钟信号高电平时拉高数据信号</span></span><br><span class="line">	HWDELAY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">SendWithoutAck</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//发送无需确认</span></span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	C_SCL;</span><br><span class="line"></span><br><span class="line">	SDA_IN;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWIMWaitAck</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//等待从机确认并读取确认信号</span></span><br><span class="line">	C_SCL;</span><br><span class="line">	SDA_IN;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SCL;</span><br><span class="line">	<span class="keyword">if</span>(!READ_SDA)&#123;</span><br><span class="line">		HWDELAY;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		HWDELAY;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWISendByte</span><span class="params">(TWIDATA SentByte)</span></span>&#123;  <span class="comment">//发送一个字节</span></span><br><span class="line">	TWIDATA bit_count = <span class="number">8</span>;</span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(bit_count--)&#123;</span><br><span class="line">		<span class="keyword">if</span>(SentByte &amp; <span class="number">0x80</span>)&#123;</span><br><span class="line">			C_SCL;  <span class="comment">//先拉低SCL</span></span><br><span class="line">			S_SDA;  <span class="comment">//1则置高</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			C_SCL;  <span class="comment">//先拉低SCL</span></span><br><span class="line">			C_SDA;  <span class="comment">//0则置低</span></span><br><span class="line">		&#125;</span><br><span class="line">		SentByte &lt;&lt;= <span class="number">1</span>;  <span class="comment">//前移一位</span></span><br><span class="line">		HWDELAY;</span><br><span class="line"></span><br><span class="line">		S_SCL;</span><br><span class="line">		HWDELAY;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIWriteByte</span><span class="params">(DADDR DevAddr, RADDR RegAddr, TWIDATA *Data)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(TWIStart() != <span class="number">0</span>)&#123;</span><br><span class="line">			TWISendByte(DevAddr);</span><br><span class="line">			MTWACK;</span><br><span class="line"><span class="comment">//			addrAckRead = TWIMWaitAck();  //测试时使用</span></span><br><span class="line"></span><br><span class="line">			TWISendByte(RegAddr&gt;&gt;<span class="number">8</span>);  <span class="comment">//采用16bit寻址空间，先发送高8位地址，在发送低8位地址</span></span><br><span class="line">			MTWACK;</span><br><span class="line"><span class="comment">//			regAckRead = TWIMWaitAck();</span></span><br><span class="line"></span><br><span class="line">			TWISendByte(RegAddr);</span><br><span class="line">			MTWACK;</span><br><span class="line"><span class="comment">//			regAckRead = TWIMWaitAck();</span></span><br><span class="line"></span><br><span class="line">			TWISendByte(*(Data+<span class="number">0</span>));</span><br><span class="line">			MTWACK;</span><br><span class="line"><span class="comment">//			dataAckRead = TWIMWaitAck();</span></span><br><span class="line">		&#125;</span><br><span class="line">		TWIStop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIWriteByteContinuly</span><span class="params">(DADDR DevAddr, RADDR RegAddr, <span class="keyword">int</span> length, TWIDATA *Data)</span></span>&#123;  <span class="comment">//连续发送数据，相同设备无暂停</span></span><br><span class="line">		TWIStart();</span><br><span class="line"></span><br><span class="line">		TWISendByte(DevAddr);</span><br><span class="line">		MTWACK;</span><br><span class="line"></span><br><span class="line">		TWISendByte(RegAddr&gt;&gt;<span class="number">8</span>);  <span class="comment">//采用16bit寻址空间，先发送高8位地址，在发送低8位地址</span></span><br><span class="line">		MTWACK;</span><br><span class="line"></span><br><span class="line">		TWISendByte(RegAddr);</span><br><span class="line">		MTWACK;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;length; i++)&#123;</span><br><span class="line">			TWISendByte(*(Data+i));</span><br><span class="line">			MTWACK;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		TWIStop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> DADDR <span class="title">TWIDAddrTest</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">// 设备地址测试验证</span></span><br><span class="line">	DADDR MAXADDR = <span class="number">0x7F</span>;  <span class="comment">//设置最大地址为0x7F，此处仅测试7bit设备地址，10bit不测试</span></span><br><span class="line">	DADDR tempAddress = <span class="number">0x00</span>;  <span class="comment">//设置设备最小值</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(; tempAddress &lt;= MAXADDR; tempAddress++)  <span class="comment">//设置for循环</span></span><br><span class="line">	&#123;</span><br><span class="line">		TWISendByte((TWIDATA) tempAddress);<span class="comment">//发送设备地址</span></span><br><span class="line">		<span class="keyword">if</span>(TWIMWaitAck()) <span class="keyword">return</span> tempAddress;  <span class="comment">//等待应答，如果应答，则返回正确的设备地址</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0xFF</span>;  <span class="comment">//否则（运行结束时）返回0xFF。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWISCL</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//Only used in Test mode</span></span><br><span class="line">	C_SCL;</span><br><span class="line">	S_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line">	S_SCL;</span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// 以下函数未使用。</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">MRSendAck</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//Only in Master-receiver mode, 发送确认信号给slave，仅在主-收模式时使用</span></span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	C_SCL;</span><br><span class="line"></span><br><span class="line">	SDA_IN;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWI_read_byte</span><span class="params">(DADDR DevAddr, RADDR RegAddr)</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> TWIDATA RetVal = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	TWIStart();</span><br><span class="line"></span><br><span class="line">	TWISendByte( DevAddr );  <span class="comment">//发送设备地址和W标志位，等待确认，据Figure87</span></span><br><span class="line">	MTWACK;</span><br><span class="line"></span><br><span class="line">	TWISendByte(RegAddr&gt;&gt;<span class="number">8</span>);  <span class="comment">//发送MSB寄存器地址</span></span><br><span class="line">	MTWACK;</span><br><span class="line">	TWISendByte(RegAddr);  <span class="comment">//放LSB寄存器地址</span></span><br><span class="line">	MTWACK;</span><br><span class="line"></span><br><span class="line">	TWIReStart();  <span class="comment">//重启动并发送设备地址</span></span><br><span class="line"></span><br><span class="line">	TWISendByte( DevAddr+<span class="number">1</span> );  <span class="comment">//发送设备地址和R标志位，等待确认</span></span><br><span class="line">	MTWACK;</span><br><span class="line"></span><br><span class="line">	RetVal = TWIReceiveByte();</span><br><span class="line">	SendWithoutAck();</span><br><span class="line"></span><br><span class="line">	TWIStop();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> RetVal;  <span class="comment">//返回目标寄存器的值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWI_write_2_byte</span><span class="params">(DADDR DevAddr, RADDR RegAddr, TWIDATA Data1, TWIDATA Data2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (TWIStart() != <span class="number">0</span>)&#123;</span><br><span class="line">		TWISendByte(DevAddr); <span class="comment">//1、发送设备地址</span></span><br><span class="line">		MTWACK;</span><br><span class="line">		TWISendByte(RegAddr); <span class="comment">//2、发送寄存器地址</span></span><br><span class="line">		MTWACK;</span><br><span class="line">		TWISendByte(Data1); <span class="comment">//3、发送寄存器数据 for PORT 0</span></span><br><span class="line">		MTWACK;</span><br><span class="line">		TWISendByte(Data2); <span class="comment">//4、发送下一个寄存器数据 for PORT 1</span></span><br><span class="line">		MTWACK</span><br><span class="line">	&#125;</span><br><span class="line">	TWIStop();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWIReceiveByte</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//作为主机，读取从机字节</span></span><br><span class="line">	TWIDATA Byte_count = <span class="number">8</span>;</span><br><span class="line">	TWIDATA RetVal = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	C_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	SDA_IN;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (Byte_count--)&#123;</span><br><span class="line">		S_SCL;</span><br><span class="line">		RetVal &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (READ_SDA)&#123;</span><br><span class="line">			RetVal = RetVal | <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		HWDELAY;</span><br><span class="line">		C_SCL;</span><br><span class="line">		HWDELAY;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> RetVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> DADDR <span class="title">TWIDevAddrTest</span><span class="params">(<span class="keyword">char</span> addressBit)</span></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(addressBit)&#123;</span><br><span class="line">	<span class="keyword">case</span> (<span class="number">7</span>):</span><br><span class="line">			<span class="keyword">for</span>(targetAddr = <span class="number">0x00</span> ; targetAddr &lt; <span class="number">0x7F</span>; targetAddr++)&#123;</span><br><span class="line">				TWIStart();</span><br><span class="line">				TWISendByte(targetAddr&lt;&lt;<span class="number">1</span>);  <span class="comment">//尝试过target和target&lt;&lt;1都不行</span></span><br><span class="line">				<span class="keyword">if</span>(!TWIMWaitAck() ) &#123;</span><br><span class="line">					TWIStop();</span><br><span class="line">					<span class="keyword">return</span> targetAddr;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> TWIStop();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> (<span class="number">10</span>):  <span class="comment">//此处需要自定义</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> (<span class="number">0x00</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (<span class="number">0x00</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="TWI-h"><a href="#TWI-h" class="headerlink" title="TWI.h"></a>TWI.h</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * TWI.H</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Created on: 2021年6月16日</span></span><br><span class="line"><span class="comment"> *      Author: 431240</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sru21479.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;def21479.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cdef21479.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;21479.h&gt;</span></span></span><br><span class="line"><span class="comment">//#include &quot;Common.h&quot;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ADDS_21479_EzKit.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 调试用宏定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NACK 0   <span class="comment">//不用从机确认</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACK 1  <span class="comment">//需要从机进行确认</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define HWDELAY_CORETIMER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HWDELAY_SYSWAITNOP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define EVA_21479 1  //如果是评估板</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 数据类型定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> DADDR;  <span class="comment">//设备地址数据类型定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> RADDR;  <span class="comment">//寄存器地址数据类型定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> TWIDATA;  <span class="comment">//数据发送的数据类型定义</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//  引脚定义：RST 定义为 DPI_12  ，  SDA 定义为 DPI_11  ，  SCL 定义为 DPI_13</span></span><br><span class="line"><span class="comment">// 在试制板中，两块codec均与21479的第7、8引脚连接，DPI_07定义为SDA, DPI_08定义为SCL</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RST_OUT &#123;SRU(HIGH, DPI_PBEN12_I); &#125;   <span class="comment">//设置复位信号输出方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_RST  &#123;SRU(LOW, DPI_PB12_I); &#125;   <span class="comment">//拉低电平以设置复位信号</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_RST  &#123;SRU(HIGH, DPI_PB12_I);&#125;   <span class="comment">//拉高电平以释放复位信号</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> EVA_21479</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_OUT &#123;SRU(HIGH, DPI_PBEN11_I); &#125;   <span class="comment">//设置SDA输出方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_IN  &#123;SRU(LOW, DPI_PBEN11_I); &#125;   <span class="comment">//设置SDA输入方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_SDA  &#123;SRU(LOW, DPI_PB11_I); &#125;   <span class="comment">//拉低SDA以清除数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_SDA  &#123;SRU(HIGH, DPI_PB11_I); &#125;   <span class="comment">//拉高SDA</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCL_OUT  &#123; SRU(HIGH, DPI_PBEN13_I); &#125;   <span class="comment">//SCL设定为输出方向的定义</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_SCL &#123;SRU(LOW, DPI_PB13_I); &#125;   <span class="comment">//拉低SCL以清除时钟</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_SCL &#123;SRU(HIGH, DPI_PB13_I); &#125;   <span class="comment">//拉高SCL以设置时钟</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SDA (*pDPI_PIN_STAT &amp; DPI_PB11)   <span class="comment">//从SDA读取数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SCL  (*pDPI_PIN_STAT &amp; DPI_PB13)  <span class="comment">//从SCL读取数据</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span>  <span class="comment">//量产版</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_OUT &#123;SRU(HIGH, DPI_PBEN07_I); &#125;   <span class="comment">//设置SDA输出方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_IN  &#123;SRU(LOW, DPI_PBEN07_I); &#125;   <span class="comment">//设置SDA输入方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_SDA  &#123;SRU(LOW, DPI_PB07_I); &#125;   <span class="comment">//拉低SDA以清除数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_SDA  &#123;SRU(HIGH, DPI_PB07_I); &#125;   <span class="comment">//拉高SDA</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCL_OUT  &#123; SRU(HIGH, DPI_PBEN08_I); &#125;   <span class="comment">//SCL设定为输出方向的定义</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_SCL &#123;SRU(LOW, DPI_PB08_I); &#125;   <span class="comment">//拉低SCL以清除时钟</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_SCL &#123;SRU(HIGH, DPI_PB08_I); &#125;   <span class="comment">//拉高SCL以设置时钟</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SDA (*pDPI_PIN_STAT &amp; DPI_PB07)   <span class="comment">//从SDA读取数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SCL  (*pDPI_PIN_STAT &amp; DPI_PB08)  <span class="comment">//从SCL读取数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//提示：靠近功放的codec，其ADDR1为1电平，ADDR0为高电平，其I2C地址是0x3E</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 数据宏定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MINDT 1   <span class="comment">//定义延迟最小时间 Minimal delay time</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HWDELAY_SYSWAITNOP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HW_SYSWAITNOP_TIME 100  <span class="comment">//定义使用SYSWAITNOP的延迟时间，默认90</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 函数声明</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWITimerIsr</span><span class="params">(<span class="keyword">int</span>)</span></span>;  <span class="comment">//用于产生中断高/低电平延时的定时器中断（句柄）</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">HWDelay</span><span class="params">(<span class="keyword">float</span>)</span></span>;  <span class="comment">// 定义硬件延时（单位微秒）</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIInit</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//初始化函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">TWIStart</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//启动函数</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIReStart</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//重启动函数</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIStop</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//停止</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">SendWithoutAck</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//发送无需确认</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWIMWaitAck</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//等待从机确认并读取确认信号</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWISendByte</span><span class="params">(TWIDATA)</span></span>;  <span class="comment">//发送一个字节</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIWriteByte</span><span class="params">(DADDR, RADDR, TWIDATA*)</span></span>;  <span class="comment">//单次发送数据</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIWriteByteContinuly</span><span class="params">(DADDR, RADDR , <span class="keyword">int</span>, TWIDATA *)</span></span>;  <span class="comment">//连续发送数据，相同设备无暂停</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> DADDR <span class="title">TWIDAddrTest</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">// 设备地址测试验证</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWISCL</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//Only used in Test mode</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下函数未使用。</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">MRSendAck</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//Only in Master-receiver mode, 发送确认信号给slave，仅在主-收模式时使用</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWI_read_byte</span><span class="params">(DADDR, RADDR)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWI_write_2_byte</span><span class="params">(DADDR, RADDR, TWIDATA, TWIDATA)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWIReceiveByte</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//作为主机，读取从机字节</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> DADDR <span class="title">TWIDevAddrTest</span><span class="params">(<span class="keyword">char</span> addressBit)</span></span>;  <span class="comment">// 从机地址遍历测试</span></span><br></pre></td></tr></table></figure>



<h2 id="SigmaStudioFW-h"><a href="#SigmaStudioFW-h" class="headerlink" title="SigmaStudioFW.h"></a>SigmaStudioFW.h</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Modified by Liewzheng in June 9th, 2021</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __SIGMASTUDIOFW_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __SIGMASTUDIOFW_H__</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 头文件</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;TWI.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ADDS_21479_EzKit.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 数据类型定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">short</span> ADI_DATA_U16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span>  ADI_REG_TYPE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 宏定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMASTUDIOTYPE_FIXPOINT 	0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMASTUDIOTYPE_INTEGER 	1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置时钟分频，有且仅有一个能被启用</span></span><br><span class="line"><span class="comment">//#define CLK_DIV_1</span></span><br><span class="line"><span class="comment">//#define CLK_DIV_2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CLK_DIV_3</span></span><br><span class="line"><span class="comment">//#define CLK_DIV_4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> testPLL[<span class="number">5</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 宏定义——函数声明</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMA_WRITE_REGISTER( devAddress, address, dataLength, data ) &#123;<span class="comment">/*<span class="doctag">TODO:</span> implement macro or define as function*/</span>&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMA_READ_REGISTER( devAddress, address, length, pData ) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMA_SET_REGSITER_FIELD( regVal, fieldVal, fieldMask, fieldShift )  \</span></span><br><span class="line">		&#123; (regVal) = (((regVal) &amp; (~(fieldMask))) | (((fieldVal) &lt;&lt; (fieldShift)) &amp;&amp; (fieldMask))) &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMA_GET_REGSITER_FIELD( regVal, fieldMask, fieldShift )  \</span></span><br><span class="line">		&#123; ((regVal) &amp; (fieldMask)) &gt;&gt; (fieldShift) &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMASTUDIOTYPE_FIXPOINT_CONVERT( _value ) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMASTUDIOTYPE_INTEGER_CONVERT( _value ) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 函数定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">// modified by liewzheng, in June 15th, 2021</span></span><br><span class="line"><span class="keyword">void</span> SIGMA_WRITE_REGISTER_BLOCK(  <span class="keyword">unsigned</span> <span class="keyword">int</span> devAddress,</span><br><span class="line">									<span class="keyword">unsigned</span> <span class="keyword">int</span> address,</span><br><span class="line">									<span class="keyword">unsigned</span> <span class="keyword">char</span> length,</span><br><span class="line">									ADI_REG_TYPE *pData ) &#123;</span><br><span class="line">	<span class="keyword">if</span>(length == <span class="number">1</span>)&#123;</span><br><span class="line">		TWIWriteByte(devAddress, address, pData);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(length &gt; <span class="number">1</span>)&#123;</span><br><span class="line">				TWIWriteByteContinuly(devAddress, (address), length, pData);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SysWaitNOP(<span class="number">100</span>);   <span class="comment">//可以注释掉</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// modified by liewzheng, in June 15th, 2021</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SIGMA_WRITE_DELAY</span><span class="params">(  <span class="keyword">unsigned</span> <span class="keyword">int</span> devAddress,</span></span></span><br><span class="line"><span class="function"><span class="params">						    <span class="keyword">unsigned</span> <span class="keyword">char</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">						    <span class="keyword">unsigned</span> <span class="keyword">char</span> *pData )</span> </span>&#123;</span><br><span class="line">	SysWaitNOP(<span class="number">10000000</span>);</span><br><span class="line">	SysWaitNOP(<span class="number">10000000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>





<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.nxp.com/docs/en/user-guide/UM10204.pdf">《NXP_UM10204_I2C-bus specification and user manual》</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/13/Linux/Firewalld/2021-05-13-Firewalld%E9%98%B2%E7%81%AB%E5%A2%99%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/13/Linux/Firewalld/2021-05-13-Firewalld%E9%98%B2%E7%81%AB%E5%A2%99%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Firewalld防火墙详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-13 14:10:00" itemprop="dateCreated datePublished" datetime="2021-05-13T14:10:00+08:00">2021-05-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-14 19:47:48" itemprop="dateModified" datetime="2021-05-14T19:47:48+08:00">2021-05-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://blog.51cto.com/andyxu/2137046">blog.51cto.com</a></p>
<p>众所周知，在RHEL7系统中，firewalld防火墙取代了iptables防火墙。我们都知道iptables的防火墙策略是交由内核层面的netfilter网络过滤器来处理的，而firewalld则是交由内核层面的nftables包过滤框架来处理。<br>相较于iptables防火墙而言，firewalld支持动态更新技术并加入了区域（zone）的概念。简单来说，区域就是firewalld预先准备了几套防火墙策略集合（策略模板），用户可以根据生产场景的不同而选择合适的策略集合，从而实现防火墙策略之间的快速切换。</p>
<blockquote>
<p>Firewalld provides a dynamically managed firewall with support for network/firewall zones to define the trust level of network connections or interfaces. It has support for IPv4, IPv6 firewall settings and for ethernet bridges and has <strong>a separation of runtime and permanent configuration options.</strong> It also supports an interface for services or applications to add firewall rules directly.</p>
</blockquote>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h2 id="区域"><a href="#区域" class="headerlink" title="区域"></a>区域</h2><p><strong>表1：firewalld中常用的区域名称及策略规则</strong></p>
<table>
<thead>
<tr>
<th>区域（zone）</th>
<th>默认策略规则</th>
</tr>
</thead>
<tbody><tr>
<td>trusted</td>
<td>允许所有的数据包进出</td>
</tr>
<tr>
<td>home</td>
<td>拒绝进入的流量，除非与出去的流量相关；而如果流量与ssh、mdns、ipp-client、amba-client与dhcpv6-client服务相关，则允许进入</td>
</tr>
<tr>
<td>Internal</td>
<td>等同于home区域</td>
</tr>
<tr>
<td>work</td>
<td>拒绝进入的流量，除非与出去的流量相关；而如果流量与ssh、ipp-client与dhcpv6-client服务相关，则允许进入</td>
</tr>
<tr>
<td>public</td>
<td>拒绝进入的流量，除非与出去的流量相关；而如果流量与ssh、dhcpv6-client服务相关，则允许进入</td>
</tr>
<tr>
<td>external</td>
<td>拒绝进入的流量，除非与出去的流量相关；而如果流量与ssh服务相关，则允许进入</td>
</tr>
<tr>
<td>dmz</td>
<td>拒绝进入的流量，除非与出去的流量相关；而如果流量与ssh服务相关，则允许进入</td>
</tr>
<tr>
<td>block</td>
<td>拒绝进入的流量，除非与出去的流量相关</td>
</tr>
<tr>
<td>drop</td>
<td>拒绝进入的流量，除非与出去的流量相关</td>
</tr>
</tbody></table>
<blockquote>
<p>These are the zones provided by firewalld sorted according to the default trust level of the zones <strong>from untrusted to trusted</strong>:</p>
<p><strong>drop</strong> : Any incoming network packets are dropped, there is no reply. Only outgoing network connections are possible.</p>
<p><strong>block</strong> : Any incoming network connections are rejected with an icmp-host-prohibited message for IPv4 and icmp6-adm-prohibited for IPv6. Only network connections initiated within this system are possible.</p>
<p><strong>public</strong> : For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</p>
<p><strong>external</strong> : For use on external networks with masquerading enabled especially for routers. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</p>
<p><strong>dmz</strong> : For computers in your demilitarized zone that are publicly-accessible with limited access to your internal network. Only selected incoming connections are accepted.</p>
<p><strong>work</strong> : For use in work areas. You mostly trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</p>
<p><strong>home</strong> : For use in home areas. You mostly trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</p>
<p><strong>internal</strong> : For use on internal networks. You mostly trust the other computers on the networks to not harm your computer. Only selected incoming connections are accepted.</p>
<p><strong>trusted</strong> : All network connections are accepted.</p>
</blockquote>
<p><strong>动静态更新技术之间的区别</strong>：iptables每一个更改都需要先清除所有旧有的规则，然后重新加载所有的规则（包括新的和修改后的规则）；<mark>而firewalld任何规则的变更都不需要对整个防火墙规则重新加载</mark>。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>firewalld服务的主配置文件是firewalld.conf，防火墙策略的配置文件是以xml格式为主，存放在以下两个目录里。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/firewalld   # 用户配置文件</span><br><span class="line">/usr/lib/firewalld    #系统配置文件，预定义配置文件</span><br></pre></td></tr></table></figure>


<p>firewalld有基于CLI（命令行界面）和基于GUI（图形用户界面)两种管理方式，即：firewall-cmd（终端管理工具）和firewall-config（图形管理工具）。</p>
<p>firewalld的参数一般都是以“长格式”来提供的，但是在RHEL7系统里支持部分命令的参数补齐，其中就包括firewall-cmd命令，也就是说可以用Tab键来补齐长格式参数，很酷吧。</p>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><p><strong>表2：firewall-cmd命令中使用的参数以及作用</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>–get-default-zone</td>
<td>查访默认的区域名称</td>
</tr>
<tr>
<td>–set-default-zone=&lt;区域名称&gt;</td>
<td>设置默认的区域，使其永久生效</td>
</tr>
<tr>
<td>–get-zones</td>
<td>显示可用的区域</td>
</tr>
<tr>
<td>–get-services</td>
<td>显示预定义的服务</td>
</tr>
<tr>
<td>–get-active-zones</td>
<td>显示当前正在使用的区域、来源地址和网卡名称</td>
</tr>
<tr>
<td>–add-source=</td>
<td>将源自此IP或子网的流量导向指定的区域</td>
</tr>
<tr>
<td>–remove-source=</td>
<td>不再将源自此IP或子网的流量导向这个区域</td>
</tr>
<tr>
<td>–add-interface=&lt;网卡名称&gt;</td>
<td>将源自该网卡的所有流量都导向某个指定区域</td>
</tr>
<tr>
<td>–change-interface=&lt;网卡名称&gt;</td>
<td>将某个网卡与区域进行关联</td>
</tr>
<tr>
<td>–list-all</td>
<td>显示当前区域的网卡配置参数、资源、端口以及服务等信息</td>
</tr>
<tr>
<td>–list-all-zones</td>
<td>显示所有区域的网卡配置参数、资源、端口以及服务等信息</td>
</tr>
<tr>
<td>–add-service=&lt;服务名&gt;</td>
<td>设置默认区域允许该服务的流量</td>
</tr>
<tr>
<td>–add-port=&lt;端口号/协议&gt;</td>
<td>设置默认区域允许该端口的流量</td>
</tr>
<tr>
<td>–remove-service=&lt;服务名&gt;</td>
<td>设置默认区域不再允许该服务的流量</td>
</tr>
<tr>
<td>–remove-port=&lt;端口号/协议&gt;</td>
<td>设置默认区域不再允许该端口的流量</td>
</tr>
<tr>
<td>–reload</td>
<td>让“永久生效”的配置规则立即生效，并覆盖当前的配置规则</td>
</tr>
<tr>
<td>–panic-on</td>
<td>开启应急状况模式</td>
</tr>
<tr>
<td>–panic-off</td>
<td>关闭应急状况模式</td>
</tr>
</tbody></table>
<p>firewalld配置的防火墙策略默认为运行时（Runtime）模式，又称为当前生效模式，而且随着系统的重启会失效。如果想让配置策略一直存在，就需要使用永久（Permanent）模式了，方法就是在firewall-cmd命令后面添加–permanent参数，这样配置的防火墙策略就可以永久生效了。但是，永久生效模式有一个“不近人情”的特点，就是使用它设置的策略只有在系统重启后才会生效。如果想让配置的永久策略立即生效，需要手动执行firewall-cmd –reload命令。</p>
<p><em>注：remove掉ssh服务或者ssh端口，当前远程登陆会话不会断开，退出后就无法远程连接了。</em></p>
<p>firewalld服务启动、重启、停止</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld</span><br><span class="line">systemctl restart firewalld</span><br><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure>



<p>重新加载防火墙配置<br><code>firewall-cmd --reload</code></p>
<p>查看firewalld的运行状态<br><code>firewall-cmd --state</code></p>
<p>查看默认当前使用的区域<br><code>firewall-cmd --get-default-zone</code></p>
<p>查看系统默认活动区域名称、来源地址和关联的网卡<br><code>firewall-cmd --get-active-zones</code></p>
<p><img src="https://pic.islet.space/2021/05/777d5cabb7eb51fbb84c7058129368d9.png" alt="firewalld防火墙详解"></p>
<p>查看所有可用区域<br><code>firewall-cmd --get-zones</code></p>
<p>查看区域的所有设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;internal --list-all   </span><br><span class="line">firewall-cmd --list-all   </span><br></pre></td></tr></table></figure>

<p><img src="https://pic.islet.space/2021/05/4d9b1b3e6c45a33748d4892e6dd2736d.png" alt="firewalld防火墙详解"></p>
<blockquote>
<p>Target：目标<br>icmp-block-inversion：ICMP协议类型黑白名单开关（yes/no）<br>Interfaces：关联的网卡接口<br>sources：来源，可以是IP地址，也可以是mac地址<br>services：允许的服务<br>ports：允许的目标端口，即本地开放的端口<br>protocols：允许通过的协议<br>masquerade：是否允许伪装（yes/no），可改写来源IP地址及mac地址<br>forward-ports：允许转发的端口<br>source-ports：允许的来源端口<br>icmp-blocks：可添加ICMP类型，当icmp-block-inversion为no时，这些ICMP类型被拒绝；当icmp-block-inversion为yes时，这些ICMP类型被允许。<br>rich rules：富规则，即更细致、更详细的防火墙规则策略，它的优先级在所有的防火墙策略中也是最高的。</p>
</blockquote>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>查看所有预设的服务<br><code>firewall-cmd --get-services</code><br>此时将会列出/usr/lib/firewalld/services/目录中所有的服务名称。</p>
<p>查看所有区域的设置<br><code>firewall-cmd --list-all-zones</code></p>
<p>查看指定网卡所在的区域<br><code>firewall-cmd --get-zone-of-interface=ens32</code></p>
<p>把firewalld的当前默认区域设置为drop，此为永久设置<br><code>firewall-cmd --set-default-zone=drop</code></p>
<p>把ens32网卡关联的区域修改为drop</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --zone&#x3D;drop --change-interface&#x3D;ens32   # 永久设置</span><br><span class="line">firewall-cmd --zone&#x3D;drop --change-interface&#x3D;ens32   # 当前生效</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.islet.space/2021/05/aafb80274a54961a3c0c1a50989b7fd3.png" alt="firewalld防火墙详解"></p>
<p>我们后面的设置命令将全部使用运行时模式，即当前生效模式。<br>将来自ens33网卡的流量都作用到默认的drop区域</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;drop -add-interface&#x3D;ens33   # 作用在指定区域</span><br><span class="line">firewall-cmd -add-interface&#x3D;ens33   # 作用在默认区域</span><br><span class="line">firewall-cmd -remove-interface&#x3D;ens33  # 禁止ens33网卡作用在drop区域</span><br></pre></td></tr></table></figure>

<p><em>注：不指定–zone参数的话，将会对默认区域进行设置</em><br>启动关闭firewalld防火墙服务的应急状况模式，远程连接服务器时请慎用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --panic-on  </span><br><span class="line">firewall-cmd --panic-off  </span><br><span class="line">firewall-cmd --query-panic  </span><br></pre></td></tr></table></figure>

<p>设置一个来源地址作用在drop区域上面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;drop --add-source&#x3D;192.168.1.12  # 作用在指定区域</span><br><span class="line">firewall-cmd --add-source&#x3D;192.168.1.12  # 作用在默认区域</span><br><span class="line">firewall-cmd --remove-source&#x3D;192.168.1.12  # 取消源IP为192.168.1.12的包作用在drop区域</span><br></pre></td></tr></table></figure>

<p>说明：凡是IP为192.168.1.12发来包将会使用drop区域设置的规则</p>
<p>对于一个接收到的请求具体使用哪个zone，firewalld是通过三种方式来判断的：</p>
<p>1、source，来源地址<br>2、Interface，接收请求的网卡<br>3、firewalld配置的默认区域（zone）</p>
<p>这三个方式的优先级按顺序依次降低，也就是说如果按照source可以找到就不会再按interface去找，如果前两个都找不到才会使用第三个默认区域。<br>查询drop区域是否允许请求ssh和https服务的流量</p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>在drop区域开放https服务<br><code>firewall-cmd --zone=drop --add-service=https</code></p>
<p>取消开放https服务，即禁止https服务<br><code>firewall-cmd --zone=drop --remove-service=https</code></p>
<p>开放22端口<br><code>firewall-cmd --zone=drop --add-port=22/tcp</code></p>
<p>取消开放22端口<br><code>firewall-cmd --zone=drop --remove-port=22/tcp</code></p>
<p>开放8080和8081端口<br><code>firewall-cmd --zone=drop --add-port=8080-8081/tcp</code></p>
<p><strong>查询drop区域开放了哪些端口</strong><br><code>firewall-cmd --zone=drop --list-ports</code></p>
<p>允许icmp协议流量，即允许ping<br><code>firewall-cmd --zone=drop --add-protocol=icmp</code></p>
<p>取消允许icmp协议的流量，即禁ping<br><code>firewall-cmd --zone=drop --remove-protocol=icmp</code></p>
<p>查询drop区域开放了哪些协议<br><code>firewall-cmd --zone=drop --list-protocols</code></p>
<h3 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h3><p>将原本访问本机888端口的流量转发到本机22端口<br><code>firewall-cmd --zone=drop --add-forward-port=port=888:proto=tcp:toport=22</code></p>
<p>将原本访问本机888端口的流量转发到ip为192.168.2.208的主机的22端口，需要开启masquerade</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;drop --add-masquerade</span><br><span class="line">firewall-cmd --zone&#x3D;drop --add-forward-port&#x3D;port&#x3D;888:proto&#x3D;tcp:toport&#x3D;22:toaddr&#x3D;192.168.2.208</span><br></pre></td></tr></table></figure>

<p>测试端口转发功能是否生效<br>在客户端尝试访问192.168.2.210主机的888端口，连上去后发现实际连接的是192.168.2.208主机，测试OK。</p>
<p><img src="https://pic.islet.space/2021/05/34e156798d037e1dcc1e63d506fd2960.png" alt="firewalld防火墙详解"></p>
<p><img src="https://pic.islet.space/2021/05/fec17bffb6fb66b9c077d844956a7699.png" alt="firewalld防火墙详解"></p>
<h3 id="富规则"><a href="#富规则" class="headerlink" title="富规则"></a>富规则</h3><p>接下来我们来看富规则的设置，即 <em><strong>rich rules</strong></em></p>
<p>允许192.168.2.208主机的所有流量<br><code>firewall-cmd --zone=drop --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.2.208&quot; accept&quot;</code></p>
<p>允许192.168.2.208主机的icmp协议，即允许192.168.2.208主机ping<br><code>firewall-cmd --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.2.208&quot; protocol value=&quot;icmp&quot; accept&quot;</code></p>
<p>取消允许192.168.2.208主机的所有流量<br><code>firewall-cmd --zone=drop --remove-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.2.208&quot; accept&quot;</code></p>
<p>允许192.168.2.208主机访问ssh服务<br><code>firewall-cmd --zone=drop --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.2.208&quot; service name=&quot;ssh&quot; accept&quot;</code></p>
<p>禁止192.168.2.208访问https服务，并返回错误信息<br><code>firewall-cmd --zone=drop --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.2.208&quot; service name=&quot;https&quot; reject&quot;</code><br><em>注：如果是drop的话是直接丢弃，会返回timeout（连接超时）</em></p>
<p>允许192.168.2.0/24网段的主机访问22端口<br><code>firewall-cmd --zone=drop --add-rich-rule=&quot;rule family=&quot;ipv4&quot; source address=&quot;192.168.2.0/24&quot; port protocol=&quot;tcp&quot; port=&quot;22&quot; accept&quot;</code></p>
<p>每分钟允许2个新连接访问ftp服务<br><code>firewall-cmd --add-rich-rule=&quot;rule service name=ftp limit value=2/m accept&quot;</code></p>
<p>允许新的ipv4和ipv6连接ftp，并使用日志和审核，每分钟允许访问一次<br><code>firewall-cmd --add-rich-rule=&quot;rule service name=ftp log limit value=&quot;1/m&quot; audit accept&quot;</code></p>
<p>拒绝来自192.168.2.0/24网段的连接，10秒后自动取消<br><code>firewall-cmd --add-rich-rule=&quot;rule family=ipv4 source address=192.168.2.0/24 reject&quot; --timeout=10</code></p>
<p>允许ipv6地址为2001:db8::/64子网的主机访问dns服务，并且每小时审核一次，300秒后自动取消<br><code>firewall-cmd --add-rich-rule=&quot;rule family=ipv6 source address=&quot;2001:db8::/64&quot; service name=&quot;dns&quot; audit limit value=&quot;1/h&quot; reject&quot; --timeout=300</code></p>
<p>将来自192.168.2.0/24网段访问本机80端口的流量转发到本机的22端口<br><code>firewall-cmd --zone=drop --add-rich-rule=&quot;rule family=ipv4 source address=192.168.2.0/24 forward-port port=80 protocol=tcp to-port=22&quot;</code></p>
<p>将来自192.168.2.0/24网段访问本地80端口的流量转发到192.168.2.208主机的22端口<br><code>firewall-cmd --zone=drop --add-rich-rule=&quot;rule family=ipv4 source address=192.168.2.0/24 forward-port port=80 protocol=tcp to-port=22 to-addr=192.168.2.208&quot;</code></p>
<p>伪装，将来自局域网192.168.2.0/24网段访问外网的流量映射为网络出口公网IP，即修改源IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;drop --add-masquerade</span><br><span class="line">firewall-cmd --zone&#x3D;drop --add-rich-rule&#x3D;&quot;rule family&#x3D;ipv4 source address&#x3D;192.168.2.0&#x2F;24 masquerade&quot;</span><br></pre></td></tr></table></figure>

<p>好了，写的差不多了，工作中基本上够用了</p>
<h2 id="GUI配置"><a href="#GUI配置" class="headerlink" title="GUI配置"></a>GUI配置</h2><p>在RHEL7之前的发行版本默认的防火墙中，几乎没有图形化的防火墙管理工具，但是firewalld却有，firewall-config是firewalld防火墙配置管理工具的GUI（图开用户界面）版本，几乎可以实现所有命令行执行的操作。即使没有扎实的Linux命令基础，也完合可以通过它来妥善配置firewalld防火墙策略。Firewall-config的界面如下图所示，功能具体如下：</p>
<p><img src="https://pic.islet.space/2021/05/cfe328ae0f110db0798a9d5edde8a2ba.png" alt="firewalld防火墙详解"></p>
<p>1、选择运行时（Runtime）模式或永久（Permanent）模式。<br>2、可选的策略集合区域列表。<br>3、常用的系统服务列表。<br>4、当前正在使用的区域。<br>5、管理当前被选中区域中的服务。<br>6、管理当前被选中区域中的端口。<br>7、开启或关闭SNAT（源地址转换协议）技术。<br>8、设置端口转发策略。<br>9、控制请求icmp服务的流量。<br>10、管理防火墙的富规则。<br>11、管理网卡设备。<br>12、被选中区域的服务，若勾选了相应服务前面的复选框，则表示允许与之相关的流量。<br>13、Firewall-config工具的运行状态。</p>
<p>对外开放http服务，如下图</p>
<p><img src="https://pic.islet.space/2021/05/fc3e7d116afe83c1bfe5980bfd928849.png" alt="firewalld防火墙详解"></p>
<p>添加一条防火墙规则，使其放行访问8080-8088端口（TCP协议）的流量，并且永久生效</p>
<p><img src="https://pic.islet.space/2021/05/b9719667bc933bd079c526d733de7646.png" alt="firewalld防火墙详解"></p>
<p>单击Options菜单中的Reload Firewalld选项，让上面配置的永久规则立即生效，这与在命令行中执行–reload参数的效果一样。</p>
<p><img src="https://pic.islet.space/2021/05/8bbca43ed6964afbbeeff8ff711dbcde.png" alt="firewalld防火墙详解"></p>
<p>SNAT技术相信很多人都知道，那现在我们来开启SNAT技术，其实就是命令行下的masquerade。</p>
<p><img src="https://pic.islet.space/2021/05/695086a6a2aaf59d79bfe99bb5a02d85.png" alt="firewalld防火墙详解"></p>
<p>下面我们来配置一个端口转发规则，将888端口的流量转发到其他主机的22端口上。<br><em>注：转发本机端口不需要开启masquerade，转发到别的主机才需要开启masquerade。</em></p>
<p><img src="https://pic.islet.space/2021/05/e66fb33793bf0ab48346c83b6a383d68.png" alt="firewalld防火墙详解"></p>
<p>配置富规则，允许192.168.2.206主机访问本机的1234端口号</p>
<p><img src="https://pic.islet.space/2021/05/5e75f674b7cbf921f7e2c0d3d13384e9.png" alt="firewalld防火墙详解"></p>
<p>最后来看一下区域和网卡的关联，增加网卡的话只需要输入网卡名称即可。</p>
<p><img src="https://pic.islet.space/2021/05/51e73b7f425667cd83cc981c26fea0a2.png" alt="firewalld防火墙详解"></p>
<p>下面是我自己写的一个简单的防火墙初始化脚本，5210是ssh端口号，192.168.2.208是<strong>保垒机</strong>，192.168.2.206是<strong>备用ssh机器</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">\cp -p &#x2F;usr&#x2F;lib&#x2F;firewalld&#x2F;zones&#x2F;drop.xml &#x2F;etc&#x2F;firewalld&#x2F;zones&#x2F;</span><br><span class="line">systemctl start firewalld</span><br><span class="line">firewall-cmd --set-default-zone&#x3D;drop</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;drop --change-interface&#x3D;ens32</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;drop --add-service&#x3D;https</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;drop --add-protocol&#x3D;icmp</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;drop --add-masquerade</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;drop --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.2.208&quot; port protocol&#x3D;&quot;tcp&quot; port&#x3D;&quot;5210&quot; accept&quot;</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;drop --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;192.168.2.206&quot; port protocol&#x3D;&quot;tcp&quot; port&#x3D;&quot;5210&quot; accept&quot;</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;drop --add-rich-rule&#x3D;&quot;rule family&#x3D;&quot;ipv4&quot; source address&#x3D;&quot;116.226.230.115&quot; port protocol&#x3D;&quot;tcp&quot; port&#x3D;&quot;8023&quot; accept&quot;</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>​          </p>
<p>​    </p>
<p><a target="_blank" rel="noopener" href="https://firewalld.org/documentation/howto/enable-and-disable-firewalld.html">firewalld.org</a></p>
<h1 id="Enable-and-Disable-firewalld"><a href="#Enable-and-Disable-firewalld" class="headerlink" title="Enable and Disable firewalld"></a>Enable and Disable firewalld</h1><p>firewalld provides an init script for systems using classic  SysVinit and also a systemd service file. The following documentation is about the systemd service used in Fedora, RHEL and CentOS  distributions.</p>
<p>It is not recommended to use iptables directly while firewalld is  running as this could lead into some unexpected issues. If a user, for  example, is removing base rules or chains of the chain structure, then a firewalld reload might be needed to create them again.</p>
<h2 id="Install-and-enable-firewalld"><a href="#Install-and-enable-firewalld" class="headerlink" title="Install and enable firewalld"></a>Install and enable firewalld</h2><p>If the iptables, ip6tables, ebtables and ipset services are in use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable --now iptables.service</span><br><span class="line">systemctl disable --now ip6tables.service</span><br><span class="line">systemctl disable --now etables.service</span><br><span class="line">systemctl disable --now ipset.service</span><br><span class="line">dnf install firewalld firewall-config firewall-applet</span><br><span class="line">systemctl unmask --now firewalld.service</span><br><span class="line">systemctl enable --now firewalld.service</span><br></pre></td></tr></table></figure>

<p>To check the firewall state you have different options. The fist option is to use <code>systemctl status firewalld</code> the other one is to use <code>firewall-cmd --state</code>.</p>
<p>The output of the systemctl command should look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl status firewalld</span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;firewalld.service; enabled; vendor pr</span><br><span class="line">   Active: active (running) since Wed 2016-06-29 14:28:51 CEST; 1 weeks 6 days a</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"> Main PID: 24540 (firewalld)</span><br><span class="line">    Tasks: 2 (limit: 512)</span><br><span class="line">   CGroup: &#x2F;system.slice&#x2F;firewalld.service</span><br><span class="line">           └─24540 &#x2F;usr&#x2F;bin&#x2F;python3 -Es &#x2F;usr&#x2F;sbin&#x2F;firewalld --nofork --nopid</span><br></pre></td></tr></table></figure>

<p>The output of the firewall-cmd command should look like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ firewall-cmd --state</span><br><span class="line">running</span><br></pre></td></tr></table></figure>

<h2 id="Install-and-enable-iptables-ip6tables-ebtables-and-ipset-services"><a href="#Install-and-enable-iptables-ip6tables-ebtables-and-ipset-services" class="headerlink" title="Install and enable iptables, ip6tables, ebtables and ipset services"></a>Install and enable iptables, ip6tables, ebtables and ipset services</h2><p>If firewalld is enabled and you want to enable the iptables, ip6tables, ebtables and ipset services instead:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dnf install iptables-services ebtables ipset-service</span><br><span class="line">systemctl mask --now firewalld.service</span><br><span class="line">systemctl enable --now iptables.service</span><br><span class="line">systemctl enable --now ip6tables.service</span><br><span class="line">systemctl enable --now etables.service</span><br><span class="line">systemctl enable --now ipset.service</span><br></pre></td></tr></table></figure>

<p>The use of the mask line is recommended as systemd will start  firewalld if there is another service requires it or if the D-Bus  interface of firewalld is used. If the service only gets disabled, then  it will not be auto started anymore.</p>
<p>​                          </p>
<p>​          </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/13/Linux/SSH/%E4%BD%BF%E7%94%A8%20SSH-Key%20%E7%99%BB%E5%BD%95%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/13/Linux/SSH/%E4%BD%BF%E7%94%A8%20SSH-Key%20%E7%99%BB%E5%BD%95%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">使用 SSH-Key 登录远程服务器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-13 10:00:00" itemprop="dateCreated datePublished" datetime="2021-05-13T10:00:00+08:00">2021-05-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-14 19:50:08" itemprop="dateModified" datetime="2021-05-14T19:50:08+08:00">2021-05-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fab3252b3192">jianshu.com</a></p>
<p>ssh 提供两种级别的安全认证：</p>
<ol>
<li>基于口令的安全认证</li>
<li>基于密钥的安全认证</li>
</ol>
<h2 id="基于口令的安全认证"><a href="#基于口令的安全认证" class="headerlink" title="基于口令的安全认证"></a>基于口令的安全认证</h2><p>需要知道用户名和密码即可登录，该连接是加密的，但客户端不能确认目标主机是否为“伪造的”，也不能保证口令安全。</p>
<p>远程主机的 /etc/ssh/sshd_config 需配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PasswordAuthentication yes</span><br></pre></td></tr></table></figure>

<p>重启 sshd 使改动生效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ &#x2F;etc&#x2F;init.d&#x2F;sshd reload</span><br></pre></td></tr></table></figure>

<h2 id="基于密钥的安全认证"><a href="#基于密钥的安全认证" class="headerlink" title="基于密钥的安全认证"></a>基于密钥的安全认证</h2><p>需要用户持有“公钥/私钥对”，远程服务器持有公钥，本地持有私钥。</p>
<p>客户端向服务器发出请求。服务器收到请求之后，先在用户的主目录下找到该用户的公钥，然后对比用户发送过来的公钥。如果一致，服务器用公钥加密“质询”并发送给客户端。客户端收到“质询”后用私钥解密，再发还给服务器。认证结束。</p>
<p>生成 ssh-key，选加密算法（rsa、dsa），给秘钥命名（可选）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C &quot;name&quot;</span><br></pre></td></tr></table></figure>

<p>passphrase 是证书口令，以加强安全性，避免证书被恶意复制。</p>
<p>会在 <code>~.ssh</code> 下生成 <code>id_rsa</code>, <code>id_rsa.pub</code> 两个文件，分别是 私钥/公钥。</p>
<p><mark>公钥需保存到远程服务器 <code>~/.ssh/authorized_keys</code> 里，私钥由客户端本地留存。</mark></p>
<p>要保证 <code>.ssh</code> 和 <code>authorized_keys</code> 都只有用户自己有写权限。否则验证无效。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ chmod -R 700 ~&#x2F;.ssh&#x2F;</span><br><span class="line">$ chmod 600 ~&#x2F;.ssh&#x2F;authorized_keys</span><br></pre></td></tr></table></figure>

<h2 id="ssh-配置的一些实践"><a href="#ssh-配置的一些实践" class="headerlink" title="ssh 配置的一些实践"></a>ssh 配置的一些实践</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ vim &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PermitRootLogin no</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">StrictModes no</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile %h&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure>

<h2 id="持有多个-ssh-key-时的使用方法"><a href="#持有多个-ssh-key-时的使用方法" class="headerlink" title="持有多个 ssh-key 时的使用方法"></a>持有多个 ssh-key 时的使用方法</h2><p>简单情况下，通过手动指定私钥文件登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh username@hostname -i ~&#x2F;.ssh&#x2F;my_id_rsa</span><br></pre></td></tr></table></figure>

<p>觉得麻烦可以配置客户端的 <code>/etc/ssh/ssh_config</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IdentityFile ~&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line"></span><br><span class="line">IdentityFile ~&#x2F;.ssh&#x2F;my_id_rsa</span><br></pre></td></tr></table></figure>

<p>你也可以使用 SSH Agent，下面以使用 GitHub 为场景简单介绍。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C &#39;second@mail.com&#39;</span><br><span class="line">$ ssh-add ～&#x2F;.ssh&#x2F;id_rsa_second</span><br></pre></td></tr></table></figure>

<p>创建 <code>~/.ssh/config</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">HostName github.com</span><br><span class="line">User git</span><br><span class="line">IdentityFile C:&#x2F;Users&#x2F;username&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Host github-second</span><br><span class="line">HostName github.com</span><br><span class="line">User git</span><br><span class="line">IdentityFile C:&#x2F;Users&#x2F;username&#x2F;.ssh&#x2F;id_rsa_second</span><br></pre></td></tr></table></figure>

<p>配置完成后，在连接非默认账号的仓库时，远端地址要修改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add test git@github-second:second&#x2F;test.git</span><br></pre></td></tr></table></figure>

<p>​          </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/11/Computer/2021-05-11-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/11/Computer/2021-05-11-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">数据库学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-11 19:11:00" itemprop="dateCreated datePublished" datetime="2021-05-11T19:11:00+08:00">2021-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-14 19:47:28" itemprop="dateModified" datetime="2021-05-14T19:47:28+08:00">2021-05-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/database/" itemprop="url" rel="index"><span itemprop="name">database</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="数据库入门"><a href="#数据库入门" class="headerlink" title="数据库入门"></a>数据库入门</h1><h4 id="数据库相关从业"><a href="#数据库相关从业" class="headerlink" title="数据库相关从业"></a>数据库相关从业</h4><p><strong>前面五种</strong>：重点是设计和应用，侧重于软件和数据逻辑层面。</p>
<p>数据库应用开发 (application development)</p>
<blockquote>
<p>除了基本的SQL方面的知识，还要对开发流程，软件工程，各种框架和开发工具等等<br>数据库应用开发这个方向上的机会最多，职位最多</p>
</blockquote>
<p>数据建模专家 (data modeler)</p>
<blockquote>
<p>除了基本的SQL方面的知识，非常熟悉数据库原理，数据建模<br>负责将用户对数据的需求转化为数据库物理设计和物理设计<br>这个方向上在大公司（金融，保险，研究，软件开发商等）有专门职位，<br>在中小公司则可能由程序员承担。</p>
</blockquote>
<p>商业智能专家 (business intelligence - BI)</p>
<blockquote>
<p>主要从商业应用，最终用户的角度去从数据中获得有用的信息，<br>涉及OLAP (online analytical processing)<br>需要使用SSRS, cognos, crystal report等报表工具，或者其他一些数据挖掘，统计方面的软件工具</p>
</blockquote>
<p>ETL开发 (ETL Developer)</p>
<blockquote>
<p>使用ETL工具或者自己编写程序在不同的数据源之间对数据进行导入，导出，转换，<br>所接触的数据库一般数据量非常大，要求进行的数据转换也比较复杂。<br>和数据仓库和商业智能的关系比较密切。</p>
</blockquote>
<blockquote>
<p>在一些数据库应用规模很大的公司里面有专门的职位，<br>中小公司里面则可能由程序员或者DBA负责这方面的工作。</p>
</blockquote>
<p>数据构架师 (Data Architect)</p>
<blockquote>
<p>主要从全局上制定和控制关于数据库在逻辑这一层的大方向，<br>也包括数据可用性，扩展性等长期性战略，<br>协调数据库的应用开发，建模，DBA之间的工作。<br>这个方向上在大公司（金融，保险，研究，软件开发商等）有专门职位，<br>在中小公司或者没有这个职位，或者由开发人员，DBA负责。</p>
</blockquote>
<p><strong>后面五种</strong>：重点是运营和维护，侧重与硬件和数据物理层面。</p>
<p>数据库管理员 (database administrator - DBA)</p>
<blockquote>
<p>数据库的安装，配置，调优，备份/恢复，监控，自动化等，<br>协助应用开发（有些职位还要求优化SQL，写存储过程和函数等）<br>这个方向上的职位相对少一些，但一般有点规模的公司还是会有这样的职位</p>
</blockquote>
<p>数据仓库专家 (data warehouse - DW)</p>
<blockquote>
<p>应付超大规模的数据，历史数据的存储，管理和使用，<br>和商业智能关系密切，很多时候BI和DW是放在一个大类里面的，<br>但是我觉得DW更侧重于硬件和物理层上的管理和优化。</p>
</blockquote>
<p>存储工程师 (storage engineer)</p>
<blockquote>
<p>专门负责提供数据存储方案，使用各种存储技术满足数据访问和存储需求，<br>和DBA的工作关系比较密切。<br>对高可用性有严格要求（比如通信，金融，数据中心等）的公司通常有这种职位，<br>这种职位也非常少。</p>
</blockquote>
<p>性能优化工程师 (performance engineer)</p>
<blockquote>
<p>专长数据库的性能调试和优化，为用户提供解决性能瓶颈方面的问题。<br>我知道至少IBM, 微软和Oracle都有专门的数据库性能实验室(database performance lab）,<br>也有专门的性能优化工程师，负责为其数据库产品和关键应用提供这方面的技术支持。<br>对数据库性能有严格要求的公司（比如金融行业）可能会有这种职位。<br>因为针对性很强，甚至要求对多种数据库非常熟悉，所以职位极少。</p>
</blockquote>
<p>高级数据库管理员 (senior DBA)</p>
<blockquote>
<p>在DBA的基础上，还涉及上面3种职位的部分工作，具体包括下面这些：<br>对应用系统的数据（布局，访问模式，增长模式，存储要求等）比较熟悉。<br>对性能优化非常熟悉，可以发现并优化从SQL到硬件I/O，网络等各个层面上的瓶颈<br>对于存储技术相对熟悉，可能代替存储工程师的一些工作，<br>对数据库的高可用性技术非常熟悉（比如MSSQL的集群，ORACLE RAC/FailSafe, IBM的DPF, HADR等）<br>对大规模数据库有效进行物理扩展（比如表分区）或者逻辑扩展（比如数据库分区，联合数据库等）<br>熟悉各种数据复制技术，比如单向，双向，点对点复制技术，以满足应用要求。<br>灾难数据恢复过程的建立，测试和执行<br>这种职位一般只在对数据库要求非常高并且规模非常大（比如金融，电信，数据中心等）的公司需要，<br>而且这种公司一般有一个专门独立负责数据库的部门或组。 </p>
</blockquote>
<h1 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h1><p>说到关系型数据库，不仅仅是涉及计算机概念，也涉及一些数学概念，例如表格的概念、包含关系、关系运算及关系代数等。</p>
<h2 id="关系模型术语"><a href="#关系模型术语" class="headerlink" title="关系模型术语"></a>关系模型术语</h2><img src="https://pic.islet.space/2021/05/image-20210512085059008.png" alt="image-20210512085059008" style="zoom:67%;" />

<ol>
<li><strong>表</strong>：关系型数据库由表集合而成，<strong>表是关系型数据库的一个基本组成</strong>，每个表具有唯一的名字。</li>
<li><strong>关系</strong>：在关系型数据库中，<strong>关系</strong> 指代 <strong>表</strong> 的概念，即一般可认为 <strong>关系 = 表</strong>。</li>
<li><strong>元组</strong>：在关系型数据库中，<strong>元组</strong> 指代 <strong>行</strong> 的概念，即一般可认为 <strong>元组 = 行</strong>。</li>
<li><strong>属性</strong>：在关系型数据库中，<strong>属性</strong> 指代 <strong>列</strong> 的概念，即一般可认为 <strong>属性 = 列</strong>。</li>
<li><strong>域</strong>：属性下所有元素的可取值范围或取值类型。</li>
<li><strong>原子域</strong>：域中的元素不可再分，则称为原子域。</li>
<li><strong>空值</strong>：属性下元素为空(NULL)。</li>
<li><strong>关系实例</strong>：即表实例，严谨说法是 “表示一个关系的特定实例，也就是所包含的一组特定的行”，就是不仅仅只有属性这一行，还具有特定的某些具体数据的表格。</li>
<li><strong>关系模式</strong>：即表模式，严谨说法是“关系模式由属性序列及各属性对应域组成”，通俗地说就是，没有具体数据，而仅定义了属性和域的表格。</li>
<li><strong>数据库模式</strong>：对数据库的逻辑设计。</li>
<li><strong>数据库实例</strong>：对数据库中数据的快照。</li>
<li><strong>超码</strong>：是一个或多个属性的集合，超码内的一个或多个属性组合可以唯一区分和标识一个元组。</li>
<li><strong>候选码</strong>：最小超码。</li>
<li><strong>主码</strong>：主码是候选码的一种，最重要的是，<strong>主码由设计者选中，具有人为性</strong>。</li>
<li><strong>外码</strong>：用于表示关系之间的引用和被引用关系。即关系A中的某项属性来自于关系B中的某项属性，则称该引用过来的属性为外码。<strong>但据课本，是被引用的主码称为外码。</strong></li>
<li><img src="https://pic.islet.space/2021/05/image-20210512134116409.png" alt="image-20210512134116409"></li>
</ol>
<h2 id="结构化查询语言SQL"><a href="#结构化查询语言SQL" class="headerlink" title="结构化查询语言SQL"></a>结构化查询语言SQL</h2><h3 id="发展历史"><a href="#发展历史" class="headerlink" title="发展历史"></a>发展历史</h3><img src="https://pic.islet.space/2021/05/image-20210512192241572.png" alt="image-20210512192241572" style="zoom:67%;" />



<blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/745815#:~:text=SQL%E6%A0%87%E5%87%86%E6%98%AF%E7%94%B1%E5%9B%BD%E9%99%85%E6%A0%87%E5%87%86%E5%8C%96%E7%BB%84%E7%BB%87%EF%BC%88ISO%EF%BC%89%E3%80%81%E7%BE%8E%E5%9B%BD%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86%E5%A7%94%E5%91%98%E4%BC%9AANSI%E7%AD%89%E5%88%B6%E5%AE%9A%E7%9A%84%EF%BC%8C%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%9F%E4%B8%80%E6%93%8D%E4%BD%9C%E6%96%B9%E5%BC%8F%E3%80%82%20SQL%20%E6%98%AF%20Structured%20Query%20Language%20%E7%9A%84%E7%BC%A9%E5%86%99%EF%BC%8C%E8%A7%84%E8%8C%83%E7%9A%84%E5%8F%91%E9%9F%B3%E6%98%AF%20%E2%80%9C%CB%8C%C9%9Bs%CB%8Ckju%CB%90%CB%88%C9%9Bl%E2%80%9D%E3%80%82,%E6%98%AF%20SQL%20Query%20Language%20%E7%9A%84%E7%BC%A9%E5%86%99%E3%80%82%20IBM%E5%AF%B9%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%A5%E5%8F%8ASQL%E8%AF%AD%E8%A8%80%E7%9A%84%E5%BD%A2%E6%88%90%E5%92%8C%E8%A7%84%E8%8C%83%E5%8C%96%E4%BA%A7%E7%94%9F%E4%BA%86%E9%87%8D%E5%A4%A7%E7%9A%84%E5%BD%B1%E5%93%8D%EF%BC%8C%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%89%88%E6%9C%AC%E7%9A%84SQL%E6%A0%87%E5%87%86SQL86%E5%B0%B1%E6%98%AF%E5%9F%BA%E4%BA%8ESystem%20R%E7%9A%84%E6%89%8B%E5%86%8C%E8%80%8C%E6%9D%A5%E7%9A%84%E3%80%82%20Oracle%E5%9C%A81979%E5%B9%B4%E7%8E%87%E5%85%88%E6%8E%A8%E5%87%BA%E4%BA%86%E6%94%AF%E6%8C%81SQL%E7%9A%84%E5%95%86%E7%94%A8%E4%BA%A7%E5%93%81%E3%80%82">数据库必知词汇：SQL标准</a></p>
<p>SQL标准是由国际标准化组织（ISO）、美国国家标准委员会ANSI等制定的，对数据库管理系统的统一操作方式。</p>
<p>SQL 是  Structured Query Language 的缩写，规范的发音是 “ˌɛsˌkjuːˈɛl”。但是它的前身是著名的关系数据库原型系统  System R 所采用的 SEQUEL 语言，这也是为什么有很多人将其读作 “ˈsiːkwəl” 的来源。也有人类比 GNU  这个词的定义（GNU’s Not UNIX），认为 SQL 是 SQL Query Language 的缩写。</p>
<p>IBM对关系数据库以及SQL语言的形成和规范化产生了重大的影响，第一个版本的SQL标准SQL86就是基于System  R的手册而来的。Oracle在1979年率先推出了支持SQL的商用产品。随着数据库技术和应用的发展，为不同RDBMS提供一致的语言成了一种现实需要。</p>
<p>对SQL标准影响最大的机构自然是那些著名的数据库产商，而具体的制订者则是一些非营利机构，例如国际标准化组织ISO、美国国家标准委员会ANSI等。各国通常会按照ISO标准和ANSI标准制定自己的国家标准。</p>
<p>“美国国家标准化组织(ANSI)”是一个核准多种行业标准的组织。SQL作为关系型数据库所使用的标准语言，最初是基于IBM的实现在1986年被批准的。1987年，“国际标准化组织(ISO)”把ANSI SQL作为国际标准。</p>
<p>SQL发展的简要历史：<br>1986年，ANSI X3.135-1986，ISO/IEC 9075:1986，SQL-86<br>1989年，ANSI X3.135-1989，ISO/IEC 9075:1989，SQL-89<br>1992年，ANSI X3.135-1992，ISO/IEC 9075:1992，SQL-92（SQL2）<br>1999年，ISO/IEC 9075:1999，SQL:1999（SQL3）<br>2003年，ISO/IEC 9075:2003，SQL:2003<br>2008年，ISO/IEC 9075:2008，SQL:2008<br>2011年，ISO/IEC 9075:2011，SQL:2011<br>补充<br>1986 年，ANSI X3.135-1986，ISO/IEC 9075:1986，SQL-86。这是 ANSI 首次将 SQL 语言标准化的版本。<br>1989 年，ANSI X3.135-1989，ISO/IEC 9075:1989，SQL-89。增加了完整性约束。<br>1992 年，ANSI X3.135-1992，ISO/IEC 9075:1992，SQL-92（SQL2）。最重要的一个版本。 引入了标准的分级概念。<br>1999 年，ISO/IEC 9075:1999，SQL:1999（SQL3）。变动最大的一个版本。改变了标准符合程度的定义；增加了面向对象特性、正则表达式、存储过程、Java 等支持。<br>2003 年，ISO/IEC 9075:2003，SQL:2003。引入了 XML、Window 函数等。<br>2008 年，ISO/IEC 9075:2008，SQL:2008。引入了 TRUNCATE 等。<br>2011 年，ISO/IEC 9075:2011，SQL:2011。引入了时序数据等。<br>2016 年，ISO/IEC 9075:2016，SQL:2016。引入了 JSON 等。</p>
<p>绝大多数人提起SQL标准，涉及的内容其实是SQL92里头最基本或者说最核心的一部分。SQL92本身是分级的，包括入门级、过度级、中间级和完全级，推荐泛读SQL92，增量式式阅读其他标准。而随着SQL标准的发展，其包含的内容实在太多了，而且有很多特性对新的SQL产品而言也越来越不重要了。从SQL99之后，标准中符合程度的定义就不再分级，而是改成了核心兼容性和特性兼容性；也没有机构来推出权威的SQL标准符合程度的测试认证了。</p>
</blockquote>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ol>
<li>数据库查询</li>
<li>定义数据结构</li>
<li>修改数据</li>
<li>说明安全性约束条件</li>
</ol>
<h3 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h3><img src="https://pic.islet.space/2021/05/image-20210512192708528.png" alt="image-20210512192708528" style="zoom:67%;" />

<p><em><strong>以上所有类型都可能包含一个被称作空值的特殊值。NULL表示一个缺失的值，即表示该值可能存在但并不为人所知，或者可能根本不存在。</strong></em></p>
<h4 id="关于char-varchar-nvarchar的比较"><a href="#关于char-varchar-nvarchar的比较" class="headerlink" title="关于char / varchar / nvarchar的比较"></a>关于char / varchar / nvarchar的比较</h4><img src="https://pic.islet.space/2021/05/image-20210512193208247.png" alt="image-20210512193208247" style="zoom:67%;" />



<h3 id="SQL完整性约束"><a href="#SQL完整性约束" class="headerlink" title="SQL完整性约束"></a>SQL完整性约束</h3><img src="https://pic.islet.space/2021/05/image-20210512201050138.png" alt="image-20210512201050138" style="zoom:67%;" />

<p>例如，上方教员的名称为 “张三”， 我想删除后保存，会破坏 <code>instructor</code> 关系下 <code>name</code> 的非空约束，SQL不通过这种操作。</p>
<h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><h4 id="新建表格"><a href="#新建表格" class="headerlink" title="新建表格"></a>新建表格</h4><p>数据表格新建格式及样例如下：</p>
<p><img src="https://pic.islet.space/2021/05/image-20210512193506987.png" alt="image-20210512193506987"></p>
<blockquote>
<p>其中r是关系名，即表名；A<del>x</del>是属性名，即列名；D<del>x</del>是属性的域，即指定了A的类型及可选约束，用于限制所允许的A<del>x</del>取值的集合。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*部门关系*/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> department(</span><br><span class="line">    dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    building <span class="type">varchar</span>(<span class="number">15</span>),</span><br><span class="line">    budget <span class="type">numeric</span>(<span class="number">12</span>,<span class="number">2</span>),</span><br><span class="line">    <span class="keyword">primary</span> key(dept_name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*课程关系*/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course(</span><br><span class="line">    coourse_id <span class="type">varchar</span>(<span class="number">7</span>),</span><br><span class="line">    title <span class="type">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    credits <span class="type">numeric</span>(<span class="number">2</span>,<span class="number">0</span>),</span><br><span class="line">    <span class="keyword">primary</span> key(course_id),</span><br><span class="line">    <span class="keyword">foreign</span> key (dept_name) <span class="keyword">references</span> department</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*教员关系*/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> instructor(</span><br><span class="line">	ID <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    salary <span class="type">numeric</span>(<span class="number">8</span>,<span class="number">2</span>),</span><br><span class="line">    <span class="keyword">primary</span> key(ID),</span><br><span class="line">    <span class="keyword">foreign</span> key(dept_name) <span class="keyword">references</span> department</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*（课程）章节关系*/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> section(</span><br><span class="line">	course_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">    sec_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">    semester <span class="type">varchar</span>(<span class="number">6</span>),</span><br><span class="line">    <span class="keyword">year</span> <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line">    building <span class="type">varchar</span>(<span class="number">7</span>),</span><br><span class="line">    time_slot_id <span class="type">varchar</span>(<span class="number">4</span>),</span><br><span class="line">    <span class="keyword">primary</span> key(course_id, sec_id, semester, <span class="keyword">year</span>),</span><br><span class="line">    <span class="keyword">foreign</span> key(course_id) <span class="keyword">references</span> course</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*教师关系*/</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teachers(</span><br><span class="line">	ID <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line">    course_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">    sec_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line">    semester <span class="type">varchar</span>(<span class="number">6</span>),</span><br><span class="line">    <span class="keyword">year</span> <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line">    <span class="keyword">primary</span> key(ID, course_id, sec_id, semester, <span class="keyword">year</span>),</span><br><span class="line">    <span class="keyword">foreign</span> key(course_id, sec_id, semester, <span class="keyword">year</span>) <span class="keyword">references</span> section,</span><br><span class="line">    <span class="keyword">foreign</span> key(ID) <span class="keyword">references</span> instructor</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>foreign key 可以拿来当 primary key，如章节关系中所示。</p>
<p><code>not null</code> 关键字约束表明 “在该属性上不允许空值” 。</p>
</blockquote>
<h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><p><img src="https://pic.islet.space/2021/05/image-20210512201338050.png" alt="image-20210512201338050"></p>
<p>插入值过程中，所给出的值的顺序应与关系模式中的属性顺序一致。</p>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p><code>delete</code> 命令可以用于删除元组。</p>
<ul>
<li>如果直接使用命令 <code>delete from student</code> ， 则将从 <em>student</em> 关系中删除所有元组。</li>
<li>使用其他语句可以执行特定删除，如：<ul>
<li>使用命令 <code>delete from instructor where salary between 13000 and 150000;</code> ，删除所有工资在13000到15000美元之间的教师</li>
<li>其他操作……</li>
</ul>
</li>
</ul>
<h4 id="丢弃表格"><a href="#丢弃表格" class="headerlink" title="丢弃表格"></a>丢弃表格</h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/11/Signal/2021-05-11-TRS%E7%AB%AF%E5%AD%90%E5%8F%8A%E5%85%B6%E4%BB%96%E9%9F%B3%E9%A2%91%E6%8E%A5%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/11/Signal/2021-05-11-TRS%E7%AB%AF%E5%AD%90%E5%8F%8A%E5%85%B6%E4%BB%96%E9%9F%B3%E9%A2%91%E6%8E%A5%E5%8F%A3/" class="post-title-link" itemprop="url">TRS端子及其他音频接口</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-11 16:00:00" itemprop="dateCreated datePublished" datetime="2021-05-11T16:00:00+08:00">2021-05-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-14 19:47:43" itemprop="dateModified" datetime="2021-05-14T19:47:43+08:00">2021-05-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Signal/" itemprop="url" rel="index"><span itemprop="name">Signal</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>接口其实包括对 “<strong>接口</strong>” （interface）和 “<strong>连接器</strong>” （connector）这两个方面的讨论，“连接器”我们通常也称之为“接头”或“插头”。 “接口”定义了电子设备之间连接的物理特性，包括传输的<strong>信号频率</strong>、<strong>强度</strong>，以及相应<strong>连线的类型</strong>、<strong>数量</strong>，还包括<strong>插头</strong>、<strong>插座</strong>的结构设计；而“连接器”则是在物理上实现设备之间连接的装置。</p>
<h1 id="TRS"><a href="#TRS" class="headerlink" title="TRS"></a>TRS</h1><p>TRS端子（TRS connector）是一种常用于连接音响设备，用以传递音频信号的连接器。该词是其三个组成部件的首字母缩写：<strong>Tip</strong>（尖）、<strong>Ring</strong>（环）、<strong>Sleeve</strong>（套）。</p>
<p>由于该种接头一般用于接插耳机和麦克风，因此也称 Phone Jack。虽然统称TRS，但也可依据具体的插头/插座的<strong>环（R）数</strong> 不同而分别称为<strong>TS</strong>（无环，即尖和套各提供一个接触点）、<strong>TRS</strong>（一环，三个接触点）、<strong>TRRS</strong>（两环，四个接触点）等等。</p>
<p>日常生活中我们见得最多的就是<strong>TRS</strong>接口，它的接头外观是圆柱体形状，通常有三种尺寸**1/4”<strong>（6.3mm）、</strong>1/8”<strong>（3.5mm）、</strong>3/32”**（2.5mm），最常见的是3.5mm尺寸的接头。</p>
<img src="https://pic.islet.space/2021/05/72f082025aafa40fc0dca129a764034f78f0192f" alt="img" style="zoom:50%;" />

<p><strong>TRS</strong> 的含义是Tip（signal）、Ring（signal）、Sleeve（ground），分别代表了这种接头的3个触点，我们看到的就是被两段绝缘材料隔离开的三段金属柱。因此，3.5mm接头和6.3mm接头也被人称为“小三芯”和“大三芯”。</p>
<img src="https://pic.islet.space/2021/05/Cg-4WlUQA2qIVD1QAAEWTBx9jskAAAGGAKz658AARZk513.jpg" alt=" " style="zoom: 150%;" />



<p>TRS接口就是一个圆孔，其内部与接头对应，也有三个触点，彼此之间也被绝缘材料隔开。</p>
<h2 id="常见设备"><a href="#常见设备" class="headerlink" title="常见设备"></a>常见设备</h2><p>通常，手机上的耳机插口都是TRRS，而电脑上通常是两个TRS，一个传声音的左右声道，一个传话筒的左右声道。</p>
<p>而为了使得双TRS的耳麦可以插到手机上，产生了转接头，也就是图中的第二个设备。不过我们考虑一下会发现，两个TRS都是3个信号，合并到一个TRRS接口上，信号变成了4个，减少了两个。除去一个共地的GND，还少了一个信号，去哪了呢？其实这是因为它会把LMIC和RMIC合并成一个MIC，而且TRRS本身就是只能传输一个MIC信号的，不存在左右声道。</p>
<p>当然了，也有反过来将TRRS转接成两个TRS接口的转接头。</p>
<p>此外，还有TS麦克风，如图中的第四个设备。如果话筒采用的这种接口，就默认了MIC只有一个声道，这种一般是用在小蜜蜂扩音器上。</p>
<p><img src="https://pic.islet.space/2021/05/41_2.jpg" alt="img"></p>
<p>当然，既然能加芯，那也可以减芯。二芯的TRS接头可以用来传送非平衡的单声道音频信号，比如电吉他用的线就是二芯的TRS线。所以，单从TRS接口外观来看，我们不会知道它是否支持平衡传输；单从芯数来看，我们也不能确定四芯及以上的TRS接头是否支持平衡传输，具体情况需要看设备。</p>
<p>尖和套是一定要有的，但环可以根据需要加，常见的有0-2个环的，也就是TS、TRS和TRRS。环越多，可以传输的信号数量越多。</p>
<p>因此，普通双声道耳机需要3个信号，即TRS；而如果是带麦克风的耳机，就需要4个信号了，即TRRS。注意，这里除了左声道(L)、右声道(R)以及带麦耳机所需的麦克风(MIC)信号，必须还要有地线(GND)，因为没有绝对电压而只有相对电压。</p>
<p>在3.5mm接口上传输的是模拟信号，使用电压模拟声波。</p>
<p>此外，还有一种用于耳机的四芯3.5mm插头则是用来传输平衡信号的。6.3mm的“大三芯”插头可用来传输平衡信号或非平衡立体声信号，也就是说它可以和XLR平衡接口一样，能够传输平衡信号，但因制作这样的平衡线成本比较高，所以一般只用在高档专业音频设备上。</p>
<img src="https://article-fd.zol-img.com.cn/t_s640x2000/g2/M00/01/08/Cg-4WlUQBM2IO7yBAAPH1zKABagAAAGHwBFP9AAA8fv952.jpg" alt="拒绝做小白 你应该知道的常见音频接口 " style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">二芯6.3mm TRS电吉他线</div>





<h2 id="TRS母头"><a href="#TRS母头" class="headerlink" title="TRS母头"></a>TRS母头</h2><p>ADI公司旗下的 ADAU1772 评估板采用的就是CUI公司旗下型号为 SJ-3523-SMT-TR 的TRS母头</p>
<p><img src="https://pic.islet.space/2021/05/2021-05-11_16-39.png"></p>
<p>说明书如：<a target="_blank" rel="noopener" href="https://www.cuidevices.com/product/resource/digikeypdf/sj-352x-smt.pdf">sj-352x-smt.pdf</a> ，其规格如下：</p>
<p><img src="https://pic.islet.space/2021/05/image-20210511164353982.png" alt="image-20210511164353982"></p>
<h1 id="RCA"><a href="#RCA" class="headerlink" title="RCA"></a>RCA</h1><p> RCA接口在我们日常生活中也非常常见，音箱、电视、功放、DVD机等设备上基本都有。它得名于美国无线电公司的英文缩写（Radio Corporation of America），上世纪40年代的时候，该公司将这种接口引入市场，用它来连接留声机和扬声器，也因此，它在欧州又称为PHONO接口。我们对它更熟悉的接头称呼则是“莲花头”。</p>
<img src="https://article-fd.zol-img.com.cn/t_s640x2000/g2/M00/01/08/Cg-4WlUQCFeITgCFAAaVRivfdawAAAGKwBI8wMABpVe851.jpg" alt="拒绝做小白 你应该知道的常见音频接口 " style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">RCA接口在我们日常生活中非常常见</div>

<img src="https://article-fd.zol-img.com.cn/t_s640x2000/g2/M00/01/08/Cg-4WVUQCFyIRm-6AAMW5z_mkQ8AAAGKwB5ZmQAAxb_659.jpg" alt="拒绝做小白 你应该知道的常见音频接口 " style="zoom:67%;" />

<div style="text-align: center; font-weight: 900;">被称为“莲花头”的RCA接头</div>



<p>RCA接口采用同轴传输信号的方式，中轴用来传输信号，外沿一圈的接触层用来接地。每一根RCA线缆负责传输一个声道的音频信号，因此，可以根据对声道的实际需要，使用与之数量相匹配的RCA线缆。比如要组双声道立体声就需要两根RCA线缆。</p>
<h1 id="XLR"><a href="#XLR" class="headerlink" title="XLR"></a>XLR</h1><p>XLR接口又被称为“卡农口”，这是因为James H. Cannon创立的Cannon Electric公司是它最初的生产商。它们最早的产品是“cannon X”系列，后来改进产品增加了一个锁定装置（Latch），于是在“X”后面增加了一个“L”；再后来又围绕着接头的金属触点增加了橡胶封口（Rubber compound），于是又在“L”后面增加了一个“R”。人们就把三个大写字母组合在一起，称这种接头为“XLR connector”。</p>
<p><img src="https://article-fd.zol-img.com.cn/t_s640x2000/g2/M00/01/08/Cg-4WVUQChyIbKeoAALaNHpTfMUAAAGMAMweHgAAtpM096.jpg"></p>
<div style="text-align: center; font-weight: 900;">比较常见的三芯XLR接口</div>

<p><img src="https://article-fd.zol-img.com.cn/t_s640x2000/g2/M00/01/08/Cg-4WlUQDLCIUqT0AAHcPS_ygasAAAGOQEvIJQAAdxV227.jpg" alt=" "></p>
<div style="text-align: center; font-weight: 900;">有的耳放上面会提供四芯平衡XLR接口</div>

<p>我们通常见到的XLR插头是3脚的，当然也有2脚、4脚、5脚、6脚的，比如在一些高档耳机线上，我们也会看到四芯XLR平衡接头。XLR接口与“大三芯”TRS接口一样，可以用来传输音频平衡信号。这里我们简单说一下平衡信号与非平衡信号。声波转换成电信号后，如果直接传送就是非平衡信号，如果把原始信号反相180度，然后同时传送原始信号和反相信号，这就是平衡信号。平衡传输就是利用相位抵消原理，将音频信号传输过程中受到的其他干扰降至最低。 当然，XLR接口也跟“大三芯”TRS接口一样，可以传输非平衡信号，因此光从接口看，我们是看不出来它到底传输的是哪种信号。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/06/Signal/2021-05-06-%E6%BB%A4%E6%B3%A2%E5%99%A8%E3%80%81%E5%A2%9E%E7%9B%8A%E5%92%8C%E9%9F%B3%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/06/Signal/2021-05-06-%E6%BB%A4%E6%B3%A2%E5%99%A8%E3%80%81%E5%A2%9E%E7%9B%8A%E5%92%8C%E9%9F%B3%E9%87%8F/" class="post-title-link" itemprop="url">晶振、滤波器、运放、增益与音量</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-06 08:55:00" itemprop="dateCreated datePublished" datetime="2021-05-06T08:55:00+08:00">2021-05-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-09 17:16:58" itemprop="dateModified" datetime="2021-05-09T17:16:58+08:00">2021-05-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/signal/" itemprop="url" rel="index"><span itemprop="name">signal</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="晶振"><a href="#晶振" class="headerlink" title="晶振"></a>晶振</h1><iframe src="//player.bilibili.com/player.html?aid=375201195&bvid=BV1Do4y1f7zZ&cid=326338193&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>





<iframe src="//player.bilibili.com/player.html?aid=541620530&bvid=BV1qi4y1u7Ha&cid=218806392&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>









<h1 id="滤波器"><a href="#滤波器" class="headerlink" title="滤波器"></a>滤波器</h1><p><strong>自百度百科</strong>：</p>
<p>滤波器是由 <strong>电容</strong>、<strong>电感</strong>和<strong>电阻</strong> 组成的滤波电路。滤波器可以 <strong>对 <strong>电源线中</strong>特定频率的频点</strong> <strong>或</strong> 该频点 <strong>以外的频率</strong> 进行有效滤除，得到一个特定频率的电源信号，或消除一个特定频率后的电源信号。</p>
<p><strong>自Bilibili视频</strong>：</p>
<p>滤波器是具有频率选择作用的 <strong>电路</strong> 或 <strong>运算处理系统</strong>， 具有 <strong>滤除噪声</strong> 和 <strong>分离各种不同信号</strong> 的功能。</p>
<p>即滤波器有模拟滤波器和数字滤波器两类，模拟滤波器主要依靠电路实现滤波，数字滤波器依靠运算处理系统进行滤波。滤波主要是为了滤除噪声或者分离不同信号。</p>
<iframe src="//player.bilibili.com/player.html?aid=925644966&bvid=BV1nT4y1u7LL&cid=192193457&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>



<p><strong>自Wikipedia</strong>：</p>
<p>电子滤波器（英语：electronic filters）可执行信号处理功能的电子线路组件或设备，它专门用于去除信号中不想要的成分或者增强所需成分。</p>
<p>电子滤波器有音频滤波器（wave filter）与噪声滤波器（noise filter）等应用设备，可以是：</p>
<ul>
<li>无源的或者有源的</li>
<li>模拟的或者数字的</li>
<li>离散时间（采样）的或者连续时间的</li>
<li>线性的或者非线性的</li>
<li>无限脉冲响应（IIR）或者有限脉冲响应（FIR）</li>
</ul>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>自百度百科</strong>：</p>
<p>滤波器是一种选频装置，可以使信号中特定的频率成分通过，而极大地衰减其他频率成分。利用滤波器的这种选频作用，可以滤除干扰噪声或进行频谱分析。换句话说，凡是可以使信号中特定的频率成分通过，而极大地衰减或抑制其他频率成分的装置或系统都称之为滤波器。滤波器，是对波进行过滤的器件。“波”是一个非常广泛的物理概念，在电子技术领域，“波”被狭义地局限于特指描述各种物理量的取值随时间起伏变化的过程。该过程通过各类传感器的作用，被转换为电压或电流的时间函数，称之为各种物理量的时间波形，或者称之为信号。因为自变量时间是连续取值的，所以称之为<strong>连续时间信号</strong>，又习惯地称之为模拟信号(Analog Signal)。</p>
<p>滤波是信号处理中的一个重要概念，在<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%9B%B4%E6%B5%81%E7%A8%B3%E5%8E%8B%E7%94%B5%E6%BA%90/327901">直流稳压电源</a>中滤波电路的作用是尽可能减小脉动的直流电压中的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BA%A4%E6%B5%81/2700357">交流</a>成分，保留其直流成分，使输出电压纹波系数降低，波形变得比较平滑。</p>
 <img src="https://pic.islet.space/2021/05/fc1f4134970a304e3fbc1b7edfc8a786c8175c93" alt="滤波" style="zoom:50%;" />



<h2 id="主要参数"><a href="#主要参数" class="headerlink" title="主要参数"></a>主要参数</h2><p><strong>品质因数</strong></p>
<p>仅针对2阶滤波器有效，对1阶和3阶滤波器无效。</p>
<iframe src="//player.bilibili.com/player.html?aid=19074169&bvid=BV1rW411H7qv&cid=31115293&page=3" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p><strong>中心频率</strong>（Center Frequency）</p>
<blockquote>
<p>滤波器通带的频率f0，一般取 f0=（f<del>1</del>+f<del>2</del>）/2，f<del>1</del>、f<del>2</del>为带通或带阻滤波器左、右相对下降1dB或3dB边频点。窄带滤波器常以插损最小点为中心频率计算通带带宽。</p>
</blockquote>
<p><strong>截止频率</strong>（Cutoff Frequency）</p>
<blockquote>
<p>指低通滤波器的通带右边频点及高通滤波器的通带左边频点。通常以1dB或3dB <strong>相对损耗点</strong> 来标准定义。</p>
<p><strong>相对损耗的参考基准为：</strong>低通以DC处插损为基准，高通则以未出现 <strong>寄生阻带</strong> 的足够高通带频率处插损为基准。</p>
</blockquote>
<p><strong>通带带宽</strong></p>
<blockquote>
<p>指需要通过的频谱宽度，BW=（f2-f1）。f<del>1</del>、f<del>2</del>为以中心频率f<del>0</del>处插入损耗为基准。</p>
</blockquote>
<p><strong>插入损耗</strong>（Insertion Loss）</p>
<blockquote>
<p>由于滤波器的引入对电路中原有信号带来的衰耗，以中心或截止频率处损耗表征，如要求 <mark>全带内插损需强调</mark>。</p>
</blockquote>
<p><strong>纹波</strong>（Ripple）</p>
<blockquote>
<p>指1dB或3dB带宽（截止频率）范围内，插损随频率在损耗均值曲线基础上波动的峰值。</p>
</blockquote>
<p><strong>带内波动</strong>（Passband Ripple）</p>
<blockquote>
<p>通带内插入损耗随频率的变化量。1dB带宽内的带内波动是1dB。</p>
</blockquote>
<p><strong>带内驻波比</strong>（VSWR）</p>
<blockquote>
<p>衡量滤波器通带内信号是否良好匹配传输的一项重要指标。理想匹配VSWR=1：1，失配时VSWR 大于1。对于一个实际的滤波器而言，满足VSWR小于1.5：1的带宽一般小于BW3dB，其占BW3dB的比例与滤波器阶数和插损相关。</p>
</blockquote>
<p><strong>回波损耗</strong>（Return Loss）</p>
<blockquote>
<p>端口信号输入功率与反射功率之比的分贝（dB）数，也等于20Log10ρ，ρ为电压反射系数。输入功率被端口全部吸收时回波损耗为无穷大。</p>
</blockquote>
<p><strong>阻带抑制度</strong></p>
<blockquote>
<p>衡量滤波器选择性能好坏的重要指标。该指标越高说明对带外干扰信号抑制的越好。通常有两种提法：一种为要求对某一给定带外频率fs抑制多少dB，计算方法为fs处衰减量；另一种为提出表征滤波器幅频响应与理想矩形接近程度的指标——矩形系数（KxdB大于1），KxdB=BWxdB/BW3dB，（X可为40dB、30dB、20dB等）。滤波器阶数越多矩形度越高——即K越接近理想值1，制作难度当然也就越大。</p>
</blockquote>
<p><strong>延迟</strong>（Td）</p>
<blockquote>
<p>指信号通过滤波器所需要的时间，数值上为传输相位函数对角频率的导数，即Td=df/dv。</p>
</blockquote>
<p><strong>带内相位线性度</strong></p>
<blockquote>
<p>该指标表征滤波器对通带内传输信号引入的相位失真大小。按线性相位响应函数设计的滤波器具有良好的相位线性度。</p>
</blockquote>
<h2 id="主要分类"><a href="#主要分类" class="headerlink" title="主要分类"></a>主要分类</h2><ul>
<li><p>按所处理的信号分为 <strong>模拟滤波器</strong> 和 <strong>数字滤波器</strong> 两种。</p>
<ul>
<li>模拟滤波器在实时性方面较有优势，且发展较早，更为成熟。</li>
<li>数字滤波器依赖于计算速度。</li>
</ul>
</li>
<li><p>按所通过信号的频段分为 <strong>低通</strong>、<strong>高通</strong>、<strong>带通</strong>、<strong>带阻</strong> 和 <strong>全通</strong> 滤波器五种。</p>
<p>  <strong>低通滤波器</strong>：它允许信号中的低频或直流分量通过，抑制高频分量或干扰和噪声；</p>
<p>  <strong>高通滤波器</strong>：它允许信号中的高频分量通过，抑制低频或直流分量；</p>
<p>  <strong>带通滤波器</strong>：它允许一定频段的信号通过，抑制低于或高于该频段的信号、干扰和噪声；</p>
<p>  <strong>带阻滤波器</strong>：它抑制一定频段内的信号，允许该频段以外的信号通过，又称为陷波滤波器。 [1] </p>
<p>  <strong>全通滤波器</strong>：全通滤波器是指在全频带范围内，信号的幅值不会改变，也就是全频带内幅值增益恒等于1，<strong>即全通滤波器并不滤波</strong>。一般全通滤波器 <strong>用于移相</strong>，也就是说，对输入信号的相位进行改变，理想情况是相移与频率成正比，相当于一个时间延时系统。</p>
</li>
<li><p>按所采用的元器件分为 <strong>无源</strong> 和 <strong>有源</strong> 滤波器两种。</p>
<ul>
<li>无源滤波 常见有 <strong>LC无源滤波</strong>，<strong>RC无源滤波</strong>，<strong>特殊元件无源滤波（应用较少）</strong> 等。<ul>
<li>LC滤波器中的 L电杆 和 C电容 都是理想元件，本身不耗能，但电杆体积较大，现一般不使用。</li>
<li>RC滤波器中的 R电阻 是会消耗能量的。</li>
</ul>
</li>
<li>有源滤波 常见有 <strong>RC有源滤波</strong>。</li>
</ul>
</li>
<li><p>按照传递函数微分方程的介数分为 <strong>一阶滤波器</strong>、<strong>二阶滤波器</strong> 及 <strong>高阶滤波器</strong>。</p>
</li>
<li><p>根据滤波器的安放位置不同，一般分为 <strong>板上滤波器</strong> 和 <strong>面板滤波器</strong>。</p>
<p>  <strong>板上滤波器</strong>安装在线路板上，如PLB、JLB系列滤波器。这种滤波器的优点是经济，缺点是高频滤波效果欠佳。其主要原因是：</p>
<blockquote>
<p>1、滤波器的输入与输出之间没有隔离，容易发生耦合；</p>
<p>2、滤波器的接地阻抗不是很低，削弱了高频旁路效果；</p>
<p>3、滤波器与机箱之间的一段连线会产生两种不良作用： 一个是机箱内部空间的电磁干扰会直接感应到这段线上，沿着电缆传出机箱，借助电缆辐射，使滤波器失效；另一个是外界干扰在被板上滤波器滤波之前，借助这段线产生辐射，或直接与线路板上的电路发生耦合，造成敏感度问题；</p>
</blockquote>
<p>  滤波阵列板、滤波连接器等<strong>面板滤波器</strong>一般都直接安装在屏蔽机箱的金属面板上。由于直接安装在金属面板上，滤波器的输入与输出之间完全隔离，接地良好，电缆上的干扰在机箱端口上被滤除，因此滤波效果相当理想。</p>
</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/image-20210509151758365.png" alt="image-20210509151758365"></p>
<p><img src="https://pic.islet.space/2021/05/image-20210509152214883.png" alt="image-20210509152214883"></p>
<h2 id="常用滤波器"><a href="#常用滤波器" class="headerlink" title="常用滤波器"></a>常用滤波器</h2><h3 id="有源滤波及无源滤波比较"><a href="#有源滤波及无源滤波比较" class="headerlink" title="有源滤波及无源滤波比较"></a>有源滤波及无源滤波比较</h3><table>
<thead>
<tr>
<th></th>
<th>无源滤波（Passive Filter）</th>
<th>有源滤波（Active Filter）</th>
</tr>
</thead>
<tbody><tr>
<td>组成</td>
<td>仅由无源元件(R、L 和C)组成<br>即不使用任何需要电源的器件</td>
<td>由无源滤波 + 有源器件（如运放）组成</td>
</tr>
<tr>
<td>优点</td>
<td>- 电路比较简单<br>- 不需要直流电源供电<br>- 可靠性高</td>
<td>- 输出阻抗可以很低<br>- 可以使用放大器进行增益<br>- 不使用电感，因为电感是高容差型元件，频率较低时，体积会很大<br>- 通带内的信号不仅没有能量损耗，而且还可以放大<br>- 负载效应不明显<br>- 多级相联时相互影响很小<br>- 利用级联的简单方法很容易构成高阶滤波器<br>- 并且滤波器的体积小、重量轻、不需要磁屏蔽(由于不使用电感元件）；</td>
</tr>
<tr>
<td>缺点</td>
<td>- 通带内的信号有能量损耗<br>- 负载效应比较明显<br>- 使用电感元件时容易引起电磁感应<br>- 当电感L较大时滤波器的体积和重量都比较大，在低频域不适用。</td>
<td>- 通带范围受有源器件(如集成运算放大器）的带宽限制，需要直流电源供电<br>- 可靠性不如无源滤波器高，在高压、高频、大功率的场合不适用。</td>
</tr>
<tr>
<td>应用场景</td>
<td>电源滤波器<br>廉价且噪声较高的电源<br>处理10MHz以上的高频信号</td>
<td>不能应用于电源滤波，因为有源滤波也需要其他电源进行供电</td>
</tr>
</tbody></table>
<p>注意：有源滤波器的设计所用运算放大器的频率通常要比设计截止频率高100倍左右，具体数值取决于峰化和其他多种因素。即（目前）无法使用有源滤波器处理10MHz以上的高频信号，这需要GHz规格的有源滤波器。</p>
<h3 id="数字滤波器和模拟滤波器比较"><a href="#数字滤波器和模拟滤波器比较" class="headerlink" title="数字滤波器和模拟滤波器比较"></a>数字滤波器和模拟滤波器比较</h3><table>
<thead>
<tr>
<th></th>
<th>数字滤波器</th>
<th>模拟滤波器</th>
</tr>
</thead>
<tbody><tr>
<td>优点</td>
<td>- 可编程（有一组系数和一个时钟频率，容易更改）<br>- 可重复性（即可复用性，数字滤波器的特性受环境影响较小）<br>- 采用FIR滤波器，会产生（框架中固有的）恒定时间的延迟（应该是受计算性能影响）</td>
<td>- 无混叠（No aliasing）<br>- 降低对数字滤波的要求<br>- 降低对ADC的要求</td>
</tr>
</tbody></table>
<p>注意：在数字滤波器中，一个超过奈奎斯特频率的频率通过ADC时，滤波器将无法区分该频率和较低的频率。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210509162541363.png" alt="image-20210509162541363"></p>
<h3 id="数字滤波器"><a href="#数字滤波器" class="headerlink" title="数字滤波器"></a>数字滤波器</h3><p><strong>定义</strong></p>
<p>数字滤波器是与模拟滤波器相对应的，我们在常用的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%A6%BB%E6%95%A3%E7%B3%BB%E7%BB%9F/9719813">离散系统</a>中， 使用数字滤波器。它的主要作用是利用离散时间系统的特性，在这里 时间就是一个变量，然后在对外部输入的信号，进行处理，这里的输 入信号一般都是广义上的波形型号，信号可以是电压、电流、功率等。  当然也有类似于频率等这种。在实际的操作中，我们也可以把输入的信号波形变成输出，也就是将输入和输出倒置。从而实现我们将信号的频谱修改的目的。</p>
<p><strong>实现技术手段</strong></p>
<p>数字滤波器有多种方式可以实现信号的处理，我们介绍在实际中使用最多的两种，一种是我们集成电路的方式将集成电路的各种元器件组成一个专用的设备，这种设备称之为<strong>数字信号处理机</strong>，类似于arm架构或者单片机架构的数字处理机就是我们常用的一种，这种方式对于成套批量的需求商用价值比较高，因为造价成本比较低，受到了市场的欢迎；另一种就是使用我们平常使用的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/x86/6150538">x86</a>/<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/x64/8161446">x64</a>的商用或者工控计算机进行模拟仿真，这个完全是使用应用软件进行仿真的，这种方式也在实验室或者大型的数字滤波项目中使用，这种方式成本较高，不适宜与大批量的生产与配套。但是在实验室是最好的一种模拟方式，在高阶模拟和运算中有非常大的优势。</p>
<p><strong>数字滤波器的对比</strong></p>
<p>数字滤波器主要有两种，一种是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/IIR/875808">IIR</a>，我们称之为<strong>无限的冲激响应滤波器</strong>，另外一种是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/FIR/345936">FIR</a>，这种滤波器是与IIR相对应的，这个是<strong>有限的冲激响应滤波器</strong>。</p>
<p>两个系统都是有各自的特点的，FIR的滤波器是没有闭环的反馈的环路信号，它的结构比较简单，可以实现比较严格的线性方程的相位的计算，一般情况下<mark>相位的要求不严格一般不会使用FIR滤波器</mark>，相反的话，会采用这种滤波器。</p>
<p>当然在很多的场景下面，我们要对信号进行一些实时的处理，当现场的信号数据越来越多的情况下，我们对硬件的性能要求就越来越高，市面上很多的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8D%95%E7%89%87%E6%9C%BA/102396">单片机</a>已经无法满足我们实际的功能需求，一般的8位的16位的乃至32位的单片机以及<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ARM/7518299">ARM</a>芯片已经不能在对算法进行支撑，由于专门为数字处理设计的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/DSP/74514">DSP</a>控制器的出现，提高了我们滤波器的效率，DSP很多情况下可以使用多组总线的方式，并行处理多组实时的数据，独立的一些算法器充分的使用大大提高了我们滤波器的效率。</p>
<p>对于硬件上的短板完全可以由DSP的芯片进行弥补，做到对数字信号的实时处理与计算。DSP与普通的微处理器相比有很大的数字信号的处理优势，他是单片机以及ARM的继承，为信号处理做了一些局部的开发和改进，大大的增强了数字处理的能力，它有特定的数据流程格式、有特定的算法器，有特殊的系统结构为解决复杂的数字信号的处理提供了很多优越的条件和基础，通过对DSP的编程可以实现IIR滤波器。  FIR滤波器实际上有一定的缺陷，这类系统只有零点，它不会跟IIR系统的那样容易获取比较好衰减的特性，但是也有更加明显的优势。他是通过非硬件电路实现的，相比硬件电路实现滤波器主要优点有很多，例如，效率很高、有极点、有反馈等。</p>
<h3 id="程控滤波系统"><a href="#程控滤波系统" class="headerlink" title="程控滤波系统"></a>程控滤波系统</h3><p>程控滤波系统是在传统滤波器的不足中提出的，传统滤波器在工作时产生误差，会影响整个系统的精确度。低精度的滤波器在使用时会造成很多不良后果，而且传统滤波器对波形要求越高就意味着需要跟多的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BF%90%E6%94%BE/1527937">运放</a>，这是非常麻烦的。所以程控滤波器的数字化能够减少生产过程中的不确定因素和人为参与的环节数，可以有效地解决电源模块中诸如可靠性、智能化和产品一致性等工程问题，极大地提高生产 效率和产品的可维护性。</p>
<h3 id="无源滤波器"><a href="#无源滤波器" class="headerlink" title="无源滤波器"></a>无源滤波器</h3><p>无源滤波器是利用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%94%B5%E9%98%BB/3315365">电阻</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%94%B5%E6%8A%97%E5%99%A8/7397303">电抗器</a>和<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%94%B5%E5%AE%B9%E5%99%A8/1087619">电容器</a>元器件构成的滤波电路。谐振频率时，电路阻抗值最小，非谐振频率时，电路阻抗比很大，将电路元器件数值调整到某一特征谐波频率，则能滤除该次谐波电流；当若干谐波频率的调谐电路组成在一起，则能滤除对应的特征谐波频率，通过低阻抗旁路实现对主要次数谐波（3、5、7）的过滤。主要原理就是针对不同次数谐波，设计该谐波频率的阻抗为很小，实现谐波电流的分流效应，即为预滤除的高次谐波提供旁路通道，实现净化波形。</p>
<p>无源滤波器按接线形式可分为电容滤波器、电厂滤波电路、L型RC滤波电路、π形RC滤波电路、多节π形RC 滤波电路、π形LC滤波电路。按功能可分为<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8D%95%E8%B0%83%E8%B0%90%E6%BB%A4%E6%B3%A2%E5%99%A8/10801261">单调谐滤波器</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%8F%8C%E8%B0%83%E8%B0%90%E6%BB%A4%E6%B3%A2%E5%99%A8/10801292">双调谐滤波器</a>、高通滤波器。无源滤波器具有如下优势：结构  形式简单、投资费用低，能够补偿系统中的无功分量、改善电网功率因数；工作稳定性较高、维护简单、技术成熟等，在有源滤波器出现以前被广泛采用。无源滤波器的缺点也有很多方面：受电网参数的影响较大，系统阻抗值和主要次数谐振频率往往随着工况发生变化；谐波滤除的频带也较窄，只能滤除主要次数的谐波，或因发生<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%B9%B6%E8%81%94%E8%B0%90%E6%8C%AF/9876961">并联谐振</a>，放大一些次数的谐波；滤波和无功补偿及调压之间的协调较困难 ；随着流经滤波器的电流升高，可能造成设备过负荷运行；耗材多，重量和体积都较大；运行稳定性较差等缺点。因此，整体性能更优的有源滤波器得到越来越多的应用。 [4] </p>
<h3 id="有源滤波器"><a href="#有源滤波器" class="headerlink" title="有源滤波器"></a>有源滤波器</h3><p>有源滤波器主要作用不仅能动态追踪并抑制谐波，而且可以补偿电网中较低的无功分量。它能够对幅值和频率都波动的高次谐波分量进行补偿，以及对变化的系统无功分量进行动态补偿，克服了传统型式谐波治理方案和无功补偿的缺点，达到了动态跟踪补偿的效果。<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/APF/15286545">APF</a>的基本原理是检测当前系统的电压和电流信号，通过指令电流运算电路的运算，产生补偿电流信号，并将其指令由补偿电流发生电路按谐波信号放大，从而得到补偿电流，再与系统中的高次谐波分量及无功等电流抵消，实现系统波形的正弦化，滤除电网谐波，提高电能质量。有源滤波器和无源滤波器的区别，在于需要电源供电，且既补谐波又补无功。指令电流运算电路和补偿电流发生电路是有源滤波器的两个重要组成部分。指令电流运算电路的作用是检测出系统所需补偿的谐波分量和无功分量等。补偿电流发生电路的作用是按照上述检测到的谐波分量和无功分量，发出补偿电流指令，产生能够抵消的补偿电流，它主要由三部分构成 ：电流跟踪控制电路、驱动电路和主电路。 </p>
<p>根据储能元件的不同，有源滤波器可以分为电压型有源滤波器和电流型有源滤波器。电压型有源滤波器，因其损耗少、效率高，被广泛使用。电流型有源滤波器，因损耗大、效率低，而较少采用。按照交直流电源可分为直流 APF 和交流 APF。按照电路拓朴结构分类，可分为串联型 APF、并联型 APF 和串并联型，以及APF和<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/PPF/2374493">PPF</a>的混合型使用方式。与无源滤波器相比，有源滤波器有许多优点：响应速度快，可控性能非常强；具有自适应功能，能够动态跟踪和补偿系统高次谐波；稳定性高，不受系统阻抗影响，避免谐振的发生；能够抑制闪变；补偿系统不足的无功分量等。机柜式系统采用模块化结构，联络设计细密，可随时根据现场实际需求扩容，可拓展性强，模块化的配置方式和小巧的体积让设计者有更多的选择，并可最大程度节省用户空间，可实现弹性的容量配置，支持后续现场容量扩展。现场安装和维修维护更是简单拔插即可。  抽屉式结构，能够满足用户单独对模块设计，选用优良的架构形式，具备DSP处理能力，运用大型可编程控制器操作，选用大功率电力电子组件，具有可外传的通信端口，还可附于其他盘柜中独立工作。 [4] </p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>板上滤波器虽然对高频的滤波效果不理想，但是如果应用得当，可以满足大部分民用产品<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%94%B5%E7%A3%81%E5%85%BC%E5%AE%B9">电磁兼容</a>的要求。在使用时要注意以下事项：</p>
<p>如果决定使用板上滤波器，在布线时就要注意在电缆端口处留出一块“干净地”，滤波器和连接器都安装在“干净地”上。通过前面的讨论，可知信号地线上的干扰是十分严重的。如果直接将电缆的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%BB%A4%E6%B3%A2%E7%94%B5%E5%AE%B9">滤波电容</a>连接到这种地线上，会造成严重的 <strong>共模辐射</strong> 问题。为了取得较好的滤波效果，必须准备一块干净地。并与信号地只能在一点连接起来，这个流通点称为“桥”，所有<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BF%A1%E5%8F%B7%E7%BA%BF">信号线</a>都从桥上通过，以减小信号环路面积。</p>
<p><strong>并排设置</strong>：同一组电缆内的所有<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%AF%BC%E7%BA%BF">导线</a>的未滤波部分在—起，已滤波部分在一起。否则，一根导线的耒滤波部分会将另一根导线的已滤波部分重新污染使电缆整体滤波失效。</p>
<p><strong>靠近电缆</strong>：滤波器与面板之间的导线的距离应尽量短。必要时，使用金属板遮挡一下，隔离近场干扰。</p>
<p><strong>与机箱接</strong>：安装滤波器的干净地要与金属机箱可靠地搭接起来，如果机箱不是金属的，就在线路板下方设置一块较大的金属板来作为滤波地。干净地与金属机箱之间的搭接要保证很低的射频阻抗。如有必要，可以使用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%94%B5%E7%A3%81">电磁</a>密封衬垫搭接，增加搭接面积，减小射频阻抗。</p>
<p><strong>接地线短</strong>：考虑到<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BC%95%E8%84%9A">引脚</a>的电感效应，其重要性前面已讨论，滤波器的局部布线和设计线路板与机箱（金属板）的连接结构时要特别注意。</p>
<h1 id="滤波电容"><a href="#滤波电容" class="headerlink" title="滤波电容"></a>滤波电容</h1><iframe src="//player.bilibili.com/player.html?aid=497834686&bvid=BV1yK411V74V&cid=181383906&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<p><strong>旁路</strong>：一般出现在电路的输入端，为交流信号提供一个分支，滤除不需要的交流成分。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210509154852357.png" alt="image-20210509154852357"> <img src="https://pic.islet.space/2021/05/image-20210509155438601.png" alt="image-20210509155438601"></p>
<p>下图是带有低频扰动和高频尖刺的直流信号，使用所示电路对该信号进行过滤，可获得稳定直流信号。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210509155705572.png" alt="image-20210509155705572"> <img src="https://pic.islet.space/2021/05/image-20210509155806309.png" alt="image-20210509155806309"></p>
<p>其中，0.1uF 用于滤除高频成分；1000uF 用于滤除/抵抗 <strong>低频扰动</strong> 信号。</p>
<p><strong>去耦</strong>：既有 <strong>滤波</strong> 的作用也有 <strong>储能</strong> 的作用。</p>
<p>当芯片电路需要拉去较大的电压时，VCC可能会突然供电不足，此时用于VCC的去耦电容发挥了储能的作用，为芯片电路提供较稳定的电源。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210509155156432.png" alt="image-20210509155156432"></p>
<iframe src="//player.bilibili.com/player.html?aid=752864529&bvid=BV1kk4y1R7TZ&cid=178561019&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

<img src="https://pic.islet.space/2021/05/image-20210509154226811.png" alt="image-20210509154226811" style="zoom:50%;" />





<h1 id="运算放大器"><a href="#运算放大器" class="headerlink" title="运算放大器"></a>运算放大器</h1><h2 id="运放定义"><a href="#运放定义" class="headerlink" title="运放定义"></a>运放定义</h2><p>同相输入端，V<del>p</del>和V<del>n</del> 。</p>
<p>虚短：</p>
<p>虚断：</p>
<h2 id="运放分类"><a href="#运放分类" class="headerlink" title="运放分类"></a>运放分类</h2><p>按照电源电压分类：单端运放、双端运放。</p>
<p>单端运放是指运算放大器的供给电源为正向电源和地；双端运放是指运算放大器的供给电源为正向电源和负向电源。</p>
<h1 id="增益与音量"><a href="#增益与音量" class="headerlink" title="增益与音量"></a>增益与音量</h1><h2 id="增益"><a href="#增益" class="headerlink" title="增益"></a>增益</h2><blockquote>
<p><strong>增益(Gain)的一般含义简而言之就是放大倍数</strong>。</p>
<p>在电子学上，通常为一个系统的讯号输出与讯号输入的比率，如天线增益表示定向天线辐射集中程度的参数，为定向天线和无方向天线在预定方向产生的电场强度平方之比。<strong>放大器增益</strong>，表示放大器功率放大倍数，以输出功率同输入功率比值的常用对数表示等。</p>
</blockquote>
<p>增益一般指对元器件、电路、设备或系统，其电流、电压或功率增加的程度，以分贝(dB)数来规定，即增益的单位一般是分贝（dB），是一个<strong>相对值</strong>。电子学上常使用对数单位量度增益，并以贝（bel）作为单位：</p>
<ul>
<li>Gain = log<del>10</del>( <em>P<del>2</del></em> / <em>P<del>1</del></em> ) bel</li>
</ul>
<p>其中P1与P2分别为输入及输出的功率。</p>
<p>由于增益的数值通常都很大，因此一般都使用分贝来表示：</p>
<ul>
<li>Gain = 10×log<del>10</del>( <em>P<del>2</del></em> / <em>P<del>1</del></em> ) dB</li>
</ul>
<p>这就是增益的绝对值与相对值分贝之间的关系。</p>
<h3 id="常见增益"><a href="#常见增益" class="headerlink" title="常见增益"></a>常见增益</h3><h4 id="天线增益"><a href="#天线增益" class="headerlink" title="天线增益"></a>天线增益</h4><p>天线增益是指：在输入功率相等的条件下，实际天线与理想的辐射单元在空间同一点处所产生的信号的功率密度之比。天线增益是入网测试时极其重要的标准，它表示了天线的方向性和信号能量的集中程度。增益的大小影响天线发射信号覆盖范围和强度。主瓣越窄，旁瓣越小，能量就会越集中，那么天线增益越高。 </p>
<p> 一般来说，增益的提高主要依靠减小垂直面向辐射的波瓣宽度，而在水平面上保持全向的辐射性能。天线增益对移动通信系统的运行质量极为重要，因为它决定蜂窝边缘的信号电平。增加增益就可以在一确定方向上增大网络的覆盖范围，或者在确定范围内增大增益余量。任何蜂窝系统都是一个双向过程，增加天线的增益能同时减少双向系统增益预算余量。</p>
<p>天线增益的单位一般有两种：<strong>dBi</strong>与<strong>dBd</strong>，其中dBi是以理想点源天线为参考的基准，在各方向的辐射是均匀的；dBd是以半波阵子（偶极子）的天线为参考基准，相对于对称阵子天线的增益dBi=dBd+2.15。相同的条件下，增益越高，电波传播的距离越远。一般地，GSM定向基站的天线增益为18dBi，全向的为11dBi。同一个天线增益，dBi比dBd在数值上大2.15 dB。</p>
<h4 id="放大器增益"><a href="#放大器增益" class="headerlink" title="放大器增益"></a>放大器增益</h4><p>放大器增益是放大器输出功率与输入功率比值的对数，用以表示功率放大的程度。亦指电压或电流的放大倍数。同样，分贝就是放大器增益的单位。</p>
<p>放大器输出与输入的比值为放大倍数，单位是“倍”，如10倍放大器，100倍放大器。</p>
<p>当改用“分贝”做单位时，放大倍数就称之为增益，这是一个概念的两种称呼。电学中分贝与放大倍数的转换关系为：</p>
<p>AV(I)(dB)=20lg[V<del>o</del>/V<del>i</del>(I<del>o</del>/I<del>i</del>)]；Ap(dB)=10lg(P<del>o</del>/P<del>i</del>)</p>
<p>分贝定义时 <strong>电压(电流)增益</strong> 和 <strong>功率增益</strong> 的公式不同，但我们都知道功率与电压、电流的关系是P=V^2/R=I^2R。采用这套公式后，两者的增益数值就一样了：</p>
<p>10lg[P<del>o</del>/P<del>i</del>]=10lg(V<del>2o</del>/R)/(V<del>2i</del>/R)=20lg(V<del>o</del>/V<del>i</del>)。</p>
<p>使用分贝做单位有很大好处。<br>电子系统的总放大倍数常常是几千、几万甚至几十万，一架收音机从天线收到的信号至送入喇叭放音输出，一共要放大2万倍左右。用分贝表示先取个对数，数值就小得多。放大器级联时，总的放大倍数是各级相乘。用分贝做单位时，总增益就是相加。若某功放前级是100倍(20dB)，后级是20倍(13dB)，那么总功率放大倍数是100×20=2000倍，总增益为<code>20dB+13dB=33dB</code>。</p>
<h4 id="功率增益"><a href="#功率增益" class="headerlink" title="功率增益"></a>功率增益</h4><p>功率增益（Power gain）是指一个电路里输出功率和输入功率的比例。不像其他的信号增益，例如电压增益和电流增益，功率增益由于“输入功率”和“输出功率”本身有着相对模糊的定义，因此有时显得有点混淆。</p>
<p>三种重要的功率增益包括：<strong>运算功率增益</strong>（operating power gain）、<strong>转换功率增益</strong>（transducer power gain）和 <strong>有效功率增益</strong>（available power gain）。</p>
<p style="color: #aaa; font-style: italic;">值得注意的是，上述三种增益的定义均基于功率的平均效果，而非瞬时功率，不过“平均”二字经常被省略，在有的情况会引起混淆。</p>



<h4 id="环路增益"><a href="#环路增益" class="headerlink" title="环路增益"></a>环路增益</h4><p>环路增益（loop gain）为电子学及控制工程的名词，是指一反馈回路中的总增益，一般会以比例或是分贝表示。</p>
<p>环路增益常用在放大器及电子振荡器的线路中，后来更扩展到控制工厂及设备的工业控制系统中。环路增益的概念也用在生物学中。在反馈回路中，为了控制输出，会量测设备、程序的输出，取样后，再以此影响输入信号，使输出控制的更理想。环路增益和环路相位移决定了设备的特性，也决定输出是否稳定，或是不稳定（振荡）。</p>
<p>海因里希·巴克豪森在1921年最早发现环路增益在电子反馈放大器特性分析中的重要性，后来在1930年代由贝尔实验室的亨德里克·韦德·波德及哈里·奈奎斯特继续发展。<br>在通讯上，环路增益可以指载波终端或是二线中继器上的可用功率增益。最大的可用增益是由闭回路的总损失决定，可用增益不能大于总损失。</p>
<h2 id="Volume-音量"><a href="#Volume-音量" class="headerlink" title="Volume/音量"></a>Volume/音量</h2><p>音量(Volume)又称音强、响度，是指人耳对所听到的声音大小强弱的主观感受，其客观评价尺度是声音的振幅大小。这种感受源自物体振动时所产生的压力，即声压。物体振动通过不同的介质，将其振动能量传导开去。人们为了对声音的感受量化成可以监测的指标，就把声压分成“级”——声压级，以便能客观的表示声音的强弱，其单位称为“分贝”（dB）。</p>
<p>音量影响的是后级最终输出的响度。</p>
<h2 id="增益和音量的关系"><a href="#增益和音量的关系" class="headerlink" title="增益和音量的关系"></a>增益和音量的关系</h2><p>增益多与“敏感度”相关，比方说：你的麦克风需要更“灵敏”吗？那么就把增益开大些。但是增益开得过大，信噪比会降低，底噪声就会更加明显。还会因电流输出限制产生削波失真。 这就是我们所说的“过载”效果的真正来源。也是很多朋友想要通过开大clean通道的volume去制造过载却不明显的原因。</p>
<p>如果把增益开大，把音量关小的话，可以得到过载的效果。很多60,70年代的音乐作品中可以听到这种音色；关小增益开大音量的话，音符会很清晰，颗粒性也很好。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/05/Signal/2021-05-05-%E6%A8%A1%E6%95%B0%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84%E5%8F%AF%E7%BC%96%E7%A8%8B%E5%A2%9E%E7%9B%8A%E6%94%BE%E5%A4%A7%E5%99%A8%EF%BC%88PGA%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/05/Signal/2021-05-05-%E6%A8%A1%E6%95%B0%E6%8E%A5%E5%8F%A3%E4%B8%AD%E7%9A%84%E5%8F%AF%E7%BC%96%E7%A8%8B%E5%A2%9E%E7%9B%8A%E6%94%BE%E5%A4%A7%E5%99%A8%EF%BC%88PGA%EF%BC%89/" class="post-title-link" itemprop="url">模数接口中的可编程增益放大器（PGA）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-05 23:58:32" itemprop="dateCreated datePublished" datetime="2021-05-05T23:58:32+08:00">2021-05-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-20 22:53:04" itemprop="dateModified" datetime="2021-05-20T22:53:04+08:00">2021-05-20</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Signal/" itemprop="url" rel="index"><span itemprop="name">Signal</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>原文出处：<a target="_blank" rel="noopener" href="https://www.21ic.com/app/analog/201207/134812.htm">https://www.21ic.com/app/analog/201207/134812.htm</a></p>
<p>用可编程增益放大器(PGA)处理数据采集系统中传感器/变送器模拟输出和信号处理数字之间的接口。单片和高集成度PGA现在被可编程、更高精度、更高吞吐量和更小封装尺寸的模块和混合方案替代。 </p>
<p>由于来自传感器/变送器的模拟信号的本性，使其工作必须具备相当大的动态范围。这要求采用连续增益级在进行任何实际的数字处理之前增大这些信号，PGA能满足这种要求。 </p>
<p>PGA是可变增益放大器(VGA)的一种。VGA提供可变和连续增益控制，而PGA <mark>必须在软件控制下以固定步(通常6dB步)做到可变增益控制</mark>。达到更精细的分辨步0.5dB是可能的。 一般多通道数据采集系统用很多不同类型的传感器/变送器，这包括 <strong>热电偶</strong>、<strong>惠斯登电桥</strong>，<strong>热敏电阻</strong>、<strong>应变计</strong> 和 <strong>超声系统</strong>。虽然，传感器/变送器是基于不同的物理原理，但大多数产品是 <strong>以电压做为输出</strong>。甚至这会产生中间值(如电容或电阻)，但最终变换为电压，以便在数据采集系统中进行</p>
<p><img src="http://pic.islet.space/2021/04/fb222bc5a544088d5a7fc0c708476621.jpg"></p>
<p>传感器/变送器的输出可覆盖非常大的范围，需要PGA来处理传感器/变送器输出到ADC的接口。</p>
<blockquote>
<p>例如，在工业过程控制系统中，低频信号可以几毫伏到几伏变化。需要PGA来匹配这种宽传感器/变送器输出范围到特定的ADC输入范围。通常，在输入数据采集通道最低信号电平与最高信号电平之比是2个量级或更大。  12位ADC接收小于ADC满标输入十分之一的信号仅可提供8位分辨率，除非在信号到达ADC之前用PGA放大。PGA允许在软件控制下使接收信号的增益达到宽范围增益一带宽乘积。这可避免钳位并允许采用较便宜的ADC，如用12位ADC替代16位ADC。 </p>
</blockquote>
<p>PGA可做更多事情。PGA缓冲来自前级(通常是多路转换器)ADC的输入，防止多路转换器导通电阻所引起的加载。PGA也提供差分别单端的变换，大多数跟踪和保持型ADC需要单输入。把PGA连接到差分多路转换器输出时，PGA提供共模抑制。 </p>
<p>在市场上可以得到很多种PGA和支持元件。这包括可独立应用的运放被专门设计成PGA、ASIC、集成有可编程滤波器的PGA、仪表放大器PGA、用于运放的数字电位器前端、PGA用数字可编程分压器、ADC驱动器。有时把PGA和DAC集成在同一芯片上。 </p>
<p>对于不需要信号宽动态范围的应用，PGA不是必须的。放大器可以直接接口传感器/变送器到ADC。</p>
<blockquote>
<p>例如，Maxim的MAX1494仪表放大器适合于250V/V或更小增益范围的应用。 </p>
</blockquote>
<h1 id="各种性能的PGA"><a href="#各种性能的PGA" class="headerlink" title="各种性能的PGA"></a>各种性能的PGA</h1><p>对于特殊性能参量(如高增益稳定性和高精度，低漂移，低失真，高输出驱动电流，高转换率，快速建立时间，高共模抑制比，低功率和小尺寸)有很多PGA是最佳的。 </p>
<blockquote>
<ul>
<li>Microchip公司的MCP6S2X家族PGA具有2、6和8通道输入，包含多路转换器并可通过串行外设接口(SPI)总线进行增益控制和通道选择。</li>
<li>NS公司的LMH6718IC是双PGA，具有高输出(200mA)驱动信号。  </li>
<li>高性能小封装的PAG有ADI公司的AD8555，这是封装在微型8引线SOIC中的数字可编程信号调理自动零放大器，它包含放大器，比较器，用Digit  Trim技术的电阻调节分压器和缓冲器。其500V/℃总输入失调漂移是其他竞争产品的1/20。</li>
<li>Linear公司的LTC6915A也是小封装高性能PGA。此仪表放大器封装为16引线SSOP或12引线DFN，可把它放置在最靠近传感器/变送器的地方。它所占电路板面积是等效分立方案的1/6。零漂移特性具有高达4096的宽可编程动态范围(增益精度0.1%)。它也有50mV/℃漂移和与增益无关的125dB CMRR。  </li>
<li>对于低失真是主要考虑因素的应用，可以选择Intersil公司PGA缓冲器HFA11XX，其低失真电平低到-73dBc、噪声电平低到7”9nV/√Hz。</li>
<li>TI公司的THS7001/7002单/双PGA采用Power PAD封装，包含分离的低噪声前置放大器和增益放大级。此器件可达到非常低的噪声电平(低到1.7nV/√Hz)。 </li>
<li>其他可注意的PGA包括ADI公司的AD628首款具有可编程增益的共模差分放大器和Linear公司的LTC1564 PGA(除放大器外，它还具有8阶软件可编程抗混淆滤波器)。 </li>
</ul>
</blockquote>
<p>PGA也集成有其他前端电路。</p>
<blockquote>
<p>如Maxim公司的MAX14XX家族，这是包含PGA的信号调理ASIC。这种器件直接用于传感器/变送器和ADC之间。</p>
<p>Maxim公司的ADC驱动器MAX2055具有低失真(-76dBc 2次谐波和-69dBc 3次谐波)特性，其差分输出是为驱动高速ADC专门设计的。 </p>
</blockquote>
<p>一些PGA供应商也提供驱动PGA前端的数字电位计和分压器IC。</p>
<blockquote>
<p>例如，Maxim公司的MAX5420/21数字可编程电压分压器；</p>
<p>ADI公司的AD5321数字电位计(常用于可编程增益和衰减的非易失性存储器)。  </p>
<p>另外，Xicor也提供不少PGA器件，这些PGA器件对于执行数字控制的电位计(DCP)是最佳的。  </p>
</blockquote>
<h1 id="集成方案"><a href="#集成方案" class="headerlink" title="集成方案"></a>集成方案</h1><p>现在，很多公司把PGA和其他信号调理电路直接集成在ADC芯片上。这种方法有利于所占空间更小，比分离PGA和ADC方案具有更好的性能。然而，其成本比较高，集成PGA在ADC上除灵活性较低外，还有 <mark>较高的时钟噪声电平</mark>。 </p>
<blockquote>
<p>带线化前端的Maxim公司的MAX1457(图2)传统器线性化IC就是其中一种，它包含12位ADC。</p>
<p>ADI公司的ADC7707高精度信号调理16位S-D  ADC包含多路转换器、缓冲器、PGA、电荷平衡电路、串行接口和时钟产生器。</p>
<p>ADI公司的ADC7708/18S-D6位/24位ADC具有与AD7707相同的电路，但它们的目标是低电压和低功率应用。 </p>
</blockquote>
<p><img src="http://pic.islet.space/2021/04/8b55f596bcfdf9a408bd3c959504fb21.jpg" alt="img"></p>
<p>一个感兴趣的高集成度ADC是ADC7731  24位S-D器件，它具有ADC77017的所有电路。另外，还加上定标微控制器(图3)。此IC的目标是低噪声高吞吐量应用。</p>
<p>Maxim公司也有带集成PGA的双6位ADC，它具有90Sample/s吞吐率、功耗仅550mW。 </p>
<p><img src="http://pic.islet.space/2021/04/8CzZ7BjS2OMEYQJ.jpg"></p>
<p>我们将会看到更多包含PGA和其他信号处理电路的ADC吗？</p>
<p>不可回避的事实是高集成度是IC业的准则，而PGA和其他信号调理支持电路也不例外。所以希望看到PGA与ADC集成在同一芯片，并能解决片上性能参量(如时钟引起的噪声)和降低高分辨率器件的单个ADC价格。</p>
<p>事实上，设计人员主要的目标是把传感器/变送器电路放在高集成度ADC上。</p>
<p>这将是最终解决问题：现实世界模拟信号与计算机的数字世界结合起来的途经。</p>
<p>这也将聚焦在模拟和数字电路设计的两种不同方法。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/05/Signal/2021-05-05-%E5%88%86%E8%B4%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/05/Signal/2021-05-05-%E5%88%86%E8%B4%9D/" class="post-title-link" itemprop="url">分贝</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-05 14:30:32" itemprop="dateCreated datePublished" datetime="2021-05-05T14:30:32+08:00">2021-05-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-09 13:01:39" itemprop="dateModified" datetime="2021-05-09T13:01:39+08:00">2021-05-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Signal/" itemprop="url" rel="index"><span itemprop="name">Signal</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%88%86%E8%B2%9D">Wikipedia</a></p>
<h1 id="分貝"><a href="#分貝" class="headerlink" title="分貝"></a>分貝</h1><p><strong>分贝</strong>（decibel）是量度两个相同单位之数量<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AF%94%E4%BE%8B">比例</a>的单位，常用<strong>dB</strong>表示。“<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%88%86">分</a>”（deci-）指十分之一，个位是“贝”或“贝尔”（bel，纪念发明家<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%9A%E5%8E%86%E5%B1%B1%E5%A4%A7%C2%B7%E6%A0%BC%E6%8B%89%E6%B1%89%E5%A7%86%C2%B7%E8%B4%9D%E5%B0%94">亚历山大·格拉汉姆·贝尔</a>），但一般只用分贝。</p>
<table>
<thead>
<tr>
<th>dB</th>
<th>声能比</th>
<th>声压比</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>100</td>
<td>10 000 000 000</td>
<td></td>
<td>100 000</td>
<td></td>
</tr>
<tr>
<td>90</td>
<td>1 000 000 000</td>
<td></td>
<td>31 623</td>
<td></td>
</tr>
<tr>
<td>80</td>
<td>100 000 000</td>
<td></td>
<td>10 000</td>
<td></td>
</tr>
<tr>
<td>70</td>
<td>10 000 000</td>
<td></td>
<td>3 162</td>
<td></td>
</tr>
<tr>
<td>60</td>
<td>1 000 000</td>
<td></td>
<td>1 000</td>
<td></td>
</tr>
<tr>
<td>50</td>
<td>100 000</td>
<td></td>
<td>316</td>
<td>.2</td>
</tr>
<tr>
<td>40</td>
<td>10 000</td>
<td></td>
<td>100</td>
<td></td>
</tr>
<tr>
<td>30</td>
<td>1 000</td>
<td></td>
<td>31</td>
<td>.62</td>
</tr>
<tr>
<td>20</td>
<td>100</td>
<td></td>
<td>10</td>
<td></td>
</tr>
<tr>
<td>10</td>
<td>10</td>
<td></td>
<td>3</td>
<td>.162</td>
</tr>
<tr>
<td>6</td>
<td>3</td>
<td>.981（≈4）</td>
<td>1</td>
<td>.995（≈2）</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>.995（≈2）</td>
<td>1</td>
<td>.413（≈√2）</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>.259</td>
<td>1</td>
<td>.122</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td></td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>-3</td>
<td>0</td>
<td>.501（≈½）</td>
<td>0</td>
<td>.708（≈√½）</td>
</tr>
<tr>
<td>-6</td>
<td>0</td>
<td>.251（≈¼）</td>
<td>0</td>
<td>.501（≈½）</td>
</tr>
<tr>
<td>-10</td>
<td>0</td>
<td>.1</td>
<td>0</td>
<td>.316 2</td>
</tr>
<tr>
<td>-20</td>
<td>0</td>
<td>.01</td>
<td>0</td>
<td>.1</td>
</tr>
<tr>
<td>-30</td>
<td>0</td>
<td>.001</td>
<td>0</td>
<td>.031 62</td>
</tr>
<tr>
<td>-40</td>
<td>0</td>
<td>.000 1</td>
<td>0</td>
<td>.01</td>
</tr>
<tr>
<td>-50</td>
<td>0</td>
<td>.000 01</td>
<td>0</td>
<td>.003 162</td>
</tr>
<tr>
<td>-60</td>
<td>0</td>
<td>.000 001</td>
<td>0</td>
<td>.001</td>
</tr>
<tr>
<td>-70</td>
<td>0</td>
<td>.000 000 1</td>
<td>0</td>
<td>.000 316 2</td>
</tr>
<tr>
<td>-80</td>
<td>0</td>
<td>.000 000 01</td>
<td>0</td>
<td>.000 1</td>
</tr>
<tr>
<td>-90</td>
<td>0</td>
<td>.000 000 001</td>
<td>0</td>
<td>.000 031 62</td>
</tr>
<tr>
<td>-100</td>
<td>0</td>
<td>.000 000 000 1</td>
<td>0</td>
<td>.000 01</td>
</tr>
</tbody></table>
<p>这是一个说明声源能量 (<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/87f9e315fd7e2ba406057a97300593c4802b53e4" alt="x">), 声压 (<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/d62b24be305beff66cba9bfbcc01a362ba390f44" alt="{\sqrt {x}}">)，与声音分贝数 dB (<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/be2b0b75f65fbc06b19e6e8548ce8ec33b0c0c4f" alt="{\displaystyle 10\log _{10}{x}}">) 正比关系的对照表 从声音分贝数 dB 只有 2<del>3 个数字的差异，相比声源或声压 9</del>10 个数字的差异，dB可<strong>帮助人们更快的理解数字代表的意义</strong>。</p>
<h2 id="计算方法"><a href="#计算方法" class="headerlink" title="计算方法"></a>计算方法</h2><p>分贝（dB）是十分之一贝尔（B）：<code>1B = 10dB</code>。1贝尔的两个功率量的比值是10:1，1贝尔的两个场量的比值是<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/2f35055a56f97ce282bf4797deddb716cfa8a924" alt="{\sqrt {10}}:1">[<a href="about:reader?url=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%E5%88%86%E8%B2%9D#cite_note-1">1]</a>。’</p>
<p>场量（field quantity）是诸如<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%94%B5%E5%8E%8B">电压</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%94%B5%E6%B5%81">电流</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%A3%B0%E5%8E%8B">声压</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%94%B5%E5%9C%BA%E5%BC%BA%E5%BA%A6">电场强度</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%80%9F%E5%BA%A6">速度</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%9B%BB%E8%8D%B7%E5%AF%86%E5%BA%A6">电荷密度</a>等量值，其平方值在一个线性系统中与功率成比例。功率量（power quantity）是功率值或者直接与功率值成比例的其它量，如<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%83%BD%E9%87%8F%E5%AF%86%E5%BA%A6">能量密度</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%9F%B3%E5%BC%BA">音强</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8F%91%E5%85%89%E5%BC%BA%E5%BA%A6">发光强度</a>等。 </p>
<p>分贝的计算，依赖于是 <strong>功率量</strong> 还是 <strong>场量</strong> 而不同。 </p>
<p>两个信号具有1分贝的差异，那么其功率比值是1.25892（即<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/99d92002d56747705f253a7c0aac2c7e4c310f20" alt="10^{\frac {1}{10}}\,">）而幅值之比是1.12202（即<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/a515a9617441696adc7fb0f3a2cd1f74210cee64" alt="{\sqrt {10}}^{\frac {1}{10}}\,">）[<a href="about:reader?url=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%E5%88%86%E8%B2%9D#cite_note-2">2]</a>。</p>
<h2 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h2><p>使用分贝有很多便利之处：</p>
<ul>
<li>分贝实际上是对数值，因此可以用常用的数量来表示非常大的比值，可以清楚地表示非常大的数量变化。</li>
<li>多部件系统的整体增益（如级联的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%94%BE%E5%A4%A7%E5%99%A8">放大器</a>）可以直接用各部件的增益分贝相加而求得。不必把这些增益值相乘（例如log(A × B × C) = log(A) + log(B) + log(C)）。</li>
<li>人对强度的感知，如声音或者光照，更接近与强度的对数成正比而不是强度值本身，依据<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%9F%8B%E4%BC%AF%E5%AE%9A%E7%90%86">韦伯定理</a>，因此分贝值可用于描述感知级别或级差。</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="声学"><a href="#声学" class="headerlink" title="声学"></a>声学</h3><p>声学中，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%A3%B0%E5%BC%BA">声音的强度</a>定义为声压。计算分贝值时采用20微帕斯卡为参考值[<a href="about:reader?url=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%E5%88%86%E8%B2%9D#cite_note-ElectronicEngineersHandbook-5">5]</a>。这一参考值是人类对声音能够感知的阈值下限。声压是场量，因此使用声压计算分贝时使用下述版本的公式： </p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/3994b439a75418d133c3c75063bdea671f5f16ae" alt="声音强度公式"></p>
<p>在空气中 <strong>1帕斯卡等于94分贝声压级</strong>。在其他介质，如水下，1微帕斯卡更为普遍[<a href="about:reader?url=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%E5%88%86%E8%B2%9D#cite_note-Morfey-6">6]</a>。这些标准被<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ANSI">ANSI</a>S1.1-1994.所收录[<a href="about:reader?url=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%E5%88%86%E8%B2%9D#cite_note-7">7]</a>。</p>
<p>人耳对声音感知具有很大的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8A%A8%E6%80%81%E8%8C%83%E5%9B%B4">动态范围</a>。从短期暴露即会永久损害听力的声强到最静的人耳能听到的声强，其比值是1万亿（10^12^）。[<a href="about:reader?url=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%E5%88%86%E8%B2%9D#cite_note-8">8]</a>这么大的比值范围表示为对数度量：1万亿（10^12^）基于10的对数为12，用分贝表示是240。人的听力并不是对所有频率都是相同敏感，最敏感的频率范围是20<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B5%AB%E5%85%B9">Hz</a>~20<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8D%83%E8%B5%AB%E5%85%B9">kHz</a>.</p>
<p>当一个空间受外来声音干扰，而影响预期的正常作息时，需要建置一个六面结构的宁静空间，而当宁静空间建置完成后，能否达到预期的效果，则于施工前制定一个规范，此规范即为声学规范。</p>
<h3 id="电子学"><a href="#电子学" class="headerlink" title="电子学"></a>电子学</h3><p>电子学中，通常用分贝表示功率或幅值之比（<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%A2%9E%E7%9B%8A">增益</a>），而不常用算术比或者百分比。一项好处是一些列部件组成的系统的总增益是各部件增益之和。类似的，电信领域中，从一个发射器到一个接收器通过一些媒介（<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/w/index.php?title=%E5%85%89%E6%97%A0%E7%BA%BF%E9%80%9A%E4%BF%A1&action=edit&redlink=1">光无线通信</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%B3%A2%E5%AF%BC">波导</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%8C%E8%BD%B4%E7%94%B5%E7%BC%86">同轴电缆</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%85%89%E7%BA%A4">光纤</a>等等）的信号增益用分贝表示，用于<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%93%BE%E8%B7%AF%E9%A2%84%E7%AE%97">链路预算</a>。</p>
<p>分贝也可以组合一些后缀，表示电功率的绝对单位。例如，后缀”m”表示”毫瓦”组合出”dBm”，0 dBm等于1毫瓦，1 dBm约为1.259 毫瓦。</p>
<p>在专业声学领域，常用单位是dBu。”u”代表”unloaded”。dBu是电压的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%B9%B3%E6%96%B9%E5%B9%B3%E5%9D%87%E6%95%B0">平方平均数</a>（RMS）度量的单位，其参考电压约为 0.775 VRMS。由于历史原因，此参考电压是在600欧姆电阻上耗散1 mW功率的电压，用于电话音频电路的标准阻抗。</p>
<h2 id="后缀与参考值"><a href="#后缀与参考值" class="headerlink" title="后缀与参考值"></a>后缀与参考值</h2><p>dB与后缀的组合，指出计算比值时的参考值。例如dBm指示功率值与1毫瓦的比值的分贝数。 </p>
<p>如果计算分贝时的参考值明确、确切地给出，那么分贝数值可以作为绝对量，如同被测量的功率量或者场量。例如，20dBm即为100毫瓦。 </p>
<p>SI国际单位制不允许使用分贝与后缀的组合形式如dBm, dBu, dBA，等等[<a href="about:reader?url=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%E5%88%86%E8%B2%9D#cite_note-13">13]</a>。但这种不遵从SI单位制的表示却广泛应用于很多场合。 </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/05/Signal/2021-05-05-%E4%BD%BF%E7%94%A8ADAU1761-PGA%E3%80%81ALC-%E7%9A%84DSP%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/05/Signal/2021-05-05-%E4%BD%BF%E7%94%A8ADAU1761-PGA%E3%80%81ALC-%E7%9A%84DSP%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">使用ADAU1761 PGA、ALC 的DSP控制模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-05 11:00:32" itemprop="dateCreated datePublished" datetime="2021-05-05T11:00:32+08:00">2021-05-05</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-09 13:01:38" itemprop="dateModified" datetime="2021-05-09T13:01:38+08:00">2021-05-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Signal/" itemprop="url" rel="index"><span itemprop="name">Signal</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用ADAU1761-PGA-ALC的DSP控制模式"><a href="#使用ADAU1761-PGA-ALC的DSP控制模式" class="headerlink" title="使用ADAU1761 PGA / ALC的DSP控制模式"></a>使用ADAU1761 PGA / ALC的DSP控制模式</h1><p>ADAU1761模拟前端具有ALC（自动电平控制）功能，可根据输入信号的电平动态设置差分输入路径的增益。但是，可以绕过ALC，DSP程序可以直接控制应用于 <strong>差分输入</strong> 的增益量。</p>
<p>为此，一个或两个通道的差分路径需要<strong>启用和取消静音</strong>。为了启用 <strong>差分路径</strong>，还应根据需要将<strong>LDBOOST</strong>（和/或<strong>RDBOOST</strong>）设置为0 dB或20 dB。</p>
<p><a target="_blank" rel="noopener" href="https://ez.analog.com/cfs-file/__key/communityserver-wikis-components-files/00-00-00-01-75/1e169c85b74a88a01485d3c18fecd396.jpg"><img src="https://ez.analog.com/cfs-filesystemfile/__key/communityserver-components-secureimagefileviewer/communityserver-wikis-components-files-00-00-00-01-75/1e169c85b74a88a01485d3c18fecd396.jpg_2D00_373x238.jpg?_=636716033579270573" alt="img"></a></p>
<p>然后，<strong>应将ALCSEL</strong>位设置为<strong>DSP控制</strong>模式。</p>
<p><a target="_blank" rel="noopener" href="https://ez.analog.com/cfs-file/__key/communityserver-wikis-components-files/00-00-00-01-75/be2493be5fd62ceb941ade31bb1c2ea2.jpg"><img src="https://ez.analog.com/cfs-filesystemfile/__key/communityserver-components-secureimagefileviewer/communityserver-wikis-components-files-00-00-00-01-75/be2493be5fd62ceb941ade31bb1c2ea2.jpg_2D00_136x228.jpg?_=636716033581410640" alt="img"></a></p>
<p>现在，在DSP程序原理图中，用户可以将<strong>AIGC输出</strong>单元添加到项目中：</p>
<p><a target="_blank" rel="noopener" href="https://ez.analog.com/cfs-file/__key/communityserver-wikis-components-files/00-00-00-01-75/a6abc0254ac0020e47fd1b347f706504.jpg"><img src="https://ez.analog.com/cfs-filesystemfile/__key/communityserver-components-secureimagefileviewer/communityserver-wikis-components-files-00-00-00-01-75/a6abc0254ac0020e47fd1b347f706504.jpg_2D00_215x49.jpg?_=636716033575290474" alt="img"></a></p>
<p>通道0映射到左侧的PGA。</p>
<p><a target="_blank" rel="noopener" href="https://ez.analog.com/cfs-file/__key/communityserver-wikis-components-files/00-00-00-01-75/524d0fbf699c770a6e85e142dd636b3b.png"><img src="https://ez.analog.com/cfs-filesystemfile/__key/communityserver-components-secureimagefileviewer/communityserver-wikis-components-files-00-00-00-01-75/524d0fbf699c770a6e85e142dd636b3b.png_2D00_91x54.png?_=636716033578360546" alt="img"></a></p>
<p>通道1映射到右侧的PGA。</p>
<p><a target="_blank" rel="noopener" href="https://ez.analog.com/cfs-file/__key/communityserver-wikis-components-files/00-00-00-01-75/3a9410be5a75f96f99e4087743e69d2f.jpg"><img src="https://ez.analog.com/cfs-filesystemfile/__key/communityserver-components-secureimagefileviewer/communityserver-wikis-components-files-00-00-00-01-75/3a9410be5a75f96f99e4087743e69d2f.jpg_2D00_94x57.jpg?_=636716033575450467" alt="img"></a></p>
<p>现在，馈送到这些单元中每个单元的5.23信号确定了相应PGA的增益。</p>
<p>作为一个简单的示例，要将每个PGA的增益设置为0.5（或-6 dB），请从<strong>Sources</strong>库创建一个<strong>DC Input Entry</strong>单元并将其设置为0.5，然后将其连接到<strong>AIGC输出</strong>。</p>
<p><a target="_blank" rel="noopener" href="https://ez.analog.com/cfs-file/__key/communityserver-wikis-components-files/00-00-00-01-75/462b7691a9c4c01ab55c2f09825bd18e.jpg"><img src="https://ez.analog.com/cfs-filesystemfile/__key/communityserver-components-secureimagefileviewer/communityserver-wikis-components-files-00-00-00-01-75/462b7691a9c4c01ab55c2f09825bd18e.jpg_2D00_208x103.jpg?_=636716033578360546" alt="img"></a></p>
<p>在下一个示例中，使用“<strong>乘”</strong>和“<strong>加”</strong>单元缩放并移动10 Hz的<strong>正弦音调</strong>，使其范围在0到1之间，然后将其发送到<strong>AIGC输出</strong>单元。这会导致PGA增益在0 dB和静音之间快速来回移动，从而产生颤音效果。</p>
<p><a target="_blank" rel="noopener" href="https://ez.analog.com/cfs-file/__key/communityserver-wikis-components-files/00-00-00-01-75/8f391a0c6d528ce961e9f54617503cd9.jpg"><img src="https://ez.analog.com/cfs-filesystemfile/__key/communityserver-components-secureimagefileviewer/communityserver-wikis-components-files-00-00-00-01-75/8f391a0c6d528ce961e9f54617503cd9.jpg_2D00_349x178.jpg?_=636716033575530468" alt="img"></a></p>
<p>在下面的示例中，每个输入的峰值电平由“<strong>峰值包络”</strong>单元检测，并且使用“<strong>除法”</strong>单元和“ <strong>DC输入条目”</strong>单元创建该信号的反相。结果发送到<strong>AIGC输出</strong>单元。这意味着输入峰值电平的倒数用于缩放PGA增益。结果是，当输入信号为低电平时，增益较高；但是，当输入电平增加时，增益将降低以避免削波。</p>
<p><a target="_blank" rel="noopener" href="https://ez.analog.com/cfs-file/__key/communityserver-wikis-components-files/00-00-00-01-75/d24015ce9b3e9d247f8a8fb1e43943a3.jpg"><img src="https://ez.analog.com/cfs-filesystemfile/__key/communityserver-components-secureimagefileviewer/communityserver-wikis-components-files-00-00-00-01-75/d24015ce9b3e9d247f8a8fb1e43943a3.jpg_2D00_400x379.jpg?_=636716033578810577" alt="img"></a></p>
<p>这些只是在ADAU1761的PGA上使用DSP控制模式可以完成的操作的几个示例。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>
<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备19004822号 </a>
  </div>

<div class="copyright">
  &copy; 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liewzheng</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
