<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://code.islet.space/font//css?family=/CascadiaCode/CascadiaCode:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"islet.space","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/db.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>
<meta name="description" content="笔记分享的旮旯孤岛而已">
<meta property="og:type" content="website">
<meta property="og:title" content="Coder的孤岛">
<meta property="og:url" content="http://islet.space/page/7/index.html">
<meta property="og:site_name" content="Coder的孤岛">
<meta property="og:description" content="笔记分享的旮旯孤岛而已">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Liewzheng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://islet.space/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Coder的孤岛</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Coder的孤岛</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">islet of the coder</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-文章"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章</a></li>
        <li class="menu-item menu-item-目录"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>目录</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-简历"><a href="/resume/" rel="section"><i class="fa fa-address-card fa-fw"></i>简历</a></li>
        <li class="menu-item menu-item-友链"><a href="/friends/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liewzheng</p>
  <div class="site-description" itemprop="description">笔记分享的旮旯孤岛而已</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">118</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">221</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:liewzheng@foxmail.com" title="E-Mail → mailto:liewzheng@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/23/Programming/C++/2021-05-23-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E4%B8%8E-%E6%9E%84%E9%80%A0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/23/Programming/C++/2021-05-23-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-%E4%B8%8E-%E6%9E%84%E9%80%A0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">基本数据类型 与 构造数据类型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-05-23 19:21:00 / Modified: 23:50:04" itemprop="dateCreated datePublished" datetime="2021-05-23T19:21:00+08:00">2021-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>[cnblogs.com](https://www.cnblogs.com/ybtools/p/6432464.html#:~:text=构造数据类型指可以通过其他的数据类型进行构造，可由程序员自定义，故又称为 ",自定义数据类型 "。 基本数据类型包括整型（short%2Cint%2Clong）、实型（又称浮点型）（float和double）、字符型char、布尔型bool等，他们都可以用于定义常量和变量。)</p>
<p>PS：本文以C++为例介绍数据类型。</p>
<h1 id="数据类型">数据类型　</h1>
<p>从广义上根据量的值是否可变，可分为<strong>常量</strong>和<strong>变量</strong>两种数据类型。</p>
<p>根据数据复杂程度，划分为<strong>基本数据类型</strong>和<strong>构造数据类型</strong>这两大类。</p>
<p><strong>基本数据类型</strong> 包括：整型（short,int,long）、实型（又称浮点型）（float和double）、字符型char、布尔型bool等。</p>
<p><strong>构造数据类型</strong> 包括：数组类型、枚举类型enum、指针类型、引用类型、结构体struct、联合体union（又称联合，共用体）、类class等。</p>
<p>构造数据类型指可以通过其他的数据类型进行构造，可由程序员自定义，故又称为 "<strong>自定义数据类型</strong>"。</p>
<h1 id="基本数据类型">基本数据类型</h1>
<p>基本数据类型包括整型（short,int,long）、实型（又称浮点型）（float和double）、字符型char、布尔型bool等，他们都可以用于定义常量和变量。</p>
<p>基本数据类型，也叫做基础类型，或内置类型。</p>
<p><strong>1、整型（short,int,long）</strong></p>
<p>整型量，包括短整型short、整型int、长整型long，而且3种类型都可以分别再细分为：有符号(signed)以及无符号(unsigned)。</p>
<p><strong>2、实型（又称浮点型）（float和double）</strong></p>
<p>实型，又称为浮点型，它包括两种数据类型：单精度浮点数float和双精度浮点数double。他们都是有符号数据类型。如果一个数值常量，包含小数点、指数部分（字符e），则为浮点数。</p>
<p>双精度浮点型，还可细分为双精度（double型）、长双精度（long double）</p>
<p><strong>3、字符型char</strong></p>
<p>字符型char类型定义的常量，必须要用单括号括起来。</p>
<p>例如：char ch='a' ; //把字符常量'a'存储到ch中。</p>
<p>字符型char类型量也可以细分为有符号(char)和无符号(unsigned char)。</p>
<p><strong>4、布尔型bool</strong></p>
<p>布尔型的取值为true或者false。</p>
<p>布尔型变量的说明：例：bool flag，则布尔型数据的变量flag取值：只有 false 和 true 两个值，即分别是0和1。</p>
<h1 id="构造数据类型">构造数据类型</h1>
<p>有些比较复杂的数据，单纯用基本数据类型未能表示，在C++中程序员可以用基本数据类型来自定义构造出新的数据类型，称构造数据类型，也称作 <strong><em>构造类型</em></strong>、<strong><em>构造数据类型</em></strong>。</p>
<p>构造数据类型除了可以用常见的如int、float和double、char、bool等基本数据类型进行构造，也可以包含其他构造类型的数据。</p>
<p>构造数据类型包括：数组类型、枚举类型enum、指针类型、引用类型、结构体struct、联合体union（又称联合，共用体）、class类等，他们可以通过其他的数据类型进行构造，由程序员自定义，所以又称为自定义数据类型。</p>
<p>参考：http://blog.csdn.net/u013174689/article/details/17484223</p>
<p>​</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/23/Programming/C++/2021-05-23-enum-in-CC++/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/23/Programming/C++/2021-05-23-enum-in-CC++/" class="post-title-link" itemprop="url">enum in C/C++</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-05-23 18:22:00 / Modified: 22:03:34" itemprop="dateCreated datePublished" datetime="2021-05-23T18:22:00+08:00">2021-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>enum</code> 是 Enumeration // 的缩写，是C/C++中的 <strong>枚举</strong> 关键字。</p>
<h1 id="特点">特点</h1>
<p>符合以下场景时可能需要使用到枚举：</p>
<ul>
<li>需要使用到的变量 <strong>数量较大</strong>，通过枚举以简写代码，提高代码可读性</li>
<li>使用整形（integer）进行定义（但不同于直接定义成 <code>int</code> 的 <strong>显式整形</strong>，使用枚举类型定义的话会变成 <strong>隐式整形</strong>）</li>
<li>所有值都是有固定范围的，是可人为预设的。</li>
<li>具有常量的特性（主要特点是：不可在定义之外的地方被修改）</li>
</ul>
<p>注意：</p>
<ul>
<li><em>在所有枚举值都未被赋值的情况下</em>，枚举值默认从 0 开始，往后逐个加 1（递增）。</li>
</ul>
<h1 id="定义">定义</h1>
<p><strong>枚举格式</strong>：一般为 <code>enum 枚举名&#123; 枚举值表 &#125;;</code> ，也可以省略枚举名，写成如下格式：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">typeName</span>&#123;</span> valueName1, valueName2, valueName3, ...... &#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>enum</code> 定义 <strong>枚举类型的关键字</strong>；</p>
<p><code>typeName</code>是 枚举类型的名称，即 <strong>枚举名</strong>。</p>
<p><code>valueName1, valueName2, valueName3, ......</code>是每个值对应的名字的列表，所有元素集合即为 <strong>枚举值表</strong></p>
<p>注意：最后的<code>;</code>不能少。</p>
</blockquote>
<h1 id="使用示例">使用示例</h1>
<h2 id="起始值赋值">起始值赋值</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">cats</span> &#123;</span></span><br><span class="line">    juran = <span class="number">3</span>,</span><br><span class="line">    guoran,</span><br><span class="line">    dala,</span><br><span class="line">    baomei,</span><br><span class="line">    baodi,</span><br><span class="line">    zhaofeng,</span><br><span class="line">    ainiao</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">juran = 3</span><br><span class="line">guoran = 4</span><br><span class="line">dala = 5</span><br><span class="line">ainiao = 9</span><br></pre></td></tr></table></figure>
<h2 id="值表中途赋值">值表中途赋值</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">cats</span> &#123;</span></span><br><span class="line">    juran,</span><br><span class="line">    guoran,</span><br><span class="line">    dala = <span class="number">0</span>,</span><br><span class="line">    baomei,</span><br><span class="line">    baodi,</span><br><span class="line">    zhaofeng,</span><br><span class="line">    ainiao</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>给出如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">juran = 0</span><br><span class="line">guoran = 1</span><br><span class="line">dala = 0</span><br><span class="line">ainiao = 4</span><br></pre></td></tr></table></figure>
<h1 id="typedef-enum">Typedef enum</h1>
<p>Typedef enum 的用法一般如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span>&#123;</span>....&#125; a; </span><br></pre></td></tr></table></figure>
<p>enum 的用法一般如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span>&#123;</span>....&#125; a;</span><br></pre></td></tr></table></figure>
<p>前者是将 <code>enum&#123;….&#125;</code> 定义成一个 <strong><em>a类型</em></strong>，声明变量的时候可以用 <code>a b</code> 格式;可以理解为类似 <code>int i</code>;</p>
<p>后者是将 <code>enum&#123;….&#125;</code> 声明了一个 <strong><em>变量</em></strong><code>a</code>。</p>
<h1 id="枚举遍历">枚举遍历</h1>
<p>在C 语言中，枚举类型是被当做 int 或者 unsigned int 类型来处理的，所以按照 C 语言规范是没有办法遍历枚举类型的。</p>
<p>不过在一些特殊的情况下，枚举类型必须连续是可以实现有条件的遍历。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">DAY</span>&#123;</span></span><br><span class="line">      MON=<span class="number">1</span>, TUE, WED, THU, FRI, SAT, SUN</span><br><span class="line">&#125; day;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 遍历枚举元素</span></span><br><span class="line">    <span class="keyword">for</span> (day = MON; day &lt;= SUN; day++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;枚举元素：%d \n&quot;</span>, day);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="错误示范">错误示范</h1>
<p>以下错误示范给出的提示均由 Linux的 <strong><em>GNU</em></strong> 编译器 及 Mac的 <strong><em>Clang</em></strong>（<em>Apple clang version 11.0.0 (clang-1100.0.33.17)</em>）编译器给出。</p>
<h2 id="重复定义">重复定义</h2>
<p>不允许 <strong>在同一个作用域内</strong> 定义 <strong>一样的枚举名称</strong> ；也不允许 <strong>在同一个作用域内</strong> 的不同枚举变量中定义 <strong>名称一样的元素</strong>。</p>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210523204125878.png" alt="image-20210523204125878" /><figcaption aria-hidden="true">image-20210523204125878</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210523204041715.png" alt="image-20210523204041715" /><figcaption aria-hidden="true">image-20210523204041715</figcaption>
</figure>
<p>以上两种情况的错误提示如下：</p>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210523182310296.png" alt="image-20210523182310296" /><figcaption aria-hidden="true">image-20210523182310296</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210523204224839.png" alt="image-20210523204224839" /><figcaption aria-hidden="true">image-20210523204224839</figcaption>
</figure>
<p>也就是说 <strong>枚举名称和枚举元素都要绝对唯一</strong>。</p>
<h2 id="数值更改">数值更改</h2>
<p>枚举类数据不允许更改数值（包括自增和赋值都不允许），有点类似于常量（const）。</p>
<p>枚举中的元素自增时的错误提示：</p>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210523202049638.png" alt="image-20210523202049638" /><figcaption aria-hidden="true">image-20210523202049638</figcaption>
</figure>
<p>枚举中的元素赋值时的错误提示：</p>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210523202501260.png" alt="image-20210523202501260" /><figcaption aria-hidden="true">image-20210523202501260</figcaption>
</figure>
<blockquote>
<p>根据 <a target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/142755629.html">网友的回答</a> :</p>
<p>C支持枚举类型的自增操作，但C++不支持。</p>
</blockquote>
<p>以下为常量自增时给出的错误提示：</p>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210523202757582.png" alt="image-20210523202757582" /><figcaption aria-hidden="true">image-20210523202757582</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/23/Programming/C++/2021-05-23-Difference-between-GCC,-gcc-and-g++/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/23/Programming/C++/2021-05-23-Difference-between-GCC,-gcc-and-g++/" class="post-title-link" itemprop="url">Difference between GCC, gcc and g++</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-05-23 17:00:00 / Modified: 20:07:33" itemprop="dateCreated datePublished" datetime="2021-05-23T17:00:00+08:00">2021-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>gcc 和 GCC 是两个不同的东西。</p>
<blockquote>
<p><strong>GCC</strong>：GNU Compiler Collection(GUN 编译器集合)，它可以编译C、C++、JAV、Fortran、Pascal、Object-C、Ada等语言。</p>
<p><strong>gcc</strong>：GCC中的GUN C Compiler（C 编译器）</p>
<p><strong>g++</strong>：GCC中的GUN C++ Compiler（C++编译器）</p>
</blockquote>
<p>一个有趣的事实就是，就本质而言，gcc和g++并不是编译器，也不是编译器的集合，它们只是一种驱动器，根据参数中要编译的文件的类型，调用对应的GUN编译器而已，比如，用gcc编译一个c文件的话，会有以下几个步骤：</p>
<blockquote>
<p>Step1：Call a preprocessor, like cpp.</p>
<p>Step2：Call an actual compiler, like cc or cc1.</p>
<p>Step3：Call an assembler, like as.</p>
<p>Step4：Call a linker, like ld</p>
</blockquote>
<p>由于编译器是可以更换的，所以gcc不仅仅可以编译C文件</p>
<p>所以，更准确的说法是：gcc调用了C compiler，而g++调用了C++ compiler</p>
<h1 id="gcc和g的主要区别">gcc和g++的主要区别</h1>
<ol type="1">
<li><p>对于 <em>.c和</em>.cpp文件，gcc分别当做c和cpp文件编译（c和cpp的语法强度是不一样的）</p></li>
<li><p>对于 <em>.c和</em>.cpp文件，g++则统一当做cpp文件编译</p></li>
<li><p>使用g++编译文件时，<strong>g++会自动链接标准库STL，而gcc不会自动链接STL</strong></p></li>
<li><p>gcc在编译C文件时，可使用的预定义宏是比较少的</p></li>
<li><p>gcc在编译cpp文件时/g++在编译c文件和cpp文件时（这时候gcc和g++调用的都是cpp文件的编译器），会加入一些额外的宏，这些宏如下：</p></li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __GXX_WEAK__ 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __cplusplus 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __DEPRECATED 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __GNUG__ 4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __EXCEPTIONS 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __private_extern__ extern</span></span><br></pre></td></tr></table></figure>
<ol start="6" type="1">
<li>在用gcc编译c++文件时，为了能够使用STL，需要加参数 –lstdc++ ，但这并不代表 gcc –lstdc++ 和 g++等价，它们的区别不仅仅是这个</li>
</ol>
<p>其主要参数：</p>
<blockquote>
<p>-g - turn on debugging (so GDB gives morefriendly output)</p>
<p>-Wall - turns on most warnings</p>
<p>-O or -O2 - turn on optimizations</p>
<p>-o - name of the output file</p>
<p>-c - output an object file (.o)</p>
<p>-I - specify an includedirectory</p>
<p>-L - specify a libdirectory</p>
<p>-l - link with librarylib.a</p>
</blockquote>
<p>使用示例：<code>g++ -ohelloworld -I/homes/me/randomplace/include helloworld.C</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/22/Linux/2021-05-21-Equipments_in_debian_linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/22/Linux/2021-05-21-Equipments_in_debian_linux/" class="post-title-link" itemprop="url">Equipments in Debian Linux(KALI)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-22 20:30:00" itemprop="dateCreated datePublished" datetime="2021-05-22T20:30:00+08:00">2021-05-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-23 23:51:40" itemprop="dateModified" datetime="2021-05-23T23:51:40+08:00">2021-05-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="介绍">介绍</h1>
<p>作为一个日常开发的程序员，三大平台都在日常使用的软件（生产力工具及娱乐工具）如下：</p>
<ul>
<li>utools</li>
<li>typora</li>
<li>visual studio code</li>
<li>picgo</li>
<li>sogou pinyin</li>
<li>snipaste(win) / flameshot(linux) / ishot(mac)</li>
<li>cosbrowser</li>
<li>nodejs 及 npm</li>
<li>hexo</li>
<li>qqmusic</li>
</ul>
<p>win和mac安装软件都相对简单，linux安装需要使用者自身具有一定的耐心和排除困难的经验，为了更好地体验linux的方便，这里对linux装机后的生产力工具安装做个简单记录，以下安装均在 <strong>KALI</strong> （Kali也属于Debian系Linux）上进行。</p>
<p>使用Linux系统的最大好处是 “一个终端即可解决即可开启大部分软件和解决日常事务，最多再开启一个utools”。</p>
<p>Linux上的软件安装方式通常分为四种方式：</p>
<ul>
<li>通过 <code>dpkg</code> 命令安装 <code>.deb</code> 文件</li>
<li>通过 <code>apt</code> 或其他软件的软件安装命令（如，<code>npm</code> 和 <code>pip</code>）来安装</li>
<li>通过 <code>ln</code> 链接将程序绑定至全局变量来 “安装” 和使用</li>
<li>通过直接调用 <code>AppImage</code> 的方式直接使用软件，此类方式需要一般需要手动双击执行</li>
</ul>
<p>其中前三种方式的困难因系统而异，所说的困难是可能出现所安装的软件依赖不存在，需要使用者自行去定位（包括下载和添加源）和安装，或者链接方式错误等。而Linux源众多，每个节点的速度及其更新情况都不太一样，需要使用者判断。</p>
<h1 id="utools-flameshot">uTools &amp; Flameshot</h1>
<p><a target="_blank" rel="noopener" href="https://res.u-tools.cn/currentversion/utools_1.3.5_amd64.deb">uTools</a> 使用的是 <code>.deb</code> 安装包安装，flameshot 使用 <code>apt</code> 命令进行安装。</p>
<p><strong>依赖文件</strong>：</p>
<ol type="1">
<li><code>libspdlog1-fmt7</code> 是 flameshot所需文件</li>
<li><code>libappindicator3-1</code> 是 utools所需文件</li>
</ol>
<h2 id="libspdlog1">libspdlog1</h2>
<p>尝试安装utools和flameshot后，apt会提示缺少文件。使用 <code>sudo apt-get install libspdlog1-fmt7</code> 来安装 <code>libspdlog1-fmt7</code> 。</p>
<p>如果触发安装破损修复，使用<code>apt --fix-broken install</code> 可以让apt自动修复安装错误，自动补全依赖文件。</p>
<h2 id="libappindicator3">libappindicator3</h2>
<p><code>libappindicator3-1</code> 文件需要使用者往 <code>/etc/apt/source.list</code> 中添加debian源，需要使用者掌握基本的 <code>vim</code> 软件使用方法（包括插入、保存和退出）。</p>
<ul>
<li><p>使用 <code>sudo vim /etc/apt/sources.list</code> 命令打开 <code>source.list</code> 。</p></li>
<li><p>按 <code>i</code> 进入 <strong>插入模式</strong>，复制粘贴 <code>deb http://ftp.de.debian.org/debian sid main</code> 至空白处，按 <code>ESC</code> 键，再依次输入 <code>:wq</code> 进行保存和退出。</p></li>
<li><p>在终端输入 <code>sudo apt-get update</code> 进行源库软件列表更新，再次尝试 <code>sudo apt-get install libappindicator3</code> 来安装</p>
<p><code>libappindicator3-1</code> and <code>libappindicator3-7</code> 。</p></li>
</ul>
<p>最后再次尝试以下两条语句即可成功安装 utools 和 flameshot 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i utools_1.3.5_amd64.deb</span><br><span class="line">sudo apt-get install flameshot</span><br></pre></td></tr></table></figure>
<h1 id="typora">Typora</h1>
<p><a target="_blank" rel="noopener" href="https://tyopra.io">TYPORA.IO</a> 官方提供的安装代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys BA300B7755AFCFAE</span><br><span class="line">sudo add-apt-repository <span class="string">&#x27;deb https://typora.io/linux ./&#x27;</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install typora</span><br></pre></td></tr></table></figure>
<p>其中，向apt中添加源的第二条语句 <code>add-apt-repository</code> 会因缺乏 <code>PPA</code> 而无法执行，可以参考 <a target="_blank" rel="noopener" href="https://ywnz.com/linuxjc/7953.html#:~:text=%E6%9C%89%E4%BA%9B%E7%94%A8%E6%88%B7%E5%9C%A8UOS%E3%80%81Deepin%E7%AD%89%E6%9F%90%E4%BA%9BLinux%E5%8F%91%E8%A1%8C%E7%89%88%E7%BB%88%E7%AB%AF%E4%B8%AD%E8%BE%93%E5%85%A5PPA%E5%91%BD%E4%BB%A4%E6%97%B6%E4%BC%9A%E6%8F%90%E7%A4%BA%E2%80%9Csudo%3A%20add-apt-repository%EF%BC%9A%E6%89%BE%E4%B8%8D%E5%88%B0%E5%91%BD%E4%BB%A4%EF%BC%88command,not%20found%EF%BC%89%E2%80%9D%EF%BC%8C%E8%BF%99%E6%98%AF%E5%9B%A0%E4%B8%BA%E6%B2%A1%E6%9C%89%E5%AE%89%E8%A3%85PPA%E6%89%80%E8%87%B4%EF%BC%8C%E6%8A%8A%E5%AE%83%E5%AE%89%E8%A3%85%E4%B8%8A%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%AD%E8%BF%90%E8%A1%8C%E4%B8%89%E6%9D%A1%E5%91%BD%E4%BB%A4%E3%80%82">sudo: add-apt-repository：找不到命令的解决方法</a> 进行安装。</p>
<p>也可以参考 <code>libappindicator3</code> 的源添加方法，往 <code>source.list</code> 文件中添加 <code>deb https://typora.io/linux ./</code> 来添加源。</p>
<p>添加成功后即可成功安装tyopra。</p>
<h1 id="sogou-pinyin">Sogou Pinyin</h1>
<p>从搜狗官方下载的 <a target="_blank" rel="noopener" href="https://ime.sogoucdn.com/dl/index/1612260778/sogoupinyin_2.4.0.3469_amd64.deb?st=USANnSZV6afzzi2u6c8J-g&amp;e=1621603885&amp;fn=sogoupinyin_2.4.0.3469_amd64.deb">Sogou</a> 安装包，需要用 <code>sudo dpkg -i sogoupinyin_2.4.0.3469_amd64.deb</code> 命令进行安装，会遇到以下缺乏库的提示，主要是因为缺少 <code>fcitx</code> 的提示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">dpkg: 依赖关系问题使得 sogoupinyin 的配置工作不能继续：</span><br><span class="line"> sogoupinyin 依赖于 fcitx (&gt;= 1:4.2.8)；然而：</span><br><span class="line">  未安装软件包 fcitx</span><br><span class="line"> sogoupinyin 依赖于 fcitx-frontend-gtk2；然而：</span><br><span class="line">  未安装软件包 fcitx-frontend-gtk2。</span><br><span class="line"> sogoupinyin 依赖于 fcitx-frontend-gtk3；然而：</span><br><span class="line">  未安装软件包 fcitx-frontend-gtk3。</span><br><span class="line"> sogoupinyin 依赖于 fcitx-frontend-qt5；然而：</span><br><span class="line">  未安装软件包 fcitx-frontend-qt5。</span><br><span class="line"> sogoupinyin 依赖于 fcitx-module-kimpanel；然而：</span><br><span class="line">  未安装软件包 fcitx-module-kimpanel。</span><br><span class="line"> sogoupinyin 依赖于 fcitx-module-x11；然而：</span><br><span class="line">  未安装软件包 fcitx-module-x11。</span><br><span class="line"> sogoupinyin 依赖于 im-config；然而：</span><br><span class="line">  未安装软件包 im-config。</span><br><span class="line"> sogoupinyin 依赖于 fcitx-libs | libfcitx-config4；然而：</span><br><span class="line">  未安装软件包 fcitx-libs。</span><br><span class="line">  未安装软件包 libfcitx-config4。</span><br><span class="line"> sogoupinyin 依赖于 fcitx-libs | libfcitx-qt0；然而：</span><br><span class="line">  未安装软件包 fcitx-libs。</span><br><span class="line">  未安装软件包 libfcitx-qt0。</span><br><span class="line"> sogoupinyin 依赖于 fcitx-libs | libfcitx-utils0；然而：</span><br><span class="line">  未安装软件包 fcitx-libs。</span><br><span class="line">  未安装软件包 libfcitx-utils0。</span><br><span class="line"> sogoupinyin 依赖于 fcitx-ui-classic；然而：</span><br><span class="line">  未安装软件包 fcitx-ui-classic。</span><br><span class="line"> sogoupinyin 依赖于 libqt5quickwidgets5；然而：</span><br><span class="line">  未安装软件包 libqt5quickwidgets5。</span><br><span class="line"> sogoupinyin 依赖于 qml-module-qtquick2；然而：</span><br><span class="line">  未安装软件包 qml-module-qtquick2。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Fcitx[ˈfaɪtɪks]是 (Free Chinese Input Toy for X) 的英文缩写，中文名为小企鹅输入法，是一个以 GPL 方式发布的输入法框架， 编写它的目是为桌面环境提供一个灵活的输入方案，彻底解决在GNU/Linux下没有一个好的中文输入法的问题。</p>
</blockquote>
<h2 id="fcitx">FCITX</h2>
<p>通过输入 <code>sudo apt-get install fcitx</code> 来尝试安装，会触发 apt fix broken install， 此时只要再次输入 <code>sudo apt --fix-broken install</code> 来修复。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">下列软件包有未满足的依赖关系：</span><br><span class="line"> fcitx : 依赖: fcitx-bin 但是它将不会被安装</span><br><span class="line">         依赖: fcitx-data 但是它将不会被安装</span><br><span class="line">         依赖: fcitx-modules 但是它将不会被安装</span><br><span class="line">         推荐: fcitx-config-gtk 但是它将不会被安装 或</span><br><span class="line">                 kde-config-fcitx 但是它将不会被安装</span><br><span class="line">         推荐: fcitx-frontend-all 但是它将不会被安装 或</span><br><span class="line">                 fcitx-frontend-fbterm 但是它将不会被安装</span><br><span class="line">         推荐: fcitx-ui-classic 但是它将不会被安装 或</span><br><span class="line">                 fcitx-ui-light 但是它将不会被安装</span><br><span class="line">         推荐: im-config (&gt;= 0.5) 但是它将不会被安装</span><br><span class="line"> sogoupinyin : 依赖: fcitx-frontend-gtk2 但是它将不会被安装</span><br><span class="line">               依赖: fcitx-frontend-gtk3 但是它将不会被安装</span><br><span class="line">               依赖: fcitx-frontend-qt5 但是它将不会被安装</span><br><span class="line">               依赖: fcitx-module-kimpanel 但是它将不会被安装</span><br><span class="line">               依赖: fcitx-module-x11 但是它将不会被安装</span><br><span class="line">               依赖: im-config 但是它将不会被安装</span><br><span class="line">               依赖: fcitx-libs 但是它将不会被安装 或</span><br><span class="line">                       libfcitx-config4 但是它将不会被安装</span><br><span class="line">               依赖: fcitx-libs 但是它将不会被安装 或</span><br><span class="line">                       libfcitx-qt0 但无法安装它</span><br><span class="line">               依赖: fcitx-libs 但是它将不会被安装 或</span><br><span class="line">                       libfcitx-utils0 但是它将不会被安装</span><br><span class="line">               依赖: fcitx-ui-classic 但是它将不会被安装</span><br><span class="line">               依赖: libqt5quickwidgets5 但是它将不会被安装</span><br><span class="line">               依赖: qml-module-qtquick2 但是它将不会被安装</span><br><span class="line">E: 有未能满足的依赖关系。请尝试不指明软件包的名字来运行“apt --fix-broken install”(也可以指定一个解决办法)。</span><br></pre></td></tr></table></figure>
<h2 id="安装成功">安装成功</h2>
<p>FIX-BROKEN 成功后，再次尝试安装 FCITX 就可以提示成功；接着安装sogou即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install fcitx                   </span><br><span class="line">正在读取软件包列表... 完成</span><br><span class="line">正在分析软件包的依赖关系树... 完成</span><br><span class="line">正在读取状态信息... 完成                 </span><br><span class="line">fcitx 已经是最新版 (1:4.2.9.8-3)。</span><br><span class="line">fcitx 已设置为手动安装。</span><br><span class="line">升级了 0 个软件包，新安装了 0 个软件包，要卸载 0 个软件包，有 136 个软件包未被升级。</span><br><span class="line"></span><br><span class="line">$ sudo dpkg -i sogoupinyin_2.4.0.3469_amd64.deb</span><br><span class="line">(正在读取数据库 ... 系统当前共安装有 270000 个文件和目录。)</span><br><span class="line">准备解压 sogoupinyin_2.4.0.3469_amd64.deb  ...</span><br><span class="line">正在解压 sogoupinyin (2.4.0.3469) 并覆盖 (2.4.0.3469) ...</span><br><span class="line">正在设置 sogoupinyin (2.4.0.3469) ...</span><br><span class="line">正在处理用于 mailcap (3.69) 的触发器 ...</span><br><span class="line">正在处理用于 desktop-file-utils (0.26-1) 的触发器 ...</span><br><span class="line">正在处理用于 hicolor-icon-theme (0.17-2) 的触发器 ...</span><br></pre></td></tr></table></figure>
<h2 id="依赖库">依赖库</h2>
<p>sogou输入法依赖库具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">下列【新】软件包将被安装：</span><br><span class="line">  dbus-x11 fcitx fcitx-bin fcitx-config-common fcitx-config-gtk fcitx-data</span><br><span class="line">  fcitx-frontend-all fcitx-frontend-gtk2 fcitx-frontend-gtk3</span><br><span class="line">  fcitx-frontend-qt5 fcitx-libs fcitx-module-dbus fcitx-module-kimpanel</span><br><span class="line">  fcitx-module-lua fcitx-module-x11 fcitx-modules fcitx-ui-classic</span><br><span class="line">  fcitx5-module-quickphrase-editor im-config libfcitx-config4</span><br><span class="line">  libfcitx-core0 libfcitx-gclient1 libfcitx-qt5-1 libfcitx-qt5-data</span><br><span class="line">  libfcitx-utils0 libgettextpo0 libpresage-data libpresage1v5</span><br><span class="line">  libqt5qmlworkerscript5 libqt5quickwidgets5 libtinyxml2.6.2v5 presage</span><br><span class="line">  qml-module-qtquick2</span><br></pre></td></tr></table></figure>
<h1 id="nodejs-hexo">NodeJS &amp; Hexo</h1>
<p>使用 <code>sudo apt-get install nodejs</code> 或 <code>sudo apt-get install node.js</code> 均可以实现node.js 的安装，但是只能安装V12版。</p>
<p>可以在官方下载 <a target="_blank" rel="noopener" href="https://nodejs.org/dist/v16.2.0/node-v16.2.0-linux-x64.tar.xz">node-v16.2.0-linux-x64.tar.xz</a> ，并使用以下命令进行解压：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xz -d node-v16.2.0-linux-x64.tar.xz</span><br><span class="line">tar -xvf node-v16.2.0-linux-x64.tar</span><br></pre></td></tr></table></figure>
<p>解压完毕之后，以管理员身份将该文件移动至 <code>/usr/local/node</code> ，以下命令将 <code>node-v16.2.0-linux-x64</code> 拷贝的同时进行了 <strong>重命名</strong> 操作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /home/XXX/downloads/node-v16.2.0-linux-x64 /usr/<span class="built_in">local</span>/node</span><br></pre></td></tr></table></figure>
<p style="color: gray; font-style: italic;">
注：XXX是用户名
</p>
<p>然后进行软连接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/<span class="built_in">local</span>/node/bin/node /usr/<span class="built_in">local</span>/bin</span><br><span class="line">sudo ln -s /usr/<span class="built_in">local</span>/node/bin/npm /usr/<span class="built_in">local</span>/bin</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Linux ln（英文全拼：link files）命令是一个非常重要命令，它的功能是为某一个文件在另外一个位置建立一个同步的链接。</p>
<p>当我们需要在不同的目录，用到相同的文件时，我们不需要在每一个需要的目录下都放一个必须相同的文件，我们只要在某个固定的目录，放上该文件，然后在 其它的目录下用ln命令链接（link）它就可以，不必重复的占用磁盘空间。</p>
</blockquote>
<p>以上是 <code>ln</code> 链接命令的解释，实际最重要的作用是将某个已下载的软件及其命令定义至全局，在终端的任意一个目录位置都可以使用该软件。</p>
<h2 id="安装-成功">“安装” 成功</h2>
<p>实际上新版的nodejs并不涉及 前述 <code>dpkg</code> 或 <code>apt</code> 命令的安装，但软连接该文件目录至 <code>/usr/local/bin</code> 后，能实现安装效果，使用 <code>node -v</code> 及 <code>npm -v</code> 命令即可进行测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">v16.2.0</span><br><span class="line"></span><br><span class="line">$ npm -v                   </span><br><span class="line">7.14.0</span><br></pre></td></tr></table></figure>
<h2 id="其他">其他</h2>
<p>对于使用此类安装方式进行安装的 依赖于nodejs的应用如果需要在全局进行使用可能也需要进行软连接，如 hexo。</p>
<p>使用 <code>npm install hexo-cli -g</code> 成功安装hexo后提示如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ whereis hexo</span><br><span class="line">hexo:</span><br></pre></td></tr></table></figure>
<p>此时需要将 <code>/usr/local/node/bin</code> 文件夹下安装的程序也拉到全局变量中 <code>/usr/local/bin</code> 中。再次使用 <code>whereis</code> 命令检测时即可成功。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ln -s /usr/<span class="built_in">local</span>/node/bin/hexo /usr/<span class="built_in">local</span>/bin/hexo</span><br><span class="line">                                                                             </span><br><span class="line">$ whereis hexo</span><br><span class="line">hexo: /usr/<span class="built_in">local</span>/bin/hexo</span><br></pre></td></tr></table></figure>
<h1 id="visual-studio-code">Visual Studio Code</h1>
<p>VS code安装使用 <code>dpkg</code> 命令，最大的问题是微软的源下载太慢，以下提供个人下载点，安装过程不再记录。</p>
<p>个人下载点： <a target="_blank" rel="noopener" href="https://storage.islet.space/02_Softwares/02_Microsoft/VisualStudioCode/Linux/code_1.55.2-1618307277_amd64.deb">Visual Studio Code Linux (deb)</a></p>
<h1 id="picgo">PicGo</h1>
<p><a target="_blank" rel="noopener" href="https://support.typora.io/Upload-Image/#picgo-core-command-line-opensource">Typora_Picgo</a> 有 command-line 版 和 app 版，参考 <a target="_blank" rel="noopener" href="https://picgo.github.io/PicGo-Doc/zh/">PicGo官方文档</a> （GFW封锁了<strong><em>github.io</em></strong>域名后缀，需要梯子）进行安装吧。</p>
<h1 id="qqmusic-cosbrowser">QQmusic &amp; cosbrowser</h1>
<p>这两个软件都是腾讯家产品，下载、安装和使用都很方便。</p>
<p>其中，QQMusic使用 <code>dpkg</code> 命令进行安装即可， <code>cosbrowser</code> 是 <code>AppImage</code> 格式文件，直接打开即可使用，无需安装。</p>
<p><strong>彩蛋</strong>：<code>sudo apt-get install cmatrix</code></p>
<p>---EOF---</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/21/Programming/C++/2021-05-21-How-to-Use-the-C-Preprocessors-#error-Directive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/21/Programming/C++/2021-05-21-How-to-Use-the-C-Preprocessors-#error-Directive/" class="post-title-link" itemprop="url">How to Use the C Preprocessor's error Directive</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-21 23:40:32" itemprop="dateCreated datePublished" datetime="2021-05-21T23:40:32+08:00">2021-05-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-23 20:06:47" itemprop="dateModified" datetime="2021-05-23T20:06:47+08:00">2021-05-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://barrgroup.com/embedded-systems/how-to/c-preprocessor-error-directive">barrgroup.com</a></p>
<p>One of the least used but potentially most useful features of the C preprocessor is the <strong><em>ANSI-specified #error directive</em></strong>. Here's a look at a couple of clever uses for <code>#error</code> that have proven invaluable in embedded software development.</p>
<p>The syntax of <code>#error</code> is very straightforward:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">error</span> <span class="meta-string">&lt;writer supplied error message&gt;</span>  <span class="comment">//开发者提供的错误信息</span></span></span><br></pre></td></tr></table></figure>
<p><code>&lt;writer supplied error message&gt;</code> 中可包含任何可显示的文本，甚至不需要使用双引号 <code>""</code> 。</p>
<blockquote>
<p>The <code>&lt;writer supplied error message&gt;</code> can consist of any printable text. You don't even have to enclose the text in quotes. (Technically, the message is optional--though it rarely makes sense to omit it.)</p>
</blockquote>
<p>当C预处理器遇到 <code>#error</code> 语句时，会将停止编译，并将错误信息输出至 <code>stderr</code> 文件。C编译器的典型错误信息如下：</p>
<blockquote>
<p>When the C preprocessor encounters a <code>#error</code> statement, it causes compilation to terminate and the writer-supplied error message to be printed to <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Standard_streams">stderr (link is external)</a>. A typical error message from a C compiler looks like this:</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Filename(line_number): Error! </span><br><span class="line">Ennnn: &lt;writer supplied error message&gt; </span><br></pre></td></tr></table></figure>
<p>where Filename is the source file name, <code>line_number</code> is the line number where the <code>#error</code> statement is located, and <code>Ennnn</code> is a compiler-specific error number. Thus, the <code>#error</code> message is basically indistinguishable from ordinary compiler error messages.</p>
<p>"Wait a minute," you might say. "I spend enough time trying to get code to compile and now he wants me to do something that causes more compiler errors?" Absolutely! The essential point is that code that compiles but is incorrect is worse than useless. I've found three general areas in which this problem can arise and <code>#error</code> can help. Read on and see if you agree with me.</p>
<h2 id="incomplete-code">Incomplete code</h2>
<p>I tend to code using a step-wise refinement approach, so it isn't unusual during development for me to have functions that do nothing, for loops that lack a body, and so forth. Consequently, I often have files that are compilable but lack some essential functionality. Working this way is fine, until I'm pulled off to work on something else (an occupational hazard of being in the consulting business). Because these distractions can occasionally run into weeks, I sometimes return to the job with my memory a little hazy about what I haven't completed. In the worst-case scenario (which has occurred), I perform a make, which runs happily, and then I attempt to use the code. The program, of course, crashes and burns, and I'm left wondering where to start.</p>
<p>In the past, I'd comment the file to note what had been done and what was still needed. However, I found this approach to be rather weak because I then had to read all my comments (and I comment heavily) in order to find what I was looking for. Now I simply enter something like the following in an appropriate place in the file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#error *** Nigel - Function incomplete. Fix before using *** </span><br></pre></td></tr></table></figure>
<p>Thus, if I forget that I haven't done the necessary work, an inadvertent attempt to use the file will result in just about the most meaningful compiler message I'll ever receive. Furthermore, it saves me from having to wade through pages of comments, trying to find what work I haven't finished.</p>
<h2 id="compiler-dependent-code">Compiler-dependent code</h2>
<p>As much as I strive to write portable code, I often find myself having to trade off performance for portability - and in the embedded world, performance tends to win. However, what happens if a few years later I reuse some code without remembering that the code has <strong><em>compiler-specific peculiarities</em></strong>? The result is a much longer debug session than is necessary. But a <strong><em>judicious</em></strong> <code>#error</code> statement can prevent a lot of grief. A couple of examples may help.</p>
<h3 id="example-1">Example 1</h3>
<p>Some floating-point code requires at least 12 digits of resolution to return the correct results. Accordingly, the various variables are defined as type long double. But <strong><em>ISO C</em></strong> only requires that <em><u>a long double have 10 digits of resolution</u></em>. Thus on certain machines, a long double may be <strong><em>inadequate</em></strong> to do the job. To protect against this, I would include the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;float.h&gt;</span><br><span class="line">#if (LDBL_DIG &lt; 12) </span><br><span class="line">	#error *** long doubles need 12 digit resolution.</span><br><span class="line">	Do not use this compiler! *** </span><br><span class="line">#endif </span><br></pre></td></tr></table></figure>
<p>This approach works by examining the value of an ANSI-mandated constant found in <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Float.h">float.h (link is external)</a>.</p>
<h3 id="example-2">Example 2</h3>
<p>An amazing amount of code makes invalid assumptions about the underlying size of the various integer types. If you have code that has to use an int (as opposed to a user-specified data type such as <code>int16</code>), and the code assumes that an int is 16 bits, you can do the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;limits.h&gt;</span><br><span class="line">#if (INT_MAX !&#x3D; 32767) </span><br><span class="line">	#error *** This file only works with 16-bit int.</span><br><span class="line">	Do not use this compiler! *** </span><br><span class="line">#endif </span><br></pre></td></tr></table></figure>
<p>Again, this works by checking the value of an ANSI-mandated constant. This time the constant is found in the file <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Limits.h">limits.h (link is external)</a>. This approach is a lot more useful than putting these limitations inside a big comment that someone may or may not read. After all, you have to read the compiler error messages.</p>
<h2 id="conditionally-compiled-code">Conditionally-compiled code</h2>
<p>Since conditionally compiled code seems to be a necessary evil in embedded programming, it's common to find code sequences such as the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#if defined OPT_1 </span><br><span class="line">	&#x2F;* Do option_1 *&#x2F; </span><br><span class="line">#else </span><br><span class="line">	&#x2F;* Do option_2 *&#x2F; </span><br><span class="line">#endif </span><br></pre></td></tr></table></figure>
<p>As it is written, this code means the following: if and only if OPT_1 is defined, we will do option_1; otherwise we'll do option_2. The problem with this code is that a user of the code doesn't know (without explicitly examining the code) that OPT_1 is a valid compiler switch. Instead, the naive user will simply compile the code without defining OPT_1 and get the alternate implementation, irrespective of whether that is what's required or not. A more considerate coder might be aware of this problem, and instead do the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#if defined OPT_1 </span><br><span class="line">	&#x2F;* Do option 1 *&#x2F; </span><br><span class="line">#elif defined OPT_2 </span><br><span class="line">	&#x2F;* Do option 2*&#x2F; </span><br><span class="line">#endif </span><br></pre></td></tr></table></figure>
<p>In this case, failure to define either OPT_1 or OPT_2 will typically result in an obscure compiler error at a point later in the code. The user of this code will then be stuck with trying to work out what must be done to get the module to compile. This is where #error comes in. Consider the following code sequence:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#if defined OPT_1 </span><br><span class="line">	&#x2F;* Do option_1 *&#x2F; </span><br><span class="line">#elif defined OPT_2 </span><br><span class="line">	&#x2F;* Do option_2 *&#x2F; </span><br><span class="line">#else </span><br><span class="line">	#error *** You must define one of OPT_1 or OPT_2 *** </span><br><span class="line">#endif </span><br></pre></td></tr></table></figure>
<p>Now the compilation fails, but at least it tells the user explicitly what to do to make the module compile. I know that if this procedure had been adopted universally, I would have saved a lot of time over the years trying to reuse other people's code.</p>
<p>So there you have it. Now tell me, don't you agree that <code>#error</code> is a really useful part of the preprocessor, worthy of your frequent use-and occasional praise?</p>
<p>​</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/19/Web/2021-05-19-What-is-the-meaning-of--savefor-NPM-install-/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/19/Web/2021-05-19-What-is-the-meaning-of--savefor-NPM-install-/" class="post-title-link" itemprop="url">What is the meaning of '-save' for NPM install ?</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-19 20:10:00" itemprop="dateCreated datePublished" datetime="2021-05-19T20:10:00+08:00">2021-05-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-08-07 00:03:57" itemprop="dateModified" datetime="2021-08-07T00:03:57+08:00">2021-08-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Networking/" itemprop="url" rel="index"><span itemprop="name">Networking</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/what-is-the-meaning-of-save-for-npm-install/">geeksforgeeks.org</a></p>
<p><strong><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/node-js-npm-node-package-manager/">NPM (Node Package Manager)</a></strong> is the default package manager employed in JavaScript runtime environment in Node.js. It has a very frequently used command <strong>npm install [Package Name] –save</strong>. But the fact is there is no difference between <strong>npm install [Package Name]</strong> and <strong>npm install [Package Name] –save</strong> in the later version after npm 5.0.0 onwards.</p>
<p>Before npm 5.0.0, it was necessary to add <code>--save</code> after package name because it will save the installed package to package.json file in the dependency section. If you are using a recent version of npm save yourself from unnecessary typing and use <strong>npm install [Package Name]</strong> instead of <strong>npm install [Package Name] <code>--save</code></strong> by default it will add the installed package to the dependency list in the package.json file.</p>
<p><strong>NPM has several commands which are listed below:</strong></p>
<ol type="1">
<li><p>–save or -S:</p>
<p>When the following command is used with npm install this will save all your installed core packages into the dependency section in the package.json file. Core dependencies are those packages without which your application will not give desired results. But as mentioned earlier, it is an unnecessary feature in the npm 5.0.0 version onwards.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save</span><br></pre></td></tr></table></figure></li>
<li><p>–save-prod or -P:</p>
<p>The following command is introduced in the later version of npm it will perform the same task as the</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--save</span><br></pre></td></tr></table></figure>
<p>command unless any other command such as</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-D</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-O</span><br></pre></td></tr></table></figure>
<p>is present.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-prod</span><br></pre></td></tr></table></figure></li>
<li><p>–save-dev or -D:</p>
<p>With</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--save-dev</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-D</span><br></pre></td></tr></table></figure>
<p>command your installed packages will be added to devDependency section of the package.json file. Development dependencies are those packages which only meant for development purpose it will not affect the application’s result.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev</span><br></pre></td></tr></table></figure></li>
<li><p>–save-optional or -O:</p>
<p>When this command is used the install the that packages will be listed under the optional Dependency section of the package.json file. Optional dependencies are those packages which are only used when a particular feature of the application is used and will not be required if that functionality isn’t used.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-optional</span><br></pre></td></tr></table></figure></li>
<li><p>–no-save:</p>
<p>When this command is used with npm install it will not allow the installed packages from being saved into the dependency section.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --no-save</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>Note:</strong> NPM provides two additional options to save dependencies into package.json file.</p>
<ol type="1">
<li><p>–save-exact or -E:</p>
<p>This is an additional or optional command provided by the npm that will save the exact version of the installed packages which are configured at the time of development. It will not download the dependencies from npm’s default server range operator.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-exact</span><br></pre></td></tr></table></figure></li>
<li><p>–save-bundle or -B:</p>
<p>The following command is also an optional command when</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--save-bundle</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-B</span><br></pre></td></tr></table></figure>
<p>is used. This will also add the saved dependencies under the bundleDependency list.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-bundle</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/17/Computer/2021-05-17-%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80%E5%AF%B9%E9%BD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/17/Computer/2021-05-17-%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80%E5%AF%B9%E9%BD%90/" class="post-title-link" itemprop="url">内存地址对齐</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-05-17 20:10:00 / Modified: 20:32:07" itemprop="dateCreated datePublished" datetime="2021-05-17T20:10:00+08:00">2021-05-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer/" itemprop="url" rel="index"><span itemprop="name">Computer</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mhq-martin/p/11537873.html">cnblogs.com</a></p>
<h1 id="对齐定义">对齐定义</h1>
<p>内存地址对齐，是一种在计算机内存中排列数据、访问数据的一种方式。</p>
<h1 id="对齐分类">对齐分类</h1>
<p>内存地址对齐包含了两种相互独立又相互关联的部分：<strong>基本数据对齐</strong> 和 <strong>结构体数据对齐</strong>。</p>
<p>当今的计算机在计算机内存中读写数据时都是 <mark>按字(word)大小块来进行操作</mark> 的。在32位系统中，数据总线宽度为32位，每次能读取4bytes，地址总线宽度为32，因此最大的寻址空间为2<sup>32</sup>bits=4GB，但是最低2位A[0]、A[1]是不用于寻址，A[2-31]才能存储器相连，因此只能访问4的倍数地址空间，但是总的寻址空间还是2<sup>30</sup>bits字长=4GB，因此在 <mark>内存中所有存放的基本类型数据的首地址的最低两位都是0，除结构体中的成员变量</mark> 。</p>
<blockquote>
<p>基本类型数据对齐就是数据在内存中的 <mark>偏移地址必须等于一个字的倍数</mark>，按这种存储数据的方式，可以提升系统在读取数据时的性能。<mark>为了对齐数据，可能必须在上一个数据结束和下一个数据开始的地方插入一些没有用处字节，这就是结构体数据对齐</mark>。</p>
</blockquote>
<h2 id="基本数据对齐示例">基本数据对齐示例</h2>
<p>例如，假设计算机的字大小为4bytes，因此变量在内存中的首地址都是满足4地址对齐，CPU只能对4的倍数的地址进行读取，而每次能读取4个字节大小的数据。</p>
<p>假设有一个整型的数据a的首地址不是4的倍数(如下图所示)，不妨设为 <code>0X00FFFFF3</code>，则该整型数据存储在地址范围为<code>0X00FFFFF3</code> ~<code>0X00FFFFF6</code>的存储空间中，而CPU每次只能对4的倍数内存地址进行读取，因此想读取a的数据，CPU要分别在 <code>0X00FFFFF0</code> 和 <code>0X00FFFFF4</code> 进行两次内存读取，而且还要对两次读取的数据进行处理才能得到a的数据，而一个程序的瓶颈往往不是CPU的速度，而是取决于内存的带宽，因为CPU得处理速度要远大于从内存中读取数据的速度，因此减少对内存空间的访问是提高程序性能的关键。从上例可以看出，采取内存地址对齐策略是提高程序性能的关键。</p>
<p><mark>也就是说，不对齐内存地址的话会造成CPU对内存中数据访问范围的增大，造成性能浪费。</mark></p>
<h2 id="结构体对齐示例">结构体对齐示例</h2>
<p>首先我们先看看下面的C语言的结构体：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typedef struct MemAlign</span><br><span class="line">&#123;</span><br><span class="line">    int a;</span><br><span class="line">    char b[3];</span><br><span class="line">    int c;</span><br><span class="line">&#125;MemAlign;</span><br></pre></td></tr></table></figure>
<p>以上这个结构体占用内存多少空间呢？</p>
<p>也许你会说，这个简单，计算每个类型的大小，将它们相加就行了，以32bit平台为例，int类型占4bytes，char占用1byte，所以：4 + 3 + 4 = 11bytes，那么这个结构体一共占用11字节空间。</p>
<p>实际上用sizeof运算符来求出这个结构体占用内存空间大小，sizeof(MemAlign)，出乎意料的是，结果居然为12？</p>
<p>是因为这个结构体被优化了，这个优化有个另外一个名字叫“对齐”，那么这个对齐到底做了什么样的优化呢。</p>
<figure>
<img src="https://pic.islet.space/2021/05/1231881-20190917224404418-1265388453.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<p>相信学过汇编的朋友都很熟悉这张图，这张图就是CPU与内存如何进行数据交换的模型，其中，左边蓝色的方框是CPU，右边绿色的方框是内存，内存上面的0～3是内存地址。</p>
<p>上图以32位CPU作为代表，<mark>32位CPU是以双字（DWORD）为单位进行数据传输的</mark>，因此 <mark>在32位系统中，无论是8位、16位还是32位都是以双字进行数据传输</mark> 。</p>
<h2 id="非32位数据非对齐传输示例">非32位数据非对齐传输示例</h2>
<p>8位或16位一样可以传输，但是事情并非像我们想象的那么简单。</p>
<p>一个int类型4字节的数据如果放在上图内存地址1开始的位置，那么这个数据占用的内存地址为1～4，那么这个数据就被分为了2个部分，一个部分在地址0～3中，另外一部分在地址4～7中，又由于32位CPU以双字进行传输，所以，CPU会分2次进行读取，一次先读取地址0～3中内容，再一次读取地址4～7中数据，最后CPU提取并组合出正确的int类型数据，舍弃掉无关数据。那么反过来，如果我们把这个int类型4字节的数据放在上图从地址0开始的位置会怎样呢？读到这里，也许你明白了，CPU只要进行一次读取就可以得到这个int类型数据了。没错，就是这样，这次CPU只用了一个周期就得到了数据，由此可见，对内存数据的摆放是多么重要啊，<mark>摆放正确位置可以减少CPU的使用资源</mark>。</p>
<h1 id="对齐原则">对齐原则</h1>
<ul>
<li><p>第一个成员的首地址为0</p></li>
<li><p>每个成员的首地址是自身大小的整数倍</p>
<ul>
<li>以4bytes对齐为例，如果自身大小大于4bytes，都以4bytes整数倍为基准对齐。</li>
</ul></li>
<li><p>最后以结构总体对齐。</p>
<ul>
<li>以4字节bytes为例，取结构体中最大成员类型倍数，如果超过4字节，都以4字节整数倍为基准对齐。（其中这一条还有个名字叫：“补齐”，补齐的目的就是多个结构变量挨着摆放的时候也满足对齐的要求。）</li>
</ul></li>
</ul>
<h2 id="基本数据对齐与结构补齐示例">基本数据对齐与结构补齐示例</h2>
<p>上述的三原则听起来还是比较抽象，那么接下来我们通过一个例子来加深对内存对齐概念的理解，下面是一个结构体，我们动手算出下面结构体一共占用多少内存？假设我们以32位平台并且以4字节对齐方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#pragma pack(4)</span><br><span class="line">typedef struct MemAlign</span><br><span class="line">&#123;</span><br><span class="line">    char a[18];</span><br><span class="line">    double b;    </span><br><span class="line">    char c;</span><br><span class="line">    int d;    </span><br><span class="line">    short e;    </span><br><span class="line">&#125;MemAlign;</span><br></pre></td></tr></table></figure>
<p>下图为对齐后结构如下：</p>
<figure>
<img src="https://pic.islet.space/2021/05/1231881-20190917224631323-2009020349.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<p>我们就以这个图来讲解是如何对齐的：</p>
<p>第一个成员（char a[18]）：首先，假设我们把它放到内存开始地址为0的位置，由于第一个成员占18个字节，所以第一个成员占用内存地址范围为0～18。</p>
<p>第二个成员（double b）：由于double类型占8字节，又因为8字节大于4字节，所以就以4字节对齐为基准。由于第一个成员结束地址为18，那么地址18并不是4的整数倍，我们需要再加2个字节，也就是从地址20开始摆放第二个成员。</p>
<p>第三个成员（char c）：由于char类型占1字节，任意地址是1字节的整数倍，所以我们就直接将其摆放到紧接第二个成员之后即可。</p>
<p>第四个成员（int d）：由于int类型占4字节，但是地址29并不是4的整数倍，所以我们需要再加3个字节，也就是从地址32开始摆放这个成员。</p>
<p>第五个成员（short e）：由于short类型占2字节，地址36正好是2的整数倍，这样我们就可以直接摆放，无需填充字节,紧跟其后即可。</p>
<p>这样我们内存对齐就完成了。但是离成功还差那么一步，那是什么呢？对，是对整个结构体补齐，接下来我们就补齐整个结构体。那么，先让我们回顾一下补齐的原则：“以4字节对齐为例，取结构体中最大成员类型倍数，如果超过4字节，都以4字节整数倍为基准对齐。”在这个结构体中最大类型为double类型（占8字节），又由于8字节大于4字 节，所以我们还是以4字节补齐为基准，整个结构体结束地址为38，而地址38并不是4的整数倍，所以我们还需要加额外2个字节来填充结构体，如下图红色的就是补齐出来的空间：</p>
<figure>
<img src="https://pic.islet.space/2021/05/1231881-20190917224653471-2076639760.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<p>到此为止，我们内存对齐与补齐就完毕了！接下来我们用实验来证明真理，程序如下：</p>
<figure>
<img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" /><figcaption aria-hidden="true">复制代码</figcaption>
</figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;memory.h&gt;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; 由于VS2010默认是8字节对齐，我们</span><br><span class="line">&#x2F;&#x2F; 通过预编译来通知编译器我们以4字节对齐</span><br><span class="line">#pragma pack(4)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; 用于测试的结构体</span><br><span class="line">typedef struct MemAlign</span><br><span class="line">&#123;</span><br><span class="line">    char a[18];    &#x2F;&#x2F; 18 bytes</span><br><span class="line">    double b;    &#x2F;&#x2F; 08 bytes    </span><br><span class="line">    char c;        &#x2F;&#x2F; 01 bytes</span><br><span class="line">    int d;        &#x2F;&#x2F; 04 bytes</span><br><span class="line">    short e;    &#x2F;&#x2F; 02 bytes</span><br><span class="line">&#125;MemAlign;</span><br><span class="line"> </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; 定义一个结构体变量</span><br><span class="line">    MemAlign m;</span><br><span class="line">    &#x2F;&#x2F; 定义个以指向结构体指针</span><br><span class="line">    MemAlign *p &#x3D; &amp;m;</span><br><span class="line">    &#x2F;&#x2F; 依次对各个成员进行填充，这样我们可以</span><br><span class="line">    &#x2F;&#x2F; 动态观察内存变化情况</span><br><span class="line">    memset( &amp;m.a, 0x11, sizeof(m.a) );</span><br><span class="line">    memset( &amp;m.b, 0x22, sizeof(m.b) );</span><br><span class="line">    memset( &amp;m.c, 0x33, sizeof(m.c) );</span><br><span class="line">    memset( &amp;m.d, 0x44, sizeof(m.d) );</span><br><span class="line">    memset( &amp;m.e, 0x55, sizeof(m.e) );</span><br><span class="line">    &#x2F;&#x2F; 由于有补齐原因，所以我们需要对整个</span><br><span class="line">    &#x2F;&#x2F; 结构体进行填充，补齐对齐剩下的字节</span><br><span class="line">    &#x2F;&#x2F; 以便我们可以观察到变化</span><br><span class="line">    memset( &amp;m, 0x66, sizeof(m) );</span><br><span class="line">    &#x2F;&#x2F; 输出结构体大小</span><br><span class="line">    printf( &quot;sizeof(MemAlign) &#x3D; %d&quot;, sizeof(m) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure>
<img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" /><figcaption aria-hidden="true">复制代码</figcaption>
</figure>
<p>程序运行过程中，查看内存如下：</p>
<figure>
<img src="https://pic.islet.space/2021/05/1231881-20190917225512389-1581088258.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<p>其中，各种颜色带下划线的代表各个成员变量，蓝色方框的代表为内存对齐时候填补的多余字节，由于这里看不到补齐效果，我们接下来看下图，下图篮框包围的字节就是与上图的交集以外的部分就是补齐所填充的字节。</p>
<figure>
<img src="https://pic.islet.space/2021/05/1231881-20190917225534651-684741719.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<p>在最后，我在谈一谈关于补齐的作用，<mark>补齐其实就是为了让这个结构体定义的数组变量时候，数组内部，也同样满足内存对齐的要求</mark>，为了更好的理解这点，我做了一个跟本例子相对照的图：</p>
<figure>
<img src="https://pic.islet.space/2021/05/1231881-20190917225553591-1418591054.png" alt="img" /><figcaption aria-hidden="true">img</figcaption>
</figure>
<h1 id="参考链接">参考链接</h1>
<p>https://blog.csdn.net/donkeylong/article/details/4909720</p>
<p>https://blog.csdn.net/cyousui/article/details/17655051</p>
<p>​</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/17/Computer/2021-05-17-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/17/Computer/2021-05-17-%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" class="post-title-link" itemprop="url">汇编语言</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-17 20:00:00" itemprop="dateCreated datePublished" datetime="2021-05-17T20:00:00+08:00">2021-05-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-05-20 22:50:31" itemprop="dateModified" datetime="2021-05-20T22:50:31+08:00">2021-05-20</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer/" itemprop="url" rel="index"><span itemprop="name">Computer</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="x86指令集介绍">X86指令集介绍</h1>
<h2 id="x86指令集的基本特色">X86指令集的基本特色</h2>
<ul>
<li>向下兼容</li>
<li>变长指令
<ul>
<li>1-15字节，多为2-3字节长度</li>
</ul></li>
<li>多种寻址方式（可访问不对齐内存地址）</li>
</ul>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210517203416861.png" alt="image-20210517203416861" /><figcaption aria-hidden="true">image-20210517203416861</figcaption>
</figure>
<h2 id="x86寄存器">X86寄存器</h2>
<p>指令集的通用寄存器个数有限</p>
<blockquote>
<p>X86-32下指令集通用寄存器数量为8个，x86-64下为16个</p>
</blockquote>
<p>至多只有一个操作数在内存中，另一个操作数为立即数或寄存器</p>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210517204354665.png" alt="image-20210517204354665" /><figcaption aria-hidden="true">image-20210517204354665</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210517204446891.png" alt="image-20210517204446891" /><figcaption aria-hidden="true">image-20210517204446891</figcaption>
</figure>
<p><em>源自 网络PDF</em>——<a target="_blank" rel="noopener" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwimmc7O39DwAhV5yYsBHdS2CHMQFjAAegQIAxAD&amp;url=http%3A%2F%2Fimages.china-pub.com%2Febook4930001-4935000%2F4934543%2Fch02.pdf&amp;usg=AOvVaw0yJuRWmzjtj41FR6ld_Vmm">X86处理器架构</a></p>
<h1 id="sharc汇编">SHARC汇编</h1>
<p><a href="">《Assembler and Preprocessor Manual(including the ADSP-BFxxx, ADSP-21xxx, ADSP-TSxxx)》</a></p>
<h2 id="visualdsp">VisualDSP++</h2>
<p>以下是ADI官网对VisualDSP++（以下简称VDSP）的解释，本质上是个集成软件开发和调试环境（IDDE）。</p>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210520005659254.png" alt="image-20210520005659254" /><figcaption aria-hidden="true">image-20210520005659254</figcaption>
</figure>
<p>汇编器的操作取决于两种类型的控制：汇编器指令和汇编器开关。</p>
<blockquote>
<p>Assembler operations depend on two types of controls: <strong>assembler directives</strong> and <strong>assembler switches</strong>.</p>
</blockquote>
<p>VDSP支持以下三种不同的汇编器：</p>
<p><img src="https://pic.islet.space/2021/05/image-20210520010438229.png" alt="image-20210520010438229" style="zoom: 67%;" /></p>
<p>DSP汇编开发者需要先熟悉以下内容：</p>
<blockquote>
<ul>
<li><p>“<em>Writing Assembly Programs</em>” on page 1-3</p></li>
<li><p>“<em>Using Assembler Support for C Structs</em>” on page 1-21</p></li>
<li><p>“<em>Preprocessing a Program</em>” on page 1-24</p></li>
<li><p>“<em>Using Assembler Feature Macros</em>” on page 1-25</p></li>
<li><p>“<em>Generating Make Dependencies</em>” on page 1-37</p></li>
<li><p>“<em>Reading a Listing File</em>” on page 1-38</p></li>
<li><p>“<em>Enabling Statistical Profiling for Assembly Functions</em>” on page 1-38</p></li>
<li><p>“<em>Specifying Assembler Options in VisualDSP++</em>” on page 1-173</p></li>
</ul>
</blockquote>
<h2 id="总览">总览</h2>
<p>汇编器 将 <strong>汇编源(.asm)</strong>、<strong>数据(.dat)</strong> 和 <strong>头文件(.h)</strong> 三者整理成可执行可链接的格式（ELF），也就是一个标准的 <strong>二进制文件(.doj)</strong>。</p>
<p>另外，汇编器还将生成一个 <strong>列表文件(.lst)</strong>，展示二进制文件和源文件之间的联系。</p>
<p>也就是说，编译成功后，.doj和.lst文件就是其编译结果。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210520011656751.png" alt="image-20210520011656751" style="zoom:67%;" /></p>
<blockquote>
<p>Figure 1-1 shows a graphical overview of the assembly process. The figure shows the preprocessor processing the assembly source (.asm) and header (.h) files.</p>
<p>By default, the assembler processes an intermediate file to produce a binary object file (.doj) and an optional listing file (.lst).</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210520012328329.png" alt="image-20210520012328329" style="zoom:67%;" /></p>
<h2 id="编写">编写</h2>
<ul>
<li><p>Assembler directives are coded in assembly source files.</p></li>
<li><p>The directives allow you to <strong>define variables</strong>, <strong>set up hardware features</strong>, and <strong>identify program sections</strong> for placement within processor memory.</p></li>
<li><p>The assembler uses directives for guidance as it translates a source program into object code.</p></li>
</ul>
<p>注意：</p>
<blockquote>
<ul>
<li><p>Do not use a <strong><em>word processor</em></strong> that embeds special control codes in the text.</p></li>
<li><p>Use an <code>.asm</code> extension to source file names to identify them as assembly source files.</p></li>
</ul>
</blockquote>
<p>可以使用像 <code>batch-file</code> 和 <code>makefile</code> 这样的命令行工具来汇编你的源文件。</p>
<p>列表文件还提供了关于导入的C语言数据结构的信息。</p>
<h2 id="问题解决">问题解决</h2>
<h3 id="问题一">问题一</h3>
<p><strong>现象</strong>：出现如下图所示的头文件缺少</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210520095711.png" alt="image-20210520090023689" /><figcaption aria-hidden="true">image-20210520090023689</figcaption>
</figure>
<p><strong>原因</strong>：<code>.boj</code>文件和其所依赖的 <code>.h</code> 头文件相对路径不一致，或项目文件的绝对路径与原来创建时不一致。</p>
<p><strong>例如</strong>：从文件 <code>Debug/system/startup_Idf/app_IVT.doj</code> 中可以看出，该文件的创作者是将其放置在 <code>D:\ADSP\workspace\LED_test\Debug</code> 下的，因此需要改变该项目文件的位置。</p>
<p><strong>解决方法</strong>：在原创作者的绝对路径下放置该项目文件。</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210520095708.png" alt="image-20210520090936369" /><figcaption aria-hidden="true">image-20210520090936369</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/14/Communication/2021-05-14-I2C%E3%80%81SPI%E3%80%81TDM%E5%8F%8AI2S/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/14/Communication/2021-05-14-I2C%E3%80%81SPI%E3%80%81TDM%E5%8F%8AI2S/" class="post-title-link" itemprop="url">I^2^C、SPI、TDM及I2S</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-14 10:55:00" itemprop="dateCreated datePublished" datetime="2021-05-14T10:55:00+08:00">2021-05-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-15 21:12:20" itemprop="dateModified" datetime="2021-07-15T21:12:20+08:00">2021-07-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Communication/" itemprop="url" rel="index"><span itemprop="name">Communication</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="i2c">I<sup>2</sup>C</h1>
<p><strong>标准</strong>：<a target="_blank" rel="noopener" href="https://www.nxp.com/docs/en/user-guide/UM10204.pdf">《NXP_UM10204_I<sup>2</sup>C-bus specification and user manual》</a></p>
<blockquote>
<p><em>I<sup>2</sup>C总线是一个事实上的世界标准，现在已经在50多家公司生产的1000多种不同的IC中实施。</em></p>
<p><em>此外，多功能的I<sup>2</sup>C总线被用于各种控制架构，如系统管理总线（SMBus）、电源管理总线（PMBus）、智能平台管理接口（IPMI）、显示数据通道（DDC）和高级电信计算架构（ATCA）。</em></p>
<p><em>本文件帮助设备和系统设计者了解I<sup>2</sup>C总线的工作原理并实现工作应用。描述了各种操作模式。它包含了对I<sup>2</sup>C<strong>总线数据传输</strong>、握手和总线仲裁方案的全面介绍。详细的章节涵盖了I<sup>2</sup>C总线在每种工作模式下的时序和电气规范。</em></p>
<p><em>I<sup>2</sup>C兼容芯片的设计者应将该文件作为参考，并确保新设备满足该文件中规定的所有限制。包含I<sup>2</sup>C器件的系统的设计者应审查本文件，并参考各个组件的数据表。</em></p>
<p>——翻译自标准文件</p>
</blockquote>
<p>I<sup>2</sup>C(Inter－Integrated Circuit)是一种通用的总线协议。它是由Philips(飞利浦)公司，现NXP(恩智浦)半导体开发的一种简单的双向两线制总线协议标准。</p>
<p>对于硬件设计人员来说，只需要2个管脚，极少的连接线和面积，就可以实现芯片间的通讯，对于软件开发者来说，可以使用同一个I<sup>2</sup>C驱动库，来实现实现不同器件的驱动，大大减少了软件的开发时间。极低的工作电流，降低了系统的功耗，完善的应答机制大大增强通讯的可靠性。</p>
<h2 id="术语">术语</h2>
<p><img src="https://pic.islet.space/2021/05/image-20210514111033910.png" alt="image-20210514111033910" style="zoom: 67%;" /></p>
<table>
<thead>
<tr class="header">
<th>术语</th>
<th>释义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>总线</td>
<td>传输数据的通路</td>
</tr>
<tr class="even">
<td>传送者</td>
<td>传输数据至总线的设备</td>
</tr>
<tr class="odd">
<td>接收者</td>
<td>从总线上接受数据的设备</td>
</tr>
<tr class="even">
<td>主（机）</td>
<td>主动开启传输、生成时钟信号 并 主动结束传输的设备</td>
</tr>
<tr class="odd">
<td>从（机）</td>
<td>由主机寻址的设备</td>
</tr>
<tr class="even">
<td>多主（机）</td>
<td>在不损坏数据传输的情况下允许多主机可以试图同时控制总线</td>
</tr>
<tr class="odd">
<td>仲裁</td>
<td>确保在有多个主机同时试图控制总线的情况下，只允许一个主机这样做，而且仲裁成功的信息不会被（其他设备）破坏的程序。</td>
</tr>
<tr class="even">
<td>同步</td>
<td>确保两个及以上设备其时钟信号的同步</td>
</tr>
</tbody>
</table>
<p>以下这个图应该可以较好地解释“多主机”的概念，多个主机可以同时向外发出传输数据的申请，也可以主动结束其数据传输。虽然，I<sup>2</sup>C降低了总线复用的成本，但仍需要“仲裁”机制来解决多个主机之间的无序竞争状态。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210514112114667.png" alt="image-20210514112114667" style="zoom:67%;" /></p>
<h2 id="总线特征">总线特征</h2>
<h3 id="总线硬件要求">总线硬件要求</h3>
<p>通过 <strong>串行数据</strong>（SDA，Serial Data）和 <strong>串行时钟</strong>（SCL，Serial Clock）两条线路对设备进行连接。</p>
<p>每个设备都通过自身的通信设备地址进行互相辨别，且每个设备都可以当发送者或接收者，取决于设备自身的功能定义。</p>
<h3 id="标准传输速率">标准传输速率</h3>
<p>各模式、速率及其传输方向见下方表格。</p>
<blockquote>
<p>Data on the I<sup>2</sup>C-bus can be transferred at rates of up to 100 kbit/s in the Standard-mode, up to 400 kbit/s in the Fast-mode, up to 1 Mbit/s in Fast-mode Plus, or up to 3.4 Mbit/s in the High-speed mode.</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th>MODE</th>
<th>RATE</th>
<th>TRANSFER DIRECTION</th>
<th>DOWNWARD COMPATIBLE WITH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>STANDARD</td>
<td>100 Kbit/s</td>
<td>bidirectional</td>
<td>/</td>
</tr>
<tr class="even">
<td>FAST</td>
<td>400 Kbit/s</td>
<td>bidirectional</td>
<td>STANDARD</td>
</tr>
<tr class="odd">
<td>FAST-PLUS</td>
<td>1 Mbit/s</td>
<td>bidirectional</td>
<td>STANDARD / FAST</td>
</tr>
<tr class="even">
<td>HIGH-SPEED</td>
<td>3.4 Mbit/s</td>
<td>bidirectional</td>
<td>STANDARD / FAST / FAST-PLUS</td>
</tr>
<tr class="odd">
<td>ULTRA-FAST</td>
<td>5 Mbit/s</td>
<td>unidirectional</td>
<td>/</td>
</tr>
</tbody>
</table>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210522182927364.png" alt="image-20210522182927364" /><figcaption aria-hidden="true">image-20210522182927364</figcaption>
</figure>
<h2 id="协议要求">协议要求</h2>
<p>以下协议要求适用于双向通信模式（不包括ULTRA-FAST模式下的单向通信）</p>
<h3 id="逻辑电平规定">逻辑电平规定</h3>
<p>由于I<sup>2</sup>C的接入设备众多（如CMOS、NMOS、Bipolar等），因此逻辑电平0和逻辑电平1（的电压）并不是固定不变的，这取决于VDD的电平。</p>
<p>输入参考电平会被控制在VDD电平的30%~70%之间。 V<sub>IL</sub> = 0.3 * V<sub>DD</sub>；V<sub>IH</sub> = 0.7 * V<sub>DD</sub> 。</p>
<p>某些传统设备的输入电平会被固定在1.5V（V<sub>IL</sub>）和3.0V（V<sub>IH</sub>），但新设备都要求是 30%V<sub>DD</sub> 及 70%V<sub>DD</sub> 。</p>
<p><strong>注意</strong>：V<sub>IL</sub>、V<sub>IH</sub>、V<sub>OL</sub>、V<sub>OH</sub>都是以参考电压作为基准的，即要达到某个电压的百分之多少时，才能够被认为是 <strong>逻辑电平0</strong> 或 <strong>逻辑电平1</strong> 。例如，可将V<sub>IL</sub> 视作当V<sub>DD</sub>下降到只有30%及以下时，为逻辑电平0，30%V<sub>DD</sub>是其逻辑电平的最高阈值；同理可得 V<sub>IH</sub> ；超过这个值而未到达70%的中间态则为不确定态。</p>
<blockquote>
<p>Due to the variety of different technology devices (CMOS, NMOS, bipolar) that can be connected to the I<sup>2</sup>C-bus, the levels of the logical ‘0’ (LOW) and ‘1’ (HIGH) are not fixed and depend on the associated level of VDD . Input reference levels are set as 30 % and 70 % of VDD ; VIL is 0.3VDD and VIH is 0.7V DD .</p>
<p>See Figure 38, timing diagram. Some legacy device input levels were fixed at V<sub>IL</sub> = 1.5 V and V<sub>IH</sub> = 3.0 V, but all new devices require this 30 %/70 % specification.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210514134830615.png" alt="image-20210514134830615" style="zoom: 67%;" /></p>
<h3 id="时序正确性">时序正确性</h3>
<ul>
<li>SDA上的数据必须在SCL高电平期间保持稳定，即不能在SCL高电平期间发生翻转（后见原因），只有在SCL低电平时可以翻转。</li>
<li>时钟脉冲信号生成要先于数据传送。</li>
</ul>
<blockquote>
<p>The data on the SDA line must be stable during the HIGH period of the clock. The HIGH or LOW state of the data line can only change when the clock signal on the SCL line is LOW (see Figure 4). One clock pulse is generated for each data bit transferred.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210514141512136.png" alt="image-20210514141512136" style="zoom: 80%;" /></p>
<h3 id="开始及结束标志">开始及结束标志</h3>
<ul>
<li><p>传输开始时必须以一个 <strong>开始</strong> 信号作为标志，结束时必须以一个 <strong>结束</strong> 信号作为标志。</p></li>
<li><p><strong>开始信号 </strong>是以SCL为高电平时的 <strong>SDA电平的由高转低</strong> 作为标志，<strong>结束信号</strong> 是以SCL高电平时的 <strong>SDA电平的由低转高</strong> 作为标志。</p></li>
<li><p>开始和结束标志必须由主设备控制。</p></li>
</ul>
<blockquote>
<p>All transactions begin with a START (S) and are terminated by a STOP (P) (see Figure 5). A HIGH to LOW transition on the SDA line while SCL is HIGH defines a START condition. A LOW to HIGH transition on the SDA line while SCL is HIGH defines a STOP condition.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210514142116674.png" alt="image-20210514142116674" style="zoom: 80%;" /></p>
<h4 id="开始字节">开始字节</h4>
<p><img src="https://pic.islet.space/2021/05/image-20210515150526897.png" alt="image-20210515150526897" style="zoom:67%;" /></p>
<blockquote>
<p>dummy acknowledge (HIGH) : 无声确认？？？</p>
</blockquote>
<h3 id="总线状态">总线状态</h3>
<p>总线具有两种状态，<strong>繁忙</strong>（Busy）和 <strong>空闲</strong>（Free），即 SDA电平 “开始” 后，总线进入繁忙状态， SDA电平 “结束” 后，总线进入空闲状态。</p>
<p><strong>注意</strong>：在总线繁忙期间，发生重复的“开始”状态（而不是“结束”状态），由于“重复开始”和 “开始” 功能相同，为了方便，统称为 “开始”，除非特殊说明为 “重复开始”。</p>
<blockquote>
<p>The bus stays busy if a repeated START (Sr) is generated instead of a STOP condition. In this respect, the START (S) and repeated START (Sr) conditions are functionally identical. For the remainder of this document, therefore, the S symbol is used as a generic term to represent both the START and repeated START conditions, unless Sr is particularly relevant.</p>
</blockquote>
<h3 id="传输比特位">传输比特位</h3>
<ul>
<li>SDA线上的字节传输必须满足8位长度。</li>
<li>每次传输数据的字节数不受限制。</li>
<li>每个字节数后都需要跟一个<strong>确认位（Acknowledge bit）</strong>。</li>
<li>当从机无法完整接收或传输一个完整的数据字节时，例如正在产生内部中断等，除非其完成内部的某些功能，否则该从机将能够一直拉低SCL的电平，<strong>强制让主机一直处于等待状态</strong>。只有当从机准备好接收下一个完整的字节并释放SCL时，数据传输才会继续。</li>
</ul>
<blockquote>
<p>Every byte put on the SDA line must be eight bits long. The number of bytes that can be transmitted per transfer is unrestricted. Each byte must be followed by an Acknowledge bit.</p>
<p><strong>Data is transferred with the Most Significant Bit (MSB) first</strong> (see Figure 6). If a slave cannot receive or transmit another complete byte of data until it has performed some other function, for example servicing an internal interrupt, it can hold the clock line SCL LOW to force the master into a wait state. Data transfer then continues when the slave is ready for another byte of data and releases clock line SCL.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210514144620803.png" alt="image-20210514144620803" style="zoom:80%;" /></p>
<h3 id="确认标志">确认标志</h3>
<ul>
<li>每个字节（8比特）后都跟着一个确认位，即前8位数据，第9位确认。</li>
<li><strong>SCL上的时钟信号由主机产生，包括确认位的的第九个时钟脉冲</strong>。</li>
<li>SDA线并不是由主机一直占有的，每发送完一个完整字节后，主机都会释放SDA线，由从机进行数据确认。</li>
<li>发送者在确认时钟脉冲期间释放SDA线，以便接收者可以将SDA线拉低，并且在该时钟脉冲的高电平期间保持稳定的低电平（见图4）。</li>
<li>对于设置（set-up）和保持（Hold）的时间，都应该依照表10中只针对各种不同模式的要求进行设置。</li>
<li>如果SDA电平在第九个时钟脉冲时仍保持高电平，则被定义为 “未确认状态”。则此时主机可以发送一个“结束”标志来结束当前连接，或发送一个“开始”标志来开启一次新的传送。</li>
</ul>
<p><img src="/home/kali/.config/Typora/typora-user-images/image-20210514154506246.png" alt="image-20210514154506246" style="zoom: 80%;" /></p>
<blockquote>
<p>The acknowledge takes place after every byte. The acknowledge bit allows the receiver to signal the transmitter that the byte was successfully received and another byte may be sent. The master generates all clock pulses, including the acknowledge ninth clock pulse.</p>
<p>The Acknowledge signal is defined as follows: the transmitter releases the SDA line during the acknowledge clock pulse so the <strong><em>receiver can pull the SDA line LOW</em></strong> and it remains stable LOW during the HIGH period of this clock pulse (see Figure 4). Set-up and hold times (specified in Section 6) must also be taken into account.</p>
<p>When SDA remains HIGH during this ninth clock pulse, this is defined as the Not Acknowledge signal. The master can then generate either a STOP condition to abort the transfer, or a repeated START condition to start a new transfer.</p>
</blockquote>
<p><strong>以下为五种“未确认/未应答”的可能情况</strong>：There are five conditions that lead to the generation of a NACK:</p>
<ol type="1">
<li><strong>传输地址错误</strong>：No receiver is present on the bus with the transmitted address so there is no device to respond with an acknowledge.</li>
<li><strong>实时处理中</strong>：The receiver is unable to receive or transmit because it is performing some real-time function and is not ready to start communication with the master.</li>
<li><strong>数据/代码未定义</strong>：During the transfer, the receiver <strong>gets data or commands that it does not understand.</strong></li>
<li><strong>正在传输中</strong>：During the transfer, the receiver <strong>cannot receive any more data bytes</strong>.</li>
<li><strong>未收到结束信号（收发身份未转换）</strong>：A master-receiver must signal the end of the transfer to the slave transmitter.</li>
</ol>
<h3 id="时钟同步">时钟同步</h3>
<p>任意几个主机都可能同时发起数据传输请求，此时只有一个主机和一个从机可以掌握总线进行通信，此时需要通过 <strong>时间同步</strong> 和 <strong>仲裁</strong> 完成对总线的调配。</p>
<p><strong>在单机系统（Single Master System）中，不需要时钟同步和仲裁。</strong></p>
<p>时钟同步是通过I<sup>2</sup>C接口与SCL线的有线-AND连接进行的。</p>
<p>这意味着SCL线上的高电平到低电平的转换会导致相关的主站开始对其低电平周期进行计数（如图7的CLK<sub>2</sub>），一旦一个主站时钟 CLK<sub>1</sub> 变为低电平，它就会将SCL线电平拉低，并保持在这个状态，直到另一个时钟 CLK<sub>2</sub> 达到高电平状态。</p>
<p>然而，如果时钟 CLK<sub>2</sub> 仍在其低电平周期内，CLK<sub>1</sub> 的低电平到高电平转换可能不会改变SCL线的状态。</p>
<p>因为SCL线被具有最长的低电平周期的主站 CLK<sub>2</sub> 保持为低电平，而在这段时间内，低电平周期较短的主站 CLK<sub>1</sub> 进入高电平等待状态。</p>
<blockquote>
<p>Clock synchronization is performed using the wired-AND connection of I<sup>2</sup>C interfaces to the SCL line. This means that a HIGH to LOW transition on the SCL line causes the masters concerned to start counting off their LOW period and, once a master clock has gone LOW, it holds the SCL line in that state until the clock HIGH state is reached (see Figure 7). However, if another clock is still within its LOW period, the LOW to HIGH transition of this clock may not change the state of the SCL line. The SCL line is therefore held LOW by the master with the longest LOW period. Masters with shorter LOW periods enter a HIGH wait-state during this time.</p>
</blockquote>
<p>当所有相关的主控器都结束了他们的低电平周期，时钟线被释放并变成高电平。</p>
<p>然后，在主站时钟和SCL线的状态之间没有差异，所有的主站开始计算他们的高电平周期。</p>
<p><strong>第一个完成其高电平周期的主站再次将SCL线拉到低电平</strong>。这样，就产生了一个<strong>同步的SCL时钟</strong>，<strong>其低电平周期由具有最长时钟低电平周期的主站决定</strong>，<strong>其高电平周期由具有最短时钟高电平周期的主站决定</strong>。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210514170202184.png" alt="image-20210514170202184" style="zoom: 67%;" /></p>
<h3 id="竞争仲裁">竞争仲裁</h3>
<p>仲裁和同步一样，是指只有在系统中使用一个以上的主站时才需要的协议的一个部分。注意，从机不参与仲裁程序。</p>
<p>一个主站只有在总线空闲时才可以开始传输。两个主站可以在START条件的最小保持时间（tHD;STA）内产生一个START条件，从而在总线上产生一个有效的START条件。然后需要进行仲裁，以确定哪个主站将完成其传输。</p>
<p>仲裁是逐位进行的。在每个比特期间，当SCL为高电平时，每个主站检查SDA电平是否与其所发送的内容相符，期间可能需要很多比特，只要传输的内容相同，两个主站实际上可以无误地完成整个信息传输过程。</p>
<p><mark>当一个主站第一次试图发送一个高电平，但检测到SDA电平为低电平时，主站知道它已经失去了仲裁，并关闭其SDA输出驱动器</mark>。在其他主站被仲裁过程中，正在传输其信息的主站将继续其传输，没有信息丢失。</p>
<p>失去仲裁的主站可以产生时钟脉冲，直到它失去仲裁的字节结束，并且必须在总线空闲时重新尝试传输。</p>
<p><mark>如果一个主站也包含了一个从站功能，并且它在寻址阶段失去了仲裁，有可能获胜的主站正试图对它进行寻址。因此，失败的主站必须立即切换到其从站模式。</mark></p>
<p>图8显示了两个主站的仲裁程序。可能涉及更多，这取决于有多少个主站连接到总线上。</p>
<p><mark>当产生DATA1的主站的内部数据电平与SDA线上的实际电平有差异时，DATA1的输出被关闭。这并不影响由获胜主站发起的数据传输。</mark></p>
<p><img src="https://pic.islet.space/2021/05/image-20210515142633906.png" alt="image-20210515142633906" style="zoom: 67%;" /></p>
<h3 id="时间拉伸">时间拉伸</h3>
<h3 id="从机地址和读取位">从机地址和读取位</h3>
<h3 id="位寻址">10位寻址</h3>
<h3 id="反转地址">反转地址</h3>
<h3 id="通用寻址">通用寻址</h3>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210515172907284.png" alt="image-20210515172907284" /><figcaption aria-hidden="true">image-20210515172907284</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210515172945861.png" alt="image-20210515172945861" /><figcaption aria-hidden="true">image-20210515172945861</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210515172958184.png" alt="image-20210515172958184" /><figcaption aria-hidden="true">image-20210515172958184</figcaption>
</figure>
<h3 id="软复位">软复位</h3>
<p>在发送general call (0000 0000)后，再发送一个 0000 0110 (06h) ，这样两个具有先后顺序的字节来定义软复位。</p>
<p>首先，这种软复位是可选 ，并不是所有设备都会对软复位指令进行响应。</p>
<p>在收到这2个字节的序列时，所有被设计为响应一般调用地址的设备都会复位，并接收其地址的可编程部分。</p>
<blockquote>
<p>On receiving this 2-byte sequence, all devices designed to respond to the general call address reset and take in the programmable part of their address.</p>
</blockquote>
<p>必须采取预防措施，确保设备在施加电源电压后没有拉低SDA或SCL线，因为这些低电平会阻断总线。</p>
<h3 id="总线复位">总线复位</h3>
<p>SCK信号一直卡在低电平的事件较少发生。</p>
<ul>
<li>如果I<sup>2</sup>C总线设备拥有硬件复位输入，则可以通过优先程序启用硬件中断复位来重置总线。</li>
<li>如果没有硬件复位输入，则通过给设备循环供电，激活强制性的内部开机复位（POR）电路。</li>
</ul>
<p>SDA信号如果一直卡在低电平。</p>
<ul>
<li><p>则主机应该发送九次SCL时钟脉冲，此时令SDA保持低电平的设备在收到九次脉冲后应主动释放总线。</p></li>
<li><p>如果九次脉冲没有用，则启用硬件中断复位或循环供电来清除总线。</p></li>
</ul>
<h3 id="设备id">设备ID</h3>
<p>可选的3字节只读设备ID编码（an optional 3-byte read-only ）：</p>
<ul>
<li>12位是设备制造商编号，具有独一无二性</li>
<li>9位零件ID，由设备制造商写入</li>
<li>3位模具/晶元版本，由设备制造商写入</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/image-20210515152141963.png" alt="image-20210515152141963" style="zoom:67%;" /></p>
<ol type="1">
<li><p>启动条件</p></li>
<li><p>主站发送保留设备ID的 I<sup>2</sup>C 总线地址，后面的R/W位设置为<code>0</code>（写）：<code>1111 1000</code>。</p></li>
<li><p>主站发送从属地址。LSB是一个 "不关心"的值，只有一个设备必须确认这个字节（拥有I<sup>2</sup>C总线从属地址的设备）。</p></li>
<li><p>主站发送一个 Re-START 条件。</p></li>
</ol>
<blockquote>
<p>备注：在 STOP 条件之后，再加上一个 START 条件，就会重置从属状态机，无法进行设备ID读取。另外，在 STOP 条件或 Re-START 条件之后，对另一个从属设备的访问也会重置从属状态机，无法执行Device ID读取。</p>
</blockquote>
<ol start="5" type="1">
<li><p>主站发送保留设备ID的 I<sup>2</sup>C 总线地址，后面的R/W位设置为 <code>1</code>（读）：<code>1111 1001</code>。</p></li>
<li><p>可以进行设备ID读取，从12个制造商位开始（第一个字节+第二个字节的4个MSB），然后是9个部件识别位（第二个字节的4个LSB+第三个字节的5个MSB），然后是三个芯片修订位（第三个字节的3个LSB）。</p></li>
<li><p>主站通过NACKing最后一个字节来结束读取序列，从而重置从属设备的状态机，允许主站发送 STOP 条件。</p>
<blockquote>
<p>备注：设备ID的读取可以随时通过发送NACK来停止。</p>
</blockquote></li>
</ol>
<p>如果主站在第三个字节之后继续ACK，从站就会滚回第一个字节，并继续发送设备ID序列，直到检测到 NACK。</p>
<h1 id="spi">SPI</h1>
<p>标准：</p>
<h2 id="术语-1">术语</h2>
<h2 id="spi和i2c的对比">SPI和I<sup>2</sup>C的对比</h2>
<table>
<thead>
<tr class="header">
<th></th>
<th>SPI</th>
<th>I<sup>2</sup>C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>通信模式</td>
<td>全双工<br><em>（是指单主从设备之间的全双工，从设备之间无法进行通信）</em></td>
<td>半双工<br><em>（任意主从设备可以分时复用同一条通信线路）</em></td>
</tr>
<tr class="even">
<td>主从模式</td>
<td>一主多从</td>
<td>多主多从</td>
</tr>
<tr class="odd">
<td>引脚占用</td>
<td>从设备越多，对主机占用的引脚较多<br>主设备占用引脚：3+n<br>从设备占用引脚：4<br><em>（n为从设备数）</em></td>
<td>主从设备均占用：2</td>
</tr>
<tr class="even">
<td>应答响应</td>
<td>无</td>
<td>有</td>
</tr>
<tr class="odd">
<td>传输速率</td>
<td>最高：</td>
<td>最高：3.4Mbps</td>
</tr>
<tr class="even">
<td>从机选择</td>
<td>通过 <strong>CS(SS)选择引脚</strong> 来选择</td>
<td>通过 <strong>器件地址</strong> 来选择</td>
</tr>
<tr class="odd">
<td>数据采样</td>
<td>在SCLK边沿采样</td>
<td>在SCL高电平采样</td>
</tr>
<tr class="even">
<td>通信距离</td>
<td>短</td>
<td>短</td>
</tr>
</tbody>
</table>
<h1 id="uart">UART</h1>
<p>标准：</p>
<h1 id="tdm">TDM</h1>
<p>标准：</p>
<h1 id="i2s">I<sup>2</sup>S</h1>
<p>标准：</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/05/14/Communication/2021-05-14-I2C%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/05/14/Communication/2021-05-14-I2C%E9%80%9A%E4%BF%A1/" class="post-title-link" itemprop="url">I2C通信</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-05-14 10:55:00" itemprop="dateCreated datePublished" datetime="2021-05-14T10:55:00+08:00">2021-05-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-07-15 21:12:07" itemprop="dateModified" datetime="2021-07-15T21:12:07+08:00">2021-07-15</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Communication/" itemprop="url" rel="index"><span itemprop="name">Communication</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="i2c基本通信规则">I2C基本通信规则</h1>
<p><strong>标准</strong>：<a target="_blank" rel="noopener" href="https://www.nxp.com/docs/en/user-guide/UM10204.pdf">《NXP_UM10204_I2C-bus specification and user manual》</a></p>
<blockquote>
<p><em>I<sup>2</sup>C总线是一个事实上的世界标准，现在已经在50多家公司生产的1000多种不同的IC中实施。</em></p>
<p><em>此外，多功能的I<sup>2</sup>C总线被用于各种控制架构，如系统管理总线（SMBus）、电源管理总线（PMBus）、智能平台管理接口（IPMI）、显示数据通道（DDC）和高级电信计算架构（ATCA）。</em></p>
<p><em>本文件帮助设备和系统设计者了解I<sup>2</sup>C总线的工作原理并实现工作应用。描述了各种操作模式。它包含了对I<sup>2</sup>C<strong>总线数据传输</strong>、握手和总线仲裁方案的全面介绍。详细的章节涵盖了I<sup>2</sup>C总线在每种工作模式下的时序和电气规范。</em></p>
<p><em>I<sup>2</sup>C兼容芯片的设计者应将该文件作为参考，并确保新设备满足该文件中规定的所有限制。包含I<sup>2</sup>C器件的系统的设计者应审查本文件，并参考各个组件的数据表。</em></p>
<p>——翻译自标准文件</p>
</blockquote>
<p>I<sup>2</sup>C(Inter－Integrated Circuit)是一种通用的总线协议。它是由Philips(飞利浦)公司，现NXP(恩智浦)半导体开发的一种简单的双向两线制总线协议标准。</p>
<p>对于硬件设计人员来说，只需要2个管脚，极少的连接线和面积，就可以实现芯片间的通讯，对于软件开发者来说，可以使用同一个I<sup>2</sup>C驱动库，来实现实现不同器件的驱动，大大减少了软件的开发时间。极低的工作电流，降低了系统的功耗，完善的应答机制大大增强通讯的可靠性。</p>
<h2 id="术语">术语</h2>
<p><img src="https://pic.islet.space/2021/05/image-20210514111033910.png" alt="image-20210514111033910" style="zoom: 67%;" /></p>
<table>
<thead>
<tr class="header">
<th>术语</th>
<th>释义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>总线</td>
<td>传输数据的通路</td>
</tr>
<tr class="even">
<td>传送者</td>
<td>传输数据至总线的设备</td>
</tr>
<tr class="odd">
<td>接收者</td>
<td>从总线上接受数据的设备</td>
</tr>
<tr class="even">
<td>主（机）</td>
<td>主动开启传输、生成时钟信号 并 主动结束传输的设备</td>
</tr>
<tr class="odd">
<td>从（机）</td>
<td>由主机寻址的设备</td>
</tr>
<tr class="even">
<td>多主（机）</td>
<td>在不损坏数据传输的情况下允许多主机可以试图同时控制总线</td>
</tr>
<tr class="odd">
<td>仲裁</td>
<td>确保在有多个主机同时试图控制总线的情况下，只允许一个主机这样做，而且仲裁成功的信息不会被（其他设备）破坏的程序。</td>
</tr>
<tr class="even">
<td>同步</td>
<td>确保两个及以上设备其时钟信号的同步</td>
</tr>
</tbody>
</table>
<p>以下这个图应该可以较好地解释“多主机”的概念，多个主机可以同时向外发出传输数据的申请，也可以主动结束其数据传输。虽然，I<sup>2</sup>C降低了总线复用的成本，但仍需要“仲裁”机制来解决多个主机之间的无序竞争状态。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210514112114667.png" alt="image-20210514112114667" style="zoom:67%;" /></p>
<h2 id="硬件要求">硬件要求</h2>
<h3 id="电气特性">电气特性</h3>
<p>根据要求，I2C的高电平有效值要达到输入参考电压（一般是VDD）的0.7倍以上，低电平有效值需要达到输入参考电压的0.3倍以下。</p>
<figure>
<img src="https://pic.islet.space/2021/06/20210618143441.png" alt="image-20210618143438565" /><figcaption aria-hidden="true">image-20210618143438565</figcaption>
</figure>
<h3 id="总线硬件要求">总线硬件要求</h3>
<p>通过 <strong>串行数据</strong>（SDA，Serial Data）和 <strong>串行时钟</strong>（SCL，Serial Clock）两条线路对设备进行连接。</p>
<p>每个设备都通过自身的通信设备地址进行互相辨别，且每个设备都可以当发送者或接收者，取决于设备自身的功能定义。</p>
<h3 id="标准传输速率">标准传输速率</h3>
<p>各模式、速率及其传输方向见下方表格。</p>
<blockquote>
<p>Data on the I<sup>2</sup>C-bus can be transferred at rates of up to 100 kbit/s in the Standard-mode, up to 400 kbit/s in the Fast-mode, up to 1 Mbit/s in Fast-mode Plus, or up to 3.4 Mbit/s in the High-speed mode.</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th>MODE</th>
<th>RATE</th>
<th>TRANSFER DIRECTION</th>
<th>DOWNWARD COMPATIBLE WITH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>STANDARD</td>
<td>100 Kbit/s</td>
<td>bidirectional</td>
<td>/</td>
</tr>
<tr class="even">
<td>FAST</td>
<td>400 Kbit/s</td>
<td>bidirectional</td>
<td>STANDARD</td>
</tr>
<tr class="odd">
<td>FAST-PLUS</td>
<td>1 Mbit/s</td>
<td>bidirectional</td>
<td>STANDARD / FAST</td>
</tr>
<tr class="even">
<td>HIGH-SPEED</td>
<td>3.4 Mbit/s</td>
<td>bidirectional</td>
<td>STANDARD / FAST / FAST-PLUS</td>
</tr>
<tr class="odd">
<td>ULTRA-FAST</td>
<td>5 Mbit/s</td>
<td>unidirectional</td>
<td>/</td>
</tr>
</tbody>
</table>
<h2 id="编码协议">编码协议</h2>
<p>以下协议要求适用于双向通信模式（不包括ULTRA-FAST模式下的单向通信）</p>
<h3 id="逻辑电平规定">逻辑电平规定</h3>
<p>由于I<sup>2</sup>C的接入设备众多（如CMOS、NMOS、Bipolar等），因此逻辑电平0和逻辑电平1（的电压）并不是固定不变的，这取决于VDD的电平。</p>
<p>输入参考电平会被控制在VDD电平的30%~70%之间。 V<sub>IL</sub> = 0.3 * V<sub>DD</sub>；V<sub>IH</sub> = 0.7 * V<sub>DD</sub> 。</p>
<p>某些传统设备的输入电平会被固定在1.5V（V<sub>IL</sub>）和3.0V（V<sub>IH</sub>），但新设备都要求是 30%V<sub>DD</sub> 及 70%V<sub>DD</sub> 。</p>
<p><strong>注意</strong>：V<sub>IL</sub>、V<sub>IH</sub>、V<sub>OL</sub>、V<sub>OH</sub>都是以参考电压作为基准的，即要达到某个电压的百分之多少时，才能够被认为是 <strong>逻辑电平0</strong> 或 <strong>逻辑电平1</strong> 。例如，可将V<sub>IL</sub> 视作当V<sub>DD</sub>下降到只有30%及以下时，为逻辑电平0，30%V<sub>DD</sub>是其逻辑电平的最高阈值；同理可得 V<sub>IH</sub> ；超过这个值而未到达70%的中间态则为不确定态。</p>
<blockquote>
<p>Due to the variety of different technology devices (CMOS, NMOS, bipolar) that can be connected to the I<sup>2</sup>C-bus, the levels of the logical ‘0’ (LOW) and ‘1’ (HIGH) are not fixed and depend on the associated level of VDD . Input reference levels are set as 30 % and 70 % of VDD ; VIL is 0.3VDD and VIH is 0.7V DD .</p>
<p>See Figure 38, timing diagram. Some legacy device input levels were fixed at V<sub>IL</sub> = 1.5 V and V<sub>IH</sub> = 3.0 V, but all new devices require this 30 %/70 % specification.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210514134830615.png" alt="image-20210514134830615" style="zoom: 67%;" /></p>
<h3 id="时序正确性">时序正确性</h3>
<ul>
<li>SDA上的数据必须在SCL高电平期间保持稳定，即不能在SCL高电平期间发生翻转（后见原因），只有在SCL低电平时可以翻转。</li>
<li>时钟脉冲信号生成要先于数据传送。</li>
</ul>
<blockquote>
<p>The data on the SDA line must be stable during the HIGH period of the clock. The HIGH or LOW state of the data line can only change when the clock signal on the SCL line is LOW (see Figure 4). One clock pulse is generated for each data bit transferred.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210514141512136.png" alt="image-20210514141512136" style="zoom: 80%;" /></p>
<h3 id="开始及结束标志">开始及结束标志</h3>
<ul>
<li><p>传输开始时必须以一个 <strong>开始</strong> 信号作为标志，结束时必须以一个 <strong>结束</strong> 信号作为标志。</p></li>
<li><p><strong>开始信号 </strong>是以SCL为高电平时的 <strong>SDA电平的由高转低</strong> 作为标志，<strong>结束信号</strong> 是以SCL高电平时的 <strong>SDA电平的由低转高</strong> 作为标志。</p></li>
<li><p>开始和结束标志必须由主设备控制。</p></li>
</ul>
<blockquote>
<p>All transactions begin with a START (S) and are terminated by a STOP (P) (see Figure 5). A HIGH to LOW transition on the SDA line while SCL is HIGH defines a START condition. A LOW to HIGH transition on the SDA line while SCL is HIGH defines a STOP condition.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210514142116674.png" alt="image-20210514142116674" style="zoom: 80%;" /></p>
<h4 id="开始字节">开始字节</h4>
<p><img src="https://pic.islet.space/2021/05/image-20210515150526897.png" alt="image-20210515150526897" style="zoom:67%;" /></p>
<blockquote>
<p>dummy acknowledge (HIGH) : 无声确认？？？</p>
</blockquote>
<h3 id="总线状态">总线状态</h3>
<p>总线具有两种状态，<strong>繁忙</strong>（Busy）和 <strong>空闲</strong>（Free），即 SDA电平 “开始” 后，总线进入繁忙状态， SDA电平 “结束” 后，总线进入空闲状态。</p>
<p><strong>注意</strong>：在总线繁忙期间，发生重复的“开始”状态（而不是“结束”状态），由于“重复开始”和 “开始” 功能相同，为了方便，统称为 “开始”，除非特殊说明为 “重复开始”。</p>
<blockquote>
<p>The bus stays busy if a repeated START (Sr) is generated instead of a STOP condition. In this respect, the START (S) and repeated START (Sr) conditions are functionally identical. For the remainder of this document, therefore, the S symbol is used as a generic term to represent both the START and repeated START conditions, unless Sr is particularly relevant.</p>
</blockquote>
<h3 id="传输比特位">传输比特位</h3>
<ul>
<li>SDA线上的字节传输必须满足8位长度。</li>
<li>每次传输数据的字节数不受限制。</li>
<li>每个字节数后都需要跟一个<strong>确认位（Acknowledge bit）</strong>。</li>
<li>当从机无法完整接收或传输一个完整的数据字节时，例如正在产生内部中断等，除非其完成内部的某些功能，否则该从机将能够一直拉低SCL的电平，<strong>强制让主机一直处于等待状态</strong>。只有当从机准备好接收下一个完整的字节并释放SCL时，数据传输才会继续。</li>
</ul>
<blockquote>
<p>Every byte put on the SDA line must be eight bits long. The number of bytes that can be transmitted per transfer is unrestricted. Each byte must be followed by an Acknowledge bit.</p>
<p><strong>Data is transferred with the Most Significant Bit (MSB) first</strong> (see Figure 6). If a slave cannot receive or transmit another complete byte of data until it has performed some other function, for example servicing an internal interrupt, it can hold the clock line SCL LOW to force the master into a wait state. Data transfer then continues when the slave is ready for another byte of data and releases clock line SCL.</p>
</blockquote>
<p><img src="https://pic.islet.space/2021/05/image-20210514144620803.png" alt="image-20210514144620803" style="zoom:80%;" /></p>
<h3 id="确认标志">确认标志</h3>
<ul>
<li>每个字节（8比特）后都跟着一个确认位，即前8位数据，第9位确认。</li>
<li><strong>SCL上的时钟信号由主机产生，包括确认位的的第九个时钟脉冲</strong>。</li>
<li>SDA线并不是由主机一直占有的，每发送完一个完整字节后，主机都会释放SDA线，由从机进行数据确认。</li>
<li>发送者在确认时钟脉冲期间释放SDA线，以便接收者可以将SDA线拉低，并且在该时钟脉冲的高电平期间保持稳定的低电平。</li>
<li>对于设置（set-up）和保持（Hold）的时间，都应该依照表10中只针对各种不同模式的要求进行设置。</li>
<li>如果SDA电平在第九个时钟脉冲时仍保持高电平，则被定义为 “未确认状态”。则此时主机可以发送一个“结束”标志来结束当前连接，或发送一个“开始”标志来开启一次新的传送。</li>
</ul>
<p><mark>即，此时（第9个脉冲时）SDA的控制权已经被mater释放了，但仍为高电平，slave可以在这第9个时钟脉冲高电平期间获得控制权，如果确认收到数据，则将电平拉低，否则不拉低。</mark></p>
<figure>
<img src="https://pic.islet.space/2021/06/image-20210607141115024.png" alt="image-20210607141115024" /><figcaption aria-hidden="true">image-20210607141115024</figcaption>
</figure>
<blockquote>
<p>The acknowledge takes place after every byte. The acknowledge bit allows the receiver to signal the transmitter that the byte was successfully received and another byte may be sent. The master generates all clock pulses, including the acknowledge ninth clock pulse.</p>
<p>The Acknowledge signal is defined as follows: the transmitter releases the SDA line during the acknowledge clock pulse so the <strong><em>receiver can pull the SDA line LOW</em></strong> and it remains stable LOW during the HIGH period of this clock pulse (see Figure 4). Set-up and hold times (specified in Section 6) must also be taken into account.</p>
<p>When SDA remains HIGH during this ninth clock pulse, this is defined as the Not Acknowledge signal. The master can then generate either a STOP condition to abort the transfer, or a repeated START condition to start a new transfer.</p>
</blockquote>
<p><strong>以下为五种“未确认/未应答”的可能情况</strong>：There are five conditions that lead to the generation of a NACK:</p>
<ol type="1">
<li><strong>传输地址错误</strong>：No receiver is present on the bus with the transmitted address so there is no device to respond with an acknowledge.</li>
<li><strong>实时处理中</strong>：The receiver is unable to receive or transmit because it is performing some real-time function and is not ready to start communication with the master.</li>
<li><strong>数据/代码未定义</strong>：During the transfer, the receiver <strong>gets data or commands that it does not understand.</strong></li>
<li><strong>正在传输中</strong>：During the transfer, the receiver <strong>cannot receive any more data bytes</strong>.</li>
<li><strong>未收到结束信号（收发身份未转换）</strong>：A master-receiver must signal the end of the transfer to the slave transmitter.</li>
</ol>
<h3 id="时钟同步">时钟同步</h3>
<p>任意几个主机都可能同时发起数据传输请求，此时只有一个主机和一个从机可以掌握总线进行通信，此时需要通过 <strong>时间同步</strong> 和 <strong>仲裁</strong> 完成对总线的调配。</p>
<p><strong>在单机系统（Single Master System）中，不需要时钟同步和仲裁。</strong></p>
<p>时钟同步是通过I<sup>2</sup>C接口与SCL线的有线-AND连接进行的。</p>
<p>这意味着SCL线上的高电平到低电平的转换会导致相关的主站开始对其低电平周期进行计数（如图7的CLK<sub>2</sub>），一旦一个主站时钟 CLK<sub>1</sub> 变为低电平，它就会将SCL线电平拉低，并保持在这个状态，直到另一个时钟 CLK<sub>2</sub> 达到高电平状态。</p>
<p>然而，如果时钟 CLK<sub>2</sub> 仍在其低电平周期内，CLK<sub>1</sub> 的低电平到高电平转换可能不会改变SCL线的状态。</p>
<p>因为SCL线被具有最长的低电平周期的主站 CLK<sub>2</sub> 保持为低电平，而在这段时间内，低电平周期较短的主站 CLK<sub>1</sub> 进入高电平等待状态。</p>
<blockquote>
<p>Clock synchronization is performed using the wired-AND connection of I<sup>2</sup>C interfaces to the SCL line. This means that a HIGH to LOW transition on the SCL line causes the masters concerned to start counting off their LOW period and, once a master clock has gone LOW, it holds the SCL line in that state until the clock HIGH state is reached (see Figure 7). However, if another clock is still within its LOW period, the LOW to HIGH transition of this clock may not change the state of the SCL line. The SCL line is therefore held LOW by the master with the longest LOW period. Masters with shorter LOW periods enter a HIGH wait-state during this time.</p>
</blockquote>
<p>当所有相关的主控器都结束了他们的低电平周期，时钟线被释放并变成高电平。</p>
<p>然后，在主站时钟和SCL线的状态之间没有差异，所有的主站开始计算他们的高电平周期。</p>
<p><strong>第一个完成其高电平周期的主站再次将SCL线拉到低电平</strong>。这样，就产生了一个<strong>同步的SCL时钟</strong>，<strong>其低电平周期由具有最长时钟低电平周期的主站决定</strong>，<strong>其高电平周期由具有最短时钟高电平周期的主站决定</strong>。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210514170202184.png" alt="image-20210514170202184" style="zoom: 67%;" /></p>
<h3 id="竞争仲裁">竞争仲裁</h3>
<p>仲裁和同步一样，是指只有在系统中使用一个以上的主站时才需要的协议的一个部分。注意，从机不参与仲裁程序。</p>
<p>一个主站只有在总线空闲时才可以开始传输。两个主站可以在START条件的最小保持时间（tHD;STA）内产生一个START条件，从而在总线上产生一个有效的START条件。然后需要进行仲裁，以确定哪个主站将完成其传输。</p>
<p>仲裁是逐位进行的。在每个比特期间，当SCL为高电平时，每个主站检查SDA电平是否与其所发送的内容相符，期间可能需要很多比特，只要传输的内容相同，两个主站实际上可以无误地完成整个信息传输过程。</p>
<p><mark>当一个主站第一次试图发送一个高电平，但检测到SDA电平为低电平时，主站知道它已经失去了仲裁，并关闭其SDA输出驱动器</mark>。在其他主站被仲裁过程中，正在传输其信息的主站将继续其传输，没有信息丢失。</p>
<p>失去仲裁的主站可以产生时钟脉冲，直到它失去仲裁的字节结束，并且必须在总线空闲时重新尝试传输。</p>
<p><mark>如果一个主站也包含了一个从站功能，并且它在寻址阶段失去了仲裁，有可能获胜的主站正试图对它进行寻址。因此，失败的主站必须立即切换到其从站模式。</mark></p>
<p>图8显示了两个主站的仲裁程序。可能涉及更多，这取决于有多少个主站连接到总线上。</p>
<p><mark>当产生DATA1的主站的内部数据电平与SDA线上的实际电平有差异时，DATA1的输出被关闭。这并不影响由获胜主站发起的数据传输。</mark></p>
<p><img src="https://pic.islet.space/2021/05/image-20210515142633906.png" alt="image-20210515142633906" style="zoom: 67%;" /></p>
<h3 id="通用寻址">通用寻址</h3>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210515172907284.png" alt="image-20210515172907284" /><figcaption aria-hidden="true">image-20210515172907284</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210515172945861.png" alt="image-20210515172945861" /><figcaption aria-hidden="true">image-20210515172945861</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210515172958184.png" alt="image-20210515172958184" /><figcaption aria-hidden="true">image-20210515172958184</figcaption>
</figure>
<h3 id="软复位">软复位</h3>
<p>在发送general call (0000 0000)后，再发送一个 0000 0110 (06h) ，这样两个具有先后顺序的字节来定义软复位。</p>
<p>首先，这种软复位是可选 ，并不是所有设备都会对软复位指令进行响应。</p>
<p>在收到这2个字节的序列时，所有被设计为响应一般调用地址的设备都会复位，并接收其地址的可编程部分。</p>
<blockquote>
<p>On receiving this 2-byte sequence, all devices designed to respond to the general call address reset and take in the programmable part of their address.</p>
</blockquote>
<p>必须采取预防措施，确保设备在施加电源电压后没有拉低SDA或SCL线，因为这些低电平会阻断总线。</p>
<h3 id="总线复位">总线复位</h3>
<p>SCK信号一直卡在低电平的事件较少发生。</p>
<ul>
<li>如果I<sup>2</sup>C总线设备拥有硬件复位输入，则可以通过优先程序启用硬件中断复位来重置总线。</li>
<li>如果没有硬件复位输入，则通过给设备循环供电，激活强制性的内部开机复位（POR）电路。</li>
</ul>
<p>SDA信号如果一直卡在低电平。</p>
<ul>
<li><p>则主机应该发送九次SCL时钟脉冲，此时令SDA保持低电平的设备在收到九次脉冲后应主动释放总线。</p></li>
<li><p>如果九次脉冲没有用，则启用硬件中断复位或循环供电来清除总线。</p></li>
</ul>
<h3 id="设备id">设备ID</h3>
<p>可选的3字节只读设备ID编码（an optional 3-byte read-only ）：</p>
<ul>
<li>12位是设备制造商编号，具有独一无二性</li>
<li>9位零件ID，由设备制造商写入</li>
<li>3位模具/晶元版本，由设备制造商写入</li>
</ul>
<p><img src="https://pic.islet.space/2021/05/image-20210515152141963.png" alt="image-20210515152141963" style="zoom:67%;" /></p>
<ol type="1">
<li><p>启动条件</p></li>
<li><p>主站发送保留设备ID的 I<sup>2</sup>C 总线地址，后面的R/W位设置为<code>0</code>（写）：<code>1111 1000</code>。</p></li>
<li><p>主站发送从属地址。LSB是一个 "不关心"的值，只有一个设备必须确认这个字节（拥有I<sup>2</sup>C总线从属地址的设备）。</p></li>
<li><p>主站发送一个 Re-START 条件。</p></li>
</ol>
<blockquote>
<p>备注：在 STOP 条件之后，再加上一个 START 条件，就会重置从属状态机，无法进行设备ID读取。另外，在 STOP 条件或 Re-START 条件之后，对另一个从属设备的访问也会重置从属状态机，无法执行Device ID读取。</p>
</blockquote>
<ol start="5" type="1">
<li><p>主站发送保留设备ID的 I<sup>2</sup>C 总线地址，后面的R/W位设置为 <code>1</code>（读）：<code>1111 1001</code>。</p></li>
<li><p>可以进行设备ID读取，从12个制造商位开始（第一个字节+第二个字节的4个MSB），然后是9个部件识别位（第二个字节的4个LSB+第三个字节的5个MSB），然后是三个芯片修订位（第三个字节的3个LSB）。</p></li>
<li><p>主站通过NACKing最后一个字节来结束读取序列，从而重置从属设备的状态机，允许主站发送 STOP 条件。</p>
<blockquote>
<p>备注：设备ID的读取可以随时通过发送NACK来停止。</p>
</blockquote></li>
</ol>
<p>如果主站在第三个字节之后继续ACK，从站就会滚回第一个字节，并继续发送设备ID序列，直到检测到 NACK。</p>
<h1 id="adi-codec-i2c开发">ADI-Codec I2C开发</h1>
<p>ADI</p>
<h2 id="物理接口">物理接口</h2>
<p>存在由ADI官方提供的评估板（和MediaWorks的板） 和 开发第一板（量产板）之间的引脚定义差别，一开始使用的是评估板的DPI 11 和 12引脚，即 <strong>DPI_P11</strong> 为 <strong><em>SDA</em></strong>，<strong>DPI_P12</strong> 为 <strong><em>SCLK</em></strong>。后来发现作为时钟引脚的DPI无法被控制，转而使用 DPI 11 和 13。即 <strong>DPI_P11</strong> 为 <strong><em>SDA</em></strong>，<strong>DPI_P13</strong> 为 <strong><em>SCLK</em></strong>。</p>
<p><img src="https://pic.islet.space/2021/05/20210527144920.png" alt="image-20210524112141809" style="zoom:67%;" /></p>
<figure>
<img src="https://pic.islet.space/2021/06/20210621154130.png" alt="image-20210615083241938" /><figcaption aria-hidden="true">image-20210615083241938</figcaption>
</figure>
<p>MediaWorks核心板J3引脚排示意图</p>
<p>以下描述均以评估板为例，DIY板不一定适用。</p>
<h2 id="插口jumper定义">插口（Jumper）定义</h2>
<p><img src="https://pic.islet.space/2021/04/image-20210427165847934.png" alt="image-20210427165847934" style="zoom: 67%;" /></p>
<h2 id="时钟及pll">时钟及PLL</h2>
<ol type="1">
<li>1772的工作频率为12.288兆赫，而如果过要设置PLL，<strong>PLL输出一定是24.576兆赫。</strong></li>
<li>通过 <code>MCLKIN</code> 端为codec提供核心时钟信号，可接入8至27兆赫信号。</li>
<li>通过对 <code>0x0000</code> 到 <code>0x0005</code> 的寄存器进行写入修改PLL。</li>
<li>PLL模式要被设置为分数或整数，则取决于MCLK的输入频率。</li>
<li>在时钟信号达到PLL前，时钟信号会经过整数时间分频器以确保时钟频率符合要求；可以通过设置 0x0005 的bit[2:1]来设置其分频率。</li>
<li>要使用PLL时，<strong>首先要明确PLL输出频率是多少</strong>，当PLL信号与时钟信号是整数倍关系时才需要使用整数分频器。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210513093158863.png" alt="image-20210513093158863" /><figcaption aria-hidden="true">image-20210513093158863</figcaption>
</figure>
<p>以下列举了整数型及分数型分频器的参数设置：</p>
<p><img src="https://pic.islet.space/2021/05/image-20210513093047973.png" alt="image-20210513093047973" style="zoom:67%;" /></p>
<h3 id="评估板电路图">评估板电路图</h3>
<p><img src="https://pic.islet.space/2021/05/image-20210513092007130.png" alt="image-20210513092007130" style="zoom:67%;" /></p>
<h2 id="输入输出">输入输出</h2>
<h3 id="评估板电路图-1">评估板电路图</h3>
<p><img src="https://pic.islet.space/2021/05/image-20210513090414605.png" alt="image-20210513090414605" style="zoom: 67%;" /></p>
<h3 id="第0及第1通道">第0及第1通道</h3>
<p>以下为codec芯片对引脚的定义，在提供一个接地端，构成TRS是完全没有问题，但是codec的定义和其评估板的外围电路设计有所区别。</p>
<figure>
<img src="https://pic.islet.space/2021/05/image-20210513083636462.png" alt="image-20210513083636462" /><figcaption aria-hidden="true">image-20210513083636462</figcaption>
</figure>
<p>正常3.5mm音频接口为TRS接口，其中T虽然为VCC（通常是），R作为音频信号输入，而S为接地端，且T和R可共同作为左右声道分别进行输入。（也有T和S定义相反的设计）</p>
<p>但是按上述电路进行接线时，相当于TS接口（单声道）接线模式，却又不完全相同：</p>
<ul>
<li>使用 MICBIAS<sub>x</sub> 对14接口进行供电，此时Tip端是VCC。</li>
<li>Ring端接13接口，充当Sleeve端（而实际上的Sleeve端因已经接地，可以不进行连接）。</li>
<li>由Ring(AIN1REF)和Tip(AIN1)共同构成了TS单声道接线模式。</li>
</ul>
<h3 id="第2及第3通道">第2及第3通道</h3>
<ul>
<li>2/3输入通道是复用立体声通道，即1通道和0通道都可以单独接入音源，在物理音频接口上独立，但第2/3通道是在一起的，共用一个物理通道。UG第7页中也有提到。</li>
</ul>
<p><img src="https://pic.islet.space/2021/04/image-20210427104818097.png" alt="image-20210427104818097" style="zoom:50%;" /></p>
<p><img src="https://pic.islet.space/2021/04/image-20210427105655639.png" alt="image-20210427105655639" style="zoom:67%;" /></p>
<ul>
<li>有四个单端输入通道可以设置为麦克风信号或线路信号，一个双立体声数字输入信号通道和也可被用于单端输出的两个差分(differential)输出。</li>
</ul>
<h2 id="i2c通信">I2C通信</h2>
<h3 id="时序">时序</h3>
<p>图85展示了 <strong>单字主写模式</strong> 的时序。每9个时钟脉冲，1772都会拉低一次SDA的电平以表示确认收到。</p>
<p>图86展示了 多字主写模式 的时序。此图展示了2个字节大小数据（例如程序）的写入过程。<mark>1772会在每两个字节后增加一次子地址寄存器，因为被使用的子地址对应着 2字节 长度的寄存器或内存区域</mark>。</p>
<p>图87展示了 单字主写模式后转变为 单字主读模式 的时序。1772作为从机接受数据后发送确认标志，主机立即发起重复开始的 单字主读模式，由从机发送至主机。</p>
<p>图88展示了 多字主读模式 的时序，展示了读取目标字节为2bytes的示例。<em><u>此处上述黄底字重复</u></em>。其他地址范围可能有不同的字长，从一个到四个字节不等。ADAU1772总是对子地址进行解码，并设置自动递增电路，使地址在适当的字节数后递增。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210518105918652.png" alt="image-20210518105918652" style="zoom: 67%;" /></p>
<blockquote>
<p>S = 开始 标志</p>
<p>P = 停止 标志</p>
<p>AM = 主机确认标志</p>
<p>AS = 从机确认标志</p>
</blockquote>
<h3 id="接口">接口</h3>
<h4 id="usbi接口">USBi接口</h4>
<p>​ 《SigmaStudio_USBi_to_EZ-Board_Adapter_Schematic-Rel_0.1.pdf》中对接口的定义，总共需要4个引脚，分别是1、3、4、10，对应着 SCL / SDA / VCC / GND；</p>
<p><img src="https://pic.islet.space/2021/05/image-20210518112823329.png" alt="image-20210518112823329" style="zoom:67%;" /></p>
<h4 id="接口-1">1772接口</h4>
<p>需要用到的接口是 <code>SCL/SCLK</code> 和 <code>SDA/MISO</code> 。</p>
<figure>
<img src="https://pic.islet.space/2021/06/20210601105623.png" alt="image-20210518192233133" /><figcaption aria-hidden="true">image-20210518192233133</figcaption>
</figure>
<p>ADDR0 和 ADDR1 分别对应的是控制接口（CONTROL PORT）上的 <strong><em>CLATCH</em></strong> 和 <strong><em>CDATA</em></strong> 针脚。</p>
<figure>
<img src="https://pic.islet.space/2021/06/20210607150001.png" alt="image-20210607145600052" /><figcaption aria-hidden="true">image-20210607145600052</figcaption>
</figure>
<p><img src="https://pic.islet.space/2021/05/image-20210518112823329.png" alt="image-20210518112823329" style="zoom:67%;" /></p>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 28%" />
<col style="width: 29%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th>BIT_6</th>
<th>BIT_5</th>
<th>BIT_4</th>
<th>BIT_3</th>
<th>BIT_2</th>
<th>BIT_1 / ADDR1 / CDATA</th>
<th>BIT_0 / ADDR0 / CLATCH</th>
<th>ADDRESS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0x3C</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0x3D</td>
</tr>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0x3E</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0x3F</td>
</tr>
</tbody>
</table>
<h4 id="接口-2">21479接口</h4>
<p>《ADSP-21479 EZ-Board Evaluation System Manual》，需要用到的接口是 <code>SPI_CLK(DPI_P3)</code> 和 <code>SPI_MISO(DPI_P2)</code> 。</p>
<p><img src="https://pic.islet.space/2021/05/image-20210518113240492.png" alt="image-20210518113240492" style="zoom:67%;" /></p>
<p>对应评估板上的针脚接口如下图示 24（DPI_P3） 和 27（DPI_P2） 接口。</p>
<figure>
<img src="https://pic.islet.space/2021/05/20210519114409.png" alt="image-20210519114333234" /><figcaption aria-hidden="true">image-20210519114333234</figcaption>
</figure>
<h3 id="设备地址">设备地址</h3>
<p>主机每次发送8位数据，其中最低的一位由主机发送标识读/写位。逻辑电平1是读，逻辑电平0是写。</p>
<p>通过I2C方式进行连接的从机，其设备地址是7位数（1-7，对应表21是<code>bit0-bit6</code>），表21提供了1772的设备地址，<strong>ADDR1</strong> 和 <strong>ADDR0</strong> 位置可以通过接入pin的方式自由设置，即输入引脚的电平不同，每个1772都能够拥有4个独特的地址。此类方式允许多块1772接入同一I2C总线。</p>
<ul>
<li>即，默认情况下从机地址为 <code>0x3C</code> ，可以设置成其他：<code>0x3D</code> , <code>0x3E</code>, <code>0x3F</code>。</li>
<li>每个SDA和SCL线都应该接入一个2.0KΩ的升压电阻，但不应该高过IOVDD。</li>
</ul>
<figure>
<img src="https://pic.islet.space/2021/06/20210601105537.png" alt="image-20210519093557617" /><figcaption aria-hidden="true">image-20210519093557617</figcaption>
</figure>
<p><img src="https://pic.islet.space/2021/06/20210601105628.png" alt="image-20210519094454381" style="zoom: 67%;" /></p>
<h2 id="相关问答">相关问答</h2>
<p><strong>Q</strong>: what is the macro SIGMA_WRITE_DELAY supposed to do? Is it a simple delay? Why are there parameters regarding the device I2C address, data and length? <strong>A</strong>: This macro is used for applications that need to pause the data writes for a specific purpose. For example, if you <strong><em>need time for the PLL to be set before starting to write to the rest of the registers</em></strong>. It could be used as a simple delay, you’ll need to specify the device address always because some applications can require more than one DSP; the length is just the address byte length (could be 1 or 2 byte length) and data is the value in hex that represents the total time in milliseconds (that is up to the micro controller clock speed). The reason length is used, is that some DSPs work with one and some other require two address bytes.</p>
<p><code>&lt;SigmaStudioFW.h&gt;</code> contains a lot of macros to be defined. What I found by examinating all the code is that what macros need to be defined depend on what you want to perform with your microcontroller.</p>
<p>If you only need to load a DSP program with a call to default_download(), well, you only need (at least for the ADAU1761)</p>
<p>to implement the two macros:</p>
<ul>
<li><p>SIGMA_WRITE_REGISTER_BLOCK</p></li>
<li><p>SIGMA_WRITE_DELAY</p></li>
</ul>
<p>The first one is the basis of all the loading of data into <strong><em>program ram</em></strong>, <strong><em>parameter ram</em></strong>, and <strong><em>registers</em></strong>. The second one is only a delay (to be exact it serves to wait for the PLL to lock, in any case <strong><em>most of the times it can be implemented as a simple delay</em></strong>).</p>
<p>If you want to use sequences, that is to implement some control of the DSP running with your microcontroller, you will probably need to implement the other macros. In particular if you will control volume sliders you will need to implement the conversion macros for integer or float to the internal 5.23 representation. You can search elsewhere on the forum, I saw some of this code.</p>
<h1 id="开发代码">开发代码</h1>
<p>ADI和Codec之间的I2C通信可以通过两种方式进行，第一种是操作21478上面的TWI寄存器，需要查看《HWR》以获取更多信息。第二种是学会控制引脚高低电平，通过高低电平模拟寄存器操控来读取和写入I2C设备。</p>
<p>在开发过程中，先使用的第一种方式对TWI寄存器进行操控，但发现21479中有某个寄存器无法写入，故放弃。下面提供第二种方式中需要用到的三个文件，分别是 <code>TWI.h</code> 、 <code>TWI.c</code> 、<code>SigmaStudioFW.h</code> 。经调试，以下代码可以正常收发数据，实现对从设备的读/写。</p>
<h2 id="twi.c">TWI.c</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * TWI.C</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Created on: 2021年6月16日</span></span><br><span class="line"><span class="comment"> *      Author: 431240</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&quot;TWI.H&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//宏定义</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HWDELAY &#123;HWDelay(MINDT);&#125;  <span class="comment">//延时函数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MTWACK &#123;TWIMWaitAck();&#125;       <span class="comment">//Master Transmitter Wait Ack</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// 全局变量声明</span></span><br><span class="line">DADDR tempDevAddr = <span class="number">0x00</span>;  <span class="comment">//临时设备地址存储比对变量，及其初始化</span></span><br><span class="line">RADDR tempRegAddr = <span class="number">0x00</span>;  <span class="comment">//临时寄存器地址存储对比变量，及其初始化</span></span><br><span class="line">TWIDATA bit = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> TWIDATA dataRead = <span class="number">0</span>;  <span class="comment">//用于观察数据写入后再读取的状态</span></span><br><span class="line"><span class="comment">//static TWIDATA addrAckRead = 0;  //调试观察用</span></span><br><span class="line"><span class="comment">//static TWIDATA regAckRead = 0;  //调试观察用</span></span><br><span class="line"><span class="comment">//static TWIDATA dataAckRead = 0;  //调试观察用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> DADDR targetAddr = <span class="number">0x00</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// 函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWITimerIsr</span><span class="params">(<span class="keyword">int</span> delayTime)</span></span>&#123;  <span class="comment">//用于产生中断高/低电平延时的定时器中断（句柄）</span></span><br><span class="line"> <span class="comment">//需要自定义，涉及到定时器调用相关函数，请自行查阅手册</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">HWDelay</span><span class="params">(<span class="keyword">float</span> hwDelayTime)</span></span>&#123;  <span class="comment">// 定义硬件延时（单位微秒）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HWDELAY_CORETIMER</span></span><br><span class="line">	timer_set(<span class="number">6400</span>*hwDelayTime, <span class="number">6400</span>*hwDelayTime);</span><br><span class="line">	timer_on();</span><br><span class="line">	timer_off();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HWDELAY_SYSWAITNOP</span></span><br><span class="line">	SysWaitNOP(HW_SYSWAITNOP_TIME);  <span class="comment">//此处使用循环函数进行延时</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIInit</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//初始化函数</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> EVA_21479</span></span><br><span class="line">	SRU(FLAG13_O,DPI_PB13_I);</span><br><span class="line">	SRU(FLAG11_O,DPI_PB11_I);</span><br><span class="line"></span><br><span class="line">	SRU(HIGH,DPI_PBEN13_I);</span><br><span class="line">	SRU(HIGH,DPI_PBEN11_I);</span><br><span class="line"></span><br><span class="line">	sysreg_bit_set( sysreg_FLAGS, (FLG11O|FLG13O) );</span><br><span class="line">	sysreg_bit_clr( sysreg_FLAGS, (FLG11|FLG13) );</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	SRU(FLAG8_O,DPI_PB08_I);</span><br><span class="line">	SRU(FLAG7_O,DPI_PB07_I);</span><br><span class="line"></span><br><span class="line">	SRU(HIGH,DPI_PBEN08_I);</span><br><span class="line">	SRU(HIGH,DPI_PBEN07_I);</span><br><span class="line"></span><br><span class="line">	sysreg_bit_set( sysreg_FLAGS, (FLG7O|FLG8O) );</span><br><span class="line">	sysreg_bit_clr( sysreg_FLAGS, (FLG7|FLG8) );</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	SDA_OUT;</span><br><span class="line">	SCL_OUT;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">TWIStart</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//启动函数</span></span><br><span class="line">	SDA_OUT;  <span class="comment">//设置为数据输出方向</span></span><br><span class="line"></span><br><span class="line">	S_SDA;</span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIReStart</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//重启动函数</span></span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	C_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SDA;</span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIStop</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//停止</span></span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	C_SCL;  <span class="comment">//modified by liewzheng</span></span><br><span class="line">	C_SDA;  <span class="comment">//在时钟信号拉高之前先拉低数据信号</span></span><br><span class="line">	HWDELAY;  <span class="comment">//modified by liewzheng</span></span><br><span class="line"></span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SDA;  <span class="comment">//在时钟信号高电平时拉高数据信号</span></span><br><span class="line">	HWDELAY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">SendWithoutAck</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//发送无需确认</span></span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	C_SCL;</span><br><span class="line"></span><br><span class="line">	SDA_IN;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWIMWaitAck</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//等待从机确认并读取确认信号</span></span><br><span class="line">	C_SCL;</span><br><span class="line">	SDA_IN;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SCL;</span><br><span class="line">	<span class="keyword">if</span>(!READ_SDA)&#123;</span><br><span class="line">		HWDELAY;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		HWDELAY;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWISendByte</span><span class="params">(TWIDATA SentByte)</span></span>&#123;  <span class="comment">//发送一个字节</span></span><br><span class="line">	TWIDATA bit_count = <span class="number">8</span>;</span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(bit_count--)&#123;</span><br><span class="line">		<span class="keyword">if</span>(SentByte &amp; <span class="number">0x80</span>)&#123;</span><br><span class="line">			C_SCL;  <span class="comment">//先拉低SCL</span></span><br><span class="line">			S_SDA;  <span class="comment">//1则置高</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			C_SCL;  <span class="comment">//先拉低SCL</span></span><br><span class="line">			C_SDA;  <span class="comment">//0则置低</span></span><br><span class="line">		&#125;</span><br><span class="line">		SentByte &lt;&lt;= <span class="number">1</span>;  <span class="comment">//前移一位</span></span><br><span class="line">		HWDELAY;</span><br><span class="line"></span><br><span class="line">		S_SCL;</span><br><span class="line">		HWDELAY;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIWriteByte</span><span class="params">(DADDR DevAddr, RADDR RegAddr, TWIDATA *Data)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(TWIStart() != <span class="number">0</span>)&#123;</span><br><span class="line">			TWISendByte(DevAddr);</span><br><span class="line">			MTWACK;</span><br><span class="line"><span class="comment">//			addrAckRead = TWIMWaitAck();  //测试时使用</span></span><br><span class="line"></span><br><span class="line">			TWISendByte(RegAddr&gt;&gt;<span class="number">8</span>);  <span class="comment">//采用16bit寻址空间，先发送高8位地址，在发送低8位地址</span></span><br><span class="line">			MTWACK;</span><br><span class="line"><span class="comment">//			regAckRead = TWIMWaitAck();</span></span><br><span class="line"></span><br><span class="line">			TWISendByte(RegAddr);</span><br><span class="line">			MTWACK;</span><br><span class="line"><span class="comment">//			regAckRead = TWIMWaitAck();</span></span><br><span class="line"></span><br><span class="line">			TWISendByte(*(Data+<span class="number">0</span>));</span><br><span class="line">			MTWACK;</span><br><span class="line"><span class="comment">//			dataAckRead = TWIMWaitAck();</span></span><br><span class="line">		&#125;</span><br><span class="line">		TWIStop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIWriteByteContinuly</span><span class="params">(DADDR DevAddr, RADDR RegAddr, <span class="keyword">int</span> length, TWIDATA *Data)</span></span>&#123;  <span class="comment">//连续发送数据，相同设备无暂停</span></span><br><span class="line">		TWIStart();</span><br><span class="line"></span><br><span class="line">		TWISendByte(DevAddr);</span><br><span class="line">		MTWACK;</span><br><span class="line"></span><br><span class="line">		TWISendByte(RegAddr&gt;&gt;<span class="number">8</span>);  <span class="comment">//采用16bit寻址空间，先发送高8位地址，在发送低8位地址</span></span><br><span class="line">		MTWACK;</span><br><span class="line"></span><br><span class="line">		TWISendByte(RegAddr);</span><br><span class="line">		MTWACK;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt;length; i++)&#123;</span><br><span class="line">			TWISendByte(*(Data+i));</span><br><span class="line">			MTWACK;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		TWIStop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> DADDR <span class="title">TWIDAddrTest</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">// 设备地址测试验证</span></span><br><span class="line">	DADDR MAXADDR = <span class="number">0x7F</span>;  <span class="comment">//设置最大地址为0x7F，此处仅测试7bit设备地址，10bit不测试</span></span><br><span class="line">	DADDR tempAddress = <span class="number">0x00</span>;  <span class="comment">//设置设备最小值</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(; tempAddress &lt;= MAXADDR; tempAddress++)  <span class="comment">//设置for循环</span></span><br><span class="line">	&#123;</span><br><span class="line">		TWISendByte((TWIDATA) tempAddress);<span class="comment">//发送设备地址</span></span><br><span class="line">		<span class="keyword">if</span>(TWIMWaitAck()) <span class="keyword">return</span> tempAddress;  <span class="comment">//等待应答，如果应答，则返回正确的设备地址</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0xFF</span>;  <span class="comment">//否则（运行结束时）返回0xFF。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWISCL</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//Only used in Test mode</span></span><br><span class="line">	C_SCL;</span><br><span class="line">	S_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line">	S_SCL;</span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">// 以下函数未使用。</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">MRSendAck</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//Only in Master-receiver mode, 发送确认信号给slave，仅在主-收模式时使用</span></span><br><span class="line">	SDA_OUT;</span><br><span class="line"></span><br><span class="line">	C_SDA;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	S_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	C_SCL;</span><br><span class="line"></span><br><span class="line">	SDA_IN;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWI_read_byte</span><span class="params">(DADDR DevAddr, RADDR RegAddr)</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> TWIDATA RetVal = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	TWIStart();</span><br><span class="line"></span><br><span class="line">	TWISendByte( DevAddr );  <span class="comment">//发送设备地址和W标志位，等待确认，据Figure87</span></span><br><span class="line">	MTWACK;</span><br><span class="line"></span><br><span class="line">	TWISendByte(RegAddr&gt;&gt;<span class="number">8</span>);  <span class="comment">//发送MSB寄存器地址</span></span><br><span class="line">	MTWACK;</span><br><span class="line">	TWISendByte(RegAddr);  <span class="comment">//放LSB寄存器地址</span></span><br><span class="line">	MTWACK;</span><br><span class="line"></span><br><span class="line">	TWIReStart();  <span class="comment">//重启动并发送设备地址</span></span><br><span class="line"></span><br><span class="line">	TWISendByte( DevAddr+<span class="number">1</span> );  <span class="comment">//发送设备地址和R标志位，等待确认</span></span><br><span class="line">	MTWACK;</span><br><span class="line"></span><br><span class="line">	RetVal = TWIReceiveByte();</span><br><span class="line">	SendWithoutAck();</span><br><span class="line"></span><br><span class="line">	TWIStop();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> RetVal;  <span class="comment">//返回目标寄存器的值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWI_write_2_byte</span><span class="params">(DADDR DevAddr, RADDR RegAddr, TWIDATA Data1, TWIDATA Data2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (TWIStart() != <span class="number">0</span>)&#123;</span><br><span class="line">		TWISendByte(DevAddr); <span class="comment">//1、发送设备地址</span></span><br><span class="line">		MTWACK;</span><br><span class="line">		TWISendByte(RegAddr); <span class="comment">//2、发送寄存器地址</span></span><br><span class="line">		MTWACK;</span><br><span class="line">		TWISendByte(Data1); <span class="comment">//3、发送寄存器数据 for PORT 0</span></span><br><span class="line">		MTWACK;</span><br><span class="line">		TWISendByte(Data2); <span class="comment">//4、发送下一个寄存器数据 for PORT 1</span></span><br><span class="line">		MTWACK</span><br><span class="line">	&#125;</span><br><span class="line">	TWIStop();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWIReceiveByte</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;  <span class="comment">//作为主机，读取从机字节</span></span><br><span class="line">	TWIDATA Byte_count = <span class="number">8</span>;</span><br><span class="line">	TWIDATA RetVal = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	C_SCL;</span><br><span class="line">	HWDELAY;</span><br><span class="line"></span><br><span class="line">	SDA_IN;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (Byte_count--)&#123;</span><br><span class="line">		S_SCL;</span><br><span class="line">		RetVal &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (READ_SDA)&#123;</span><br><span class="line">			RetVal = RetVal | <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		HWDELAY;</span><br><span class="line">		C_SCL;</span><br><span class="line">		HWDELAY;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> RetVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> DADDR <span class="title">TWIDevAddrTest</span><span class="params">(<span class="keyword">char</span> addressBit)</span></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(addressBit)&#123;</span><br><span class="line">	<span class="keyword">case</span> (<span class="number">7</span>):</span><br><span class="line">			<span class="keyword">for</span>(targetAddr = <span class="number">0x00</span> ; targetAddr &lt; <span class="number">0x7F</span>; targetAddr++)&#123;</span><br><span class="line">				TWIStart();</span><br><span class="line">				TWISendByte(targetAddr&lt;&lt;<span class="number">1</span>);  <span class="comment">//尝试过target和target&lt;&lt;1都不行</span></span><br><span class="line">				<span class="keyword">if</span>(!TWIMWaitAck() ) &#123;</span><br><span class="line">					TWIStop();</span><br><span class="line">					<span class="keyword">return</span> targetAddr;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> TWIStop();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> (<span class="number">10</span>):  <span class="comment">//此处需要自定义</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> (<span class="number">0x00</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (<span class="number">0x00</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="twi.h">TWI.h</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * TWI.H</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Created on: 2021年6月16日</span></span><br><span class="line"><span class="comment"> *      Author: 431240</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sru21479.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;def21479.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cdef21479.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;21479.h&gt;</span></span></span><br><span class="line"><span class="comment">//#include &quot;Common.h&quot;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ADDS_21479_EzKit.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 调试用宏定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NACK 0   <span class="comment">//不用从机确认</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACK 1  <span class="comment">//需要从机进行确认</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define HWDELAY_CORETIMER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HWDELAY_SYSWAITNOP</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define EVA_21479 1  //如果是评估板</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 数据类型定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> DADDR;  <span class="comment">//设备地址数据类型定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> RADDR;  <span class="comment">//寄存器地址数据类型定义</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> TWIDATA;  <span class="comment">//数据发送的数据类型定义</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//  引脚定义：RST 定义为 DPI_12  ，  SDA 定义为 DPI_11  ，  SCL 定义为 DPI_13</span></span><br><span class="line"><span class="comment">// 在试制板中，两块codec均与21479的第7、8引脚连接，DPI_07定义为SDA, DPI_08定义为SCL</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RST_OUT &#123;SRU(HIGH, DPI_PBEN12_I); &#125;   <span class="comment">//设置复位信号输出方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_RST  &#123;SRU(LOW, DPI_PB12_I); &#125;   <span class="comment">//拉低电平以设置复位信号</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_RST  &#123;SRU(HIGH, DPI_PB12_I);&#125;   <span class="comment">//拉高电平以释放复位信号</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> EVA_21479</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_OUT &#123;SRU(HIGH, DPI_PBEN11_I); &#125;   <span class="comment">//设置SDA输出方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_IN  &#123;SRU(LOW, DPI_PBEN11_I); &#125;   <span class="comment">//设置SDA输入方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_SDA  &#123;SRU(LOW, DPI_PB11_I); &#125;   <span class="comment">//拉低SDA以清除数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_SDA  &#123;SRU(HIGH, DPI_PB11_I); &#125;   <span class="comment">//拉高SDA</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCL_OUT  &#123; SRU(HIGH, DPI_PBEN13_I); &#125;   <span class="comment">//SCL设定为输出方向的定义</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_SCL &#123;SRU(LOW, DPI_PB13_I); &#125;   <span class="comment">//拉低SCL以清除时钟</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_SCL &#123;SRU(HIGH, DPI_PB13_I); &#125;   <span class="comment">//拉高SCL以设置时钟</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SDA (*pDPI_PIN_STAT &amp; DPI_PB11)   <span class="comment">//从SDA读取数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SCL  (*pDPI_PIN_STAT &amp; DPI_PB13)  <span class="comment">//从SCL读取数据</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span>  <span class="comment">//量产版</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_OUT &#123;SRU(HIGH, DPI_PBEN07_I); &#125;   <span class="comment">//设置SDA输出方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SDA_IN  &#123;SRU(LOW, DPI_PBEN07_I); &#125;   <span class="comment">//设置SDA输入方向</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_SDA  &#123;SRU(LOW, DPI_PB07_I); &#125;   <span class="comment">//拉低SDA以清除数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_SDA  &#123;SRU(HIGH, DPI_PB07_I); &#125;   <span class="comment">//拉高SDA</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SCL_OUT  &#123; SRU(HIGH, DPI_PBEN08_I); &#125;   <span class="comment">//SCL设定为输出方向的定义</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> C_SCL &#123;SRU(LOW, DPI_PB08_I); &#125;   <span class="comment">//拉低SCL以清除时钟</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> S_SCL &#123;SRU(HIGH, DPI_PB08_I); &#125;   <span class="comment">//拉高SCL以设置时钟</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SDA (*pDPI_PIN_STAT &amp; DPI_PB07)   <span class="comment">//从SDA读取数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> READ_SCL  (*pDPI_PIN_STAT &amp; DPI_PB08)  <span class="comment">//从SCL读取数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//提示：靠近功放的codec，其ADDR1为1电平，ADDR0为高电平，其I2C地址是0x3E</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 数据宏定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MINDT 1   <span class="comment">//定义延迟最小时间 Minimal delay time</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> HWDELAY_SYSWAITNOP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HW_SYSWAITNOP_TIME 100  <span class="comment">//定义使用SYSWAITNOP的延迟时间，默认90</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 函数声明</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWITimerIsr</span><span class="params">(<span class="keyword">int</span>)</span></span>;  <span class="comment">//用于产生中断高/低电平延时的定时器中断（句柄）</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">HWDelay</span><span class="params">(<span class="keyword">float</span>)</span></span>;  <span class="comment">// 定义硬件延时（单位微秒）</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIInit</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//初始化函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">TWIStart</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//启动函数</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIReStart</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//重启动函数</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIStop</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//停止</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">SendWithoutAck</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//发送无需确认</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWIMWaitAck</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//等待从机确认并读取确认信号</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWISendByte</span><span class="params">(TWIDATA)</span></span>;  <span class="comment">//发送一个字节</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIWriteByte</span><span class="params">(DADDR, RADDR, TWIDATA*)</span></span>;  <span class="comment">//单次发送数据</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWIWriteByteContinuly</span><span class="params">(DADDR, RADDR , <span class="keyword">int</span>, TWIDATA *)</span></span>;  <span class="comment">//连续发送数据，相同设备无暂停</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> DADDR <span class="title">TWIDAddrTest</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">// 设备地址测试验证</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWISCL</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//Only used in Test mode</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下函数未使用。</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">MRSendAck</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//Only in Master-receiver mode, 发送确认信号给slave，仅在主-收模式时使用</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWI_read_byte</span><span class="params">(DADDR, RADDR)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">TWI_write_2_byte</span><span class="params">(DADDR, RADDR, TWIDATA, TWIDATA)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> TWIDATA <span class="title">TWIReceiveByte</span><span class="params">(<span class="keyword">void</span>)</span></span>;  <span class="comment">//作为主机，读取从机字节</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">extern</span> DADDR <span class="title">TWIDevAddrTest</span><span class="params">(<span class="keyword">char</span> addressBit)</span></span>;  <span class="comment">// 从机地址遍历测试</span></span><br></pre></td></tr></table></figure>
<h2 id="sigmastudiofw.h">SigmaStudioFW.h</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Modified by Liewzheng in June 9th, 2021</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __SIGMASTUDIOFW_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __SIGMASTUDIOFW_H__</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 头文件</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;TWI.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ADDS_21479_EzKit.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 数据类型定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">short</span> ADI_DATA_U16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span>  ADI_REG_TYPE;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 宏定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMASTUDIOTYPE_FIXPOINT 	0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMASTUDIOTYPE_INTEGER 	1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置时钟分频，有且仅有一个能被启用</span></span><br><span class="line"><span class="comment">//#define CLK_DIV_1</span></span><br><span class="line"><span class="comment">//#define CLK_DIV_2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CLK_DIV_3</span></span><br><span class="line"><span class="comment">//#define CLK_DIV_4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> testPLL[<span class="number">5</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 宏定义——函数声明</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMA_WRITE_REGISTER( devAddress, address, dataLength, data ) &#123;<span class="comment">/*<span class="doctag">TODO:</span> implement macro or define as function*/</span>&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMA_READ_REGISTER( devAddress, address, length, pData ) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMA_SET_REGSITER_FIELD( regVal, fieldVal, fieldMask, fieldShift )  \</span></span><br><span class="line">		&#123; (regVal) = (((regVal) &amp; (~(fieldMask))) | (((fieldVal) &lt;&lt; (fieldShift)) &amp;&amp; (fieldMask))) &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMA_GET_REGSITER_FIELD( regVal, fieldMask, fieldShift )  \</span></span><br><span class="line">		&#123; ((regVal) &amp; (fieldMask)) &gt;&gt; (fieldShift) &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMASTUDIOTYPE_FIXPOINT_CONVERT( _value ) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGMASTUDIOTYPE_INTEGER_CONVERT( _value ) &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*-----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 函数定义</span></span><br><span class="line"><span class="comment"> -----------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">// modified by liewzheng, in June 15th, 2021</span></span><br><span class="line"><span class="keyword">void</span> SIGMA_WRITE_REGISTER_BLOCK(  <span class="keyword">unsigned</span> <span class="keyword">int</span> devAddress,</span><br><span class="line">									<span class="keyword">unsigned</span> <span class="keyword">int</span> address,</span><br><span class="line">									<span class="keyword">unsigned</span> <span class="keyword">char</span> length,</span><br><span class="line">									ADI_REG_TYPE *pData ) &#123;</span><br><span class="line">	<span class="keyword">if</span>(length == <span class="number">1</span>)&#123;</span><br><span class="line">		TWIWriteByte(devAddress, address, pData);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(length &gt; <span class="number">1</span>)&#123;</span><br><span class="line">				TWIWriteByteContinuly(devAddress, (address), length, pData);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SysWaitNOP(<span class="number">100</span>);   <span class="comment">//可以注释掉</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// modified by liewzheng, in June 15th, 2021</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SIGMA_WRITE_DELAY</span><span class="params">(  <span class="keyword">unsigned</span> <span class="keyword">int</span> devAddress,</span></span></span><br><span class="line"><span class="function"><span class="params">						    <span class="keyword">unsigned</span> <span class="keyword">char</span> length,</span></span></span><br><span class="line"><span class="function"><span class="params">						    <span class="keyword">unsigned</span> <span class="keyword">char</span> *pData )</span> </span>&#123;</span><br><span class="line">	SysWaitNOP(<span class="number">10000000</span>);</span><br><span class="line">	SysWaitNOP(<span class="number">10000000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h1 id="参考">参考</h1>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://www.nxp.com/docs/en/user-guide/UM10204.pdf">《NXP_UM10204_I2C-bus specification and user manual》</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备19004822号 </a>
  </div>

<div class="copyright">
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liewzheng</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.12.0/dist/mermaid.min.js","integrity":"sha256-0dD7vUjUCTGJjeLnPotQQJIcSzug5fO6WDMYYyNIX4c="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":"enable","tags":"all","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
