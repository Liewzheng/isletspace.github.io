<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://code.islet.space/font//css?family=/CascadiaCode/CascadiaCode:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"islet.space","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/db.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>
<meta name="description" content="笔记分享的旮旯孤岛而已">
<meta property="og:type" content="website">
<meta property="og:title" content="Coder的孤岛">
<meta property="og:url" content="http://islet.space/page/3/index.html">
<meta property="og:site_name" content="Coder的孤岛">
<meta property="og:description" content="笔记分享的旮旯孤岛而已">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Liewzheng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://islet.space/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Coder的孤岛</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Coder的孤岛</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">islet of the coder</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-文章"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章</a></li>
        <li class="menu-item menu-item-目录"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>目录</a></li>
        <li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-简历"><a href="/resume/" rel="section"><i class="fa fa-address-card fa-fw"></i>简历</a></li>
        <li class="menu-item menu-item-友链"><a href="/friends/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Liewzheng</p>
  <div class="site-description" itemprop="description">笔记分享的旮旯孤岛而已</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">125</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">230</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="mailto:liewzheng@foxmail.com" title="E-Mail → mailto:liewzheng@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/28/Linux/System/2022-01-28-Kali-%E4%B8%8E-MBA-2015/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/28/Linux/System/2022-01-28-Kali-%E4%B8%8E-MBA-2015/" class="post-title-link" itemprop="url">Kali 与 MBA-2015</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-28 12:00:00" itemprop="dateCreated datePublished" datetime="2022-01-28T12:00:00+08:00">2022-01-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-02-23 00:20:06" itemprop="dateModified" datetime="2022-02-23T00:20:06+08:00">2022-02-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="网卡驱动安装">网卡驱动安装</h1>
<p>Macbook Air 2015年 13英寸版所使用的的网卡是 博通的
<code>BCM94360CS2</code> 。</p>
<p>可以从 <code>关于本机</code> --&gt; <code>系统报告</code> --&gt;
<code>Wi-Fi</code> 中查看到硬件固件版本。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220128154108052.png"
alt="image-20220128154108052" />
<figcaption aria-hidden="true">image-20220128154108052</figcaption>
</figure>
<p>安装完Linux之后，暂时无法联网，需要使用有线网络进行上网，可以使用
iPhone 接 <code>lighting-USBA</code> 的转接线进行上网，然后使用
<code>apt</code> 命令下载安装 <code>bcmwl-kernel-source</code> 。</p>
<p>如果使用 <code>pkgs.org</code> 官网上下载的
<code>bcmwl-kernel-source.dpkg</code>
则会提示缺少很多依赖，无法直接一步安装到位。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220128154312606.png"
alt="image-20220128154312606" />
<figcaption aria-hidden="true">image-20220128154312606</figcaption>
</figure>
<h1 id="apfs-硬盘内容读取">APFS 硬盘内容读取</h1>
<p><code>https://github.com/sgan81/apfs-fuse/</code></p>
<h1 id="reference">REFERENCE</h1>
<ol type="1">
<li><a
target="_blank" rel="noopener" href="https://www.cnblogs.com/lovesKey/p/10791914.html">在linux访问macos下的分区</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/25/Computer/2022-01-25-repo-and-git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/25/Computer/2022-01-25-repo-and-git/" class="post-title-link" itemprop="url">repo and git</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-25 11:15:00" itemprop="dateCreated datePublished" datetime="2022-01-25T11:15:00+08:00">2022-01-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-02-26 22:53:24" itemprop="dateModified" datetime="2022-02-26T22:53:24+08:00">2022-02-26</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer/" itemprop="url" rel="index"><span itemprop="name">Computer</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本博文并不提供全面的教学指导，详细手册请查阅 <a
target="_blank" rel="noopener" href="https://git-scm.com/docs/">Git-Reference</a> 和 <a
target="_blank" rel="noopener" href="https://source.android.google.cn/source/developing?hl=zh-cn#staging-files">开发</a>
。</p>
<p><code>Git</code>
是一个开放源代码的版本控制系统，专用于处理分布在多个代码库上的大型项目。</p>
<p><code>Repo</code> 是 google android 以 <code>Git</code>
为基础构建的代码库管理工具，依赖于 <code>python2</code> 脚本调用
Git，主要用来下载、管理android项目的软件仓库。</p>
<p><code>Repo</code> 简化了跨多个代码库运行的流程，与 <code>Git</code>
相辅相成。Repo 可以在必要时 <mark style="font-weight: 900;">整合多个 Git
代码库，将相关内容上传到我们的修订版本控制系统</mark>，借助单个 Repo
命令，<mark style="font-weight: 900;">可以将文件从多个代码库下载到本地工作目录</mark>。使用
Repo 执行基本的跨网络操作可大大简化文件管理工作。</p>
<h1 id="git">GIT</h1>
<p>对git的使用会分为 <a
href="##INTROCUCTION"><strong>基础概念部分</strong></a>（即相关概念介绍）、<a
href="##GIT%20COMMAND%20GRAMMER"><strong>指令语法</strong></a>、<a
href="GIT%20SITUATION"><strong>使用场景</strong></a> 三部分。</p>
<h2 id="introduction">INTRODUCTION</h2>
<p><strong>DAG</strong>： Directed Acyclic Graph，有向无环图。</p>
<p><strong>DVCS</strong>： Distributed Version Control
System，分布式版本控制系统。</p>
<h3 id="dvcs">DVCS</h3>
<p><strong>节点</strong>：在DVCS中，每个节点代表项目的一个修订（一个版本），这些对象通常被称为提交。</p>
<p><strong>有向边</strong>：
在DVCS中，每条边是基于两个修订之间的关系生成的。<mark style="font-weight: 900;">箭头是从父修订指向子修订的，代表他们之间的从属关系。</mark>
修订DAG中的箭头并不一定会形成闭环。通常修订的DAG是从左向右的结构（根节点在左，叶节点在右）或者自上而下结构（最新的版本在上面）。</p>
<h3 id="branch-tag-refs-hash-code">BRANCH / TAG / REFS / HASH-CODE</h3>
<p><strong>分支</strong>（branch）和 <strong>标签</strong>
（tag）有时候也统称为 <strong>引用</strong>（refs），它们在修订 DAG
中的含义是样的，都是修订结构图表中的外部引用（指针）。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226205719300.png"
alt="image-20220226205719300" />
<figcaption aria-hidden="true">image-20220226205719300</figcaption>
</figure>
<blockquote>
<p>上图中，包含两个分支，当前的分支 Master 和另一分支 maint 。其中
<code>34ac2</code> 分支有一个 <code>v0.9</code> 的标签，另一个
<code>3fb00</code> 标签是合并提交的。</p>
</blockquote>
<p><strong>标签</strong>（tag），即
<strong>给定版本的符号名称</strong>，如 <code>v1.3-rc3</code>
，<mark style="font-weight: 900;">其永远指向相同对象，且不会变更</mark>。</p>
<blockquote>
<p>这就是一个允许开发人员快速查询和浏览的信息，且该信息必须对所有人来说都是具有相同意义的。</p>
</blockquote>
<p><strong>分支</strong>（branch），即
<strong>一系列开发工作的符号名称</strong>。</p>
<p>本地分支的引用信息都存放在 <code>.git/refs/heads/</code> 路径下，如
<code>master</code> 分支信息存放于 <code>.git/refs/heads/master</code>
中，而 <code>refs/heads/</code> 为该 <code>master</code>
的命名空间。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226211442066.png"
alt="image-20220226211442066" />
<figcaption aria-hidden="true">image-20220226211442066</figcaption>
</figure>
<blockquote>
<p>目前Git在硬盘中采用了两种截然不同的方式来表示分支：<strong>松散格式</strong>
和 <strong>压缩格式</strong>。</p>
<p>例如master分支（该分支是Git采用的默认分支名，用户在创建新的版本库时默认的分支名就是它）。</p>
<ul>
<li>采用 <strong>松散格式</strong> 时，它是
<code>.git/refs/heads/master</code> 中的一行文本，其中指代分支的
<strong>内容是十六进制的SHA-1码</strong>。</li>
<li>采用 <strong>压缩格式</strong> 时，它是
<code>.git/packed-refs</code> 中的一行文本，使用
<strong>最顶部修订的SHA-1码</strong> 和 <strong>分支全名一起</strong>
表示该分支。</li>
</ul>
</blockquote>
<h3 id="configuration">Configuration</h3>
<p>可以通过 <code>git config --global user.email ""</code> 和
<code>git config --global user.name ""</code> 进行配置，相关信息存储在
<code>~/.gitconfig</code> 文件中。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226203128964.png"
alt="image-20220226203128964" />
<figcaption aria-hidden="true">image-20220226203128964</figcaption>
</figure>
<h3 id="branch-name">Branch Name</h3>
<table>
<thead>
<tr class="header">
<th>分支</th>
<th>命名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>主分支</td>
<td>master</td>
<td>主分支，所有提供给用户使用的正式版本</td>
</tr>
<tr class="even">
<td>开发分支</td>
<td>dev</td>
<td>开发分支，永远是功能最新最全的版本</td>
</tr>
<tr class="odd">
<td>功能分支</td>
<td>feature-*</td>
<td>新功能分支，某个功能点正在开发的分支</td>
</tr>
<tr class="even">
<td>发布分支</td>
<td>release-*</td>
<td>发布定期要上线的功能</td>
</tr>
<tr class="odd">
<td>修复分支</td>
<td>bug-*</td>
<td>修复代码bug的分支</td>
</tr>
</tbody>
</table>
<h3 id="master">Master</h3>
<p>代码库应该有且仅有一个主分支。所有提供给用户使用的正式版本，都在这个主分支上发布。Git主分支的名字，默认称为
<code>Master</code> 。<code>Master</code>
主分支是自动建立的，版本库初始化以后，默认就是在主分支在进行开发。</p>
<p>主分支只用来分布重大版本，日常开发应该在另一条分支上完成。我们把开发用的分支，叫做
Dev
这个分支可以用来生成代码的最新隔夜版本（nightly）。如果想正式对外发布，就在
Master 分支上，对 Dev 分支进行”合并”（merge）。</p>
<h3 id="head">HEAD</h3>
<p><strong>git 中的分支</strong> 本质上是个指向 commit
对象的可变指针。</p>
<p>而在每一个使用 git 的 <code>.git/</code> 路径下，还保存着一个名为
<code>HEAD</code>
的特别指针，一般来说，它是指向正在工作中的本地分支的指针。</p>
<p><code>HEAD</code> 的指向是可以改变的，比如在 commit / checkout /
branch / tag / retest / restore 等操作之后。</p>
<p>有的时候 <code>HEAD</code>
会指向一个没有分支名字的修订版本，这种情况叫 <strong><em>detached
HEAD</em></strong>。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226203838866.png"
alt="image-20220226203838866" />
<figcaption aria-hidden="true">image-20220226203838866</figcaption>
</figure>
<p>在最底层实现中，Git 历史版本识别是通过一个 SHA-1 哈希码实现的，例如
<code>2b953b4380</code> 。</p>
<p>Git
支持多种形式的版本查询，其中就包括使用哈希码的精确匹配（最少提供4个字符）。</p>
<h2 id="git-command-grammer">GIT COMMAND GRAMMER</h2>
<ol type="1">
<li>使用 <code>git &lt;command&gt; -h</code>
可以获得该命令的所有参数用法帮助（简略的）。然后可以针对性地去搜索该指令和参数的用法。</li>
<li>下方会列出一些较为常见的（自己会使用得到的）命令及其参数。个别较常见的命令会贴上一张官方的参数用法图片。</li>
</ol>
<h3 id="git-add">git add</h3>
<h4 id="file-name">&lt;file name&gt;</h4>
<p>使用本命令参数可以直接确认某个文件的变动记录。</p>
<blockquote>
<p>如 <code>git add readme.md</code> 确认了 <code>readme.md</code>
文件的修改，<code>git add .</code>
确认了当前路径下包含的所有子路径和子文件的修改。</p>
</blockquote>
<h3 id="git-blame">git blame</h3>
<h4 id="file-name-1">&lt;file name&gt;</h4>
<p>本参数可以查看文件内部每一行内容的变动，例如新增一行，文件的编辑者等。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226202721363.png"
alt="image-20220226202721363" />
<figcaption aria-hidden="true">image-20220226202721363</figcaption>
</figure>
<blockquote>
<p>跟 <code>git diff</code>
不同的是，本命令是真的打开文件然后一行一行地给你修改和提示信息，包括每一行是谁写的</p>
</blockquote>
<h3 id="git-branch">git branch</h3>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226213748945.png"
alt="image-20220226213748945" />
<figcaption aria-hidden="true">image-20220226213748945</figcaption>
</figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -D origin/xxxxxx</span><br><span class="line">git branch -D xxxxxx</span><br></pre></td></tr></table></figure>
<h4 id="a">-a</h4>
<p>使用本命令标志可以显示 <strong>本地 (local) 所有分支</strong> 和
<strong>远程 (remote) 所有分支</strong>。 其中，带 <code>*</code>
的为当前所在分支。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226200020105.png"
alt="image-20220226200020105" />
<figcaption aria-hidden="true">image-20220226200020105</figcaption>
</figure>
<h4 id="d-branch-name">-d &lt;branch name&gt;</h4>
<p>使用本命令标志可以删除 某个分支。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226211322680.png"
alt="image-20220226211322680" />
<figcaption aria-hidden="true">image-20220226211322680</figcaption>
</figure>
<h4 id="v">-v</h4>
<p>使用命令标志可以展示分支的哈希函数和commit信息，<code>-v</code> 即
<code>--verbose</code> ，表示 "冗长的"。</p>
<blockquote>
<p>例如: 下方，从 <code>master</code> 主分支刚创建出新分支
<code>SWV</code> 时，两者的哈希函数和commit信息是一样的。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226214736094.png"
alt="image-20220226214736094" />
<figcaption aria-hidden="true">image-20220226214736094</figcaption>
</figure>
<p>但修改了 <code>SWV</code>
分支的内容并确认提交之后，其哈希函数和commit信息就发生了改变。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226214912676.png"
alt="image-20220226214912676" />
<figcaption aria-hidden="true">image-20220226214912676</figcaption>
</figure>
</blockquote>
<h3 id="git-checkout">git checkout</h3>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226213843563.png"
alt="image-20220226213843563" />
<figcaption aria-hidden="true">image-20220226213843563</figcaption>
</figure>
<h4 id="branch">&lt;branch&gt;</h4>
<p>单独使用此参数可以用于切换分支（也有新的实验性语句
<code>switch</code> 可以使用，但是 <code>checkout</code>
更稳定）或恢复工作树文件。使用方式如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout dev</span><br><span class="line">git checkout origin/dev</span><br><span class="line">git checkout xxxxxx</span><br></pre></td></tr></table></figure>
<h4 id="b">-b</h4>
<p>使用本标志 + <code>&lt;new branch name&gt;</code>
可以创建一个新分支并切换至该分支，等同于 先使用
<code>git branch &lt;new branch name&gt;</code> 和
<code>git checkout &lt;new branch name&gt;</code> 。</p>
<h4 id="orphan-branch-name">--orphan &lt;branch name&gt;</h4>
<p>使用本命令标志可以创建一个与主分支没有联系的孤儿分支。</p>
<h3 id="git-commit">git commit</h3>
<h4 id="a-all">-a/-all</h4>
<p>使用本标志指
<strong>接受被追踪文件的所有变更</strong>，可以在暂存区创建一个注释来实现操作隔离。</p>
<h4 id="m">-m ""</h4>
<p>本标志和参数可以支持在 <code>""</code> 内实现对合并的快速注释。</p>
<h3 id="git-clone">git clone</h3>
<p>使用本命令可以直接从某个库中拷贝某个路径下的 repository，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@git.islet.space:srv/led_blink.git</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当然，拷贝不公开的repository时，需要确保已经将自己的 SSH-key
加入到该网站的 <code>/home/git/.ssh/authorized_keys</code>
文件中。公开的 repository 可以随便拷贝。</p>
</blockquote>
<h3 id="git-diff">git diff</h3>
<p>本命令可以简要地查看距离上次 <code>commit</code>
操作到底修改什么信息。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226202625977.png"
alt="image-20220226202625977" />
<figcaption aria-hidden="true">image-20220226202625977</figcaption>
</figure>
<h3 id="git-log">git log</h3>
<p><strong>注意</strong>：所有的 <code>git log</code>
命令只会显示如下格式的 log 记录。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226202114879.png"
alt="image-20220226202114879" />
<figcaption aria-hidden="true">image-20220226202114879</figcaption>
</figure>
<h4 id="num">-&lt;num&gt;</h4>
<p>如输入
<code>git log -2</code>，可以查看当前项目最近两条的提交记录。</p>
<h4 id="author-或---committer">--author 或 --committer</h4>
<p>本标志支持查看提交者信息，使用方法如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --author=Linus</span><br></pre></td></tr></table></figure>
<h4 id="merges-或---no-merges">--merges 或 --no-merges</h4>
<p>本标志支持查看已合并和提交或非合并提交的信息。</p>
<h4 id="path-file-name">&lt;path / file name&gt;</h4>
<p>本参数可以</p>
<h3 id="git-merge">git merge</h3>
<p>默认情况下，Git执行 <strong>快进式合并</strong>（fast-forward
merge），会直接将 Master 分支指向 Dev 分支。 使用 <code>–no–ff</code>
参数后，会执行正常合并，在 Master
分支上生成一个新节点。为了保证版本演进的清晰，我们希望采用这种做法。即：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge -no-ff dev</span><br></pre></td></tr></table></figure>
<h3 id="git-pull">git pull</h3>
<p>执行本命令后，Git系统会将服务器版本库中的变更下载到本机。自动将
remote 版本和 local
版本进行合并，然后把合并后的变更提交到<strong>本机</strong>
版本库中。</p>
<h3 id="git-push">git push</h3>
<h4 id="set-upstream">--set-upstream</h4>
<p>设置本地（新）分支的远程上游分支，一些在网上可以查找到的信息如下：</p>
<ul>
<li>set upstream branches to work properly</li>
<li>closely associated with remote branches</li>
<li>define the branch tracked on the remote branches (also called as
remote tracking branch)</li>
<li><code>--set-upstream</code> is the same as <code>-u</code></li>
</ul>
<p>在本地创建的新分支如果希望在远程版本库中添加对应的上游分支，使用此命令和标志可以使得此分支推送至远程分支的目标更加明确。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin better-random</span><br></pre></td></tr></table></figure>
<h3 id="git-rebase">git rebase</h3>
<p>rebase是将自己的分支重新基于别人的分支之上，即，在别人的基础上再添加什么东西。</p>
<h3 id="git-reset">git reset</h3>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226223239807.png"
alt="image-20220226223239807" />
<figcaption aria-hidden="true">image-20220226223239807</figcaption>
</figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^</span><br></pre></td></tr></table></figure>
<h3 id="git-remote">git remote</h3>
<p>本命令可以进行如下操作：</p>
<ol type="1">
<li>对远程repository进行
<strong>添加</strong>（add）、<strong>删除</strong>（remove）、<strong>重命名</strong>（rename）等操作。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226223823738.png"
alt="image-20220226223823738" />
<figcaption aria-hidden="true">image-20220226223823738</figcaption>
</figure>
<h3 id="git-status">git status</h3>
<p>直接使用本命令可以查看当前路径下所有文件的修改记录。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226223119337.png"
alt="image-20220226223119337" />
<figcaption aria-hidden="true">image-20220226223119337</figcaption>
</figure>
<h2 id="git-situation">GIT SITUATION</h2>
<h3 id="远程git-clone一个master分支为空的仓库时">远程git
clone一个master分支为空的仓库时</h3>
<p>要么整个仓库都为空，要么肯定还有分支，使用 <code>git branch -a</code>
查看远程仓库分支，一般如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* dev</span><br><span class="line">  remotes/origin/xxxxxxxxxx</span><br><span class="line">  remotes/origin/HEAD -&gt; origin/dev</span><br><span class="line">  remotes/origin/dev</span><br><span class="line">  remotes/origin/master</span><br></pre></td></tr></table></figure>
<p>而正好 <code>xxxxxxxxxx</code> 可能就是真正存放现有文件的分支，使用
<code>git checkout origin/xxxxxxxxxx</code> 进行分支切换。</p>
<h3 id="conflict">conflict</h3>
<p>当文件冲突时，Git系统无法自动合并它们，因为可能这些代码块不是独立的。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220225214016189.png"
alt="image-20220225214016189" />
<figcaption aria-hidden="true">image-20220225214016189</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220225211850394.png"
alt="image-20220225211850394" />
<figcaption aria-hidden="true">image-20220225211850394</figcaption>
</figure>
<p><code>git pull</code> 也 pull 不下来。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220225212102034.png"
alt="image-20220225212102034" />
<figcaption aria-hidden="true">image-20220225212102034</figcaption>
</figure>
<h1 id="repo">REPO</h1>
<p>repo 部分将分为 <a
href="##INSTALL%20REPO"><strong>安装repo</strong></a> 、<a
href="##REPO%20COMMAND%20GRAMMER"><strong>命令语法</strong></a> 和 <a
href="##REPO%20SITUATION"><strong>使用场景</strong></a> 三部分。</p>
<h2 id="install-repo">INSTALL REPO</h2>
<p><code>repo</code> 的安装有 <a
href="###SETUP%20AUTOMATICALLY"><strong>自动</strong></a> 和 <a
href="###SETUP%20MANUALLY"><strong>手动</strong></a> 两种，类 UNIX
系统都可以通过对应的包管理工具进行安装，但如果没有手动修改源，使用效果可能也不尽如人意。</p>
<p>安装完毕之后还需要进行 <a
href="####VERIFICATION"><strong>版本验证</strong></a>，可能还需要 <a
href="PYTHON%20NOT%20FOUND"><strong>对python版本进行更改</strong></a>
。</p>
<h3 id="setup-automatically">SETUP AUTOMATICALLY</h3>
<p>根据 google android <a
target="_blank" rel="noopener" href="https://source.android.google.cn/setup/develop?hl=zh-cn#installing-repo">installing
repo</a> 指示，可以从 apt 包管理库中下载和安装 repo，也可以使用
google源、清华源或其他源进行手动下载。</p>
<p>Debian 系 Linux 的安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install repo</span><br></pre></td></tr></table></figure>
<p>Mac 安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo port install repo</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo brew install repo</span><br></pre></td></tr></table></figure>
<h3 id="setup-manually">SETUP MANUALLY</h3>
<p>手动安装 <code>repo</code> 的大概思路如下：</p>
<ol type="1">
<li>在用户根目录 <code>~</code> 下新建 <code>bin</code> 文件夹，即把
<code>$HOME/bin</code> 或 <code>~/bin</code> 当做 <code>repo</code>
的执行文件路径。</li>
<li>将该路径加入系统变量 <code>PATH</code> 中，可以通过写入
<code>~/.profile</code> 或对应的 shell 配置文件（如zsh的
<code>~/.zshrc</code> ）中并更新该配置文件来实现。</li>
<li>然后在该路径下载 repo的执行程序，主要是将某个 url
中（如下方所示为清华源的repo）的信息写入 <code>~/bin/repo</code>
中。</li>
<li>为所有用户 <code>a</code> 附加 <code>~/bin/repo</code> 的可执行
<code>x</code> 权限。</li>
<li>把
<code>export REPO_URL='https://mirrors.tuna.tsinghua.edu.cn/git/git-repo'</code>
加入到配置文件中，使其一直生效（也可以在 terminal
中临时输入此命令，使其在设备重启前生效）。如果未写入 shell
的配置文件，则重启后该变量就会消失。</li>
</ol>
<p>下方代码以安装了 <code>zsh</code> shell 的 linux 或 debian
系系统为例，可以拷贝粘贴保存至脚本以运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 手动安装repo</span></span><br><span class="line">mkdir ~/bin</span><br><span class="line">PATH=~/bin:<span class="variable">$PATH</span></span><br><span class="line">curl https://mirrors.tuna.tsinghua.edu.cn/git/git-repo &gt; ~/bin/repo</span><br><span class="line">chmod a+x ~/bin/repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将源添加到shell配置文件并使其生效</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export REPO_URL=&#x27;https://mirrors.tuna.tsinghua.edu.cn/git/git-repo&#x27;&quot;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证信息</span></span><br><span class="line">repo version</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$REPO</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong>：google android用的是
<code>https://storage.googleapis.com/git-repo-downloads/repo</code>
的链接，但不是很方便下载，所以就更换成了清华源的。</p>
</blockquote>
<h4 id="verification">VERIFICATION</h4>
<p>安装完毕之后，可以对手动安装的 <code>repo</code> 进行版本验证，输入
<code>repo version</code> 和 <code>echo $REPO_URL</code>
即可，结果如下：</p>
<p>此处提示的 <code>&lt;repo not installed&gt;</code> 是正常的，因为在
<code>~</code> 目录下的确没有安装 <code>repo</code> .</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226193048479.png"
alt="image-20220226193048479" />
<figcaption aria-hidden="true">image-20220226193048479</figcaption>
</figure>
<h3 id="python-not-found">PYTHON NOT FOUND</h3>
<p>如果出现以下提示，则说明你的系统中没有为 <code>python</code> 添加
<strong>软连接</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/env: ‘python’: No such file or directory</span><br></pre></td></tr></table></figure>
<h4 id="解决方法">解决方法</h4>
<ol type="1">
<li>验证是否已经安装了 <code>python2</code> ：输入命令
<code>python2 --version</code>，如果提示对应的版本信息则跳到
第3步，否则进行 第2步。</li>
<li>下载 <code>python2</code>：debian 系用户输入命令
<code>sudo apt install python2</code> 进行安装。mac系用户输入
<code>sudo port install python2</code> 进行安装。</li>
<li>在 <code>/usr/bin/</code> 目录下为 <code>python2</code>
创建软链：<code>sudo ln -s /usr/bin/python2 /usr/bin/python</code></li>
<li>再次运行 <code>repo init</code> 即可正常。</li>
</ol>
<p>如，在 Kali Linux 绑定 <code>python2</code> 为 <code>python</code>
之后，可以输入 <code>whereis python</code> 或
<code>python --version</code> 进行验证：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220125143434000.png"
alt="image-20220125143434000" />
<figcaption aria-hidden="true">image-20220125143434000</figcaption>
</figure>
<h2 id="repo-command-grammer">REPO COMMAND GRAMMER</h2>
<ol type="1">
<li>参考 <a
target="_blank" rel="noopener" href="https://source.android.google.cn/setup/develop/repo?hl=zh-cn#upload">Repo
命令参考资料</a></li>
<li>使用 <code>repo &lt;command&gt; -h</code>
可以获取相应命令的帮助。</li>
<li>在初始化过 repo 的路径下使用 <code>repo help</code>
可以获得以下信息：</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226220906805.png"
alt="image-20220226220906805" />
<figcaption aria-hidden="true">image-20220226220906805</figcaption>
</figure>
<h3 id="repo-init">repo init</h3>
<p>执行下方的命令会在当前目录中创建一个 <code>.repo/</code> 目录并初始化
Repo 的版本控制，其中包含存放 Repo 源代码，以及从 URL（对应下方
<code>-u</code> 参数） 中同步下来的 Git 代码库 的某个分支 （对应下方
<code>-b</code> 参数）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo init -u &lt;git@xxxx.com:xxxx/manifest&gt; -b &lt;oneOfTheBranch&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-u</code>：即URL，指定从中检索清单代码库的网址。</li>
<li><code>-m</code>：选择代码库中的清单文件。如果未选择清单名称，则默认为
<code>default.xml</code>。</li>
<li><code>-b</code>：指定修订版本，即特定的 manifest-branch，可以是
<code>dev</code> 分支，也可以是特定分支，拉下来之后参照 <a
href="##REPO%20SWITCH%20BRANCH">REPO SWITCH BRANCH</a>
进行分支切换。</li>
</ul>
<p><strong>注意</strong>：对于所有剩余的 Repo 命令，当前的工作目录必须是
<code>.repo/</code> 的父目录或该父目录的子目录。</p>
<h3 id="repo-branch">repo branch</h3>
<p>使用本命令可以查看所有的
<strong>目前可用的主题分支</strong>（currently available topic
branches）。</p>
<h3 id="repo-sync">repo sync</h3>
<p>从 <code>manifest</code> 源中往外拉取分支。下方的
<code>-j&lt;number&gt;</code> 是指创建多线程进行数据资源获取，如
<code>-j4</code> 是指创建四线程进行数据资源获取。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">repo sync</span><br><span class="line">repo sync -j4</span><br><span class="line">repo sync -j8</span><br></pre></td></tr></table></figure>
<blockquote>
<p>但，bitbucket的网络资源极差，很多情况下都拉不下来代码。</p>
</blockquote>
<h3 id="repo-help">repo help</h3>
<p>在其他地方如果没有运行过 <code>repo init</code> 而直接输入
<code>repo help</code> ，则会出现以下信息，详见 <a
href="##REPO%20INIT">REPO INIT</a> 。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220226220753429.png"
alt="image-20220226220753429" />
<figcaption aria-hidden="true">image-20220226220753429</figcaption>
</figure>
<h2 id="repo-situation">REPO SITUATION</h2>
<h3 id="repo-switch-branch">REPO SWITCH BRANCH</h3>
<p>前文有说过 “借助单个 Repo
命令，<mark style="font-weight: 900;">可以将文件从多个代码库下载到本地工作目录</mark>”，即使用repo拉下来的是多个
git repository，且这个repo是通过 <code>.xml</code>
文件进行管理的，也就是它自身包含了一些版本和分支切换相关的信息。</p>
<p>如果要对repo拉下来的东西进行分支切换，就要参考一下步骤：</p>
<ol type="1">
<li>到 <code>.repo/manifest</code> 路径中。</li>
<li>使用 <code>git branch -a</code> 查看分支信息。</li>
<li>使用 <code>git checkout &lt;branch name&gt;</code>
进行分支切换。</li>
<li>再次使用 <code>repo sync</code> 命令进行同步。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220225211308567.png"
alt="image-20220225211308567" />
<figcaption aria-hidden="true">image-20220225211308567</figcaption>
</figure>
<p>下图是通过 <code>repo</code> 拉下来的多个git repository
之一中的隐藏文件，可以看到这个 <code>.git</code> 文件被使用指向上级
<code>.repo/</code> 路径下的某个 <code>.git</code>
文件，也就是说，需要先通过 <code>repo</code> 去拉取信息，再使用
<code>git</code> 来切换分支。</p>
<figure>
<img src="https://pic.islet.space/2022/02/image-20220225214801501.png"
alt="image-20220225214801501" />
<figcaption aria-hidden="true">image-20220225214801501</figcaption>
</figure>
<h1 id="reference">REFERENCE</h1>
<ol type="1">
<li><a
target="_blank" rel="noopener" href="https://www.jianshu.com/p/06e1f67c8939">Git与Repo简单入门</a></li>
<li><a target="_blank" rel="noopener" href="https://www.yiibai.com/git/git_rebase.html">git rebase
命令</a></li>
<li><a target="_blank" rel="noopener" href="https://git-scm.com/docs">git reference</a></li>
<li>《Git高手之路》，Jakub Narebski，人民邮电出版社</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/23/Computer/2022-01-23-%E7%BB%99Mac-Big-Sur%E4%BF%AE%E6%94%B9%E5%A4%96%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%99%A8%E7%9A%84%E5%88%86%E8%BE%A8%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/23/Computer/2022-01-23-%E7%BB%99Mac-Big-Sur%E4%BF%AE%E6%94%B9%E5%A4%96%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%99%A8%E7%9A%84%E5%88%86%E8%BE%A8%E7%8E%87/" class="post-title-link" itemprop="url">给Mac Big Sur修改外接显示器的分辨率</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-01-23 17:30:00 / Modified: 18:11:59" itemprop="dateCreated datePublished" datetime="2022-01-23T17:30:00+08:00">2022-01-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer/" itemprop="url" rel="index"><span itemprop="name">Computer</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>本文参考 《<a target="_blank" rel="noopener" href="https://zhangzi.life/articles/1605255382000">Mac
外接显示器色彩问题</a>》和 《<a target="_blank" rel="noopener" href="https://sspai.com/post/57549#!">为
macOS 10.15 开启 HiDPI，让 2K 显示器更舒适</a>》两篇文章。</p>
<p>刚买来新的 HUAWEI Mateview 无线版，显示器分辨率为
<code>3840*2560</code> ，该死的 <code>3:2</code>
屏幕啊，我图啥......</p>
<p>外接2015年的Macbook Air的MiniDP口输出准4K分辨率。</p>
<p>但是，但是，但是~~Air只能输出 <code>16:9</code> 和 <code>16:10</code>
的分辨率，让我搞了整整一下午来调整这个分辨率，4个小时啊。</p>
<p>算了，总结一下吧。</p>
<h1 id="关闭sip">关闭SIP</h1>
<p>Big sur 和之前版本不同，需要的操作如下：</p>
<ol type="1">
<li>关机</li>
<li>长按 <code>Command</code> 键 和 <code>R</code>
键（都不要松开），短按 开机电源键，直到出现进度条才能松开。</li>
<li>找到终端，然后输入 <code>csrutil authenticated-root disable</code>
，出现 <code>successfully</code> 字样就算是成功了。（之前的版本是
<code>csrutil disable</code> ）</li>
</ol>
<h1 id="查询设备号">查询设备号</h1>
<ol type="1">
<li>先断开显示器，输入如下代码：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ioreg -l | grep <span class="string">&quot;DisplayVendorID&quot;</span></span><br><span class="line">ioreg -l | grep <span class="string">&quot;DisplayProductID&quot;</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>再插上显示器，再次运行上方代码。</li>
<li>两次得出来的不同的设备号就可以区分哪个 <code>VendorID</code> 和
<code>ProductID</code> 是外接显示器的。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123175000229.png"
alt="image-20220123175000229" />
<figcaption aria-hidden="true">image-20220123175000229</figcaption>
</figure>
<ol start="4" type="1">
<li>记下那串代码，并将外接显示器的两个ID转换成对应的十六进制数， 如
<code>8950</code> 即 <code>22f6</code> , <code>28194</code> 即
<code>66e2</code></li>
</ol>
<h1 id="生成配置参数">生成配置参数</h1>
<ol type="1">
<li>在用户目录 ，即 <code>~</code> 下，使用
<code>DisplayVendorID-xxxx</code> （<code>xxxx</code> 即对应外接显示器
Vendor 号的16进制 ）创建一个文件夹。</li>
<li>然后在对应文件夹下创建一个 使用 <code>DisplayProductID-yyyy</code>
（ yyyy` 即对应外接显示器 Product 号的16进制
）创建一个无后缀名的文件。</li>
<li>到 <a
target="_blank" rel="noopener" href="https://codeclou.github.io/Display-Override-PropertyList-File-Parser-and-Generator-with-HiDPI-Support-For-Scaled-Resolutions/">Scaled
Resolution for your Mac</a>
网站生成配置参数，在红色框中分别填入你外接显示器的对应参数，和你想使你的显示器所呈现的分辨率参数。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123175609151.png"
alt="image-20220123175609151" />
<figcaption aria-hidden="true">image-20220123175609151</figcaption>
</figure>
<ol start="4" type="1">
<li>复制右侧的 xml 代码至刚刚的 <code>DisplayProductID-yyyy</code>
文件中，并保存。</li>
</ol>
<h1 id="导入系统">导入系统</h1>
<p>在Big Sur系统下，根目录 <code>/</code>
是禁止写入的，需要稍微用点技巧（走点弯路）。</p>
<ol type="1">
<li>新建一个文件夹，将解除SIP之后的 <code>/</code>
挂载到某个地方，如下方所示：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/nvme</span><br><span class="line">sudo mount -o nobrowse -t apfs /dev/disk1s5 ~/nvme/</span><br></pre></td></tr></table></figure>
<p>其中，<code>/dev/disk1s5</code> 中的 <code>/disk1s5</code> 要通过
<strong>磁盘工具</strong> 各自查看自己的 <strong>设备</strong>
，最后面的 <code>s1</code> 去掉不写。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123173550666.png"
alt="image-20220123173550666" />
<figcaption aria-hidden="true">image-20220123173550666</figcaption>
</figure>
<ol start="2" type="1">
<li>然后就可以 <code>cd</code>
进去查看对应目录下的文件内容，但是所有读写操作都需要加上
<code>sudo</code> 才可以。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/nvme/System/Library/Displays/Contents/Resources/Overrides</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123173806535.png"
alt="image-20220123173806535" />
<figcaption aria-hidden="true">image-20220123173806535</figcaption>
</figure>
<ol start="3" type="1">
<li>把 <code>~/DisplayVendorID-xxxx</code> 复制到
<code>~/nvme/System/Library/Displays/Contents/Resources/Overrides</code>
里面：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -r ~/DisplayVendorID-22f6 ~/nvme/System/Library/Displays/Contents/Resources/Overrides/DisplayVendorID-22f6</span><br></pre></td></tr></table></figure>
<p>复制完毕之后可以再 <code>ls</code> 查看，就存在了。</p>
<ol start="4" type="1">
<li>但是这种复制只是一种暂时的，重启之后就会被镜像文件所覆盖，所以要重新
snapshot
一下。<mark style="font-weight: 900;">注意，这一步一定要做，否则重启就失效了。</mark></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bless --folder ~/nvme/System/Library/Displays/Contents/Resources/Overrides --bootefi --create-snapshot</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/22/Hardware/STM32/2022-01-22-STM32-NUCLEOL476RG-DEVELOP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/22/Hardware/STM32/2022-01-22-STM32-NUCLEOL476RG-DEVELOP/" class="post-title-link" itemprop="url">STM32-NUCLEOL476RG DEVELOP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-22 19:30:00" itemprop="dateCreated datePublished" datetime="2022-01-22T19:30:00+08:00">2022-01-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-24 08:38:28" itemprop="dateModified" datetime="2022-01-24T08:38:28+08:00">2022-01-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/InternetOfThings/" itemprop="url" rel="index"><span itemprop="name">InternetOfThings</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>截止2022年1月23日，以下是ST公司的产品线，下图通过Flash大小和Nucleo类型对产品进行了一定划分。</p>
<p><img src="https://pic.islet.space/2022/01/en.ln1847_stm32_nucleo.jpg" alt="img" style="zoom: 67%;" /></p>
<h1 id="necleo-l476rg-data-brief">NECLEO-L476RG DATA BRIEF</h1>
<p>Necleo系列开发板下面有很多型号，且每个型号的板子（除开芯片以外）设计应该都是大同小异的，所以最底层板子也就有了自己的型号。</p>
<p>而 NecleoL476RG 开发板的底板型号为 <code>MB1136</code>
。且下方所有Necleo的产品都自带 ST-LINK/V2-1 调试器。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220122193806691.png"
alt="image-20220122193806691" />
<figcaption aria-hidden="true">image-20220122193806691</figcaption>
</figure>
<h2 id="st-linkv2-1">ST-LINK/V2-1</h2>
<p>支持USB软件 <strong>重新检查</strong>（re-enumeration）
、支持虚拟COM口、支持大容量储存、支持超过 <code>100mA</code>
电流的电源管理，但是不支持 <strong><em>SWIM</em></strong>
接口且最小输入电压为 <code>3V</code> 。</p>
<p>注意：一旦激活了 ST-LINK/V2-1
的目标读出保护功能，就会阻止目标应用运行事后运行（prevents the target
application from running afterward.）目标读出保护必须被关闭（must be
kept disabled on board）。</p>
<p>可以根据跳线帽的两种状态来使用 ST-LINK/V2-1:</p>
<ul>
<li>在线编程和调试STM32（Program/debug the on-board STM32），此时
<code>CN2</code> 的两个跳线帽都连接着，处于在线编程状态（默认）。</li>
<li>使用连接到SWD连接器CN4的电缆对外部应用板中的MCU进行编程/调试，此时
<code>CN2</code> 的两个跳线帽都不连接，以允许 <code>CN4</code> （即
<code>SWD</code> 接口）连接至外部连接器。</li>
</ul>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220123183857115.png"
alt="image-20220123183857115" />
<figcaption aria-hidden="true">image-20220123183857115</figcaption>
</figure>
<h2 id="layout">LAYOUT</h2>
<p><img src="https://pic.islet.space/2022/01/image-20220123182028068.png" alt="image-20220123182028068" style="zoom:50%;" /></p>
<p><img src="https://pic.islet.space/2022/01/image-20220123182139437.png" alt="image-20220123182139437" style="zoom:50%;" /></p>
<h1 id="chip-breief">CHIP BREIEF</h1>
<p>STM32 Nucleo L476RG 所使用的芯片是 <code>STM32L476RGT6U</code>，其中
<code>L4</code> 是系列号，<code>76</code> 是产线，<code>R</code>
是指64pin，<code>C</code> 是指 256Kbytes 的 Flash内存大小。</p>
<p>下方为《<a
target="_blank" rel="noopener" href="https://www.st.com/resource/en/data_brief/nucleo-l476rg.pdf">STM32
Nucleo-64 boards data brief</a>》提供的
<strong>产品芯片命名方法</strong>：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220122195540612.png"
alt="image-20220122195540612" />
<figcaption aria-hidden="true">image-20220122195540612</figcaption>
</figure>
<h1 id="reference">REFERENCE</h1>
<ol type="1">
<li><a
target="_blank" rel="noopener" href="https://www.st.com/en/evaluation-tools/nucleo-l476rg.html">NUCLEO-L476RG</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/22/Linux/2022-01-22-customize-vscode-font-in-debian-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/22/Linux/2022-01-22-customize-vscode-font-in-debian-linux/" class="post-title-link" itemprop="url">customize vscode font in debian linux</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-01-22 15:20:00 / Modified: 16:19:33" itemprop="dateCreated datePublished" datetime="2022-01-22T15:20:00+08:00">2022-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="install-fonts-on-debian-linux">INSTALL FONTS ON DEBIAN
LINUX</h1>
<p>We can install <strong><em>True Type</em></strong> or
<strong><em>Open Type</em></strong> fonts(<code>.ttf</code> /
<code>.otf</code> / <code>.ttc</code>) in <em>DEBIAN LINUX</em>, like
ubuntu or kali.</p>
<h2 id="download-font-from-website">DOWNLOAD FONT FROM WEBSITE</h2>
<ol type="1">
<li>Download <code>Cascadia Code</code> from
<code>https://github.com/microsoft/cascadia-code/releases</code> and
unzip it.</li>
<li>We got 3 folders here: <code>/otf/</code> , <code>/ttf/</code> and
<code>woff2</code> , and we only need `ttf</li>
</ol>
<h2 id="copy-files-to-system-font-directory">COPY FILES TO SYSTEM FONT
DIRECTORY</h2>
<p>Font fils are generally installed in either the system font directory
on the path <code>/usr/share/fonts/</code> or in a user font directory
that is frequently on one of the following paths:</p>
<ul>
<li><code>~/.local/share/fonts/</code></li>
<li><code>~/usr/local/share/fonts/</code></li>
</ul>
<ol type="1">
<li>Execute the following command to copy the fonts to system path</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -r ttf /usr/share/fonts/CascadiaCode</span><br></pre></td></tr></table></figure>
<h2 id="generate-font-chache">GENERATE FONT CHACHE</h2>
<p>We need to build font infomation caches for apps using fontconfig for
their font handling.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/fonts/CascadiaCode</span><br><span class="line">fc-cache -f -v</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><em>NOTE</em></strong></p>
<p>If you cannot execute <code>fc-cache</code> command , copy and
execute the following command in terminal.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install fontconfig</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="verify-the-font-installation">VERIFY THE FONT INSTALLATION</h2>
<p>Confirm that the fonts are installed by displaying the paths and
style definitions with <code>fc-list</code> command filtered on the font
family name with <code>grep</code> .</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc-list | grep <span class="string">&quot;Cascadia Code&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="customize-vscode">CUSTOMIZE VSCODE</h1>
<ol type="1">
<li>Get to <code>Setting</code></li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220122161611892.png"
alt="image-20220122161611892" />
<figcaption aria-hidden="true">image-20220122161611892</figcaption>
</figure>
<ol start="2" type="1">
<li>Search <code>font</code> in the bar</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220122161750043.png"
alt="image-20220122161750043" />
<figcaption aria-hidden="true">image-20220122161750043</figcaption>
</figure>
<ol start="3" type="1">
<li>Add <code>'Cascadia Code',</code> to the
<code>Editor: Font Family</code> .</li>
<li>Restart vscode.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/18/Communication/2022-01-18-SPI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/18/Communication/2022-01-18-SPI/" class="post-title-link" itemprop="url">HALF DUPLEX SPI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-18 13:40:00" itemprop="dateCreated datePublished" datetime="2022-01-18T13:40:00+08:00">2022-01-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-08-26 20:41:09" itemprop="dateModified" datetime="2022-08-26T20:41:09+08:00">2022-08-26</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Communication/" itemprop="url" rel="index"><span itemprop="name">Communication</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="spi-introdution">SPI Introdution</h1>
<p>SPI， Serial Peripheral Interface，
即串行设备接口，微控制器和外围IC（如传感器、ADC、DAC、移位寄存器、SRAM等）之间使用最广泛的接口之一。</p>
<p>SPI是一种同步的主从式接口，支持全部通信制式（单工、半双工、全双工）。与I2C的
<strong>多主多从</strong> 模式不同，SPI协议为 <strong>一主多从</strong>
模式。SPI所消耗的接口数也有所提升。</p>
<h2 id="接线">接线</h2>
<p>SPI 的物理线支持 <strong>三种类型</strong>：</p>
<ul>
<li><strong>片选线</strong>（NCS / CS / SS），某些数据手册会将
<strong>片选引脚</strong> 称为 <code>NSS</code> /<code>NCS</code> /
<code>SEL</code> (<strong><em>Sel</em></strong>ect) / <code>CS</code>
(<strong><em>C</em></strong>hip <strong><em>S</em></strong>elect) /
<code>STE</code> (<strong><em>S</em></strong>laver
<strong><em>T</em></strong>ransmit
<strong><em>E</em></strong>nable)</li>
<li><strong>时钟线</strong>（CLK / SCK）</li>
<li><strong>数据线</strong>（DA 或 MOSI 和 MISO ）</li>
</ul>
<p><mark>需要注意的是，SPI的通信线有太多的名称，需要自行对照芯片手册进行查询，避免混淆。</mark>下方为标准全双工四线SPI的通信接线示意图</p>
<p><img src="https://pic.islet.space/2021/08/image-20210819075248043.png" alt="image-20210819075248043" style="zoom: 33%;" /></p>
<p>SPI 通过对硬件资源的使用修改（禁用片选、禁 / 复用数据线）可以达到
<strong>全双工</strong> 或 <strong>半双工</strong> 通信的目的。标准SPI为
四线SPI （CS / CLK / MOSI / MISO）；最低支持2根数据引脚（仅保留 CLK /
DA，其中DA为分时复用数据线 ）来达到半双工通信的目的，可以增加一 / 多根
CS
来达到拓展SPI从设备片选的目的；也可以利用四根独立的半双工数据线，来达到
标准四线SPI 四倍通信能力 的 六线SPI（一般被称为
<code>Quad-IO SPI</code>）。</p>
<h2 id="分类">分类</h2>
<p>各芯片厂商对SPI的通信协议好像并没有一个较为正式的名称，但都可以从通信制式的类型进行区分，并不能仅从
<strong>x线SPI</strong> 的数量来判断SPI通信协议的类型。</p>
<p>较为推荐的称呼方式是：<strong>线数</strong> +
<strong>有无片选</strong> +<strong>通信制式</strong>。比如：</p>
<ul>
<li>两线无片选半双工SPI，即 CLK 和 SDIO 两线，SDIO 支持分时双工。</li>
<li>三线无片选半双工SPI，即 CLK 和 两根 SDIO，两根SDIO
都是分时双工。</li>
<li>三线有片选半双工SPI，即 CLK 、SDIO 和 CS，SDIO 支持分时双工。</li>
<li>三线无片选全双工SPI，即 CLK、MOSI 和 MISO。</li>
<li>四线有片选全双工SPI，即 CLK、MOSI、MISO 和 CS。</li>
<li>......</li>
</ul>
<blockquote>
<p>例如，据STM32L476RG芯片手册《<a
target="_blank" rel="noopener" href="https://www.st.com/resource/en/reference_manual/rm0351-stm32l47xxx-stm32l48xxx-stm32l49xxx-and-stm32l4axxx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf">RM0351</a>》第1450页所示，SPI外设可以被配置为以下三种模式，即
<strong>三线全双工</strong>，<strong>两线半双工</strong> 和
<strong>两线单工</strong>。</p>
<ul>
<li>Full-duplex synchronous transfers on three lines</li>
<li>Half-duplex synchronous transfer on two lines (with bidirectional
data line)</li>
<li>Simplex synchronous transfers on two lines (with unidirectional data
line)</li>
</ul>
</blockquote>
<blockquote>
<p><strong>SDR 和 DDR 模式</strong></p>
<p>扩展的 SPI 协议还增加了 <strong>SDR 模式</strong>（单倍速率 Single
Data Rate）和 <strong>DDR 模式</strong>（双倍 速率 Double Data
Rate）。例如在标准 SPI 协议的 SDR 模式下，只在 SCK
的单边沿进行数据传输，即一个 SCK 时钟只传输一位数据；而在它的 DDR
模式下，会在 SCK 的上升沿和下降沿都进行数据传输，即一个 SCK
时钟能传输两位数据，传输速率提高一倍。</p>
</blockquote>
<h2 id="数据传输">数据传输</h2>
<p>下以四线有片选全双工SPI为例进行说明。</p>
<p>要开始SPI通信，主机必须发送时钟信号，并通过使能CS信号选择从机。</p>
<p>片选 <strong>通常</strong> 是 低电平有效（active-low） 信号。</p>
<p>主机须在 <code>CS</code> 信号上发送逻辑 <code>0</code>
以选择从机。主机和从机可以分别通过 MOSI 和 MISO
引脚同时发送数据。在SPI通信期间，数据的发送（串行移出到MOSI/SDO总线上）和接收（采样或读入总线(MISO/SDI)上的数据）同时进行。串行时钟沿同步数据的移位和采样。</p>
<p>SPI接口允许用户灵活选择时钟的 上升沿 或 下降沿
来采样和/或移位数据。</p>
<p><strong>需要注意</strong>：SPI接口传输的 <strong>数据位数</strong>
仍需查阅器件数据手册。</p>
<h2 id="时钟极性和时钟相位">时钟极性和时钟相位</h2>
<p>在SPI中，主机可以选择 <strong>时钟极性</strong>（Clock
Polarity，<strong>CPOL</strong>）和 <strong>时钟相位</strong>（Clock
Phase，<strong>CPHA</strong>）。</p>
<p>在空闲状态期间，CPOL 控制
时钟极性。空闲状态是指传输开始时CS为高电平且在向低电平转变的期间，以及传输结束时CS为低电平且在向高电平转变的期间。</p>
<p>CPHA 控制
时钟相位。<mark>根据CPHA位的状态，使用时钟上升沿或下降沿来采样和/或移位数据</mark>。主机必须
<mark>根据从机的要求选择时钟极性和时钟相位</mark>。根据CPOL和CPHA位的选择，有四种SPI模式可用，如下表：</p>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 29%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="header">
<th>SPI 模式</th>
<th>CPOL</th>
<th>CPHA</th>
<th>空闲状态下的时钟极性</th>
<th>用于采样和/或移位数据的时钟相应</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>0</td>
<td>逻辑低电平</td>
<td>数据在上升沿采样，在下降沿移出</td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
<td>1</td>
<td>逻辑低电平</td>
<td>数据在下降沿采样，在上升沿移出</td>
</tr>
<tr class="odd">
<td>2</td>
<td>1</td>
<td>1</td>
<td>逻辑低电平</td>
<td>数据在下降沿采样，在上升沿移出</td>
</tr>
<tr class="even">
<td>3</td>
<td>1</td>
<td>0</td>
<td>逻辑低电平</td>
<td>数据在上升沿采样，在下降沿移出</td>
</tr>
</tbody>
</table>
<p>下图为TI公司F280049芯片的SPI时钟模式：</p>
<figure>
<img src="https://pic.islet.space/2021/08/image-20210819084200284.png"
alt="image-20210819084200284" />
<figcaption aria-hidden="true">image-20210819084200284</figcaption>
</figure>
<p>下图为ADI公司ADSP21479芯片的SPI时钟模式：</p>
<figure>
<img src="https://pic.islet.space/2021/08/image-20210819084447672.png"
alt="image-20210819084447672" />
<figcaption aria-hidden="true">image-20210819084447672</figcaption>
</figure>
<p>后述 图2 至 图5 显示了四种SPI模式下的通信示例。</p>
<p>在这些示例中，数据显示在MOSI和MISO线上。传输的开始和结束用绿色虚线表示，采样边沿用橙色虚线表示，移位边沿用蓝色虚线表示。请注意，这些图形仅供参考。要成功进行SPI通信，用户须参阅产品数据手册并确保满足器件的时序规格。</p>
<p><img src="https://pic.islet.space/2021/08/205973_fig_02.png" alt="图2. SPI模式0，CPOL = 0，CPHA = 0：CLK空闲状态 = 低电平，数据在上升沿采样，并在下降沿移出" style="zoom: 60%;" /></p>
<div style="font-weight: 900; text-align: center;">
图2. SPI模式0，CPOL = 0，CPHA = 0：CLK空闲状态 =
低电平，数据在上升沿采样，并在下降沿移出
</div>
<p>图3给出了SPI模式1的时序图。在此模式下，时钟极性为0，表示时钟信号的空闲状态为低电平。此模式下的时钟相位为1，表示数据在下降沿采样（由橙色虚线显示），并且数据在时钟信号的上升沿移出（由蓝色虚线显示）。</p>
<p><img src="https://www.analog.com/-/media/images/analog-dialogue/en/volume-52/number-3/articles/introduction-to-spi-interface/205973_fig_03.png?la=en&vs=1" alt="图3. SPI模式1，CPOL = 0，CPHA = 1：CLK空闲状态 = 低电平，数据在下降沿采样，并在上升沿移出" style="zoom:50%;" /></p>
<div style="font-weight: 900; text-align: center;">
图3. SPI模式1，CPOL = 0，CPHA = 1：CLK空闲状态 =
低电平，数据在下降沿采样，并在上升沿移出
</div>
<p>图4给出了SPI模式2的时序图。在此模式下，时钟极性为1，表示时钟信号的空闲状态为高电平。此模式下的时钟相位为1，表示数据在下降沿采样（由橙色虚线显示），并且数据在时钟信号的上升沿移出（由蓝色虚线显示）。</p>
<p><img src="https://www.analog.com/-/media/images/analog-dialogue/en/volume-52/number-3/articles/introduction-to-spi-interface/205973_fig_04.png?la=en&vs=1" alt="图4. SPI模式2，CPOL = 1，CPHA = 1：CLK空闲状态 = 高电平，数据在下降沿采样，并在上升沿移出" style="zoom:50%;" /></p>
<div style="font-weight: 900; text-align: center;">
图4. SPI模式2，CPOL = 1，CPHA = 1：CLK空闲状态 =
高电平，数据在下降沿采样，并在上升沿移出。
</div>
<p>图5给出了SPI模式3的时序图。在此模式下，时钟极性为1，表示时钟信号的空闲状态为高电平。此模式下的时钟相位为0，表示数据在上升沿采样（由橙色虚线显示），并且数据在时钟信号的下降沿移出（由蓝色虚线显示）。</p>
<p><img src="https://www.analog.com/-/media/images/analog-dialogue/en/volume-52/number-3/articles/introduction-to-spi-interface/205973_fig_05.png?la=en&vs=1" alt="图5. SPI模式3，CPOL = 1，CPHA = 0：CLK空闲状态 = 高电平，数据在上升沿采样，并在下降沿移出" style="zoom:50%;" /></p>
<div style="font-weight: 900; text-align: center;">
图5. SPI模式3，CPOL = 1，CPHA = 0：CLK空闲状态 =
高电平，数据在上升沿采样，并在下降沿移出
</div>
<h2 id="多从机配置">多从机配置</h2>
<p>多个从机可与单个SPI主机一起使用。从机可以采用常规模式连接，或采用菊花链模式连接。</p>
<h3 id="常规spi模式">常规SPI模式</h3>
<figure>
<img src="https://pic.islet.space/2021/08/image-20210819075431419.png"
alt="image-20210819075431419" />
<figcaption aria-hidden="true">image-20210819075431419</figcaption>
</figure>
<div style="font-weight: 900; text-align: center;">
图6. 多从机SPI配置
</div>
<p>在常规模式下，主机需要为每个从机提供单独的片选信号。一旦主机使能（拉低）片选信号，MOSI/MISO线上的时钟和数据便可用于所选的从机。如果使能多个片选信号，则MISO线上的数据会被破坏，因为主机无法识别哪个从机正在传输数据。</p>
<p>从图6可以看出，随着从机数量的增加，来自主机的片选线的数量也增加。这会快速增加主机需要提供的输入和输出数量，并限制可以使用的从机数量。可以使用其他技术来增加常规模式下的从机数量，例如使用多路复用器产生片选信号。</p>
<h3 id="菊花链模式">菊花链模式</h3>
<p><img src="https://pic.islet.space/2021/08/image-20210819075542602.png" alt="image-20210819075542602" style="zoom:67%;" /></p>
<div style="font-weight: 900; text-align: center;">
图7. 多从机SPI菊花链配置
</div>
<p>在菊花链模式下，所有从机的片选信号连接在一起，数据从一个从机传播到下一个从机。在此配置中，所有从机同时接收同一SPI时钟。来自主机的数据直接送到第一个从机，该从机将数据提供给下一个从机，依此类推。</p>
<p><mark style="font-weight: 900;">使用该方法时，由于数据是从一个从机传播到下一个从机，所以传输数据所需的时钟周期数与菊花链中的从机位置成比例（成比例倍增）。</mark></p>
<p>例如在图7所示的8位系统中，<mark>为使第3个从机能够获得数据，需要24个时钟脉冲，而常规SPI模式下只需8个时钟脉冲</mark>。图8显示了时钟周期和通过菊花链的数据传播。并非所有SPI器件都支持菊花链模式。请参阅产品数据手册以确认菊花链是否可用。</p>
<p><img src="https://www.analog.com/-/media/images/analog-dialogue/en/volume-52/number-3/articles/introduction-to-spi-interface/205973_fig_08.png?la=en&vs=1" alt="图8. 菊花链配置：数据传播" style="zoom: 50%;" /></p>
<div style="font-weight: 900; text-align: center;">
图8. 菊花链配置：数据传播
</div>
<h1 id="half-duplex-spi">HALF DUPLEX SPI</h1>
<p>半双工通信可以是 两线SPI 或 三线SPI，仅仅是有无片选线的差异而已。</p>
<h2 id="pin-definition">PIN DEFINITION</h2>
<p><strong>NCS</strong>：
SPI控制读写使能信号；<mark style="font-weight: 900;">使用时需要被拉低</mark>，否则SDIO会处在
HIGH-Z 态，而SCLK信号也会被无视。也可以被用于在通信错误发生时重置SPI
通信。两线SPI不需要这根线，但个别芯片可能需要这个引脚接地（不能悬空），具体看芯片手册。</p>
<p><strong>SDIO</strong>：
SPI的数据读写端口；半双工读写。只有在“从被控设备读出数据”的情况下，<code>SDIO</code>
才会由被控制设备控制。</p>
<p><strong>SCLK</strong>：
SPI接口时钟；<mark style="font-weight: 900;">总是由主控制器生成和控制。</mark></p>
<h2 id="transmission-protocol">TRANSMISSION PROTOCOL</h2>
<p>跟其他通信类似，SPI 的 SDIO 需要在 时钟低电平时 进行电平跳变。</p>
<p>半双工SPI读写操作都包含两个字（byte），第一个字包含1 bit的
<strong>数据方向（或称 控制位）</strong> 和 7 bit的
<strong>地址</strong>，第二个字包含 <strong>数据</strong>。</p>
<h3 id="关于数据方向控制位">关于数据方向/控制位</h3>
<p>通常定义是，当需要写入数据时，控制位写 <code>1</code>
。当需要读出数据时，控制位写 <code>0</code> 。</p>
<p><img src="https://pic.islet.space/2022/04/image-20220118135819247.png" alt="image-20220118135819247" style="zoom: 50%;" /></p>
<p>但不一定所有支持半双工SPI的通信控制位都是在MSB，有可能是在 LSB 。</p>
<blockquote>
<p>如，下方右侧 SL8541E
的安卓平台主控，支持半双工SPI，但是其控制位就在地址字符的LSB上。</p>
<figure>
<img src="https://pic.islet.space/2022/04/image-20220419235450360.png"
alt="image-20220419235450360" />
<figcaption aria-hidden="true">image-20220419235450360</figcaption>
</figure>
</blockquote>
<h3 id="写操作">写操作</h3>
<p><mark style="font-weight:900;">主控制器在SCLK下降沿时改变
SDIO的电平，被控设备在SCLK上升沿时读取SDIO的电平。</mark></p>
<p><img src="https://pic.islet.space/2022/04/image-20220118140526017.png" alt="image-20220118140526017" style="zoom:50%;" /></p>
<h3 id="读取操作">读取操作</h3>
<blockquote>
<p>SDIO会在SCLK下降沿时修改，主控制器需要在SCLK的上升沿时读取SDIO的电平信息。</p>
</blockquote>
<p><strong>注意</strong>：发送完地址字
之后需要延长半个周期的时钟低电平。</p>
<p><img src="https://pic.islet.space/2022/04/image-20220118141033005.png" alt="image-20220118141033005" style="zoom:50%;" /></p>
<h1 id="timing-serial">Timing Serial</h1>
<p>因为芯片自带的时序图有些许错误，所以就自己画了一个。</p>
<p>时序图绘图工具（开源）：<a
target="_blank" rel="noopener" href="https://wavedrom.com/editor.html">WAVEDROM</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;signal: [</span><br><span class="line">    [&#39;CPOL&#x3D;1,CPHA&#x3D;1&#39;,</span><br><span class="line">    [&#39;Read&#39;,</span><br><span class="line">        [&#39;Control&#39;,</span><br><span class="line">            &#123;name: &#39;NCS&#39;, wave: &#39;hl................h&#39;&#125;,</span><br><span class="line">            &#123;name: &#39;SCLK&#39;, wave: &#39;hn.......lnn......h&#39;&#125;,</span><br><span class="line">        ],</span><br><span class="line">         &#123;name: &#39;SDIO&#39;, wave: &#39;102222222x222222221&#39;,data: [&quot;A6&quot;,&quot;A5&quot;,&quot;A4&quot;,&quot;A3&quot;,&quot;A2&quot;,&quot;A1&quot;,&quot;A0&quot;,&quot;D7&quot;,&quot;D6&quot;,&quot;D5&quot;,&quot;D4&quot;,&quot;D3&quot;,&quot;D2&quot;,&quot;D1&quot;,&quot;D0&quot;,]&#125;,</span><br><span class="line">	],</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">  	[&#39;Write&#39;,</span><br><span class="line">        [&#39;Control&#39;,</span><br><span class="line">            &#123;name: &#39;NCS&#39;, wave: &#39;hl...............h&#39;&#125;,</span><br><span class="line">            &#123;name: &#39;SCLK&#39;, wave: &#39;hn...............h&#39;&#125;,</span><br><span class="line">        ],</span><br><span class="line">        &#123;name: &#39;SDIO&#39;, wave: &#39;1.2222222222222221&#39;,data: [&quot;A6&quot;,&quot;A5&quot;,&quot;A4&quot;,&quot;A3&quot;,&quot;A2&quot;,&quot;A1&quot;,&quot;A0&quot;,&quot;D7&quot;,&quot;D6&quot;,&quot;D5&quot;,&quot;D4&quot;,&quot;D3&quot;,&quot;D2&quot;,&quot;D1&quot;,&quot;D0&quot;,]&#125;,</span><br><span class="line">	]</span><br><span class="line">],</span><br><span class="line">&#123;&#125;,</span><br><span class="line">    [&#39;CPOL&#x3D;1,CPHA&#x3D;0&#39;,</span><br><span class="line">    [&#39;Read&#39;,</span><br><span class="line">        [&#39;Control&#39;,</span><br><span class="line">            &#123;name: &#39;NCS&#39;, wave: &#39;hl................h&#39;&#125;,</span><br><span class="line">            &#123;name: &#39;SCLK&#39;, wave: &#39;hpp......lpp......h&#39;&#125;,</span><br><span class="line">        ],</span><br><span class="line">         &#123;name: &#39;SDIO&#39;, wave: &#39;102222222x222222221&#39;,data: [&quot;A6&quot;,&quot;A5&quot;,&quot;A4&quot;,&quot;A3&quot;,&quot;A2&quot;,&quot;A1&quot;,&quot;A0&quot;,&quot;D7&quot;,&quot;D6&quot;,&quot;D5&quot;,&quot;D4&quot;,&quot;D3&quot;,&quot;D2&quot;,&quot;D1&quot;,&quot;D0&quot;,],phase: 0.25&#125;,</span><br><span class="line">	],</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">  	[&#39;Write&#39;,</span><br><span class="line">        [&#39;Control&#39;,</span><br><span class="line">            &#123;name: &#39;NCS&#39;, wave: &#39;hl...............h&#39;&#125;,</span><br><span class="line">            &#123;name: &#39;SCLK&#39;, wave: &#39;hpp..............h&#39;&#125;,</span><br><span class="line">        ],</span><br><span class="line">         &#123;name: &#39;SDIO&#39;, wave: &#39;1.2222222222222221&#39;,data: [&quot;A6&quot;,&quot;A5&quot;,&quot;A4&quot;,&quot;A3&quot;,&quot;A2&quot;,&quot;A1&quot;,&quot;A0&quot;,&quot;D7&quot;,&quot;D6&quot;,&quot;D5&quot;,&quot;D4&quot;,&quot;D3&quot;,&quot;D2&quot;,&quot;D1&quot;,&quot;D0&quot;],phase: 0.25&#125;,</span><br><span class="line">	]</span><br><span class="line">],         </span><br><span class="line">     </span><br><span class="line">],</span><br><span class="line">config: &#123; hscale: 1 &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/04/image-20220423193121090.png"
alt="image-20220423193121090" />
<figcaption aria-hidden="true">image-20220423193121090</figcaption>
</figure>
<h1 id="debug-records">DEBUG RECORDS</h1>
<p>下面这个时序图错误的坑是真的大，调了好就才折腾明白。</p>
<p>某些芯片下，SDIO 的闲置状态可能不能是 <code>Hi-Z</code> 态。</p>
<h2 id="时序图错误">时序图错误</h2>
<p>内部调试时发现，SDIO在读取数据前后必须是
<strong>输出模式</strong>，最好 <strong>强制拉高</strong>，而不是
<code>Hi-Z</code> 态。</p>
<figure>
<img src="https://pic.islet.space/2022/04/image-20220419210753902.png"
alt="image-20220419210753902" />
<figcaption aria-hidden="true">image-20220419210753902</figcaption>
</figure>
<h2 id="读写单个字符">读写单个字符</h2>
<p>以下这两个函数中的 <code>for()</code> 使用了 MSB
发送数据，最好不要自作聪明将 <code>i</code> 的数据类型改为
<code>uint8_t</code>
或其他非负型数据，以下这种循环写法会让程序陷入死循环的。</p>
<p>另外，SPI 和 I2C
不一样，读取和写入的时序有较大差异。比如，I2C会在时钟高电平时读取电平数据，在低电平时改写电平数据。而
<code>CPOL = 1, CPHA = 1</code> 的SPI 会在上升沿时读取和写入数据，而
<code>CPOL = 1, CPHA = 0</code> 的 SPI会在下降沿时读取和写入数据。</p>
<p>主从设备必须将SPI特性保持一致，才能确保读写的稳定性。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief 写入8bit数据</span></span><br><span class="line"><span class="comment"> * @param &#123;uint8_t&#125; data</span></span><br><span class="line"><span class="comment"> * @return &#123;*&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write_byte</span><span class="params">(<span class="keyword">uint8_t</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">7</span>; i&gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>( (data &gt;&gt; i) &amp; <span class="number">0x01</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            write_high_level();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            write_low_level();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief 读取8bit数据</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125;</span></span><br><span class="line"><span class="comment"> * @return &#123;uint8_t&#125; data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">uint8_t</span> <span class="title">read_byte</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint8_t</span> data = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">7</span>; i&gt;= <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> (CPHA == 1)</span></span><br><span class="line">        SCLK_SET_LOW;</span><br><span class="line">        data |= HAL_GPIO_ReadPin(SPI_DATA_GPIO_Port, SPI_DATA_Pin) &lt;&lt; i;</span><br><span class="line">        delay_nop(LEVEL_DELAY_SLICES);</span><br><span class="line"></span><br><span class="line">        SCLK_SET_HIGH;</span><br><span class="line">        delay_nop(LEVEL_DELAY_SLICES);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">        </span><br><span class="line">        SCLK_SET_HIGH;</span><br><span class="line">        delay_nop(LEVEL_DELAY_SLICES);</span><br><span class="line">        SCLK_SET_LOW;</span><br><span class="line">        data |= HAL_GPIO_ReadPin(SPI_DATA_GPIO_Port, SPI_DATA_Pin) &lt;&lt; i;</span><br><span class="line">        delay_nop(LEVEL_DELAY_SLICES);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="stm32-spi-配置">STM32 SPI 配置</h2>
<p><img src="https://pic.islet.space/2022/08/202208241758385.png" alt="image-20220824175804976" style="zoom:50%;" /></p>
<figure>
<img src="https://pic.islet.space/2022/08/202208241800048.png"
alt="image-20220824175908055" />
<figcaption aria-hidden="true">image-20220824175908055</figcaption>
</figure>
<p>由外设SPI控制的 <code>SCLK</code> / <code>SDIO</code>
波形与手动控制的 <code>SNCS</code> 波形之间的矛盾。</p>
<figure>
<img src="https://pic.islet.space/2022/08/202208241759416.png"
alt="image-20220824175942791" />
<figcaption aria-hidden="true">image-20220824175942791</figcaption>
</figure>
<p><code>write_register(0x09, 0xA5)</code>，对应应该输出数据为
<code>0x89, 0xA5</code> ，而 <code>SNCS</code>
在两处地方产生了错误的波形。</p>
<figure>
<img src="https://pic.islet.space/2022/08/202208241800029.png"
alt="image-20220824175951156" />
<figcaption aria-hidden="true">image-20220824175951156</figcaption>
</figure>
<h1 id="source-code">SOURCE CODE</h1>
<p>以下是适用于 STM32 平台的 <strong>GPIO-模拟</strong>
<strong>半双工SPI</strong> 代码，利用
空指令进行延时控制，实现半双工（三线/两线）SPI 的通信。</p>
<p>需要软件适配以下几个功能：</p>
<ol type="1">
<li>控制精细度在 <span
class="math inline">\([10^{-9}s:10^{-6}s]\)</span> 之间的
<strong>精准延时</strong>（如果做不到，通信速率就上不去
<code>1MHz</code> ）。</li>
<li>控制引脚电平的宏定义（可选）。</li>
<li><strong>设置数据接口输出</strong> 和
<strong>设置数据接口输入</strong> 的代码。</li>
<li><strong>拉高电平</strong> 和 <strong>拉低电平</strong>
的代码，这里需要根据从设备特性来控制时钟的相位，即 <code>CPHA = 1</code>
或者 <code>CPHA = 0</code> 。</li>
<li>对照着 <strong>正确的时序图</strong> 写一遍
<strong>读单字符</strong> 和 <strong>写单字符</strong>
的代码，这里需要根据从设备特性来控制时钟的相位，即 <code>CPHA = 1</code>
或者 <code>CPHA = 0</code> 。</li>
<li>对照着 <strong>正确的时序图</strong> 写一遍
<strong>写寄存器</strong> 和 <strong>读寄存器</strong>
的代码，这里需要根据从设备特性来控制时钟的极性，决定时钟在闲时为高电平还是低电平，即
<code>CPOL = 1</code> 或者 <code>CPOL = 0</code> 。</li>
</ol>
<p><strong>注意</strong>：都是按顺序来完成的，所有后面的功能都需要依托于前面的功能来实现。而且，需要用示波器（有条件）进行测量以校准通信速率，并使用正确的时序图进行编码（如果是错误的，浪费时间，尽快跟厂家确认）。</p>
<p>代码部分可以参考 <a target="_blank" rel="noopener" href="https://gitee.com/isletspace/gmi">gmi</a>
中对 spi 的定义和使用。</p>
<h1 id="reference">REFERENCE</h1>
<ol type="1">
<li><a
target="_blank" rel="noopener" href="https://blog.csdn.net/sishuihuahua/article/details/105047926">实例解析非标准SPI</a></li>
<li><a
target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1486642">扩展SPI协议</a></li>
<li><a
target="_blank" rel="noopener" href="https://www.analog.com/cn/analog-dialogue/articles/introduction-to-spi-interface.html">SPI接口简介</a></li>
<li><a
target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/150121520">SPI通信协议详解（spi总线）</a></li>
<li><a
target="_blank" rel="noopener" href="http://www.microchip.com.cn/community/Uploads/Download/Library/39699a_cn.pdf">第23
章 串行外设接口(SPI)</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2022/01/11/Hardware/STM32/2022-01-11-%E5%85%89%E7%94%B5%E4%BC%A0%E6%84%9F%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/01/11/Hardware/STM32/2022-01-11-%E5%85%89%E7%94%B5%E4%BC%A0%E6%84%9F%E5%99%A8/" class="post-title-link" itemprop="url">Optical Sensor Development</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-01-11 14:30:00" itemprop="dateCreated datePublished" datetime="2022-01-11T14:30:00+08:00">2022-01-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-23 19:37:19" itemprop="dateModified" datetime="2022-01-23T19:37:19+08:00">2022-01-23</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/InternetOfThings/" itemprop="url" rel="index"><span itemprop="name">InternetOfThings</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="基础技能">基础技能</h1>
<ol type="1">
<li>ARM架构芯片的样例代码加载、编译、烧录、调试工作熟悉。</li>
<li>bitbucket
如何使用（是否需要配置SSH、repository如何pull和push、add、commit等）
√</li>
<li>confluence 如何使用（任务的查看、提交、文章的发布、协作等等）</li>
</ol>
<h1 id="ide-for-realtek">IDE for Realtek</h1>
<h2 id="vscode-arm">VSCODE ARM</h2>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112105541195.png"
alt="image-20220112105541195" />
<figcaption aria-hidden="true">image-20220112105541195</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112110410253.png"
alt="image-20220112110410253" />
<figcaption aria-hidden="true">image-20220112110410253</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112110533598.png"
alt="image-20220112110533598" />
<figcaption aria-hidden="true">image-20220112110533598</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112110507665.png"
alt="image-20220112110507665" />
<figcaption aria-hidden="true">image-20220112110507665</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112105734831.png"
alt="image-20220112105734831" />
<figcaption aria-hidden="true">image-20220112105734831</figcaption>
</figure>
<h2 id="keil-arm">KEIL ARM</h2>
<p>将Realtek RTL8762D
SDK中的项目单独摘出来，放到某个文件夹下进行管理时，需要单独更改好几处内容：</p>
<ol type="1">
<li>C/C++的Include Path</li>
<li>源文件的Source Path</li>
<li>APP Image（<code>.bin</code> 生成文件），即
<code>after_build_common.bat</code> 的路径和内容。</li>
</ol>
<p>如下所示，把单独某个Project摘出来时会产生很多感叹号。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112111951120.png"
alt="image-20220112111951120" />
<figcaption aria-hidden="true">image-20220112111951120</figcaption>
</figure>
<h3 id="头文件路径修改">头文件路径修改</h3>
<p>此时需要进入设置中进行头文件路径修改</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112133356533.png"
alt="image-20220112133356533" />
<figcaption aria-hidden="true">image-20220112133356533</figcaption>
</figure>
<p>选择 <code>C/C++</code> 选项卡下的 <code>Include Paths</code>
进行修改。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112133505056.png"
alt="image-20220112133505056" />
<figcaption aria-hidden="true">image-20220112133505056</figcaption>
</figure>
<p>原来的路径设置都是使用相对路径进行的，此时需要将
<code>sbee2-sdk-v1.0.0</code>
文件夹放到与你项目文件同盘的某个文件夹下，最好不要相距太远。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112133731688.png"
alt="image-20220112133731688" />
<figcaption aria-hidden="true">image-20220112133731688</figcaption>
</figure>
<p>可以使用 VS Code将 <code>.uvprojx</code>
文件打开，使用搜索和替换工具对相关头文件的路径进行替换。</p>
<h3 id="源文件路径修改">源文件路径修改</h3>
<p>修改方法同头文件，</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117094508419.png"
alt="image-20220117094508419" />
<figcaption aria-hidden="true">image-20220117094508419</figcaption>
</figure>
<h3 id="bat文件路径修改">bat文件路径修改</h3>
<p><code>.bat</code> 文件是用于在 <code>.o</code>
文件生成后的链接脚本。所以如果该脚本自身路径和脚本内的包含路径出错，可能会导致无法编译出对应的
<code>app_MP_adk#####</code> 文件。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117095506866.png"
alt="image-20220117095506866" />
<figcaption aria-hidden="true">image-20220117095506866</figcaption>
</figure>
<p>下方为样例代码原来的设置情况：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120134642405.png"
alt="image-20220120134642405" />
<figcaption aria-hidden="true">image-20220120134642405</figcaption>
</figure>
<p>在 <code>Option-User</code> 设置中，可以查看到
<code>After Build/Rebuild</code> 相关的设置，其中 <code>Run #1</code>
则是 Realtek MP Tools 需要烧录 EVB开发板相关的脚本文件。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117095438927.png"
alt="image-20220117095438927" />
<figcaption aria-hidden="true">image-20220117095438927</figcaption>
</figure>
<p>将单独摘放出来的项目文件夹 <code>pixart_i2c</code> 与
<code>sbee2-sdk-v1.0.0</code> 和
<code>sbee2_wristband_sdk_upperstack_img</code> 放到同一个文件夹下。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117110446703.png"
alt="image-20220117110446703" />
<figcaption aria-hidden="true">image-20220117110446703</figcaption>
</figure>
<p>因此修改 <code>.uvprojx</code> 文件内容下
<code>after_build_common.bat</code>
的路径时，将该路径修改为如下的相对路径即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">..\sbee2-sdk-v1.0.0\tool\after_build_common.bat <span class="variable">$J</span> <span class="comment">#L @L</span></span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117104943624.png"
alt="image-20220117104943624" />
<figcaption aria-hidden="true">image-20220117104943624</figcaption>
</figure>
<p>保存修改后的 <code>.uvprojx</code> 文件，可以看到 Keil V5
自动更新了相关设置。如下：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117104955125.png"
alt="image-20220117104955125" />
<figcaption aria-hidden="true">image-20220117104955125</figcaption>
</figure>
<p><code>after_build_common.bat</code> 控制着自动生成Realtek 的 MP Tool
需要使用的 APP Bin文件，如果该 <code>Run #1</code>
没有启用，则无法生产该文件。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117105247314.png"
alt="image-20220117105247314" />
<figcaption aria-hidden="true">image-20220117105247314</figcaption>
</figure>
<p>该<code>.bat</code> 文件下所有的 <code>..\..\..\tool\</code>
都要修改成
<code>..\sbee2-sdk-v1.0.0\tool\</code>，如果项目文件夹和SDK文件夹路径有异，则需要适当修改。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117105040885.png"
alt="image-20220117105040885" />
<figcaption aria-hidden="true">image-20220117105040885</figcaption>
</figure>
<p>启用完成之后即可生成对应 <code>app_MP_adk#####</code> 文件</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220117105414578.png"
alt="image-20220117105414578" />
<figcaption aria-hidden="true">image-20220117105414578</figcaption>
</figure>
<h1 id="hardwares">HARDWARES</h1>
<h2 id="adapter">ADAPTER</h2>
<h3 id="specification">SPECIFICATION</h3>
<p>A4芯片，即KA8G2芯片用的转接板需要接入5V电压，LDO会转换电压。</p>
<p>而PAT9126JA芯片则使用两个3.3V进行接入。</p>
<h2 id="chip-board">CHIP &amp; BOARD</h2>
<p>开发测试板为 Realtek RTL8762D EVB KIT。</p>
<p>型号： RTL8762DW</p>
<h2 id="sensor---ka8g2">SENSOR - KA8G2</h2>
<blockquote>
<p><strong><em>KAG2</em></strong> is a high performance and ultra low
power <strong><em>CMOS-processed optical image sensor</em></strong> with
<em>integrated digital image process circuits</em>. It is based on an
optical navigation technology which measures changes in position by
optically acquiring sequential surface images(frames) and mathematically
determining the speed, the direction and the magnitude of motion.
<strong><em>The displacement delta_X and delta_Y information are
available in registers which are accessible through SPI serial
interface.</em></strong> A host controller reads and translates the data
from the SPI serial interface into RF signals before sending them to the
host PC.</p>
</blockquote>
<h3 id="specification-1">SPECIFICATION</h3>
<p><img src="https://pic.islet.space/2022/01/image-20220113150323525.png" alt="image-20220113150323525" style="zoom:50%;" /></p>
<h3 id="hardware-linking">HARDWARE LINKING</h3>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112172532934.png"
alt="image-20220112172532934" />
<figcaption aria-hidden="true">image-20220112172532934</figcaption>
</figure>
<figure>
<img
src="https://pic.islet.space/2022/01/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16391255852712.png"
alt="企业微信截图_16391255852712" />
<figcaption aria-hidden="true">企业微信截图_16391255852712</figcaption>
</figure>
<h3 id="chip-initiate">CHIP INITIATE</h3>
<p>这个芯片启动时，需要对一些寄存器进行写入以初始化。下方为二维数组，<code>sensor_init_regs[][0]</code>
为寄存器地址，<code>sensor_init_regs[][1]</code>
为寄存器需要写入的数据。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint8_t</span> sensor_init_regs[<span class="number">7</span>][<span class="number">2</span>] = &#123;</span><br><span class="line">	&#123;<span class="number">0X09</span>, <span class="number">0XA5</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X26</span>, <span class="number">0X34</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X19</span>, <span class="number">0X04</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X6D</span>, <span class="number">0X39</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X0D</span>, <span class="number">0X20</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X0E</span>, <span class="number">0X20</span>&#125;,</span><br><span class="line">	&#123;<span class="number">0X09</span>, <span class="number">0X00</span>&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>初始化时，需要注意以下问题：</p>
<ol type="1">
<li>某些主控芯片在使用两线SPI进行数据写入时，会有要求使用
<code>7bit</code> 地址，且 MSB 为 <code>1</code>
。此时需要判断是否需要认为修改地址的 MSB为 <code>1</code> ，例如 Realtek
的 RTL8762DW
芯片就不需要人为修改，人为修改会导致波形异常。而某些芯片需要人为写入MSB。</li>
<li>在每一次写入寄存器之后，<mark style="font-weight: 900;">强烈建议进行延时</mark>，可以使用
<code>delay(0xFFFF)</code>，（尝试过 <code>0xFF</code>
太短，不能完成初始化写入）。</li>
</ol>
<h2 id="sensor---pat9126ja">SENSOR - PAT9126JA</h2>
<ol type="1">
<li>需要确定 <code>ID_SEL</code>
引脚的连接情况，是拉高、接地还是悬空。分别对应的 <code>CHIP ID</code>
都是不一样的，可能是<code>0x73</code>  <code>0x75</code>
 <code>0x79</code> 三者之一。</li>
</ol>
<p>transformer 上的 <code>VCC</code> 为 <code>3.3V</code></p>
<h3 id="specification-2">SPECIFICATION</h3>
<p>这个芯片有两种电压要求，默认为高电压版本 <code>3.3V</code>
，可以通过SPI写入寄存器和硬件并线来达到降低至 <code>1.8V</code>
低电压的模式。</p>
<h3 id="hadware-linking">HADWARE LINKING</h3>
<figure>
<img src="https://pic.islet.space/2022/01/OpticalSensorTransfer_I2C.png"
alt="OpticalSensorTransfer_I2C" />
<figcaption aria-hidden="true">OpticalSensorTransfer_I2C</figcaption>
</figure>
<h1 id="sdk-tools">SDK &amp; Tools</h1>
<p>此处有 2个SDK包 和 3个tool包，分别是：</p>
<ol type="1">
<li><a
target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/sbee2-sdk-v1.0.0.zip">sbee2-sdk-v1.0.0.zip</a></li>
<li><a
target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/sbee2_wristband_sdk_upperstack_img.zip">sbee2_wristband_sdk_upperstack_img.zip</a></li>
<li><a
target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/MPPackTool_v2.0.5.2.zip">MPPackTool_v2.0.5.2.zip</a></li>
<li>日志输出软件：<a
target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/DebugAnalyzer-v4.0.0.14.zip">DebugAnalyzer-v4.0.0.14.zip</a></li>
<li>代码烧录软件：<a
target="_blank" rel="noopener" href="https://storage.islet.space/07_Mixosense/01_Realtek/RTL8762D/SDK/BeeMPTool_kits_v1.0.5.0.zip">BeeMPTool_kits_v1.0.5.0.zip</a></li>
</ol>
<h1 id="build-flash-log">BUILD / FLASH / LOG</h1>
<h2 id="build">BUILD</h2>
<p>点击 <code>build</code> 按钮即可进行代码构建。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113090856565.png"
alt="image-20220113090856565" />
<figcaption aria-hidden="true">image-20220113090856565</figcaption>
</figure>
<p><code>build</code> 完毕之后可以看到下方的成功提示
<code>0 Error(s), 0 Warning(s)</code>。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113091008941.png"
alt="image-20220113091008941" />
<figcaption aria-hidden="true">image-20220113091008941</figcaption>
</figure>
<h2 id="flash">FLASH</h2>
<p>FLAHS需要经过 configuration 、 detect 和 download 三步</p>
<h3 id="configuration">configuration</h3>
<p>根据《RTL8762D SDK User Guide CN》文件，RTL8762D 的 EVB KIT
是可以支持 JLINK 的（如下图所示）。</p>
<p><img src="https://pic.islet.space/2022/01/image-20220113095321215.png" alt="image-20220113095321215" style="zoom:50%;" /></p>
<p>但这里并未使用 JLINK，而是使用 Realtek 专门的工具
<code>BeeMPTool_kits</code>， 通过 <code>UART</code> 进行烧录。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113095804076.png"
alt="image-20220113095804076" />
<figcaption aria-hidden="true">image-20220113095804076</figcaption>
</figure>
<p>打开 <code>MPTool.exe</code> ，并选中对应的芯片型号
<code>RTL8762D</code> ：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113095854784.png"
alt="image-20220113095854784" />
<figcaption aria-hidden="true">image-20220113095854784</figcaption>
</figure>
<p>在这里选择 <code>调试</code> 模式进行烧录</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113095949881.png"
alt="image-20220113095949881" />
<figcaption aria-hidden="true">image-20220113095949881</figcaption>
</figure>
<p>在 <code>Config Set</code> 中选择 <code>Confirm</code>
，不需要修改什么东西。</p>
<p><img src="https://pic.islet.space/2022/01/image-20220113100100098.png" alt="image-20220113100100098" style="zoom:50%;" /></p>
<p>此处需要设置 Flash 地址映射文件 <code>flash map.ini</code> 。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113100324900.png"
alt="image-20220113100324900" />
<figcaption aria-hidden="true">image-20220113100324900</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113101953154.png"
alt="image-20220113101953154" />
<figcaption aria-hidden="true">image-20220113101953154</figcaption>
</figure>
<p>下方为 《RTL8762D SDK User Guide
CN》文件中，9.1章节对五个images文件进行了描述。</p>
<p><img src="https://pic.islet.space/2022/01/image-20220113102036834.png" alt="image-20220113102036834" style="zoom:67%;" /></p>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 32%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="header">
<th>FILE TYPE</th>
<th>DESCRIPTION</th>
<th>FILE PATH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>System Config File</td>
<td>- 来自 <code>BeeMPTool_kits</code></td>
<td><code>\BeeMPTool_kits_v1.0.5.0\BeeMPTool\ConfigFile\</code></td>
</tr>
<tr class="even">
<td>Bank0 OTA Header File</td>
<td>- 来自 <code>sbee2_wristband_sdk_upperstack_img</code></td>
<td><code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\</code></td>
</tr>
<tr class="odd">
<td>Bank0 Secure Boot Loader Image</td>
<td>- 来自 <code>sbee2_wristband_sdk_upperstack_img</code></td>
<td><code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\</code></td>
</tr>
<tr class="even">
<td>Bank0 ROM Patch Image</td>
<td>- 来自 <code>sbee2_wristband_sdk_upperstack_img</code></td>
<td><code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\</code></td>
</tr>
<tr class="odd">
<td>Bank0 APP Image</td>
<td>- 来自 <code>sbee2-sdk-v1.0.0</code></td>
<td><code>sbee2-sdk-v1.0.0\board\evb\io_sample\SPI3WIRE\spi3wire_polling\bin</code></td>
</tr>
</tbody>
</table>
<h4 id="关于app-image文件选择">关于app image文件选择</h4>
<p>在Build完成后，会生成三个 <code>.bin</code>
文件，如果选择错误，会提示
<code>MD5 check error!Image type doesn't match IC type.</code>
，选择正确的话会提示 <code>File check OK</code> 。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113111301561.png"
alt="image-20220113111301561" />
<figcaption aria-hidden="true">image-20220113111301561</figcaption>
</figure>
<h3 id="detect">detect</h3>
<p>detect 的时候需要注意：</p>
<ol type="1">
<li>将 EVB kit上的 <code>J15</code> LOG口接地，否则会检测失败</li>
<li>如果出现 <code>Failed</code> 字样，则按一下 EVB KIT 上的红色的
<code>RESET</code> 按钮进行复位后再尝试。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113111054035.png"
alt="image-20220113111054035" />
<figcaption aria-hidden="true">image-20220113111054035</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113103853161.png"
alt="image-20220113103853161" />
<figcaption aria-hidden="true">image-20220113103853161</figcaption>
</figure>
<h3 id="download">download</h3>
<p>最后选择 <code>download</code> 下载即可。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113104047601.png"
alt="image-20220113104047601" />
<figcaption aria-hidden="true">image-20220113104047601</figcaption>
</figure>
<h2 id="upperstack-flash">UPPERSTACK FLASH</h2>
<p>自带的 <code>\sbee2-sdk-v1.0.0\doc\</code> 路径下的教程是，都是有
<code>Bank0 Upperstack Image</code> 需要烧录的。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120140307997.png"
alt="image-20220120140307997" />
<figcaption aria-hidden="true">image-20220120140307997</figcaption>
</figure>
<p>步骤如下：</p>
<ol type="1">
<li><p>使用
<code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\upperstack_img</code>
路径下的 <code>.ini</code> 文件作为 layout
文件。（而之前使用的<code>flash map.ini</code> 地址为
<code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\</code>）</p></li>
<li><p>指定
<code>\sbee2_wristband_sdk_upperstack_img\src\app\wristband\firmware\upperstack_img</code>
路径下的 <code>.bin</code> 文件作为 Upperstack Image 文件。</p></li>
<li><p>将
<code>\sbee2_wristband_sdk_upperstack_img\board\evb_stack_img\wristband\flash_map.h</code>
文件作为项目工程里的唯一内存映射文件依赖。<code>flash_map.h</code>
被放在 <code>mem_config.h</code> 头文件下，间接被
<code>syetem_rtl876x.h</code> 引用。</p></li>
</ol>
<h2 id="log">LOG</h2>
<p>RTL8762D 的 EVB KIT 不支持 JTAG
方式进行观察，（听说是）通信过程容易被打断。</p>
<p>这里使用 <code>UART</code> 和 EVB KIT 上的 <code>J15</code> 口来观察
LOG数据。</p>
<h3 id="log软件">LOG软件</h3>
<p>使用专用工具 <code>DebugAnalyzer</code> 进行日志输出。</p>
<ol type="1">
<li>选择合适的串口，即使用 <code>FT232</code> 的UART口，将该芯片口的
<code>RX</code> 连接至 <code>RTL8762D</code> 板子上的 <code>J15</code>
口。并在电脑中选中对应的 <code>FT232</code> 设备。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113093030488.png"
alt="image-20220113093030488" />
<figcaption aria-hidden="true">image-20220113093030488</figcaption>
</figure>
<ol start="2" type="1">
<li>需要设置 <code>App Trace File</code> 。</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113093723962.png"
alt="image-20220113093723962" />
<figcaption aria-hidden="true">image-20220113093723962</figcaption>
</figure>
<ol start="3" type="1">
<li>观察日志输出</li>
</ol>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113104331739.png"
alt="image-20220113104331739" />
<figcaption aria-hidden="true">image-20220113104331739</figcaption>
</figure>
<h1 id="com-setting">COM SETTING</h1>
<h2 id="uart-setting">UART SETTING</h2>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220113111953878.png"
alt="image-20220113111953878" />
<figcaption aria-hidden="true">image-20220113111953878</figcaption>
</figure>
<h1 id="peripheral">PERIPHERAL</h1>
<h1 id="wired-spi">3-WIRED SPI</h1>
<p>以下是主控板 RTL8762D 的SDK对3线SPI的相关设置结构体。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_SysClock;     <span class="comment">/*!&lt; Specifies system clock */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_Speed;        <span class="comment">/*!&lt; Specifies SPI clock. */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_Mode;         <span class="comment">/*!&lt; Specifies SPI operation mode.</span></span><br><span class="line"><span class="comment">                                This parameter can be a value of @ref THREE_WIRE_SPI_mode */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_ReadDelay;    <span class="comment">/*!&lt; Specifies the delay time from the end of address phase to the start of read data phase.</span></span><br><span class="line"><span class="comment">                                    This parameter can be a value of 0x0 to 0x1f, delay time = (SPI3WIRE_ReadDelay+1)/(2*SPI3WIRE_Speed) */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_OutputDelay;  <span class="comment">/*!&lt; Specifies SPI output delay 1T or not.</span></span><br><span class="line"><span class="comment">                                 This parameter can be a value of @ref THREE_WIRE_SPI_OE_delay_config */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint32_t</span> SPI3WIRE_ExtMode;      <span class="comment">/*!&lt; Specifies extended timing window for SPI output enable = 0. */</span></span><br><span class="line">&#125; SPI3WIRE_InitTypeDef;</span><br></pre></td></tr></table></figure>
<h2 id="writing-delay">WRITING-DELAY</h2>
<p><span class="math display">\[
1s = 1^3ms = 1^6us = 1^9ns\\
1Hz = 1^{-3}KHz = 1^{-6}MHz = 1^{-9}GHz
\]</span></p>
<p>在3线SPI的数据线读取过程中，在前一段地址帧结束且尚未开始读取数据前，会有一段延时。由
<code>spiReadDelay</code> 和 <code>spiWireSpeed</code> 两个参数控制。
<span class="math display">\[
DelayTime = (spiReadDelay +1) / (2* spiWireSpeed)
\tag{延时计算公式}
\]</span> 例如， 当 <code>spiWireSpeed = 8e5</code> 时， 设置
<code>spiReadDelay = 0x03</code> ，此时 可以在中间延时
<code>2.5us</code> 。</p>
<h2 id="clock_freq">CLOCK_FREQ</h2>
<p>将RTL8762D的SPI通信时钟频率从 <code>2E7</code> 更改为
<code>1E6</code>
后可以短时间正常通信，但是稍微过一段时间就出现了不稳定，度数全为
<code>0</code> ，且复位后读取的 <code>chipID</code> 也为
<code>0x00, 0x00</code> 。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the actual frequency of spi is set by `SPI3_WIRE_SysClock`</span></span><br><span class="line"><span class="comment">// `1E6` means 1MHz, and `2E7` means 20MHz.</span></span><br><span class="line">SPI3WIRE_InitStruct.SPI3WIRE_SysClock       = <span class="number">1E6</span>;</span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220119152741283.png"
alt="image-20220119152741283" />
<figcaption aria-hidden="true">image-20220119152741283</figcaption>
</figure>
<h2 id="timing">TIMING</h2>
<p><span class="math display">\[
Sysclk = 1e7 \\
wirespeek = 8e5
\]</span></p>
<h1 id="wired-spi-1">2-WIRED SPI</h1>
<blockquote>
<p>To recover the correct communication of SPI, the host controller can
de-assert the SCLK for at least tRESYNC (1us min), and then keep SCLK
asserted for a certain time interval tWDT (1.7ms, min) as shown in below
Figure . to force the SPI control circuits of the sensor to reset.</p>
</blockquote>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120154724619.png"
alt="image-20220120154724619" />
<figcaption aria-hidden="true">image-20220120154724619</figcaption>
</figure>
<h1 id="debug-records">DEBUG RECORDS</h1>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220112163300158.png"
alt="image-20220112163300158" />
<figcaption aria-hidden="true">image-20220112163300158</figcaption>
</figure>
<p>0x05 // 0000 0101</p>
<p>// 1000 0101</p>
<h2 id="delta_x-delta_y-unread">DELTA_X &amp; DELTA_Y UNREAD</h2>
<p><code>Motion</code>  <code>DYOVF</code>  <code>DXOVF</code>
并未读出，未检测到移动。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114110802052.png"
alt="image-20220114110802052" />
<figcaption aria-hidden="true">image-20220114110802052</figcaption>
</figure>
<p><code>Operation_Mode = 0xB8, cofiguration = 0x17</code> 均为默认</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114111325286.png"
alt="image-20220114111325286" />
<figcaption aria-hidden="true">image-20220114111325286</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114111114776.png"
alt="image-20220114111114776" />
<figcaption aria-hidden="true">image-20220114111114776</figcaption>
</figure>
<p><code>0xB8</code> 使
设备处于睡眠模式，<code>configuration = 0x17</code> 使设备未处于
<code>sleep3</code> 且 <code>powerDown</code> 为正常模式，即未断电。</p>
<p>所以需要修改 <code>Operation_Mode</code> 为 <code>0x01</code> 。</p>
<p>在设置了下方的语句之后，LOG记录传送回来的 <code>OperationMode</code>
对应的数据为 <code>0xFC</code> 或 <code>0xB8</code> （
<code>1111 1100</code> 和 <code>1011 1000</code>） 。</p>
<p>默认情况下 <code>OperationMode</code> 为 <code>0xB8</code> 即
<code>1011 1000</code> 。</p>
<p>异常情况下 <code>OperationMode</code> 为 <code>0xFC</code> 即
<code>1111 1100</code> 。</p>
<p>即第 <code>2</code> 位和 第 <code>6</code>
位会变，查数据手册，<mark>只有第 <code>2</code>
位（<code>Slp2mu_Enh</code>）有影响，该位控制芯片强制进入
<code>睡眠2</code> 模式。</mark></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spi3wire_writebyte(REG_KA8G2_OPERATION_MODE, KA8G2_OM_RUN);  <span class="comment">// edited by liew in 20211114</span></span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114135400211.png"
alt="image-20220114135400211" />
<figcaption aria-hidden="true">image-20220114135400211</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220114135647079.png"
alt="image-20220114135647079" />
<figcaption aria-hidden="true">image-20220114135647079</figcaption>
</figure>
<p>从《KA8G2 optical mouse sensor》中的 <strong>MOTION Pin
Function</strong> 可以看出，<code>Motion</code>
寄存器即运动检测标志相关寄存器。</p>
<p><img src="https://pic.islet.space/2022/01/image-20220114142319440.png" alt="image-20220114142319440" style="zoom:50%;" /></p>
<h2 id="主控板io口数据异常">主控板IO口数据异常</h2>
<p>下方为利用SDK进行 <strong>读数据</strong> 的相关操作：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="keyword">uint32_t</span> random_seed_value;</span><br><span class="line">    srand(random_seed_value);</span><br><span class="line">    spi3wire_demo();</span><br><span class="line">	DBG_DIRECT(<span class="string">&quot;TEST_20220120&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">uint8_t</span> i = <span class="number">0</span>; i&lt; <span class="number">0xFF</span>; i++)&#123;	</span><br><span class="line">			spi3wire_writebyte(<span class="number">0x7F</span>, i);</span><br><span class="line">			delaySys(<span class="number">0xF</span>);</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并用逻辑分析仪进行捕获和分析，发现数据异常：</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120151632286.png"
alt="image-20220120151632286" />
<figcaption aria-hidden="true">image-20220120151632286</figcaption>
</figure>
<p>经过检查，发现时序解码无误，所有波形的高低和解码结果一致。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120151645002.png"
alt="image-20220120151645002" />
<figcaption aria-hidden="true">image-20220120151645002</figcaption>
</figure>
<p>但是相连的数据之间数据差异较大。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120151638254.png"
alt="image-20220120151638254" />
<figcaption aria-hidden="true">image-20220120151638254</figcaption>
</figure>
<p>查看LOG也发现数据的确有按照预定的逻辑进行循环：</p>
<figure>
<img src="https://pic.islet.space/2022/01/20220120.png"
alt="20220120" />
<figcaption aria-hidden="true">20220120</figcaption>
</figure>
<p>但是逻辑分析仪采出来的数据就是异常。</p>
<p>经过分析，是因为逻辑分析仪的采样率为 <code>1MHz</code>
，与SPI外设的频率 <code>1e6</code> 一致。</p>
<p>修改了逻辑分析仪的采样率为 <code>2MHz</code>
，提高了1倍，采样出来的逻辑就正常了。</p>
<figure>
<img src="https://pic.islet.space/2022/01/image-20220120162227888.png"
alt="image-20220120162227888" />
<figcaption aria-hidden="true">image-20220120162227888</figcaption>
</figure>
<p>但是之前的项目只用了写数据的函数。示波器波形和逻辑分析仪都能正常。</p>
<p>改了项目主循环中的语句为读数据之后，就出现异常了。</p>
<h3 id="问题推断">问题推断</h3>
<p>通过注释部分语句，进行间歇性测试和波形观察。</p>
<p>发现，spi读取语句
<code>uint8_t spi3wire_readbyte(uint8_t address)</code>
可能是波形不正常的原因。</p>
<p>硬件查找主控板和底板的引脚问题：</p>
<ol type="1">
<li>找到扩展板上的GPIO口对应核心板上的哪个口</li>
<li>使用示波器探头直接接触对应的GPIO口并查看波形，查看主控板和底板之间是否存在问题。</li>
</ol>
<p>发现示波器探头从底板更换至主控板之后，示波器所显示波形并无差异。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/12/27/Hardware/ESP32/2021-12-27-islet%E5%AE%B6%E5%BA%AD%E7%89%A9%E8%81%94%E7%BD%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/27/Hardware/ESP32/2021-12-27-islet%E5%AE%B6%E5%BA%AD%E7%89%A9%E8%81%94%E7%BD%91/" class="post-title-link" itemprop="url">islet家庭物联网</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-12-27 19:40:00" itemprop="dateCreated datePublished" datetime="2021-12-27T19:40:00+08:00">2021-12-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-02-24 19:41:26" itemprop="dateModified" datetime="2022-02-24T19:41:26+08:00">2022-02-24</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/InternetOfThings/" itemprop="url" rel="index"><span itemprop="name">InternetOfThings</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>GITEE</strong>: https://gitee.com/isletspace/esp32iot</p>
<p>本项目是使用
<strong>微信小程序</strong>+<strong>腾讯云</strong>+<strong>乐鑫开发板</strong>+<strong>5V-多路-继电器</strong>+<strong>220V-AC-电器</strong>
的模式对家庭中的硬件进行检测和控制，本项目涉及到
<strong>网络前端</strong>、<strong>服务器后端</strong>、<strong>网络通信</strong>
和 <strong>物联网硬件控制</strong> 方面的相关知识。</p>
<p><strong>需要实现的功能</strong>：</p>
<ol type="1">
<li>开发板能够自动连接家庭WiFi</li>
<li>开发板能够通过MQTT协议与后台服务器取得联系</li>
<li>开发板能够定时自动获取时钟并校准</li>
<li>开发板能够根据MQTT协议控制外围电路</li>
<li>开发板能够根据已经设置的参数与实时的传感器参数比对，并在一定环境条件内开启/关闭相关电路</li>
<li>手机可以通过微信小程序发送MQTT数据至服务器</li>
</ol>
<p><strong>软件开发平台</strong>：Mac</p>
<p><strong>硬件开发IDE</strong>：Arduino</p>
<h1 id="硬件准备">硬件准备</h1>
<ol type="1">
<li>4路5V红板（光耦/高低电平）继电器 *1</li>
<li>DHT11温度模块 *2</li>
<li>加热器 *1</li>
<li>ESP32-WROOM-32开发板 *1</li>
</ol>
<p>其他：</p>
<ol type="1">
<li>杜邦线</li>
<li>电烙铁</li>
<li>锡丝</li>
<li>松香</li>
<li>面包板</li>
</ol>
<h2 id="芯片模组比对选型">芯片模组比对选型</h2>
<p>ESP32-WROOM-32X（此处 <code>X</code> 代表不确定） 和
ESP32-WROVER-X（此处 <code>X</code> 代表不确定）
在性能上基本一模一样，包括核心数、最大时钟频率、Flash大小、支持的接口类型
和 特殊传感器等等。除了在 PSRAM、工作温度范围、天线、WiFi最高频率 和
模组尺寸上有所区别外。 ESP32-WROVER-X 则具有PSRAM 和 最大的面积（18mm ×
31.4mm × 3.3mm）。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228014701607.png"
alt="官方展示的ESP32模组性能参数对比" />
<figcaption
aria-hidden="true">官方展示的ESP32模组性能参数对比</figcaption>
</figure>
<h2 id="芯片选型">芯片选型</h2>
<p>无脑选了ESP32-WROOM-32SE，反正自己用，而且便宜（￥21.5包邮）。</p>
<h2 id="芯片基本信息">芯片基本信息</h2>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228012555509.png"
alt="Arduino所展示的开发板可调参数" />
<figcaption
aria-hidden="true">Arduino所展示的开发板可调参数</figcaption>
</figure>
<h1 id="arduino-ide准备">Arduino IDE准备</h1>
<p>使用 Arduino IDE 进行开发，但开发配置相关的 <code>.json</code> 文件
及其安装包都在 <code>github.com</code>
上，但因为加速器的加速层级可能和IDE拉取资源包所用的数据层级不在同一个上面，无法代理，就白天基本上无法下载，凌晨（正经程序员谁tm熬夜）才有机会下载东西。</p>
<blockquote>
<p>英文版下的 <code>首选项</code> 是 <code>Preferences</code> 。</p>
</blockquote>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228011905234.png"
alt="修改附加开发板管理网址" />
<figcaption aria-hidden="true">修改附加开发板管理网址</figcaption>
</figure>
<p>然后去 <code>开发板管理器</code> 中搜索 <code>esp32</code>
进行安装。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228012156101.png"
alt="目录-开发板-开发板管理器" />
<figcaption aria-hidden="true">目录-开发板-开发板管理器</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228012244049.png"
alt="搜索关键词“esp32”" />
<figcaption aria-hidden="true">搜索关键词“esp32”</figcaption>
</figure>
<h2 id="解决github问题">解决github问题</h2>
<h3 id="方法一">方法一</h3>
<p>本来应该用如下链接进行配置的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://dl.espressif.com/dl/package_esp32_index.json </span><br></pre></td></tr></table></figure>
<p>自己扒拉了一遍该文件中可能包含的所有资源包（主要是
<code>github.com</code> 上的），然后修改了 <code>.json</code>
文件，放到自己的桶里，然后放出来使用，还好这个文件里有明确提到要哪些资源不然也没法扒拉。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://code.islet.space/espressif/dl/package_esp32_index.json</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：Mac系统下可能会因为曾经下载过的缓存文件无法生效（如果自行修改了网站上的
<code>.json</code> 文件的话），需要自行清除缓存，打开
<code>~/Library/ArduinoXX/cache/</code> 并对应删除该网站的文件夹即可，如
<code>code.islet.space</code> 。（这里的 <code>ArduinoXX</code> 中的
<code>XX</code> 需要自己去看自己的文件夹，应该是受版本控制的）</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228005455101.png"
alt="修改链接后可以正常下载" />
<figcaption aria-hidden="true">修改链接后可以正常下载</figcaption>
</figure>
<h3 id="方法二">方法二</h3>
<p>自己去github，用浏览器或者下载器下好了以后放到
<code>用户目录--资源库--程序缓存--指定位置</code>（如下）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&#x2F;Library&#x2F;ArduinoXX&#x2F;staging&#x2F;packages&#x2F;</span><br></pre></td></tr></table></figure>
<p>这个文件夹也就需要放这么多文件吧。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228012028024.png"
alt="资源库缓存指定位置下的文件" />
<figcaption aria-hidden="true">资源库缓存指定位置下的文件</figcaption>
</figure>
<p>亲测，第二种方法更好用。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228011814461.png"
alt="提示安装成功" />
<figcaption aria-hidden="true">提示安装成功</figcaption>
</figure>
<h1 id="visual-studio-code-ide准备">Visual Studio Code IDE准备</h1>
<p>总的来说，VS Code的IDE配置会比Arduino更为复杂，VS
Code下载毫无压力，且VS Code使用习惯之后更加方便。</p>
<p>至少前期配置工作来说，VS Code更为友好。</p>
<h2 id="espressif-idf插件安装">Espressif IDF插件安装</h2>
<p>首先去插件市场搜索 <code>Espressif IDF</code> 插件进行安装，然后点击
<code>查看</code> -&gt; <code>命令面板</code>。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228182209737.png"
alt="image-20211228182209737" />
<figcaption aria-hidden="true">image-20211228182209737</figcaption>
</figure>
<p>到这里需要输入 <code>configure esp-idf extension</code>
以进入该插件的配置页面。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228182314161.png"
alt="image-20211228182314161" />
<figcaption aria-hidden="true">image-20211228182314161</figcaption>
</figure>
<h2 id="必要工具安装">必要工具安装</h2>
<p>然后它就会提示你需要安装几个必要插件，有 Git / Python / CMake 和
Ninja。这些都可以从Espressif的 <a
target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/get-started/index.html">官方文档</a>
中获取到安装步骤。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228182508965.png"
alt="image-20211228182508965" />
<figcaption aria-hidden="true">image-20211228182508965</figcaption>
</figure>
<p>下方为四个工具的官方下载链接，前三个都可以通过官方下载软件包进行安装，第四个
Ninja 我安装不成功，是通过 Mac Ports 进行安装的。</p>
<p>GIT : https://git-scm.com/</p>
<p>PYTHON : https://www.python.org/downloads/</p>
<p>CMAKE : https://cmake.org/download/</p>
<p>NINJA : https://github.com/ninja-build/ninja/releases</p>
<p>需要注意的是，CMAKE 和 Ninja 安装完还需要加入到系统环境变量
<code>PATH</code> 中去，Windows系统下的系统环境变量添加比较方便，下方为
Mac 系统下 CMake 的系统环境变量添加方法。</p>
<h3 id="cmake命令行">CMAKE命令行</h3>
<p>打开Mac系统下的 CMake GUI，点击 <code>Tools</code> --&gt;
<code>How to Install For Command Line Use</code> ，可以查看到三种将
CMake 添加到命令行中去运行的方法。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228183126458.png"
alt="点击“工具”菜单中的“如何为命令行使用进行安装”" />
<figcaption
aria-hidden="true">点击“工具”菜单中的“如何为命令行使用进行安装”</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228183411724.png"
alt="可以查看到三种安装方法" />
<figcaption aria-hidden="true">可以查看到三种安装方法</figcaption>
</figure>
<p>使用的是第二种方法，向命令行输入
<code>sudo "/Applications/CMake.app/Contents/bin/cmake-gui" --install</code>
并输入管理员密码即可。</p>
<p>然后通过 <code>cmake --version</code>
可以查看到版本号说明安装成功，但需要注意的是 <code>whereis cmake</code>
还是没有用。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228183403876.png"
alt="操作结果" />
<figcaption aria-hidden="true">操作结果</figcaption>
</figure>
<h3 id="工具安装验证">工具安装验证</h3>
<p>四个必须要安装的软件都已经安装完毕，通过 <code>--version</code>
可以查看版本号。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228184801497.png"
alt="安装验证" />
<figcaption aria-hidden="true">安装验证</figcaption>
</figure>
<h2 id="配置继续">配置继续</h2>
<p>四个必要工具安装完毕之后，关闭 <code>ESP-IDF Setup</code>
页面，然后重新在 <strong>命令面板</strong> 输入
<code>configure esp-idf extension</code> 以进入该插件的配置页面。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228184938407.png"
alt="再次进入配置页面" />
<figcaption aria-hidden="true">再次进入配置页面</figcaption>
</figure>
<p>此处选择 <code>EXPRESS</code>
即可，里面会要求选择从哪个服务器下载（自己看情况选择<code>Github</code>
/
<code>Espressif</code>）、IDF版本（默认选最新）、IDF放置路径、工具路径、使用的Python3路径
等几个信息，选完了就进入下一界面，会自动下载安装 ESP-IDF。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228185458736.png"
alt="详细配置页面" />
<figcaption aria-hidden="true">详细配置页面</figcaption>
</figure>
<p>耐心等待下载完毕即可，我用 <code>Espressif</code>
服务器下载不下来，然后改用 <code>Github</code> 进行下载的。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228185748221.png"
alt="image-20211228185748221" />
<figcaption aria-hidden="true">image-20211228185748221</figcaption>
</figure>
<p>下载过程页面如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190058612.png"
alt="image-20211228190058612" />
<figcaption aria-hidden="true">image-20211228190058612</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190027057.png"
alt="image-20211228190027057" />
<figcaption aria-hidden="true">image-20211228190027057</figcaption>
</figure>
<p>最后提示的安装成功：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190438498.png"
alt="image-20211228190438498" />
<figcaption aria-hidden="true">image-20211228190438498</figcaption>
</figure>
<h1 id="示例项目载入">示例项目载入</h1>
<p>在 <strong>命令面板</strong> 中输入
<code>show examples projects</code> 。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190651117.png"
alt="image-20211228190651117" />
<figcaption aria-hidden="true">image-20211228190651117</figcaption>
</figure>
<p>即可调出 ESP-IDF的示例代码项目列表。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190738993.png"
alt="image-20211228190738993" />
<figcaption aria-hidden="true">image-20211228190738993</figcaption>
</figure>
<p>选择 <code>blink</code> 作为测试代码。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228190839371.png"
alt="image-20211228190839371" />
<figcaption aria-hidden="true">image-20211228190839371</figcaption>
</figure>
<h2 id="项目构建">项目构建</h2>
<p>这里可以用命令面板输入 <code>esp build your project</code>
，也可以点击GUI下方的 <img
src="https://pic.islet.space/2021/12/image-20211231124940242.png"
alt="image-20211231124940242" />进行构建。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228191057987.png"
alt="命令面板构建" />
<figcaption aria-hidden="true">命令面板构建</figcaption>
</figure>
<p>构建完成后，会生成 <code>build</code>
文件夹，下次构建时CMake会查看变动的文件然后只编译变动过的代码。</p>
<p>也可以删除该 <code>build</code>
文件夹，使其全部重新构建，会比较费时。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228191156613.png"
alt="build过程" />
<figcaption aria-hidden="true">build过程</figcaption>
</figure>
<p>点击下方的闪电按钮<img
src="https://pic.islet.space/2021/12/image-20211231125445685.png"
alt="烧录按钮" />即可烧录，烧录成功提示如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228221323556.png"
alt="烧录过程" />
<figcaption aria-hidden="true">烧录过程</figcaption>
</figure>
<h1 id="连接wifi">连接WiFi</h1>
<p>下图为使用示例代码更改的项目代码文件内容：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228222302314.png"
alt="项目文件内容示例" />
<figcaption aria-hidden="true">项目文件内容示例</figcaption>
</figure>
<p>利用ESP自带的示例代码<code>station</code>
进行调试和更改，需要注意以下几点：</p>
<ol type="1">
<li><p>不用去更改 <code>isletSpaceIotMain.c</code> 中的
<code>SSID</code> 和 <code>PASS</code> ，只需要在 <code>sdkconfig</code>
文件中进行更改即可（如下图）。</p></li>
<li><p>所有的 WiFi设置参数 都可以在 <code>sdkconfig</code>
文件中进行修改，如需要连接 AP 的
名称和密码，还有自身设备所显示的名称。</p></li>
<li><p>修改文件名之后，需要对两个 <code>CMakeList.txt</code>文件 和
一个<code>Makefile</code>
文件中的项目和文件名进行修改（如下图）。</p></li>
</ol>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228222645861.png"
alt="如果修改代码名称需要修改main文件夹下的CMakeList文件" />
<figcaption
aria-hidden="true">如果修改代码名称需要修改main文件夹下的CMakeList文件</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228222717269.png"
alt="如果修改项目名称需要修改根目录下的CMakeList" />
<figcaption
aria-hidden="true">如果修改项目名称需要修改根目录下的CMakeList</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228222733903.png"
alt="如果修改项目名称需要修改根目录下的Makefile" />
<figcaption
aria-hidden="true">如果修改项目名称需要修改根目录下的Makefile</figcaption>
</figure>
<h2 id="menuconfig">MENUCONFIG</h2>
<p>MENUCONFIG 或者说 <code>sdkconfig</code>
，一个是图形界面的，一个是纯文本形式的。</p>
<p>用menuconfig的话只需要找到下方的齿轮按钮即可。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211231130402110.png"
alt="image-20211231130402110" />
<figcaption aria-hidden="true">image-20211231130402110</figcaption>
</figure>
<p>可以找到WiFi相关的配置位置：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211231130507316.png"
alt="image-20211231130507316" />
<figcaption aria-hidden="true">image-20211231130507316</figcaption>
</figure>
<p>对 <code>sdkconfig</code> 文件中的设备名称进行修改。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228223040901.png"
alt="image-20211228223040901" />
<figcaption aria-hidden="true">image-20211228223040901</figcaption>
</figure>
<p>修改完毕后可以在路由器 AP
的后台查看到已经连接的设备的名称，如下。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228223134009.png"
alt="image-20211228223134009" />
<figcaption aria-hidden="true">image-20211228223134009</figcaption>
</figure>
<h1 id="mqtt协议">MQTT协议</h1>
<p>根据 Espressif 官网的 <a
target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-reference/protocols/mqtt.html">ESP-MQTT</a>
开发文档可知，MQTT 协议支持以下几种形式：</p>
<ul>
<li><p>MQTT over TCP</p></li>
<li><p>MQTT over SSL with mbedtls</p></li>
<li><p>MQTT over Websocket</p></li>
<li><p>MQTT over Websocket Secure.</p></li>
</ul>
<p>各MQTT协议形式（与对应SDK里的 <a
href="##MQTT相关示例代码">MQTT示例代码</a>）及其所使用的端口号不同：</p>
<ul>
<li><code>protocols/mqtt/tcp</code>: MQTT over tcp, default port
1883</li>
<li><code>protocols/mqtt/ssl</code>: MQTT over tcp, default port
8883</li>
<li><code>protocols/mqtt/ssl_psk</code>: MQTT over tcp using pre-shared
keys for authentication, default port 8883</li>
<li><code>protocols/mqtt/ws</code>: MQTT over Websocket, default port
80</li>
<li><code>protocols/mqtt/wss</code>: MQTT over Websocket Secure, default
port 443</li>
</ul>
<h2 id="mqtt事件结构体">MQTT事件结构体</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MQTT event configuration structure</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">esp_mqtt_event_id_t</span> event_id;       <span class="comment">/*!&lt; MQTT event type */</span></span><br><span class="line">    <span class="keyword">esp_mqtt_client_handle_t</span> client;    <span class="comment">/*!&lt; MQTT client handle for this event */</span></span><br><span class="line">    <span class="keyword">void</span> *user_context;                 <span class="comment">/*!&lt; User context passed from MQTT client config */</span></span><br><span class="line">    <span class="keyword">char</span> *data;                         <span class="comment">/*!&lt; Data associated with this event */</span></span><br><span class="line">    <span class="keyword">int</span> data_len;                       <span class="comment">/*!&lt; Length of the data for this event */</span></span><br><span class="line">    <span class="keyword">int</span> total_data_len;                 <span class="comment">/*!&lt; Total length of the data (longer data are supplied with multiple events) */</span></span><br><span class="line">    <span class="keyword">int</span> current_data_offset;            <span class="comment">/*!&lt; Actual offset for the data associated with this event */</span></span><br><span class="line">    <span class="keyword">char</span> *topic;                        <span class="comment">/*!&lt; Topic associated with this event */</span></span><br><span class="line">    <span class="keyword">int</span> topic_len;                      <span class="comment">/*!&lt; Length of the topic for this event associated with this event */</span></span><br><span class="line">    <span class="keyword">int</span> msg_id;                         <span class="comment">/*!&lt; MQTT messaged id of message */</span></span><br><span class="line">    <span class="keyword">int</span> session_present;                <span class="comment">/*!&lt; MQTT session_present flag for connection event */</span></span><br><span class="line">    <span class="keyword">esp_mqtt_error_codes_t</span> *error_handle; <span class="comment">/*!&lt; esp-mqtt error handle including esp-tls errors as well as internal mqtt errors */</span></span><br><span class="line">    <span class="keyword">bool</span> retain;                        <span class="comment">/*!&lt; Retained flag of the message associated with this event */</span></span><br><span class="line">&#125; <span class="keyword">esp_mqtt_event_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">esp_mqtt_event_t</span> *<span class="keyword">esp_mqtt_event_handle_t</span>;</span><br></pre></td></tr></table></figure>
<h2 id="mqtt相关示例代码">MQTT相关示例代码</h2>
<p>了解完官方开发文档中的信息，就可以知道MQTT示例代码里的这些文件夹命名含义，以及自己需要打开哪个示例代码了。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228223617579.png"
alt="image-20211228223617579" />
<figcaption aria-hidden="true">image-20211228223617579</figcaption>
</figure>
<h2 id="menuconfig-1">MENUCONFIG</h2>
<p>MENUCONFIG 页面可以看到MQTT的相关配置信息。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229011902429.png"
alt="image-20211229011902429" />
<figcaption aria-hidden="true">image-20211229011902429</figcaption>
</figure>
<h1 id="mqtt服务器开发">MQTT服务器开发</h1>
<p>自行购买了腾讯云的服务器，然后完成了配置（步骤略），发现自测“主题订阅”不成功。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229033019004.png"
alt="image-20211229033019004" />
<figcaption aria-hidden="true">image-20211229033019004</figcaption>
</figure>
<p>然后刚好发现服务器的 Ubuntu 20 系统使用的防火墙是
<code>iptables</code> ，顺利打开 <code>1883</code> 端口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -A INPUT -p tcp --dport 1883 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>然后查看打开情况。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229032825212.png"
alt="image-20211229032825212" />
<figcaption aria-hidden="true">image-20211229032825212</figcaption>
</figure>
<p>顺便在服务器页面也打开相关配置。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229032753559.png"
alt="image-20211229032753559" />
<figcaption aria-hidden="true">image-20211229032753559</figcaption>
</figure>
<p>最后自测成功：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229032920902.png"
alt="image-20211229032920902" />
<figcaption aria-hidden="true">image-20211229032920902</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229032953396.png"
alt="image-20211229032953396" />
<figcaption aria-hidden="true">image-20211229032953396</figcaption>
</figure>
<h1 id="小程序开发未完">小程序开发（未完）</h1>
<p>因为个人使用腾讯云注册了自己的域名
islet.space，且小程序也属于腾讯自家产品，为了后续开发的兼容性和便利性，就同步参阅了腾讯云的
<a
target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/1081/47684">物联网自主品牌小程序开发文档</a>
。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227202550338.png"
alt="image-20211227202550338" />
<figcaption aria-hidden="true">image-20211227202550338</figcaption>
</figure>
<h2 id="微信开发者工具">微信开发者工具</h2>
<p>微信开发者工具下载页面：https://cloud.tencent.com/document/product/1081/47685</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227202759080.png"
alt="image-20211227202759080" />
<figcaption aria-hidden="true">image-20211227202759080</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227203058077.png"
alt="image-20211227203058077" />
<figcaption aria-hidden="true">image-20211227203058077</figcaption>
</figure>
<h2 id="后台设置">后台设置</h2>
<p><a
target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/1081/34738">物联网开发平台</a></p>
<h1 id="debug">DEBUG</h1>
<h2 id="烧录和调试过程报错">烧录和调试过程报错</h2>
<p>出现这种情况，可能是所选芯片不正确导致。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228214645589.png"
alt="烧录错误提示" />
<figcaption aria-hidden="true">烧录错误提示</figcaption>
</figure>
<h3 id="解决过程">解决过程</h3>
<p>重新选择了芯片，然后将烧录方法改为 <code>UART</code>
，重新烧录即可成功。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228215715687.png"
alt="在插件中选择”扩展设置“" />
<figcaption aria-hidden="true">在插件中选择”扩展设置“</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228215826153.png"
alt="选择需要调试的设备类型" />
<figcaption aria-hidden="true">选择需要调试的设备类型</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228215747432.png"
alt="选择烧录方式" />
<figcaption aria-hidden="true">选择烧录方式</figcaption>
</figure>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228215518196.png"
alt="烧录成功提示" />
<figcaption aria-hidden="true">烧录成功提示</figcaption>
</figure>
<h2 id="头文件查找错误">头文件查找错误</h2>
<p>这个bug始终没有解决，之后再说吧。。。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211228232022467.png"
alt="提示无该文件" />
<figcaption aria-hidden="true">提示无该文件</figcaption>
</figure>
<h2 id="wifi初始化出错">WIFI初始化出错</h2>
<p>将WiFi-station的代码搬到 MQTT-TCP中，发现
<code>wifiStationInit()</code> 函数初始化错误，报错的行数是
<code>117</code> 。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229143428551.png"
alt="wifi初始化函数出错" />
<figcaption aria-hidden="true">wifi初始化函数出错</figcaption>
</figure>
<p>经检查，发现该函数示例代码的一部分，并未改动，且未添加其他自定义的
<code>.h</code> 或 <code>.c</code>
文件进行编译，应该不存在人为修改错误。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229150011594.png"
alt="检查函数定义" />
<figcaption aria-hidden="true">检查函数定义</figcaption>
</figure>
<p>因为仅修改了本 <code>isletSpaceIotMain.c</code>
文件，就在本文件中搜索 <code>esp_event_loop_create_default</code>
关键字，发现在 <code>app_main()</code>
中也有该语句，初步判断可能是两次调用导致错误，就注释了 <code>298</code>
行 和 <code>299</code>
行进行重新编译和烧录，问题解决，设备可以正常连接到路由器。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229150054429.png"
alt="注释重复语句" />
<figcaption aria-hidden="true">注释重复语句</figcaption>
</figure>
<h2 id="mqtt服务器连接错误">MQTT服务器连接错误</h2>
<p>在设备成功接入WiFi后，发现MQTT客户端无法连接至服务器。给出的错误提示是
<code>There are no transports valid</code> ，大致意思即连接不可用。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229150744192.png"
alt="Monitor提示无可用传输" />
<figcaption aria-hidden="true">Monitor提示无可用传输</figcaption>
</figure>
<p>经过检查，发现原来填写在 <code>sdkconfig</code> 文件中的
<code>Broker URL</code> 链接为 <code>https://iot.islet.space</code>
，而实际上，官网给出的配置方式如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229152435708.png"
alt="查看官方URI定义" />
<figcaption aria-hidden="true">查看官方URI定义</figcaption>
</figure>
<p>打开项目配置菜单，修改为 <code>mqtt://iot.islet.space</code> ，并重新
Build 和 Flash。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229151252895.png"
alt="修改URL" />
<figcaption aria-hidden="true">修改URL</figcaption>
</figure>
<p>可以发现错误已解决，设备已经正常连接至服务器。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229152118764.png"
alt="Monitor提示成功" />
<figcaption aria-hidden="true">Monitor提示成功</figcaption>
</figure>
<p>尝试在对应主题下发布信息进行测试：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229152036214.png"
alt="尝试发布信息" />
<figcaption aria-hidden="true">尝试发布信息</figcaption>
</figure>
<p>通过终端Monitor可以观察到，设备正常接收到数据：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229152141547.png"
alt="设备接收成功" />
<figcaption aria-hidden="true">设备接收成功</figcaption>
</figure>
<h2 id="eventhandler未进入">eventHandler未进入</h2>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211229182911935.png"
alt="image-20211229182911935" />
<figcaption aria-hidden="true">image-20211229182911935</figcaption>
</figure>
<h1 id="参考">参考</h1>
<ol type="1">
<li><a
target="_blank" rel="noopener" href="https://blog.csdn.net/xujiuba/article/details/107234040">Mac 安装
CMake 配置及环境配置</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Lc6ausiKvQM">Quick User
Guide for the ESP-IDF VS Code Extension</a></li>
<li><a
target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/get-started/index.html#id2">ESP-IDF
编程指南</a></li>
<li><a
target="_blank" rel="noopener" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/protocols/mqtt.html">ESP-MQTT</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/12/27/Blog/2021-12-27-hexo%E5%BF%85%E8%A3%85%E6%8F%92%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/27/Blog/2021-12-27-hexo%E5%BF%85%E8%A3%85%E6%8F%92%E4%BB%B6/" class="post-title-link" itemprop="url">hexo必装插件及安装脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-27 10:30:00 / Modified: 11:05:03" itemprop="dateCreated datePublished" datetime="2021-12-27T10:30:00+08:00">2021-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>请先确保电脑上已经安装了必须的软件，如 <code>node.js</code> 和
<code>git</code> ，因为日常需要使用
<strong>代码</strong>、<strong>数学公式</strong>、<strong>流程图</strong>、<strong>搜索</strong>
等工具，所以下方的插件安装也主要是与此相关的。</p>
<p><strong>注意</strong>：以下仅适用于 <code>hexo-next</code> 主题。</p>
<h1 id="插件安装">插件安装</h1>
<p>先放一个博客 islet.space 需要使用到的插件，都需要使用
<code>npm</code> 进行安装。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227103125833.png"
alt="本博客使用到的一些插件" />
<figcaption aria-hidden="true">本博客使用到的一些插件</figcaption>
</figure>
<p>将下方这段脚本保存至 <code>hexo_install.sh</code> 文件中，并使用
<code>chmod +x hexo_install.sh</code> 命令为其添加执行权限，并使用
<code>./hexo_install.sh</code> 进行执行即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> uninstall the unnecessary renderer,like marked and kramed</span></span><br><span class="line">sudo npm uninstall hexo-renderer-marked --save</span><br><span class="line">sudo npm uninstall hexo-renderer-kramed --save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> install the necessary plugins <span class="keyword">for</span> hexo</span></span><br><span class="line">sudo npm install @fancyapps/fancybox --save</span><br><span class="line">sudo npm install @fortawesome/fontawesome-free --save</span><br><span class="line">sudo npm install @next-theme/pjax --save</span><br><span class="line">sudo npm install @next-theme/plugins --save</span><br><span class="line">sudo npm install hexo-deployer-git --save</span><br><span class="line">sudo npm install hexo-filter-mermaid-diagrams --save</span><br><span class="line">sudo npm install hexo-generator-searchdb --save</span><br><span class="line">sudo npm install hexo-math --save</span><br><span class="line">sudo npm install hexo-renderer-ejs --save</span><br><span class="line">sudo npm install hexo-renderer-pandoc --save</span><br><span class="line">sudo npm install hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure>
<h1 id="插件启用">插件启用</h1>
<h2 id="pandoc">pandoc</h2>
<p>若要启用pandoc进行渲染，除了之前必须要卸载旧的渲染器（如
<code>marked</code> 和 <code>kramed</code>
外），还需要去github页面下载一个pandoc的渲染器软件并进行安装。</p>
<p><strong>pandoc下载链接</strong>：https://github.com/jgm/pandoc/releases</p>
<h2 id="mermaid">mermaid</h2>
<p>mermaid需要显示的话也需要安装插件，需要在hexo-next主题文件夹下的
<code>_config.yml</code> 文件中进行启用，如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227105005422.png"
alt="mermaid在主题配置文件中的启用" />
<figcaption
aria-hidden="true">mermaid在主题配置文件中的启用</figcaption>
</figure>
<h2 id="latex">latex</h2>
<p>latex数学公式可以由 <code>pandoc</code>
渲染器进行渲染，只需要在hexo-next主题文件夹下的 <code>_config.yml</code>
文件中启用 <code>mathjax</code> ，如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227104717614.png"
alt="数学公式在主题配置文件中的启用" />
<figcaption
aria-hidden="true">数学公式在主题配置文件中的启用</figcaption>
</figure>
<h2 id="search">search</h2>
<p>搜索功能功能不仅需要安装插件，还需要分别在博客文件夹根目录中的
<code>_config.yml</code> 和 hexo-next主题文件夹下的
<code>_config.yml</code> 文件中进行启用，如下：</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227105545754.png"
alt="博客根目录配置文件下的启用" />
<figcaption aria-hidden="true">博客根目录配置文件下的启用</figcaption>
</figure>
<p><strong>注意</strong>：此处的 <code>db.json</code> 需要在
<code>public</code> 文件夹中也有一份的时候启用；如果
<code>db.json</code> 无法使用，则更换为 <code>search.xml</code> 。因为
<code>db.json</code> 或 <code>search.xml</code>
是由插件生成的搜索数据库（可以这么看）。</p>
<figure>
<img src="https://pic.islet.space/2021/12/image-20211227105510478.png"
alt="hexo主题配置文件下的启用" />
<figcaption aria-hidden="true">hexo主题配置文件下的启用</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://islet.space/2021/12/10/Others/2021-12-10-%E9%9D%A2%E8%AF%95%E7%BB%8F%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Liewzheng">
      <meta itemprop="description" content="笔记分享的旮旯孤岛而已">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coder的孤岛">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/10/Others/2021-12-10-%E9%9D%A2%E8%AF%95%E7%BB%8F%E9%AA%8C/" class="post-title-link" itemprop="url">面试经验</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-12-10 08:30:00 / Modified: 22:35:27" itemprop="dateCreated datePublished" datetime="2021-12-10T08:30:00+08:00">2021-12-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Others/" itemprop="url" rel="index"><span itemprop="name">Others</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>因为也是人力资源管理专业出身，所以基于面试者（员工）角度来写这篇文章的时候，其实是左右手互博的感觉。</p>
<p>特殊性说明，本文所描述的岗位背景其实是
<strong>嵌入式DSP裸机软件（驱动）开发</strong> 。</p>
<p><strong>注意</strong>：下面标灰色的部分都是跟HR工作相关的概念，如果看不太懂可以跳过。</p>
<h1 id="面试流程">面试流程</h1>
<p>技术类岗位招聘通常会遇到 <strong>2~3轮面试</strong> 和一次
<strong>HR提供Offer</strong> 的环节，最经典的流程如下：</p>
<pre class="mermaid">graph LR
简历投送 --> ID1((HR面)) --> ID2((项目面)) --> ID3((技术面)) --> 拿Offer</pre>
<h2 id="面试原则">面试原则</h2>
<p>面试者需要在面试过程中适当包装和美化一下自己的工作经历，但是还是需要秉承着相对诚实的原则。</p>
<h3 id="为什么说是相对诚实的原则">为什么说是相对诚实的原则</h3>
<p>你可以说“自己的工作很难但按时完成”，“自己独立完成”，“自主编写代码”
等等他人较难去鉴别的工作，这些都是一个人工作能力不错的表现。但假如把自己没做过的项目放进去，一旦被问技术面的时候问到细节就会露馅。即使面试时没有露馅，工作时露馅了，大概率也会被面试官知道的。</p>
<blockquote>
<p>一个HR有可能是在一家公司专门从事招聘的专员，也有可能是为多家公司做招聘的猎头（专门从事招聘工作的人员，通常是成立一个猎头公司，专门帮其他公司找人才）。一旦技术面的时候夸大自己的工作经验，技术面也会跟HR反馈你的夸大情况，然后你就再也不能通过该猎头或者专员找到其他的工作了，相当于自己白白损失了一个资源口。</p>
</blockquote>
<p>而，嵌入式开发之类的技术岗位（目前）是绝对的版本答案之一，企业通过猎头找人才已经是常态，因此绝对不能有这种作死行为。</p>
<h1 id="hr面">HR面</h1>
<p>由专门/兼职做人力资源的工作人员负责，主要有以下流程：</p>
<ol type="1">
<li><strong>说明招聘信息</strong>（包括所招聘的岗位的基本要求和职责、企业背景、团队情况和项目情况）</li>
<li><strong>在职情况</strong>（千万不能说自己已经离职，否则你就会很掉价，因为HR会觉得你急于找到新工作而压低你的价格——对，就是你的薪酬，你的卖身一个月的价格，当然也有其他方法可以来试着压低你的薪酬，后面再谈）</li>
<li><strong>询问面试者的离职原因</strong>（以判断该员工是否足够稳定，因为薪酬给的更高的员工其离职后给企业造成的离职成本会更高，因此需要该员工足够稳定，后面详谈如何回答离职原因）</li>
<li><strong>询问面试者当前的工作内容</strong>（以确定该员工与所招聘岗位的匹配度，就是说，面试者目前的工作内容如果和他招聘的岗位的工作内容差异太大，他就不会想要再继续去问了，这点应该比较容易懂吧。当然，面试者也不能明明不匹配就瞎说自己会该工作技能，不然就是坑自己也坑别人，这里尽量坦白一些比较好）</li>
<li><strong>询问面试者的求职意向及工作意愿</strong>（就是会问面试者是否愿意从事本岗，一般到这里如果没有回答“愿意”，都没得聊了）</li>
<li><strong>询问面试者期待的薪资及目前薪资</strong>（这一点在招聘网站看可以看到该企业所招聘的岗位能提供的薪资范围，通常也就是个薪酬区间，后面详谈如何回答这部分内容。询问目前薪资就是来确定你的人力成本，进而探寻能够压缩你人力成本空间的可能性的。）</li>
<li><strong>约定下一步面试时间</strong>（这一点应该没什么好说，通常都是电话技术面或视频技术面，确认好双方有空闲的时间）</li>
<li><strong>其他</strong>（会问是不是符合一些硬性条件，比如统招本科（就是学信网能够查到本科学历信息），毕业时间等等）</li>
</ol>
<h2 id="如何回答离职原因">如何回答离职原因</h2>
<p>这一部分看似回答很简单，其实会藏着很多坑。</p>
<blockquote>
<p>首先，要明白为什么需要HR面，为什么面试第一个打来的都是HR，而不是技术员工直接打过来。</p>
<p>从企业运行的角度考虑，每一时刻的企业运作都是需要运行成本的，包括场地成本、设备成本（采购、折旧、损耗等等）、物料成本、人力成本（招聘成本、培训成本、薪酬成本等）等等，就特别多，专人专事这个大家都能理解。</p>
<p>如果一个员工匆忙从一家企业离职，该员工入职前的招聘成本、入职时的培训成本和所需要支付的薪酬成本就会拜拜支出，不能给企业带来盈利，但企业在招聘一个员工前后所支出的成本又是实实在在支出了的，就会造成巨大损失（绿厂就不是，就完全不担心这一点，因为给的太少了（通俗点就是成本不高），打着500强名号，韭菜一茬一茬就随便割，又不会特地挽留员工离职，而且全公司现状都是培训工作做得差，成本就不高）。</p>
<p>（个人觉得）企业当然不能实现所有人终身雇佣，没有新鲜血液是不行的，一定比例的人员流动可以给企业带来活力（这个原因我就不必讲了吧）。HR是学过这些东西的，需要站在企业角度去帮企业考虑招聘什么样子的人会让企业更加稳定，人员稳定（流失减少，并控制在一定范围内）就能帮助企业降低运行成本。</p>
</blockquote>
<p>因此，<mark style="font-weight: 900;">面试者需要体现出自己的稳定性，证明自己是一个不太会轻易离职的人，并说明是一些客观的因素（并不是自己的原因）造成了面试者的离职</mark>。当然，面试者自己在一家企业就业时，也不应该轻易离职，如果是高校毕业者，最好在第一家企业从事1年及以上再离职（建议！）。以下列举了几个较为客观（不能说绝对客观）的原因：</p>
<ul>
<li>办公室氛围太过压抑，缺少团队活动</li>
<li>团队协作性太差</li>
<li>领导风格太过压迫和强势</li>
</ul>
<p>一些员工的主观原因（或者说是令HR反感的原因），这些话是绝对不能说的，绝对禁区！</p>
<ul>
<li>自己不喜欢目前的工作</li>
<li>工作太难了</li>
</ul>
<p>一些员工可以说的话：</p>
<ul>
<li>自己不太挑工作，比较看重团队氛围和工作环境（一般有自信点的HR都会觉得这点没问题，“不太挑工作”的前提是，也得是自己觉得对口的才行，别不对口你不挑个啥。比如，做MCU/ARM/SOC/DSP的相通性较高，说自己不挑可以，但是跨行业太大也敢说自己不挑那就是找事儿）（另，不太挑工作其实对HR来说是个好品质，但自己也得好好掂量掂量自己）</li>
</ul>
<h2 id="如何回答目前薪资及期望薪资">如何回答目前薪资及期望薪资</h2>
<blockquote>
<p>HR之所以需要问你的目前薪资，不仅是了解本行业或者某个岗位在某个地区的大致薪酬情况（以对比公司招聘员工的薪酬竞争优势），也是在探寻面试者的薪酬上涨或可以压缩的空间。</p>
</blockquote>
<p>面试者首先需要了解（或者说准备好）几点信息：</p>
<ol type="1">
<li>该行业该岗位在某个地区的 <strong>普遍薪资范围</strong>
是如何（当然不能拿最高薪资来当做普遍薪资，得看自己的能力和对应岗位的工作难度）</li>
<li>所面试的公司提供的薪酬范围</li>
<li>自己所期待的薪资底线</li>
<li>自己目前薪资</li>
</ol>
<p>首先是，如果HR问目前薪资。面试者可以适当夸大自己目前的薪资，税后薪资可能都很低，可以说税前，多说几千没关系，不要与对方公司提供的薪酬底线相差太大即可。如果HR说自己公司有30%或者40%的涨薪幅度限制，那么可以放心，该HR觉得你岗位匹配度较高，只是想通过这个来压一压你的成本而已。</p>
<p>此时，你可以说自己期待在某个地区某个岗位的薪酬底线，低于这个就不行。HR态度一般都会更为委婉些。</p>
<p>如果你通过面试，到了拿offer的环节，HR还是会再跟你谈一遍。豪气的公司（一种薪酬策略，用高于行业平均水平的薪资招聘员工，但也要求更高）一般开价都会比你要求的更高，但这是后面的事情了。</p>
<h2 id="hr面结束之后">HR面结束之后</h2>
<p>（如果你对HR提供的岗位较为满意，接收了技术面/项目面的预约）需要记住一些最基础、关键、有用的信息。这些HR面时都已经说明了，最好是拿个小本本记好，这是对面试企业的一个尊重，也是为了防止后面出现的一些莫名其妙的（跟你面试岗位无关的）问题把你问倒。</p>
<ol type="1">
<li><strong>岗位工作地点</strong>（很多大企业全国都有研究中心和技术中心，可以选择的，看对方给你提供的是哪个城市的就业岗位）</li>
<li><strong>对方面试官的名字</strong>（至少记住姓啥）</li>
<li><strong>对方的公司名称及背景</strong>（比如是帮别人做外包的还是做自研的，有没有上市或者有没有股权激励，成立多久了之类的）</li>
<li><strong>岗位基本信息</strong> （任职要求和工作职责等）</li>
</ol>
<h1 id="项目面和技术面">项目面和技术面</h1>
<p>普遍情况下，二轮/三轮面试都会问你一些技术和项目上的东西，根据所闻内容的不同，将其分别称呼为
<strong>技术面</strong> 和 <strong>项目面</strong>。</p>
<p>有些公司会将这两轮分开，面试的先后顺序不一，总得占比是项目经历会问得更多一些，技术面的占比较少。</p>
<p>有些公司也会将项目面和技术面合在一起（就是同一次面试里就有技术面和项目面），夹杂交替着问。</p>
<h2 id="项目面">项目面</h2>
<p>主要是问你从事（主要负责或者协助负责）过的一些项目/经历，了解你对研发的产品、芯片、硬件、软件、工具、设备的认知。项目面会有三种类型的提问：</p>
<ol type="1">
<li>工具认知提问。了解面试者对工具使用的经验。</li>
<li>问题解决提问。了解面试者对一些解决问题的方法和经历。</li>
<li>情景假设提问。考验面试者解决问题的思路。</li>
</ol>
<p><strong>项目面的面试形式：</strong>一般都是电话提问和视频提问。</p>
<p><strong>面试时长</strong>：单轮面试时间都是在15分钟以上，最长30分钟左右。</p>
<h3 id="工具认知提问">工具认知提问</h3>
<p>就是会问你开发过程中遇到的一些工具模块是如何使用的，一些算法或者逻辑的原理。这部分比较简单，都是经验而已。</p>
<p>例如，面试官问我ADC的使用，我就如实回答我是如何用ADC的，以及我对ADC模块的认知。</p>
<h3 id="问题解决提问">问题解决提问</h3>
<blockquote>
<p>有很大概率（不一定是所有公司都会问的），会问你一些“发现问题解决问题”的经验。这里面试官主要是想知道以下几点情况：</p>
<ol type="1">
<li><strong>面试者对工作问题的解决思路</strong>。是否足够清晰，有什么角度可以去考虑，需要面试者自己去总结，然后可以清晰地向他人阐述。</li>
<li><strong>面试者在解决问题时的耐心</strong>。面试者需要介绍一个以上的案例，向面试官说明问题现象，自己的思考方式、检查方法、解决方法、过程
和 结果 等等。</li>
<li><strong>面试者的经验</strong>。你能说出自己在遇到一些问题（比如调试问题）时的解决思路，或者看待问题（较为全面）的角度时，就说明了你已经具有足够经验了。</li>
</ol>
</blockquote>
<p>如果面试官问你“发现问题解决问题”的经验，你回答自己不知道，不太记得，忘记了这些话，就妥妥失败了。</p>
<p>因为这些工作问题的发现、解决和记录工作，在日常工作过程中其实都是可以稍微花点时间去完成的（这并不难，只是你有没有耐心而已），如果面试者自己没有做这部分
<strong>经验积累工作</strong>，那就很吃亏，大部分人都有相关的工作经验，自己不会去
<strong>总结</strong> 而已。</p>
<h3 id="情景假设提问">情景假设提问</h3>
<p>面试官可能会抛出情景题，例如问你给你一个芯片，2周之内完成开发，你需要怎么准备，有什么计划。其实就是一个经验问题，或者思路问题。回答方法我就不详细说了。</p>
<h2 id="技术面">技术面</h2>
<p>技术面，就是会问一些项目之下的一些底层技术问题，一般来说都不会太难，也偶尔会有一些面试官问的问题比较偏门（开发过程中较难出现的问题）。例如，我经历过的偏门提问，会问C语言的野指针出现和排查，C++的继承概念等等（这些是我项目上比较难涉及到的）。</p>
<p>但大部分情况下，这些技术提问，都是提问一些你做过的东西，比如你做过某种通信协议的开发，请你表述以下该协议的相关内容（例如，时序、通信格式（通信起始和结束的变化）、电气特性（电平、电压范围）等）。这些其实也是经验的一部分，真的做过的话就应该自己做做笔记，一定会有点印象的，不应该去抱佛脚。</p>
<p><strong>面试原则</strong>：问到你会的，你就自信回答。问到偏门的，开发过程中较少出现/遇到和使用的，你就如实回答就好了，不要不懂装懂。</p>
<p><strong>技术面的面试形式：</strong>可能是让你线上答卷，现场答卷，也可以是电话提问、视频提问。</p>
<p><strong>面试时长</strong>：同项目面，也可能夹杂着在项目面中间进行提问。</p>
<h1 id="拿offer">拿Offer</h1>
<p>拿到Offer后，你可能需要向HR详细确认的信息：</p>
<ol type="1">
<li>每天上班时间，从几点到几点</li>
<li>每个月的薪资计算时间是从几号到几号</li>
<li>每个月的薪资发放日期、时间</li>
<li>是否双休、年假情况</li>
<li>每天的加班强度、每个月的加班强度、加班薪资等</li>
<li>每年发放多少个月的薪资（就是年终奖发放情况，好一点的是15薪以上，最基本的13薪）</li>
<li><strong>每个（税前）月薪资是多少</strong>（可能需要关心一下社保和公积金的缴纳情况等）</li>
</ol>
<p>基本信息了解完毕之后，需要自己有意识地去提问的一些问题：</p>
<ol type="1">
<li>近期可以签订合同的最晚时间（合同期限一般都是3年，这个就比较不用担心）</li>
<li>期望入职时间（自己期望什么时候入职，对方期望最晚什么时候入职，可否协调程度）</li>
<li>涨薪计划（入职后会有哪些涨薪激励计划，或之前其他股权发放啊、年终奖增长等等）</li>
<li>绩效计划（可能这时候不太愿意说，但是入职后可以去了解）</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备19004822号 </a>
  </div>

<div class="copyright">
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liewzheng</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.12.0/dist/mermaid.min.js","integrity":"sha256-0dD7vUjUCTGJjeLnPotQQJIcSzug5fO6WDMYYyNIX4c="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":"enable","tags":"all","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
